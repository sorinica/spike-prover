<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>term_orderings.subterm_dp</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library term_orderings.subterm_dp</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "../basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "../list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "../term_algebra".<br/>

<br/>
</div>

<div class="doc">
<a name="lab100"></a><h1 class="section">Termination of rewriting</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Wellfounded</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Recdef</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">weaved_relation</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equational_theory_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">dp</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab101"></a><h2 class="section">Module Type Termin, for termination of rewriting systems.</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">MakeSubDP</span> (<span class="id" type="var">E</span> : <span class="id" type="var">EqTh</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">Dp</span> := <span class="id" type="var">dp.MakeDP</span> (<span class="id" type="var">E</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">Dp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">E</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Subterm</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">CD</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">constructor</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>} + {<span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R_red</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">FB</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">one_step</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R_red</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">inject</span> : <span class="id" type="var">nat</span> -&gt; <span class="id" type="var">variable</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">inject_inv</span> : <span class="id" type="var">variable</span> -&gt; <span class="id" type="var">nat</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Hinject1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">inject</span> (<span class="id" type="var">inject_inv</span> <span class="id" type="var">v</span>) = <span class="id" type="var">v</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Hinject2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>, <span class="id" type="var">inject_inv</span> (<span class="id" type="var">inject</span> <span class="id" type="var">n</span>) = <span class="id" type="var">n</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">cdp</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">cdp_in_dpR</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">ddp</span> <span class="id" type="var">R</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">P</span> : <span class="id" type="var">F.Symb.A</span> -&gt; <span class="id" type="var">nat</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">u0</span> : <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">v0</span> : <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">u0_diff_v0</span> : <span class="id" type="var">u0</span> &lt;&gt; <span class="id" type="var">v0</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">cdp_uv0</span> : <span class="id" type="var">cdp</span> <span class="id" type="var">v0</span> <span class="id" type="var">u0</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">P_ok</span> : <span class="id" type="keyword">match</span> <span class="id" type="var">v0</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">F.arity</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Free</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; <span class="id" type="var">n</span> | <span class="id" type="var">_</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; 2 <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">projection</span> (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> (<span class="id" type="var">P</span> <span class="id" type="var">f</span>)  <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">tf</span> =&gt; <span class="id" type="var">tf</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span>  <span class="id" type="var">uv0_strict</span> : <span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">v0</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">u0</span>).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">dp'</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> := <br/>
&nbsp;&nbsp;<span class="id" type="var">Dp'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; (<span class="id" type="var">u</span>,v) &lt;&gt; (<span class="id" type="var">u0</span>,v0) -&gt; <span class="id" type="var">dp'</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">dp0</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> := <br/>
&nbsp;&nbsp;<span class="id" type="var">Dp0</span> : <span class="id" type="var">dp0</span> <span class="id" type="var">v0</span> <span class="id" type="var">u0</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Rdp'</span> := <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">dp'</span>) <span class="id" type="var">R</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Rdp0</span> := <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">dp0</span>) <span class="id" type="var">R</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Rcdp</span> := <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">cdp</span>) <span class="id" type="var">R</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">R1</span> := <span class="id" type="var">compose_rel</span> (<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span>) <span class="id" type="var">Rdp0</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">R1'</span> := <span class="id" type="var">compose_rel</span> <span class="id" type="var">Rdp0</span> (<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subst_projection</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">projection</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">projection</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">projection</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span> (<span class="id" type="var">P</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>) (<span class="id" type="var">P</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti_sigma</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> (<span class="id" type="var">P</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> (<span class="id" type="var">P</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">projection_is_subterm</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,  <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">F.arity</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">AC</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Free</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">direct_subterm</span> (<span class="id" type="var">projection</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">K</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">K3</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">g1</span> <span class="id" type="var">k1</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">J1</span> <span class="id" type="var">J2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K4</span> := <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">cdp_uv0</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K4</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K4</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">J1</span> <span class="id" type="var">J2</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">J1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P_ok</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">F.arity</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ | | <span class="id" type="var">n</span>].<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u1</span> [ | <span class="id" type="var">u2</span> [ | <span class="id" type="var">u3</span> <span class="id" type="var">l</span>]]]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">P</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ | [ | <span class="id" type="var">p</span>]]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Abs</span> := <span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P_ok</span>)); <span class="id" type="tactic">inversion</span> <span class="id" type="var">Abs</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u1</span> [ | <span class="id" type="var">u2</span> [ | <span class="id" type="var">u3</span> <span class="id" type="var">l</span>]]]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">P</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ | [ | <span class="id" type="var">p</span>]]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Abs</span> := <span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P_ok</span>)); <span class="id" type="tactic">inversion</span> <span class="id" type="var">Abs</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P_ok</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">P_ok</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">set</span> (<span class="id" type="var">k</span> := <span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k1</span>); <span class="id" type="var">clearbody</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">set</span> (<span class="id" type="var">p</span> := <span class="id" type="var">P</span> <span class="id" type="var">f</span>); <span class="id" type="var">clearbody</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">p</span> <span class="id" type="var">k</span>; <span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Abs</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Abs</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">LL</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">projection_is_subterm</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span> (<span class="id" type="var">lt_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">LL</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">p</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">s_in_l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">lt_irrefl</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_dps</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">Rcdp</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;-&gt; <span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">Rdp0</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H''</span> <span class="id" type="var">H3</span> <span class="id" type="var">H'''</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">t2</span> <span class="id" type="var">u0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">u0</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u0</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u0</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">t1</span> <span class="id" type="var">v0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">v0</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_v0</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_v0</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Dp0</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Dp'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t1_diff_v0</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Dp'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t2_diff_u0</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H''</span> <span class="id" type="var">H3</span> <span class="id" type="var">H'''</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> <span class="id" type="var">u</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H''</span> <span class="id" type="var">H3</span> <span class="id" type="var">H'''</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> <span class="id" type="var">u</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp0_is_dp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">Rdp0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">Rcdp</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp'_is_dp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">Rdp'</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">Rcdp</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">extract_dp</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">f</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">s</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">v</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">u</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> = <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">connect_extract_dp_aux</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">Rcdp</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Rcdp</span> <span class="id" type="var">sn</span> <span class="id" type="var">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">extract_dp</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">extract_dp</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">are_connected</span> <span class="id" type="var">cdp</span> <span class="id" type="var">R</span> (<span class="id" type="var">un</span>,vn) (<span class="id" type="var">u1</span>,v1).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">H1</span> <span class="id" type="var">Hn</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">extract_dp</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">D1</span> [<span class="id" type="var">f</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">sigma</span> [<span class="id" type="var">K1</span> [<span class="id" type="var">J1</span> [<span class="id" type="var">L1</span> <span class="id" type="var">E1</span>]]]]]]]] [<span class="id" type="var">Dn</span> [<span class="id" type="var">g</span> [<span class="id" type="var">k1</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">tau</span> [<span class="id" type="var">K2</span> [<span class="id" type="var">J2</span> [<span class="id" type="var">L2</span> <span class="id" type="var">E2</span>]]]]]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="var">exists</span> <span class="id" type="var">tau</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">J2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">E2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">connect_extract_dp</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">tn</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">Rcdp</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rcdp</span> <span class="id" type="var">tn</span> <span class="id" type="var">s1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Rcdp</span> <span class="id" type="var">sn</span> <span class="id" type="var">tn</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">extract_dp</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">extract_dp</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">tn</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">are_connected</span> <span class="id" type="var">cdp</span> <span class="id" type="var">R</span>) (<span class="id" type="var">un</span>,vn) (<span class="id" type="var">u1</span>,v1).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">tn</span> <span class="id" type="var">H1</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">tn'</span> <span class="id" type="var">s1'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span> <span class="id" type="var">tn</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">H1</span> <span class="id" type="var">Hn</span> <span class="id" type="var">E1</span> <span class="id" type="var">En</span>;<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">connect_extract_dp_aux</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">sn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">s1'</span> <span class="id" type="var">tn'</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">tn</span> <span class="id" type="var">s1</span> <span class="id" type="var">H</span> | <span class="id" type="var">tn</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H_save</span> := <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">tn'</span> <span class="id" type="var">H21</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> <span class="id" type="var">u2</span> <span class="id" type="var">sigma2</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">Dp1</span> <span class="id" type="var">Dpn</span> <span class="id" type="var">E1</span> <span class="id" type="var">En</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E2</span> : <span class="id" type="var">extract_dp</span> <span class="id" type="var">u2</span> <span class="id" type="var">v2</span> <span class="id" type="var">tn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">f</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">En</span>, <span class="id" type="var">Dpn</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E1</span>, <span class="id" type="var">Dp1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">u2</span>,v2); <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">connect_extract_dp_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E2</span> <span class="id" type="var">En</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">connect_extract_dp_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E1</span> <span class="id" type="var">E2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">t1</span> <span class="id" type="var">un</span> <span class="id" type="var">vn</span> <span class="id" type="var">sn</span> <span class="id" type="var">Dp1</span> <span class="id" type="var">Dpn</span> <span class="id" type="var">E1</span> <span class="id" type="var">En</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1_save</span> := <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">tn'</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">tn'</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> <span class="id" type="var">u</span> <span class="id" type="var">sigma</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E</span> : <span class="id" type="var">extract_dp</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">tn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">f</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">u</span>,v).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">connect_extract_dp_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span> <span class="id" type="var">En</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHH2</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">t1</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">tn</span> <span class="id" type="var">Dp1</span> <span class="id" type="var">H1_save</span> <span class="id" type="var">E1</span> <span class="id" type="var">E</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">comp</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> -&gt; <span class="id" type="var">nat</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">comp_ok</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span>, <span class="id" type="var">are_connected</span> <span class="id" type="var">cdp</span> <span class="id" type="var">R</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span> -&gt; <span class="id" type="var">comp</span> <span class="id" type="var">uv</span> &lt;= <span class="id" type="var">comp</span> <span class="id" type="var">uv'</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">connect_approx</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span> := <span class="id" type="var">comp</span> <span class="id" type="var">uv</span> &lt;= <span class="id" type="var">comp</span> <span class="id" type="var">uv'</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">approx_dec</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span>, {<span class="id" type="var">connect_approx</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span>}+{~connect_approx <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">connect_approx</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_lt_dec</span> (<span class="id" type="var">comp</span> <span class="id" type="var">uv</span>) (<span class="id" type="var">comp</span> <span class="id" type="var">uv'</span>)).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">gt_not_le</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">approx_is_approx</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span>, ~connect_approx <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span> -&gt; ~ <span class="id" type="var">trans_clos</span> (<span class="id" type="var">are_connected</span> <span class="id" type="var">cdp</span> <span class="id" type="var">R</span>) <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">connect_approx</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">H1</span> | <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span> <span class="id" type="var">H1</span> <span class="id" type="var">Hn</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comp_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">comp</span> <span class="id" type="var">y</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comp_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">between_dp0_aux1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span>,  <br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t3</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">dp'</span>) <span class="id" type="var">R</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t5</span> <span class="id" type="var">t4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t6</span> <span class="id" type="var">t5</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">extract_dp</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">are_connected</span> <span class="id" type="var">cdp</span> <span class="id" type="var">R</span>) (<span class="id" type="var">u0</span>,v0) (<span class="id" type="var">u</span>,v) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">are_connected</span> <span class="id" type="var">cdp</span> <span class="id" type="var">R</span>) (<span class="id" type="var">u</span>,v) (<span class="id" type="var">u0</span>,v0).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span> <span class="id" type="var">H43</span> <span class="id" type="var">H54</span> <span class="id" type="var">H65</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">E</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E1</span> : <span class="id" type="var">extract_dp</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H21</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">v1</span> <span class="id" type="var">Hl21</span> <span class="id" type="var">Hdp2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> <span class="id" type="var">u2</span> <span class="id" type="var">sigma2</span> <span class="id" type="var">Hdp2'</span> <span class="id" type="var">K2</span> <span class="id" type="var">J2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hdp2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp2'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">v2</span> <span class="id" type="var">u2</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">f</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E6</span> : <span class="id" type="var">extract_dp</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span> <span class="id" type="var">t6</span> <span class="id" type="var">t5</span>).<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H65</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">v1</span> <span class="id" type="var">Hl21</span> <span class="id" type="var">Hdp2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> <span class="id" type="var">u2</span> <span class="id" type="var">sigma2</span> <span class="id" type="var">Hdp2'</span> <span class="id" type="var">K2</span> <span class="id" type="var">J2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hdp2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp2'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">v2</span> <span class="id" type="var">u2</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">f</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">connect_extract_dp</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span> <span class="id" type="var">t6</span> <span class="id" type="var">t5</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dp'_is_dp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">dp'</span>) <span class="id" type="var">R</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">dp'_is_dp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dp0_is_dp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">connect_extract_dp</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dp0_is_dp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">dp'</span>) <span class="id" type="var">R</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">dp'_is_dp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dp'_is_dp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">projection_one_step_list</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">projection</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">projection</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">h</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> (<span class="id" type="var">P</span> <span class="id" type="var">h</span>) <span class="id" type="var">l4</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l4</span> (<span class="id" type="var">P</span> <span class="id" type="var">h</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s4</span> <span class="id" type="var">H4</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">K</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l41</span> [<span class="id" type="var">l42</span> [<span class="id" type="var">L4</span> <span class="id" type="var">H4'</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span> <span class="id" type="var">H4</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> (<span class="id" type="var">P</span> <span class="id" type="var">h</span>) <span class="id" type="var">l3</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l3</span> (<span class="id" type="var">P</span> <span class="id" type="var">h</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s3</span> <span class="id" type="var">H3</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">K</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l31</span> [<span class="id" type="var">l32</span> [<span class="id" type="var">L3</span> <span class="id" type="var">H3'</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L4</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L3</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">refl_trans_clos_one_step_list_refl_trans_clos_one_step</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">sym_eq</span> <span class="id" type="var">L3</span>) <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H3</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">length</span> <span class="id" type="var">l41</span> &lt; <span class="id" type="var">length</span> <span class="id" type="var">l41</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_irrefl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> : <span class="id" type="var">length</span> <span class="id" type="var">l4</span> = <span class="id" type="var">length</span> <span class="id" type="var">l3</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_length_eq</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="var">nth_error_none</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L4</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l4</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> (<span class="id" type="var">l41</span> ++ <span class="id" type="var">s4</span> :: <span class="id" type="var">l42</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_r</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H4</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> (<span class="id" type="var">P</span> <span class="id" type="var">h</span>) <span class="id" type="var">l3</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l3</span> (<span class="id" type="var">P</span> <span class="id" type="var">h</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s3</span> <span class="id" type="var">H3</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">K</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l31</span> [<span class="id" type="var">l32</span> [<span class="id" type="var">L3</span> <span class="id" type="var">H3'</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">length</span> <span class="id" type="var">l31</span> &lt; <span class="id" type="var">length</span> <span class="id" type="var">l31</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_irrefl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> : <span class="id" type="var">length</span> <span class="id" type="var">l4</span> = <span class="id" type="var">length</span> <span class="id" type="var">l3</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_length_eq</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="var">nth_error_none</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H4</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">L</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l3</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> (<span class="id" type="var">l31</span> ++ <span class="id" type="var">s3</span> :: <span class="id" type="var">l32</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_r</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H3</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">between_dp0_aux2</span> :<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u0</span>,v0) (<span class="id" type="var">u</span>,v) -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u</span>,v) (<span class="id" type="var">u0</span>,v0) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">v</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">u</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span>,  <br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t3</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp'</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t5</span> <span class="id" type="var">t4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t6</span> <span class="id" type="var">t5</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t4</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t3</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hdp</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span> <span class="id" type="var">H43</span> <span class="id" type="var">H54</span> <span class="id" type="var">H65</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H43</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">h</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">v3</span> <span class="id" type="var">Hl43</span> <span class="id" type="var">Hdp4</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v4</span> <span class="id" type="var">u4</span> <span class="id" type="var">sigma4</span> <span class="id" type="var">Hdp4'</span> <span class="id" type="var">K4</span> <span class="id" type="var">J4</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hdp4</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp4'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v4'</span> <span class="id" type="var">u4'</span> <span class="id" type="var">Hdp4''</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">u4'</span> <span class="id" type="var">v4'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E4</span> : <span class="id" type="var">extract_dp</span> <span class="id" type="var">u4</span> <span class="id" type="var">v4</span> <span class="id" type="var">t4</span> (<span class="id" type="var">Term</span> <span class="id" type="var">h</span> <span class="id" type="var">l3</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">extract_dp</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">h</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l4</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma4</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">between_dp0_aux1</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">h</span> <span class="id" type="var">l3</span>) <span class="id" type="var">t4</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span> <span class="id" type="var">H43</span> <span class="id" type="var">H54</span> <span class="id" type="var">H65</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E4</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">projection</span> (<span class="id" type="var">Term</span> <span class="id" type="var">h</span> <span class="id" type="var">l4</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">J4</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hdp4'''</span> := <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hdp4''</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Hdp4'''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Hdp4'''</span> <span class="id" type="var">Sub4</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp4'''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u4'</span> <span class="id" type="var">r4</span> <span class="id" type="var">p4</span> <span class="id" type="var">g4</span> <span class="id" type="var">k4</span> <span class="id" type="var">R4</span> <span class="id" type="var">Sub4'</span> <span class="id" type="var">D4</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x4</span> | <span class="id" type="var">f4</span> <span class="id" type="var">ll4</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R4</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">subst_projection</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_subterm_subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K1</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">u</span> <span class="id" type="var">v</span>] | <span class="id" type="var">uv0</span> <span class="id" type="var">uv4</span> <span class="id" type="var">K1'</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">uv0</span> <span class="id" type="var">uv4</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K2</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">u</span> <span class="id" type="var">v</span>] | <span class="id" type="var">uv4</span> <span class="id" type="var">uv0</span> <span class="id" type="var">K2'</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">uv0</span> <span class="id" type="var">uv4</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hdp</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">approx_dec</span> (<span class="id" type="var">u0</span>, <span class="id" type="var">v0</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f4</span> <span class="id" type="var">ll4</span>, <span class="id" type="var">Term</span> <span class="id" type="var">g4</span> <span class="id" type="var">k4</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">C4</span> | <span class="id" type="var">notC4</span>].<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">approx_is_approx</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">notC4</span> <span class="id" type="var">K1'</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">approx_dec</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f4</span> <span class="id" type="var">ll4</span>, <span class="id" type="var">Term</span> <span class="id" type="var">g4</span> <span class="id" type="var">k4</span>) (<span class="id" type="var">u0</span>, <span class="id" type="var">v0</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">C4</span> | <span class="id" type="var">notC4</span>].<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">approx_is_approx</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">notC4</span> <span class="id" type="var">K2'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">K</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">projection_one_step_list</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">between_dp0_aux3</span> :<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u0</span>,v0) (<span class="id" type="var">u</span>,v) -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u</span>,v) (<span class="id" type="var">u0</span>,v0) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">v</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">u</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span>,  <br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t3</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t5</span> <span class="id" type="var">t4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t6</span> <span class="id" type="var">t5</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t4</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t3</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hdp</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span> <span class="id" type="var">H43</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H43</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">u4</span> <span class="id" type="var">u3</span> <span class="id" type="var">H43'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H43</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u3</span> <span class="id" type="var">u4</span>; <span class="id" type="var">revert</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H43'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t4</span> <span class="id" type="var">t3</span> <span class="id" type="var">H43</span> | <span class="id" type="var">t4</span> <span class="id" type="var">t</span> <span class="id" type="var">t3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H3</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span> <span class="id" type="var">H54</span> <span class="id" type="var">H65</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">between_dp0_aux2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">projection</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">between_dp0_aux2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHH3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t5</span> <span class="id" type="var">t6</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t4</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">between_dp0</span> :<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u0</span>,v0) (<span class="id" type="var">u</span>,v) -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u</span>,v) (<span class="id" type="var">u0</span>,v0) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">v</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">u</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span>,  <br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">t3</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Rdp0</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t3</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hdp</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span> <span class="id" type="var">H43</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">between_dp0_aux3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp0_decreases</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">Rdp0</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H21</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H21</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">v1</span> <span class="id" type="var">Hl21</span> <span class="id" type="var">Hdp2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> <span class="id" type="var">u2</span> <span class="id" type="var">sigma2</span> <span class="id" type="var">Hdp2'</span> <span class="id" type="var">K2</span> <span class="id" type="var">J2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hdp2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hdp2'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">v2</span> <span class="id" type="var">u2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">dp_uv0</span> := <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">cdp_uv0</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">dp_uv0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">dp_uv0</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">dp_uv0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u0'</span> <span class="id" type="var">r0</span> <span class="id" type="var">p0</span> <span class="id" type="var">g0</span> <span class="id" type="var">k0</span> <span class="id" type="var">H1</span> <span class="id" type="var">H3</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x0</span> | <span class="id" type="var">f0</span> <span class="id" type="var">l0</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sub</span> := <span class="id" type="var">projection_one_step_list</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hl21</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sub'</span> : <span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">projection</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g0</span> <span class="id" type="var">k0</span>))) (<span class="id" type="var">projection</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>))).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">J2</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">subst_projection</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">uv0_strict</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> [<span class="id" type="var">Sub''</span> | <span class="id" type="var">Sub''</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_apply_subst</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x2</span> | <span class="id" type="var">g2</span> <span class="id" type="var">k2</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Sub</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H6</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">projection</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">K</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">sub_projection</span> : <br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u0</span>,v0) (<span class="id" type="var">u</span>,v) -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u</span>,v) (<span class="id" type="var">u0</span>,v0) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">v</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">u</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span>, <span class="id" type="var">R1</span> <span class="id" type="var">t3</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">R1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hdp</span> <span class="id" type="var">t1</span> <span class="id" type="var">t3</span> <span class="id" type="var">t5</span> <span class="id" type="var">H53</span> <span class="id" type="var">H31</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H31</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t3'</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1'</span> <span class="id" type="var">H32</span> <span class="id" type="var">H21</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1'</span> <span class="id" type="var">t3'</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H53</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t5'</span> <span class="id" type="var">t4</span> <span class="id" type="var">t3'</span> <span class="id" type="var">H54</span> <span class="id" type="var">H43</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t3'</span> <span class="id" type="var">t5'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">B21</span> := <span class="id" type="var">dp0_decreases</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H21</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">B32</span> := <span class="id" type="var">between_dp0</span> <span class="id" type="var">Hdp</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> <span class="id" type="var">H21</span> <span class="id" type="var">H32</span> <span class="id" type="var">H43</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">B32</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> | <span class="id" type="var">t4'</span> <span class="id" type="var">t3'</span> <span class="id" type="var">B32'</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">projection</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_R_acc_dp</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">Rcdp</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R</span>)) <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_in_dpR</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_acc_ddp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_R_acc_dp_sub</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Rcdp</span> (<span class="id" type="var">trans_clos</span> <span class="id" type="var">direct_subterm</span>)) <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H4</span> := <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H4</span> <span class="id" type="var">Sub</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">subterm_subterm</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H4</span> | <span class="id" type="var">H4</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">direct_subterm</span>.<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instantiated_subterm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">direct_subterm</span>.<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instantiated_subterm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_trans</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_with_subterm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Rcdp_min</span> := <span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) <span class="id" type="var">Rcdp</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Rdp_min'</span> := <span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) <span class="id" type="var">Rdp'</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Rdp0_min</span> := <span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) <span class="id" type="var">Rdp0</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp_subterm_criterion</span>: <br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">v0</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span>  =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">F.arity</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">AC</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Free</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u0</span>,v0) (<span class="id" type="var">u</span>,v) -&gt; <span class="id" type="var">connect_approx</span> (<span class="id" type="var">u</span>,v) (<span class="id" type="var">u0</span>,v0) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">v</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">u</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> <span class="id" type="var">Rdp_min'</span> -&gt; <span class="id" type="var">well_founded</span> <span class="id" type="var">Rcdp_min</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">L</span> <span class="id" type="var">Hdp</span> <span class="id" type="var">W'</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_founded_ind</span> <span class="id" type="var">W'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">H</span> [<span class="id" type="var">Ms</span> <span class="id" type="var">Mt</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_dps</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">split</span> ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Rdp_min'</span> <span class="id" type="var">Rdp0_min</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">K</span> [<span class="id" type="var">MW1</span> <span class="id" type="var">MW2</span>]]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_dps</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K</span> | <span class="id" type="var">K</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_union_weak</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_inv_im2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">term</span> (<span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>)) <span class="id" type="var">projection</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">H32</span> <span class="id" type="var">H21</span> <span class="id" type="var">H10</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">B</span> := <span class="id" type="var">between_dp0</span> <span class="id" type="var">Hdp</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H0</span> : <span class="id" type="var">exists</span> <span class="id" type="var">a0</span>, <span class="id" type="var">Rdp0</span> <span class="id" type="var">a1</span> <span class="id" type="var">a0</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H10</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> | <span class="id" type="var">a1'</span> <span class="id" type="var">b1</span> <span class="id" type="var">K10</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H10</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K10</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1'</span> <span class="id" type="var">b1'</span> <span class="id" type="var">H10</span> | <span class="id" type="var">a1'</span> <span class="id" type="var">b1</span> <span class="id" type="var">c1'</span> <span class="id" type="var">J10</span> <span class="id" type="var">K0</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K10</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a1'</span> <span class="id" type="var">b1'</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H10</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1'</span> <span class="id" type="var">b1</span> <span class="id" type="var">c1'</span> <span class="id" type="var">K1</span> <span class="id" type="var">K10</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H10</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a1'</span> <span class="id" type="var">c1'</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a1'</span> <span class="id" type="var">c1'</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">J10</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1'</span> <span class="id" type="var">b1'</span> <span class="id" type="var">c1</span> <span class="id" type="var">J1</span> <span class="id" type="var">J0</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">J10</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a1'</span> <span class="id" type="var">c1</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b1'</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">J1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a0</span> <span class="id" type="var">H0</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H21</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a2'</span> <span class="id" type="var">b2</span> <span class="id" type="var">c2'</span> <span class="id" type="var">K2</span> <span class="id" type="var">K1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H21</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a2'</span> <span class="id" type="var">c2'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K1'</span> : <span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">Rdp'</span> <span class="id" type="var">b2</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Rdp_min'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">K</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K2'</span> := <span class="id" type="var">proj1</span> <span class="id" type="var">K2</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">B'</span> := <span class="id" type="var">B</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H0</span> <span class="id" type="var">K1'</span> <span class="id" type="var">K2'</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">B'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> <span class="id" type="var">J1</span> <span class="id" type="var">J2</span> | <span class="id" type="var">pb2</span> <span class="id" type="var">pa1</span> <span class="id" type="var">B''</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dp0_decreases</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">pb2</span> <span class="id" type="var">pa1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">projection</span> <span class="id" type="var">b2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dp0_decreases</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_trans</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_with_subterm</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_var</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ms</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">projection_is_subterm</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H4</span> := <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">cdp_uv0</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H4</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">W'</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Subterm</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp_subterm_criterion_gen</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">v</span> : <span class="id" type="var">variable</span>) (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>), ~ <span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l0</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">cdp</span> <span class="id" type="var">cdp'</span>: <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> : <span class="id" type="var">term</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">ddp</span> <span class="id" type="var">R</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">P</span> : <span class="id" type="var">symbol</span> -&gt; <span class="id" type="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> &lt;-&gt; (<span class="id" type="var">cdp'</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> \/ <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,v) <span class="id" type="var">l0</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <span class="id" type="var">u0</span> &lt;&gt; <span class="id" type="var">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">v0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">F.arity</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">AC</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Free</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">v0</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">u0</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">comp</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> -&gt; <span class="id" type="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">are_connected</span> <span class="id" type="var">cdp</span> <span class="id" type="var">R</span> <span class="id" type="var">uv</span> <span class="id" type="var">uv'</span> -&gt; <span class="id" type="var">comp</span> <span class="id" type="var">uv</span> &lt;= <span class="id" type="var">comp</span> <span class="id" type="var">uv'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n0</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">uv0</span>, <span class="id" type="var">In</span> <span class="id" type="var">uv0</span> <span class="id" type="var">l0</span> -&gt; <span class="id" type="var">comp</span> <span class="id" type="var">uv0</span> = <span class="id" type="var">n0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">v0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">F.arity</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">AC</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Free</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> : <span class="id" type="var">term</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">comp</span> (<span class="id" type="var">u</span>,v) = <span class="id" type="var">n0</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">v</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">u</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">cdp'</span>) <span class="id" type="var">R</span>)) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">cdp</span>) <span class="id" type="var">R</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">R_var</span> <span class="id" type="var">l0</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l0</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u0</span> <span class="id" type="var">v0</span>] <span class="id" type="var">l0</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">cdp</span> <span class="id" type="var">cdp'</span> <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">P</span> <span class="id" type="var">split_cdp</span> <span class="id" type="var">l0_diff</span> <span class="id" type="var">P_ok</span> <span class="id" type="var">l0_decr</span><br/>
<span class="id" type="var">comp</span> <span class="id" type="var">comp_ok</span> <span class="id" type="var">n0</span> <span class="id" type="var">l0_in_comp_n0</span> <span class="id" type="var">Wl0</span> <span class="id" type="var">cdp_decr</span> <span class="id" type="var">W'</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">cdp'</span>) <span class="id" type="var">R</span>)); [ | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> [<span class="id" type="var">H</span> <span class="id" type="var">Hmin</span>]; <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H3</span> | <span class="id" type="var">H3</span>]; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">contradiction</span>].<br/>

<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">dp_subterm_criterion</span> <span class="id" type="var">R</span> <span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">P</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">comp</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l0_diff</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">P_ok</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u0</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l0_decr</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl0</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u0</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">connect_approx</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">H0</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_decr</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">l0_in_comp_n0</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_antisym</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> =&gt; <span class="id" type="var">cdp'</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> \/ <span class="id" type="var">In</span> (<span class="id" type="var">u</span>, <span class="id" type="var">v</span>) <span class="id" type="var">l0</span>)) <span class="id" type="var">R</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> [<span class="id" type="var">H</span> <span class="id" type="var">Hmin</span>]; <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">K1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> | [<span class="id" type="var">K1</span> | <span class="id" type="var">K1</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl0</span> <span class="id" type="keyword">with</span> <span class="id" type="var">cdp'</span> <span class="id" type="var">P</span> <span class="id" type="var">comp</span> <span class="id" type="var">n0</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_in_dpR</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l0_diff</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">uv1_in_l0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_ok</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">uv1_in_l0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l0_decr</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u</span> <span class="id" type="var">v</span>] [<span class="id" type="var">u'</span> <span class="id" type="var">v'</span>] <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">comp_ok</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma</span> [<span class="id" type="var">sigma'</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma'</span>; <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">split</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H1</span>]; [<span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">H2</span>]; [<span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l0_in_comp_n0</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">uv1_in_l0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl0</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_decr</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp_subterm_criterion_one_comp</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">v</span> : <span class="id" type="var">variable</span>) (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>), ~ <span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l0</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">cdp</span> <span class="id" type="var">cdp'</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> : <span class="id" type="var">term</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">ddp</span> <span class="id" type="var">R</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">P</span> : <span class="id" type="var">symbol</span> -&gt; <span class="id" type="var">nat</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> &lt;-&gt; (<span class="id" type="var">cdp'</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> \/ <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,v) <span class="id" type="var">l0</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <span class="id" type="var">u0</span> &lt;&gt; <span class="id" type="var">v0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">v0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">F.arity</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">AC</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Free</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f</span> &lt; <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">v0</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">u0</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u0</span>,v0) <span class="id" type="var">l0</span> -&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">v0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">F.arity</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">AC</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = 2<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Free</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> : <span class="id" type="var">term</span>, <span class="id" type="var">cdp</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>  -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">v</span>) (<span class="id" type="var">projection</span> <span class="id" type="var">P</span> <span class="id" type="var">u</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">cdp'</span>) <span class="id" type="var">R</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">cdp</span>) <span class="id" type="var">R</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">R_var</span> <span class="id" type="var">l0</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l0</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u0</span> <span class="id" type="var">v0</span>] <span class="id" type="var">l0</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">cdp</span> <span class="id" type="var">cdp'</span> <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">P</span> <span class="id" type="var">split_cdp</span> <span class="id" type="var">l0_diff</span> <span class="id" type="var">P_ok</span> <span class="id" type="var">l0_decr</span> <span class="id" type="var">Wl0</span> <span class="id" type="var">cdp_decr</span> <span class="id" type="var">W'</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">cdp'</span>) <span class="id" type="var">R</span>)); [ | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> [<span class="id" type="var">H</span> <span class="id" type="var">Hmin</span>]; <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H3</span> | <span class="id" type="var">H3</span>]; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">contradiction</span>].<br/>

<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">dp_subterm_criterion</span> <span class="id" type="var">R</span> <span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">cdp_in_dpR</span> <span class="id" type="var">P</span> <span class="id" type="var">u0</span> <span class="id" type="var">v0</span>) <span class="id" type="keyword">with</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> =&gt; 0).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l0_diff</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">P_ok</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u0</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l0_decr</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl0</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u0</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">connect_approx</span>.<br/>
&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">H1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_decr</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> =&gt; <span class="id" type="var">cdp'</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> \/ <span class="id" type="var">In</span> (<span class="id" type="var">u</span>, <span class="id" type="var">v</span>) <span class="id" type="var">l0</span>)) <span class="id" type="var">R</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> [<span class="id" type="var">H</span> <span class="id" type="var">Hmin</span>]; <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">K1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> | [<span class="id" type="var">K1</span> | <span class="id" type="var">K1</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl0</span> <span class="id" type="keyword">with</span> <span class="id" type="var">cdp'</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_in_dpR</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l0_diff</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">uv1_in_l0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_ok</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">uv1_in_l0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l0_decr</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">v1</span> <span class="id" type="var">uv1_in_l0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl0</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_decr</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_cdp</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">MakeSubDP</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>