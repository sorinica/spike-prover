<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>term_orderings.rpo</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library term_orderings.rpo</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_algebra".<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Bool</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equiv_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">list_permut</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">dickson</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Wellfounded</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Wf_nat</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">decidable_set</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">ordered_set</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Recdef</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Program</span>.<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
</div>

<div class="doc">
A non-dependant version of lexicographic extension. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="var">lex</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">o1</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) (<span class="id" type="var">o2</span> : <span class="id" type="var">relation</span> <span class="id" type="var">B</span>) (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">_</span> * <span class="id" type="var">_</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">s1</span>,s2) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">t1</span>,t2) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">o2</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">o1</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Transitivity of  lexicographic extension. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lex_trans</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">o1</span> <span class="id" type="var">o2</span><br/>
&nbsp;(<span class="id" type="var">eq_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="keyword">if</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">then</span> <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> <span class="id" type="keyword">else</span> <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span>), <br/>
&nbsp;<span class="id" type="var">antisymmetric</span> <span class="id" type="var">A</span> <span class="id" type="var">o1</span> -&gt; <span class="id" type="var">transitive</span> <span class="id" type="var">A</span> <span class="id" type="var">o1</span> -&gt; <span class="id" type="var">transitive</span> <span class="id" type="var">B</span> <span class="id" type="var">o2</span> -&gt;<br/>
&nbsp;<span class="id" type="var">transitive</span> <span class="id" type="var">_</span> (<span class="id" type="var">lex</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">o1</span> <span class="id" type="var">o2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">transitive</span>, <span class="id" type="var">lex</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">o1</span> <span class="id" type="var">o2</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">A1</span> <span class="id" type="var">T1</span> <span class="id" type="var">T2</span> <span class="id" type="var">p1</span> <span class="id" type="var">p2</span> <span class="id" type="var">p3</span>; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">p1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1</span> <span class="id" type="var">b1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">p2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a2</span> <span class="id" type="var">b2</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">p3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a3</span> <span class="id" type="var">b3</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_eq_a2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a1_diff_a2</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a2_eq_a3</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a2_diff_a3</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">T2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">a2_t_a3</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a2_eq_a3</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a2_diff_a3</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">a3</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a3</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_eq_a3</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a1_diff_a3</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_diff_a2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_lt_a3</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">a3</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a3</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_eq_a3</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a1_diff_a3</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a3_lt_a2</span> <span class="id" type="var">a2_lt_a3</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">a3</span> = <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">exact</span> ( <span class="id" type="var">A1</span> <span class="id" type="var">a3</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3_lt_a2</span> <span class="id" type="var">a2_lt_a3</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_lt_a2</span> <span class="id" type="var">a2_lt_a3</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">T1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_lt_a2</span> <span class="id" type="var">a2_lt_a3</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Well-foundedness of  lexicographic extension. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_lex</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> (<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">o1</span> <span class="id" type="var">o2</span> <br/>
&nbsp;&nbsp;(<span class="id" type="var">eq_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="keyword">if</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">then</span> <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> <span class="id" type="keyword">else</span> <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span>), <br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> <span class="id" type="var">o1</span> -&gt; <span class="id" type="var">well_founded</span> <span class="id" type="var">o2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (@<span class="id" type="var">lex</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">o1</span> <span class="id" type="var">o2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">o1</span> <span class="id" type="var">o2</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">W1</span> <span class="id" type="var">W2</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span>]; <span class="id" type="var">revert</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">W1</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">W2</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Wa1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">wf_lex</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">Wa2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">a1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">wf_lex</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">a2</span> <span class="id" type="var">Wa2</span>; <span class="id" type="var">fix</span> <span class="id" type="var">wf_lex2</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">a1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">wf_lex</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">b1</span> <span class="id" type="var">b2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">b1</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">b1</span> <span class="id" type="var">a1</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">b1_eq_a1</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">b1_diff_a1</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b2_lt_a2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">b1_eq_a1</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">wf_lex2</span> <span class="id" type="var">b2</span> (<span class="id" type="var">Acc_inv</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">b2_lt_a2</span>) <span class="id" type="var">a1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">wf_lex</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">b1_lt_a1</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">wf_lex</span> <span class="id" type="var">b1</span> <span class="id" type="var">b1_lt_a1</span> <span class="id" type="var">_</span> (<span class="id" type="var">W2</span> <span class="id" type="var">b2</span>)).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab83"></a><h2 class="section">Module Type Precedence,</h2>

<a name="lab84"></a><h2 class="section">Definition of a precedence.</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">status_type</span> : <span class="id" type="keyword">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Lex</span> : <span class="id" type="var">status_type</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Mul</span> : <span class="id" type="var">status_type</span>.<br/>

<br/>
<span class="id" type="keyword">Record</span> <span class="id" type="var">Precedence</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) : <span class="id" type="keyword">Type</span> := {<br/>
&nbsp;&nbsp;<span class="id" type="var">status</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">status_type</span>;<br/>
&nbsp;&nbsp;<span class="id" type="var">prec</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>;<br/>
&nbsp;&nbsp;<span class="id" type="var">prec_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>;<br/>
&nbsp;&nbsp;<span class="id" type="var">prec_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">prec_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">prec</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; ~prec <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" type="var">prec_antisym</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">prec</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">False</span>;<br/>
&nbsp;&nbsp;<span class="id" type="var">prec_transitive</span> : <span class="id" type="var">transitive</span> <span class="id" type="var">A</span> <span class="id" type="var">prec</span><br/>
}.<br/>

<br/>
</div>

<div class="doc">
<a name="lab85"></a><h2 class="section">Module Type RPO,</h2>

<a name="lab86"></a><h2 class="section">Definition of RPO from a precedence on symbols.</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">RPO</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">T</span> : <span class="id" type="var">Term</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Section</span> <span class="id" type="var">S</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">P</span> : <span class="id" type="var">Precedence</span> <span class="id" type="var">T.symbol</span>.<br/>
</div>

<div class="doc">
<a name="lab87"></a><h2 class="section">Definition of rpo.</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Inductive</span> <span class="id" type="var">equiv</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq_lex</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">status</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> = <span class="id" type="var">Lex</span> -&gt; <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span>  <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq_mul</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,  <span class="id" type="var">status</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> = <span class="id" type="var">Mul</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">equiv_list_lex</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq_list_nil</span> : <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">nil</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq_list_cons</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv_list_lex</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_in_list</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> (<span class="id" type="var">f_stat</span> : <span class="id" type="var">status</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span>= <span class="id" type="var">Lex</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">combine</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">equiv</span>  <span class="id" type="var">t1</span>  <span class="id" type="var">t2</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_equiv</span>  : <span class="id" type="var">equivalence</span> <span class="id" type="var">term</span> <span class="id" type="var">equiv</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, {<span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}+{~equiv <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Inductive</span> <span class="id" type="var">rpo</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Subterm</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Top_gt</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">prec</span> <span class="id" type="var">P</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s'</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s'</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Top_eq_lex</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">status</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> = <span class="id" type="var">Lex</span> -&gt; (<span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">length</span> <span class="id" type="var">l'</span> \/ (<span class="id" type="var">length</span> <span class="id" type="var">l'</span> &lt;= <span class="id" type="var">bb</span> /\ <span class="id" type="var">length</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">bb</span>)) -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s'</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s'</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Top_eq_mul</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">status</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> = <span class="id" type="var">Mul</span> -&gt; <span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">rpo_eq</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">rpo_lex</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">List_gt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">t</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">List_eq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">s'</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">List_nil</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>, <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">nil</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">rpo_mul</span> ( <span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">List_mul</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l'</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">lc</span>) -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span> ++ <span class="id" type="var">lc</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">a'</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span>) /\ <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">a'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_rpo_equiv_1</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t'</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_rpo_equiv_2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> &lt;-&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t'</span> <span class="id" type="var">s</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_rpo_equiv_3</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t'</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_rpo_equiv_4</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> &lt;-&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t'</span> <span class="id" type="var">s</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab88"></a><h2 class="section">rpo is a preorder, and its reflexive closure is an ordering.</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">rpo_closure</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">s</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">False</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">False</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">s</span>  <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">rpo_trans</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">u</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab89"></a><h2 class="section">Main theorem: when the precedence is well-founded, so is the rpo.</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">wf_rpo</span> :  <span class="id" type="var">well_founded</span> (<span class="id" type="var">prec</span> <span class="id" type="var">P</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span>, <span class="id" type="var">well_founded</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab90"></a><h2 class="section">RPO is compatible with the instanciation by a substitution.</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_subst</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">equiv</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">rpo_subst</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">rpo_eq_subst</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab91"></a><h2 class="section">RPO is compatible with adding context.</h2>

</div>
<div class="code">
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">equiv_add_context</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">is_a_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span>) (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">rpo_add_context</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">p</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">is_a_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span>) (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">rpo_eq_add_context</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">p</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">is_a_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span>) (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">rpo_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, {<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}+{~rpo <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">End</span> <span class="id" type="var">S</span>.<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">RPO</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">T1</span>: <span class="id" type="var">Term</span>) <br/>
<br/>
&lt;: <span class="id" type="var">RPO</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">T</span> := <span class="id" type="var">T1</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">T</span> := <span class="id" type="var">T1</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">T1</span>.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab92"></a><h2 class="section">Definition of size-based well-founded orderings for induction.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="var">o_size</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> := <span class="id" type="var">size</span> <span class="id" type="var">s</span> &lt; <span class="id" type="var">size</span> <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_size</span> :  <span class="id" type="var">well_founded</span> <span class="id" type="var">o_size</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_founded_ltof</span> <span class="id" type="var">_</span> <span class="id" type="var">size</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">ltof</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">size2</span> <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s1</span>,s2) =&gt; (<span class="id" type="var">size</span> <span class="id" type="var">s1</span>, <span class="id" type="var">size</span> <span class="id" type="var">s2</span>) <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">o_size2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> := <span class="id" type="var">lex</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> <span class="id" type="var">lt</span> (<span class="id" type="var">size2</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size2</span> <span class="id" type="var">t</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_size2</span> : <span class="id" type="var">well_founded</span> <span class="id" type="var">o_size2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">wf_inverse_image</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">lex</span>  <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> <span class="id" type="var">lt</span>) <span class="id" type="var">size2</span> <span class="id" type="var">_</span>);<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_lex</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">beq_nat_ok</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_wf</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_wf</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size2_lex1</span> : <br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size2</span> (<span class="id" type="var">s</span>,t1) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,t2).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size2</span>, <span class="id" type="var">size2</span>, <span class="id" type="var">lex</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s_eq_t</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_lt_t</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) &lt; <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">s</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">s_in_l</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">s</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">s_in_l</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size2_lex1_bis</span> : <br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">o_size2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a</span>::l), <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size2</span>, <span class="id" type="var">size2</span>, <span class="id" type="var">lex</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>)))); <br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>)))); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s_eq_t</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_lt_t</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s_eq_t</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span> &lt; <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">plus_le_compat_r</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>) (<span class="id" type="var">size_ge_one</span> <span class="id" type="var">a</span>));<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_n_S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (1 + <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size2_lex2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size2</span> (<span class="id" type="var">s</span>,t) (<span class="id" type="var">s</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">t_in_l</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size2</span>, <span class="id" type="var">size2</span>, <span class="id" type="var">lex</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_diff_s</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s_diff_s</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size2_lex2_bis</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>, <span class="id" type="var">o_size2</span> (<span class="id" type="var">s</span>,Term <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">s</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size2</span>, <span class="id" type="var">size2</span>, <span class="id" type="var">lex</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_diff_s</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_lt_compat_l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">plus_le_compat_r</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>) (<span class="id" type="var">size_ge_one</span> <span class="id" type="var">a</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s_diff_s</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">o_size2_trans</span> : <span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">o_size2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">x1</span> <span class="id" type="var">x2</span>] [<span class="id" type="var">y1</span> <span class="id" type="var">y2</span>] [<span class="id" type="var">z1</span> <span class="id" type="var">z2</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">lex_trans</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">beq_nat_ok</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">n_lt_m</span> <span class="id" type="var">m_lt_n</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">lt_asym</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">n_lt_m</span> <span class="id" type="var">m_lt_n</span>); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span> <span class="id" type="var">n3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_trans</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span> <span class="id" type="var">n3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_trans</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">size3</span> <span class="id" type="var">s</span> := <span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s1</span>,s2) =&gt; (<span class="id" type="var">size</span> <span class="id" type="var">s1</span>, <span class="id" type="var">size2</span> <span class="id" type="var">s2</span>) <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">o_size3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> := <br/>
&nbsp;&nbsp;<span class="id" type="var">lex</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> (<span class="id" type="var">lex</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> <span class="id" type="var">lt</span>) (<span class="id" type="var">size3</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size3</span> <span class="id" type="var">t</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_size3</span> : <span class="id" type="var">well_founded</span> <span class="id" type="var">o_size3</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">wf_inverse_image</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <br/>
&nbsp;&nbsp;(<span class="id" type="var">lex</span>  <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> (<span class="id" type="var">lex</span>  <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> <span class="id" type="var">lt</span>)) <span class="id" type="var">size3</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_lex</span>; <br/>
[ <span class="id" type="tactic">exact</span> <span class="id" type="var">beq_nat_ok</span> <br/>
| <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_wf</span> <br/>
| <span class="id" type="tactic">apply</span> <span class="id" type="var">wf_lex</span>; [ <span class="id" type="tactic">exact</span> <span class="id" type="var">beq_nat_ok</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_wf</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_wf</span> ]].<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size3_lex1</span> : <br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">u1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u2</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size3</span> (<span class="id" type="var">s</span>,(t1,u1)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,(t2,u2)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">u1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u2</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size3</span>, <span class="id" type="var">size3</span>, <span class="id" type="var">size2</span>, <span class="id" type="var">lex</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s_eq_t</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_lt_t</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) &lt; <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">s</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">s_in_l</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">s</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">s_in_l</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size3_lex1_bis</span> : <br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">u1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u2</span>, <span class="id" type="var">o_size3</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,(t1,u1)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a</span>::l),(t2,u2)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">u1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size3</span>, <span class="id" type="var">size3</span>, <span class="id" type="var">lex</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>)))); <br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>)))); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s_eq_t</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_lt_t</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s_eq_t</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span> &lt; <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">plus_le_compat_r</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>) (<span class="id" type="var">size_ge_one</span> <span class="id" type="var">a</span>));<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s_eq_t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_n_S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (1 + <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size3_lex2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size3</span> (<span class="id" type="var">s</span>,(t,u1)) (<span class="id" type="var">s</span>,(Term <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">u2</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">t_in_l</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size3</span>, <span class="id" type="var">size3</span>, <span class="id" type="var">size2</span>, <span class="id" type="var">lex</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_diff_s</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>) (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t_eq_fl</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t_lt_fl</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) &lt; <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">t_in_l</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">t_eq_fl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">t_in_l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s_diff_s</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size3_lex3</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">u</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size3</span> (<span class="id" type="var">s</span>,(t,u)) (<span class="id" type="var">s</span>,(t,Term <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u_in_l</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size3</span>, <span class="id" type="var">size3</span>, <span class="id" type="var">size2</span>, <span class="id" type="var">lex</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>) (<span class="id" type="var">size</span> <span class="id" type="var">s</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s_diff_s</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_ok</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>) (<span class="id" type="var">size</span> <span class="id" type="var">t</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>) (<span class="id" type="var">size</span> <span class="id" type="var">t</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t_diff_t</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">u</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">u_in_l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t_diff_t</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s_diff_s</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">o_size3_trans</span> : <span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">o_size3</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">x1</span> <span class="id" type="var">x2</span>] [<span class="id" type="var">y1</span> <span class="id" type="var">y2</span>] [<span class="id" type="var">z1</span> <span class="id" type="var">z2</span>].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">lex_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> (<span class="id" type="var">lex</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">lt</span> <span class="id" type="var">lt</span>) <span class="id" type="var">beq_nat_ok</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">n_lt_m</span> <span class="id" type="var">m_lt_n</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">lt_asym</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">n_lt_m</span> <span class="id" type="var">m_lt_n</span>); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span> <span class="id" type="var">n3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_trans</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lex_trans</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">beq_nat_ok</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">n_lt_m</span> <span class="id" type="var">m_lt_n</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">lt_asym</span> <span class="id" type="var">n</span> <span class="id" type="var">m</span> <span class="id" type="var">n_lt_m</span> <span class="id" type="var">m_lt_n</span>); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span> <span class="id" type="var">n3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_trans</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span> <span class="id" type="var">n3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_trans</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab93"></a><h2 class="section">Definition of rpo.</h2>

</div>
<div class="code">
</div>

<div class="doc">
<a name="lab94"></a><h3 class="section">Equivalence modulo rpo</h3>

</div>
<div class="code">
<span class="id" type="keyword">Section</span> <span class="id" type="var">S</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Prec</span>:Precedence <span class="id" type="var">T1.symbol</span>.<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">equiv</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Eq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Eq_lex</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span> = <span class="id" type="var">Lex</span> -&gt; <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span>  <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;| <span class="id" type="var">Eq_mul</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,  <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span> = <span class="id" type="var">Mul</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)<br/>
<br/>
<span class="id" type="keyword">with</span> <span class="id" type="var">equiv_list_lex</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq_list_nil</span> : <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">nil</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Eq_list_cons</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv_list_lex</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_same_top</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l'</span>) -&gt; <span class="id" type="var">f</span> = <span class="id" type="var">g</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_list_lex_same_length</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">_</span> <span class="id" type="var">l1'_eq_l2'</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_same_length</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1_eq_t2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">_</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="var">f</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_eq_t2</span>; <br/>
<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_list_lex_same_length</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">permut_length</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_same_size</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">t</span> = <span class="id" type="var">size</span> <span class="id" type="var">t'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">St1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_t2</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">_</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="var">f</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_eq_t2</span>; <br/>
<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">n</span> =&gt; 1 + <span class="id" type="var">n</span>)).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l1_eq_l2</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">l1'_eq_l2'</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">St1'</span> : <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">St1'</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl1</span> : <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) &lt;= <span class="id" type="var">S</span> <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">plus_le_compat_r</span> 0 (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">size_ge_one</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">Sl1</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">n</span> =&gt; 1 + <span class="id" type="var">n</span>)).<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">permut_size</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a_in_l1</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1'</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_in_list</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> (<span class="id" type="var">f_stat</span> : <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>= <span class="id" type="var">Lex</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">combine</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">equiv</span>  <span class="id" type="var">t1</span>  <span class="id" type="var">t2</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">f_stat</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Eq_lex</span> <span class="id" type="var">f</span> <span class="id" type="var">f_stat</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">f</span> <span class="id" type="var">f_stat</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">E</span>; <span class="id" type="var">fix</span> 1; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_in_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_equiv</span>  : <span class="id" type="var">equivalence</span> <span class="id" type="var">term</span> <span class="id" type="var">equiv</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="var">t2_eq_t3</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">E_l1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="var">t2_eq_t3</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">H'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span> <span class="id" type="var">P</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t2_eq_t3</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l3</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">l2_eq_l3</span> <span class="id" type="var">H2</span> <span class="id" type="var">H''</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l3</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">P'</span> ]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">l2_eq_l3</span>;<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="var">t2_eq_t3</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">l2_eq_l3</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ |s1 <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">l2_eq_l3</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">l1'_eq_l2'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l2_eq_l3</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s2'</span> <span class="id" type="var">s3</span> <span class="id" type="var">l2''</span> <span class="id" type="var">l3'</span> <span class="id" type="var">s2_eq_s3</span> <span class="id" type="var">l2''_eq_l3'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">E_l1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">a_in_l1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_l1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">IHl</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_t2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="keyword">as</span> <br/>
&nbsp;&nbsp;[ <br/>
&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span> <span class="id" type="var">l1_eq_l2</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span> <span class="id" type="var">P</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">l1'_eq_l2'</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">a_in_l1</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Relation</span> <span class="id" type="var">term</span> <span class="id" type="var">equiv</span> <br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">EQUIV_RPO</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">equiv_bool_F</span> := <br/>
(<span class="id" type="keyword">fun</span> (<span class="id" type="var">equiv_bool</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>) =&gt;<br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">t1</span>, <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
| <span class="id" type="var">Var</span> <span class="id" type="var">v1</span>, <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> =&gt; <span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span><br/>
| <span class="id" type="var">Var</span> <span class="id" type="var">_</span>, <span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
| <span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>, <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
| <span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lex</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">equiv_lex_bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">kk1</span>} :  <span class="id" type="var">bool</span> :=  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> [] =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>=&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[] =&gt; <span class="id" type="var">false</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t2</span> :: <span class="id" type="var">k2</span>=&gt; (<span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) &amp;&amp; (<span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)) <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Mul</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">equiv_mult_bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_mult_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">kk1</span>} :  <span class="id" type="var">bool</span> :=  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> [] =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>=&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)) <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">false</span><br/>
<span class="id" type="keyword">end</span>) : (<span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>) -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">equiv_bool_terminate</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">v</span> : <span class="id" type="var">bool</span> |  <span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> : <span class="id" type="var">nat</span>, (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) &lt;= <span class="id" type="var">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">def</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">iter</span> (<span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">k</span> <span class="id" type="var">equiv_bool_F</span> <span class="id" type="var">def</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">v</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t1</span> := <span class="id" type="var">well_founded_ltof</span> <span class="id" type="var">term</span> <span class="id" type="var">size</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">Acc_t1</span> <span class="id" type="var">IHAcc</span>].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Acc_t1</span> <span class="id" type="var">IHAcc</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>; [<span class="id" type="tactic">intro</span> <span class="id" type="var">v1</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>]; <br/>
(<span class="id" type="tactic">intros</span> <span class="id" type="var">Acc_t1</span> <span class="id" type="var">IHAcc</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span>; [<span class="id" type="tactic">intro</span> <span class="id" type="var">v2</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]).<br/>

<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>); <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">p</span>] <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_ind</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">gt_irrefl</span> 0 <span class="id" type="var">p_lt_k</span>).<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>

<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">false</span>; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">p</span>] <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_ind</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">gt_irrefl</span> 0 <span class="id" type="var">p_lt_k</span>).<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>

<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">false</span>; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">p</span>] <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_ind</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">le_Sn_O</span> <span class="id" type="var">_</span> <span class="id" type="var">p_lt_k</span>).<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>

<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>.<br/>
<span class="id" type="tactic">assert</span> ({<span class="id" type="var">v</span> : <span class="id" type="var">bool</span> |<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> : <span class="id" type="var">nat</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l1</span> &lt;= <span class="id" type="var">k</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">def</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">iter</span> (<span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">S</span> <span class="id" type="var">k</span>) <span class="id" type="var">equiv_bool_F</span> <span class="id" type="var">def</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) = <span class="id" type="var">v</span>}).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">iter</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IH</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> : <span class="id" type="var">term</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">v</span> : <span class="id" type="var">bool</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> : <span class="id" type="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">def</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">iter</span> (<span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">k</span> <span class="id" type="var">equiv_bool_F</span> <span class="id" type="var">def</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">v</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1_in_l1</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">IHAcc</span> <span class="id" type="var">t1</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t1_in_l1</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHAcc</span> <span class="id" type="var">Acc_t1</span> <span class="id" type="var">f2</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">IH</span> <span class="id" type="var">l2</span>; <span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> 1.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">true</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">false</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">k1</span> <span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">false</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> (<span class="id" type="var">tail_set</span> <span class="id" type="var">_</span> <span class="id" type="var">IHl1</span>) <span class="id" type="var">k2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">bl</span> <span class="id" type="var">IH'</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">a1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">a2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">ba</span> <span class="id" type="var">IH''</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">ba</span> &amp;&amp; <span class="id" type="var">bl</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">p_le_k</span> <span class="id" type="var">def</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">pa_lt_k</span> : <span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">k</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">k1</span>)); [<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span> | <span class="id" type="tactic">exact</span> <span class="id" type="var">p_le_k</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IH''</span> <span class="id" type="var">k</span> <span class="id" type="var">pa_lt_k</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">pl_le_k</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">k1</span> &lt;= <span class="id" type="var">k</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">k1</span>)); [<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_r</span> | <span class="id" type="tactic">exact</span> <span class="id" type="var">p_le_k</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IH'</span> <span class="id" type="var">k</span> <span class="id" type="var">pl_le_k</span> <span class="id" type="var">def</span>).<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHAcc</span> <span class="id" type="var">Acc_t1</span> <span class="id" type="var">f2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">IH</span> <span class="id" type="var">l2</span>; <span class="id" type="var">fix</span> <span class="id" type="var">IHl1</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">true</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">false</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">p_lt_k</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">IH</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hrem</span> : {<span class="id" type="var">ok</span> : <span class="id" type="var">option</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> : <span class="id" type="var">nat</span>, <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>) &lt;= <span class="id" type="var">k</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">def</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remove</span> (<span class="id" type="var">iter</span> <span class="id" type="var">_</span> <span class="id" type="var">k</span> <span class="id" type="var">equiv_bool_F</span> <span class="id" type="var">def</span>) <span class="id" type="var">a1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">ok</span>}).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l2</span>; <span class="id" type="var">fix</span> <span class="id" type="var">IHl2</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">None</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>)); <span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">le_Sn_O</span> <span class="id" type="var">_</span> (<span class="id" type="var">le_trans</span> 1 <span class="id" type="var">_</span> 0 (<span class="id" type="var">size_ge_one</span> <span class="id" type="var">a1</span>) (<span class="id" type="var">le_trans</span> (<span class="id" type="var">size</span> <span class="id" type="var">a1</span>) <span class="id" type="var">_</span> 0 (<span class="id" type="var">le_plus_l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">L</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">_</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>;<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">a2</span>); <span class="id" type="tactic">intro</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Ha1</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Some</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ha1</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>)); [<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">L</span>].<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">IHl2</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">IHl2</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">ok</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">ok</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">ok</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k2</span> <span class="id" type="var">IHl2</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Some</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">k2</span>)); <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ha1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl2</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>)); [<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">L</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">IHl2</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">None</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>)); <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ha1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl2</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>)); [<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">L</span>].<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">Hrem</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hrem</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">ok</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">ok</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">ok</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k2</span> <span class="id" type="var">Hrem</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">_</span> (<span class="id" type="var">tail_set</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>) <span class="id" type="var">k2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">Hl1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span> <span class="id" type="var">def</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hrem</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">l1_le_k</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l1</span> &lt;= <span class="id" type="var">k</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_r</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hl1</span> <span class="id" type="var">k</span> <span class="id" type="var">l1_le_k</span> <span class="id" type="var">def</span>).<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Hrem</span>; <span class="id" type="var">exists</span> <span class="id" type="var">false</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span> <span class="id" type="var">def</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hrem</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span>).<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">false</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>).<br/>

<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">le_Sn_O</span> <span class="id" type="var">_</span> (<span class="id" type="var">le_trans</span> 1 <span class="id" type="var">_</span> 0 (<span class="id" type="var">le_plus_l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">L</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span> <span class="id" type="var">def</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">k</span>).<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">le_S_n</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">equiv_bool</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> =&gt; <span class="id" type="keyword">let</span> (<span class="id" type="var">v</span>,_) := <span class="id" type="var">equiv_bool_terminate</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_bool_equation</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">t1</span>, <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
| <span class="id" type="var">Var</span> <span class="id" type="var">v1</span>, <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> =&gt; <span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span><br/>
| <span class="id" type="var">Var</span> <span class="id" type="var">_</span>, <span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
| <span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>, <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
| <span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lex</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">equiv_lex_bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">kk1</span>} :  <span class="id" type="var">bool</span> :=  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> [] =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>=&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[] =&gt; <span class="id" type="var">false</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t2</span> :: <span class="id" type="var">k2</span>=&gt; (<span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) &amp;&amp; (<span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)) <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Mul</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">equiv_mult_bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_mult_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">kk1</span>} :  <span class="id" type="var">bool</span> :=  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> [] =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>=&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)) <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">false</span><br/>
<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">k</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">k</span> -&gt; <span class="id" type="var">iter</span> (<span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">k</span> <span class="id" type="var">equiv_bool_F</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">k</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="tactic">at</span> 2; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">equiv_bool_terminate</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v1</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">IH</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">H</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">_</span> (<span class="id" type="var">le_n</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">f1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f1</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">f2</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t2</span> :: <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">f1</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &amp;&amp; <span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> =<br/>
(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t2</span> :: <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">f2</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &amp;&amp; <span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">g1</span> <span class="id" type="var">g2</span> <span class="id" type="var">IH</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">f_equal2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">g1</span> <span class="id" type="var">g2</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">H'</span> <span class="id" type="var">l1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t1_in_l1</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">size_unfold</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f1</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">f2</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_mult_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">remove</span> <span class="id" type="var">f1</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> =<br/>
(<span class="id" type="var">fix</span> <span class="id" type="var">equiv_mult_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">f2</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">g1</span> <span class="id" type="var">g2</span> <span class="id" type="var">IH</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f1</span> <span class="id" type="var">a1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">f2</span> <span class="id" type="var">a1</span> <span class="id" type="var">t2</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">l2</span>, <span class="id" type="var">remove</span> <span class="id" type="var">f1</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">remove</span> <span class="id" type="var">f2</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">g1</span> <span class="id" type="var">g2</span> <span class="id" type="var">IH</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">g1</span> <span class="id" type="var">g2</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H'</span> <span class="id" type="var">g1</span> <span class="id" type="var">g2</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">g2</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">g1</span> <span class="id" type="var">g2</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>)).<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">H'</span> <span class="id" type="var">l1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t1_in_l1</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">size_unfold</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="var">false</span> =&gt; ~equiv <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">v2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">equiv_bool_equation</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">v1_eq_v2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v1_eq_v2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v1_diff_v2</span> <span class="id" type="var">v1_eq_v2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">v1_diff_v2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">v1_eq_v2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">equiv_bool_equation</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">IH</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">equiv_bool_equation</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">equiv_bool_equation</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_eq_f2</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Lex_f1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">if</span> (<span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t2</span> :: <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &amp;&amp; <span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">else</span> ~equiv_list_lex <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">equiv_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_eq_a2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl1</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> ((<span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t3</span> :: <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t3</span> &amp;&amp; <span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1_diff_l2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l1_diff_l2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_diff_a2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_diff_a2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> ((<span class="id" type="var">fix</span> <span class="id" type="var">equiv_lex_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t3</span> :: <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t3</span> &amp;&amp; <span class="id" type="var">equiv_lex_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">f1_eq_f2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_lex</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1_diff_l2</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l1_diff_l2</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l1_diff_l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Lex_f1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Mul_f1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">if</span> (<span class="id" type="var">fix</span> <span class="id" type="var">equiv_mult_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">else</span> ~permut0 <span class="id" type="var">equiv</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">a2</span> : <span class="id" type="var">term</span> &amp; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">l2'</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span> &amp; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">l2''</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span> |<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l2</span> = <span class="id" type="var">l2'</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">l2''</span> /\ <span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>)}}}<br/>
&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a2</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> -&gt; ~ <span class="id" type="var">In</span> <span class="id" type="var">a2</span>  <span class="id" type="var">l2</span><br/>
&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1_eq_a2</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">remove_equation</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">equiv_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_eq_a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">term</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_diff_a2</span>; <span class="id" type="var">revert</span> <span class="id" type="var">IHl2</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k2</span> [<span class="id" type="var">a1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]]]; <span class="id" type="var">exists</span> <span class="id" type="var">a1'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">l2'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l2''</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1_not_in_l2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a_eq_a1</span> [<span class="id" type="var">a_eq_a2</span> | <span class="id" type="var">a_in_l2</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_diff_a2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">a1_not_in_l2</span> <span class="id" type="var">a</span> <span class="id" type="var">a_eq_a1</span> <span class="id" type="var">a_in_l2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">R</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k2</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">k2'</span> [<span class="id" type="var">k2''</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl1</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>) <span class="id" type="var">k2</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H3</span>; <br/>
<span class="id" type="tactic">case</span> ((<span class="id" type="var">fix</span> <span class="id" type="var">equiv_mult_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k3</span> =&gt; <span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">k2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">not_P</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_P</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">permut_cons_inside</span> <span class="id" type="var">term</span> <span class="id" type="var">term</span> <span class="id" type="var">equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u3</span> <span class="id" type="var">u1</span> <span class="id" type="var">u4</span> <span class="id" type="var">u2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H31</span> <span class="id" type="var">H41</span> <span class="id" type="var">H42</span>; <span class="id" type="tactic">transitivity</span> <span class="id" type="var">u1</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">u4</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1'</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a1_eq_a2</span> <span class="id" type="var">P'</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1_eq_a2</span>); <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> ((<span class="id" type="var">fix</span> <span class="id" type="var">equiv_mult_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">equiv_mult_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">f1_eq_f2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_mul</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">f1_eq_f2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">not_P</span> <span class="id" type="var">t1_eq_t2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">not_P</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Mul_f1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">not_P</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f1_diff_f2</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f1_diff_f2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_dec</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, {<span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}+{~equiv <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">equiv_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">term_rec3_mem</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> : <span class="id" type="var">variable</span>, <span class="id" type="var">P</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">f</span> : <span class="id" type="var">symbol</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">P</span> <span class="id" type="var">t</span>) -&gt; <span class="id" type="var">P</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>, <span class="id" type="var">P</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">Hvar</span> <span class="id" type="var">Hterm</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Size_t</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span> ]; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hterm</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_n_Sm_le</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">t_eq_t'</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_eq_t'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_same_size</span> <span class="id" type="var">t_eq_t'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">rpo</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Subterm</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Top_gt</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">prec</span> <span class="id" type="var">Prec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s'</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s'</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Top_eq_lex</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span> = <span class="id" type="var">Lex</span> -&gt; (<span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">length</span> <span class="id" type="var">l'</span> \/ (<span class="id" type="var">length</span> <span class="id" type="var">l'</span> &lt;= <span class="id" type="var">bb</span> /\ <span class="id" type="var">length</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">bb</span>)) -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s'</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s'</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Top_eq_mul</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span> = <span class="id" type="var">Mul</span> -&gt; <span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
<br/>
<span class="id" type="keyword">with</span> <span class="id" type="var">rpo_eq</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Lt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span><br/>
<br/>
<span class="id" type="keyword">with</span> <span class="id" type="var">rpo_lex</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">List_gt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">t</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">List_eq</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">s'</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">List_nil</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>, <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">nil</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>)<br/>
<br/>
<span class="id" type="keyword">with</span> <span class="id" type="var">rpo_mul</span> ( <span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">List_mul</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l'</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">lc</span>) -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span> ++ <span class="id" type="var">lc</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">a'</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span>) /\ <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">a'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size_direct_subterm_mem</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) &lt;= <span class="id" type="var">S</span> <span class="id" type="var">n</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">t</span> &lt;= <span class="id" type="var">n</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Sfl</span> <span class="id" type="var">t_mem_l</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">t_eq_t'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_eq_t'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_same_size</span> <span class="id" type="var">t_eq_t'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size2_lex1_mem</span> : <br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size2</span> (<span class="id" type="var">s</span>,t1) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,t2).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">s_mem_l</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">s_eq_s'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_eq_s'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size2</span>, <span class="id" type="var">size2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_same_size</span> <span class="id" type="var">s_eq_s'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size2_lex1</span> <span class="id" type="var">s'</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size2_lex2_mem</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size2</span> (<span class="id" type="var">s</span>,t) (<span class="id" type="var">s</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">t_mem_l</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">t_eq_t'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_eq_t'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size2</span>, <span class="id" type="var">size2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_same_size</span> <span class="id" type="var">t_eq_t'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size2_lex2</span> <span class="id" type="var">t'</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size3_lex1_mem</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">u1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u2</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size3</span> (<span class="id" type="var">s</span>,(t1,u1)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,(t2,u2)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">u1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u2</span> <span class="id" type="var">s_mem_l</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">s_eq_s'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_eq_s'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size3</span>, <span class="id" type="var">size3</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_same_size</span> <span class="id" type="var">s_eq_s'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size3_lex1</span> <span class="id" type="var">s'</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t1</span> <span class="id" type="var">u1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u2</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size3_lex2_mem</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size3</span> (<span class="id" type="var">s</span>,(t,u1)) (<span class="id" type="var">s</span>,(Term <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">u2</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">t_mem_l</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">t_eq_t'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_eq_t'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size3</span>, <span class="id" type="var">size3</span>, <span class="id" type="var">size2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_same_size</span> <span class="id" type="var">t_eq_t'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size3_lex2</span> <span class="id" type="var">t'</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">size3_lex3_mem</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">u</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">o_size3</span> (<span class="id" type="var">s</span>,(t,u)) (<span class="id" type="var">s</span>,(t,Term <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u_mem_l</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">u_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">u_eq_u'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_eq_u'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">o_size3</span>, <span class="id" type="var">size3</span>, <span class="id" type="var">size2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_same_size</span> <span class="id" type="var">u_eq_u'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">size3_lex3</span> <span class="id" type="var">u'</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_mem</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">equiv_list_lex</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;  (<span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">t_mem_l1</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">l1_eq_l2'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t_mem_l1</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t_eq_t1</span> | <span class="id" type="var">t_mem_l1</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">transitivity</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">t_mem_l2</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">l1_eq_l2'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t_mem_l2</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t_eq_t2</span> | <span class="id" type="var">t_mem_l2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">transitivity</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_rpo_equiv_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">p</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s</span>,t) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">well_founded_ind</span> <span class="id" type="var">wf_size2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s</span> <span class="id" type="var">t</span>] <span class="id" type="var">IH</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">s_lt_t</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t''</span> | <span class="id" type="var">f</span>  <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Stat</span> <span class="id" type="var">H</span> | <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Stat</span> <span class="id" type="var">P</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="keyword">as</span>  [<span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">t''_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g</span> <span class="id" type="var">g'</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">g_prec_f</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">L</span> <span class="id" type="var">l'_lt_ll1</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">l'_lt_ll1</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t''_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_lt_t'</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_mem</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_mem</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s'</span>,(Term <span class="id" type="var">f</span> <span class="id" type="var">l1</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l'_lt_t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_list_lex_same_length</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">l'_lt_t</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="var">L</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l2</span> <span class="id" type="var">l'</span> <span class="id" type="var">l'_lt_ll1</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l'</span> <span class="id" type="var">l'_lt_l1</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1_eq_l2</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l'_lt_l1</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">s</span> <span class="id" type="var">t1'</span> <span class="id" type="var">l''</span> <span class="id" type="var">l1'</span> <span class="id" type="var">s_lt_t1'</span> <span class="id" type="var">L_eq</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1'</span> <span class="id" type="var">t1''</span> <span class="id" type="var">l''</span> <span class="id" type="var">l1'</span> <span class="id" type="var">t1'_eq_t1''</span> <span class="id" type="var">l''_lt_l1'</span> | <span class="id" type="var">s</span> <span class="id" type="var">l''</span>]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1''</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">t1''_eq_t2</span> <span class="id" type="var">l1_eq_l2'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s</span>,t1)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_eq</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">o_size2_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_bis</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_nil</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s'</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l'_lt_t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Stat</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Stat'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="keyword">as</span>  [<span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">t''_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g</span> <span class="id" type="var">g'</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">g_prec_f</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">L'</span> <span class="id" type="var">l'_lt_l1</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">l'_lt_l1</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t''_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_lt_t'</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span>  <span class="id" type="var">t'</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">t'</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l2</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s'</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l'_lt_t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Stat</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Stat'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l'_lt_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l''</span> <span class="id" type="var">l'''</span> <span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_trans</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_sym</span> <span class="id" type="var">equiv_equiv</span>). <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Q2</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">s</span>,t)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">s</span>,t')); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Relation_Definitions.equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_rpo_equiv_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> &lt;-&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t'</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">p</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s</span>,t) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t'</span> <span class="id" type="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">well_founded_ind</span> <span class="id" type="var">wf_size2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s</span> <span class="id" type="var">t</span>] <span class="id" type="var">IH</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">t_lt_s</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t''</span> | <span class="id" type="var">g</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Stat</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="var">g</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Stat</span> <span class="id" type="var">P</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_lt_s</span> <span class="id" type="keyword">as</span>  [<span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">t''_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">g_prec_f</span> <span class="id" type="var">l'_lt_s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">L</span> <span class="id" type="var">ll1_lt_l</span> <span class="id" type="var">ll_lt_s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">ll1_lt_l</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t''_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_lt_t'</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">t''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t'</span>,t'')); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l'_lt_s</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">mem_mem</span> <span class="id" type="var">s'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_list_lex_same_length</span> <span class="id" type="var">l1_eq_l2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">ll_lt_s</span> <span class="id" type="var">t_lt_s</span> <span class="id" type="var">L</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">ll1_lt_l</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">l1_lt_l</span> <span class="id" type="var">IH</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t1'</span> <span class="id" type="var">s</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l'</span> <span class="id" type="var">t1'_lt_s</span> <span class="id" type="var">L_eq</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1'</span> <span class="id" type="var">s</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l''</span> <span class="id" type="var">t1'_eq_s</span> <span class="id" type="var">l1'_lt_l''</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">s</span> <span class="id" type="var">l'</span>]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1''</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">t1''_eq_t2</span> <span class="id" type="var">l1_eq_l2'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_nil</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s</span>,t1)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_eq</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">o_size2_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_bis</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ll_lt_s</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">mem_mem</span> <span class="id" type="var">s'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Stat</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Stat'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_lt_s</span> <span class="id" type="keyword">as</span>  [<span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">t''_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">g_prec_f</span> <span class="id" type="var">l'_lt_s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">L</span> <span class="id" type="var">ll1_lt_l</span> <span class="id" type="var">ll_lt_s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Stat'</span> <span class="id" type="var">ll1_lt_l</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t''_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''_lt_t'</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">t''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t'</span>,t'')); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l'_lt_s</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">s'</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Stat</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Stat'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">ll1_lt_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_sym</span> <span class="id" type="var">equiv_equiv</span>). <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">s</span>,t)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">s</span>,t')); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Relation_Definitions.equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_rpo_equiv_3</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t'</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">s</span> <span class="id" type="var">s_le_t</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">s_le_t</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">t_eq_t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Relation_Definitions.equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_rpo_equiv_4</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> &lt;-&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t'</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t'</span> <span class="id" type="var">s</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">s</span> <span class="id" type="var">t_le_s</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t_le_s</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">t_eq_t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab95"></a><h2 class="section">rpo is a preorder, and its reflexive closure is an ordering.</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_subterm_equiv</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">tj</span>, <span class="id" type="var">direct_subterm</span> <span class="id" type="var">tj</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">tj</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> [ | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">fl_eq_s</span> <span class="id" type="var">tj</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">tj_in_l</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span>  <span class="id" type="var">fl_eq_s</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">tj</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_subterm</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">tj</span>, <span class="id" type="var">direct_subterm</span> <span class="id" type="var">tj</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">tj</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <br/>
<span class="id" type="tactic">cut</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">s</span>,t) =&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">tj</span>, <span class="id" type="var">direct_subterm</span> <span class="id" type="var">tj</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">tj</span> <span class="id" type="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">s</span>,t)).<br/>

<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">well_founded_ind</span> <span class="id" type="var">wf_size2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>]] <span class="id" type="var">IH</span> <span class="id" type="var">t_lt_s</span> <span class="id" type="var">tj</span> <span class="id" type="var">tj_in_l</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">tj_in_l</span>; [ <span class="id" type="var">contradiction</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_lt_s</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">t'</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_in_l'</span> <span class="id" type="var">t'_le_s'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">g'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">g'_prec_f'</span> <span class="id" type="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">k'_lt_k</span> <span class="id" type="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">k'_lt_k</span> ].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t'_le_s'</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t''</span> <span class="id" type="var">s''</span> <span class="id" type="var">t'_eq_s'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">s''</span> <span class="id" type="var">t'_lt_s'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">t'_le_s'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Subterm</span> <span class="id" type="var">bb</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">tj</span> <span class="id" type="var">s'</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_subterm_equiv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Subterm</span> <span class="id" type="var">bb</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">tj</span> <span class="id" type="var">s'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s'</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">k'_lt_k</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">tj_mem_l</span> := <span class="id" type="var">in_impl_mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">Eq</span> <span class="id" type="var">tj</span> <span class="id" type="var">l</span> <span class="id" type="var">tj_in_l</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">tj</span> <span class="id" type="var">P1</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">tj_mem_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">tj_mem_l</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">tj_mem_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">tj_mem_ls</span> | <span class="id" type="var">tj_mem_llc</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> <span class="id" type="var">tj_mem_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_mem_a_lg</span> <span class="id" type="var">tj_lt_a'</span>]].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Subterm</span> <span class="id" type="var">bb</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">tj</span> <span class="id" type="var">a'</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a'</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Subterm</span> <span class="id" type="var">bb</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">tj</span> <span class="id" type="var">tj</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">tj</span> <span class="id" type="var">P2</span>).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_subterm_mem</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">s</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">tj</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">tj</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">tj</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">fl_lt_s</span> <span class="id" type="var">tj</span> <span class="id" type="var">tj_mem_l</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">tj_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">tj'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">tj_eq_tj'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">tj_eq_tj'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span>  <span class="id" type="var">_</span> <span class="id" type="var">tj_eq_tj'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Relation</span> <span class="id" type="var">term</span> <span class="id" type="var">equiv</span> <br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">EQA</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Relation</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) (<span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span>) <br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">permut0_refl</span> <span class="id" type="var">equiv_equiv</span>) <br/>
&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">permut0_sym</span> <span class="id" type="var">equiv_equiv</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">permut0_trans</span> <span class="id" type="var">equiv_equiv</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">LP</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">mem</span> <span class="id" type="var">equiv</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">equiv</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> ==&gt; <span class="id" type="var">iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">mem_morph2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">exact</span> (<span class="id" type="var">mem_morph2</span> <span class="id" type="var">equiv_equiv</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">List.app</span> (<span class="id" type="var">A</span>:=term)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">app_morph</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">exact</span> (<span class="id" type="var">app_morph</span> <span class="id" type="var">equiv_equiv</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">List.cons</span> (<span class="id" type="var">A</span>:=term)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">equiv</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">add_A_morph</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">exact</span> (<span class="id" type="var">add_A_morph</span> <span class="id" type="var">equiv_equiv</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_trans</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;  <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>;<br/>
<span class="id" type="tactic">cut</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">triple</span> : <span class="id" type="var">term</span> * (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">triple</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">s</span>,(t,u)) =&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">u_lt_t</span> <span class="id" type="var">t_lt_s</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">s</span>,(t,u))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">triple</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">triple</span>; <br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">well_founded_ind</span> <span class="id" type="var">wf_size3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">triple</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">triple</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] [<span class="id" type="var">t</span> <span class="id" type="var">u</span>]] <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t_lt_v</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t_lt_v</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t_lt_fl</span> <span class="id" type="var">u_lt_t</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_lt_fl</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f''</span> <span class="id" type="var">l'</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_in_l'</span> <span class="id" type="var">t_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f''</span> <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l'</span> <span class="id" type="var">f'_prec_f</span> <span class="id" type="var">H''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l'</span> <span class="id" type="var">Sf</span> <span class="id" type="var">L</span> <span class="id" type="var">l'_lt_l</span> <span class="id" type="var">H</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l'</span> <span class="id" type="var">Sf</span> <span class="id" type="var">l'_lt_l</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">t_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">t_lt_t'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span>  <span class="id" type="var">_</span> <span class="id" type="var">t_eq_t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t'</span>,(t,u))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex1_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u_lt_t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f''</span> <span class="id" type="var">l''</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_in_l'</span> <span class="id" type="var">u_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">f''_prec_f'</span> <span class="id" type="var">H'''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="var">H</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">l''_lt_l'</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">u_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">u_lt_t'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_t'</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,(t',u))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex2_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">prec_transitive</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l''</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex3_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l''</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex3_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l''</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex3_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_subterm_mem</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f'</span> <span class="id" type="var">l''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u_lt_t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f''</span> <span class="id" type="var">l''</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_in_l'</span> <span class="id" type="var">u_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">f''_prec_f'</span> <span class="id" type="var">H'''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L'</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="var">H</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">l''_lt_l'</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">u_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">u_lt_t'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_t'</span>);<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_subterm_mem</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">t'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex2_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l''</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex3_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">L</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">L</span> | [<span class="id" type="var">L1</span> <span class="id" type="var">L2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">L'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">L'</span> | [<span class="id" type="var">L1'</span> <span class="id" type="var">L2'</span>]].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">l'_lt_l</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">l'_lt_l</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="var">IH</span> <span class="id" type="var">H0</span> <span class="id" type="var">H3</span> <span class="id" type="var">t_lt_fl</span> <span class="id" type="var">u_lt_t</span> <span class="id" type="var">L</span> <span class="id" type="var">L'</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">l'_lt_l</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l'_lt_l</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l'_lt_l</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t</span> <span class="id" type="var">s'</span> <span class="id" type="var">k'</span> <span class="id" type="var">k</span> <span class="id" type="var">t_lt_s</span>  | <span class="id" type="var">t</span> <span class="id" type="var">s'</span> <span class="id" type="var">k'</span> <span class="id" type="var">k</span> <span class="id" type="var">t_eq_s</span> <span class="id" type="var">k'_lt_k</span> | <span class="id" type="var">t</span> <span class="id" type="var">k</span>];<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">u</span> <span class="id" type="var">t'</span> <span class="id" type="var">k''</span> <span class="id" type="var">h'</span> <span class="id" type="var">u_lt_t</span> | <span class="id" type="var">u</span> <span class="id" type="var">t'</span> <span class="id" type="var">k''</span> <span class="id" type="var">h'</span> <span class="id" type="var">u_eq_t</span> <span class="id" type="var">k''_lt_k'</span> | <span class="id" type="var">u</span> <span class="id" type="var">k1</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s</span>,(t,u))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_nil</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">t_eq_s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_eq</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">k'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">o_size3_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k'</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k''</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex1_bis</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_nil</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">discriminate</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">discriminate</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">discriminate</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l''</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex3_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u_lt_t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f''</span> <span class="id" type="var">l''</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_in_l'</span> <span class="id" type="var">u_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">f''_prec_f'</span> <span class="id" type="var">H'''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="var">H</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">l''_lt_l'</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u_le_t'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">u_eq_t'</span> | <span class="id" type="var">t''</span> <span class="id" type="var">t'''</span> <span class="id" type="var">u_lt_t'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_t'</span>);<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_subterm_mem</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">t'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex2_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_subterm_mem</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l''</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>, <span class="id" type="var">u</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex3_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l'_lt_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">P'</span> <span class="id" type="var">P</span> <span class="id" type="var">ls_lt_alg</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l''_lt_l'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> <span class="id" type="var">lg'</span> <span class="id" type="var">ls'</span> <span class="id" type="var">lc'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">Q'</span> <span class="id" type="var">Q</span> <span class="id" type="var">ls'_lt_alg'</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q</span>.<br/>
<span class="id" type="tactic">destruct</span> (@<span class="id" type="var">ac_syntactic</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Q</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k1</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k3</span> [<span class="id" type="var">k4</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P3</span> <span class="id" type="var">P4</span>]]]]]]].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> (<span class="id" type="var">lg</span> ++ <span class="id" type="var">k2</span>) (<span class="id" type="var">ls'</span> ++ <span class="id" type="var">k3</span>) <span class="id" type="var">k1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Q'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_permut0_app_app</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>;[|apply <span class="id" type="var">equiv_equiv</span>|apply (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_permut0_app_app</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_mem_ls'_k3</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_mem_ls'_k3</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_mem_ls'_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_mem_ls'</span> | <span class="id" type="var">b_mem_k3</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls'_lt_alg'</span>  <span class="id" type="var">_</span> <span class="id" type="var">b_mem_ls'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a''</span> [<span class="id" type="var">a''_in_a'lg'</span> <span class="id" type="var">b_lt_a''</span>]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a''</span> <span class="id" type="var">P4</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">a''_in_a'lg'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a''_in_a'lg'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a''_in_a'lg'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a''_mem_k2</span> | <span class="id" type="var">a''_mem_k4</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">a''</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a3</span> [<span class="id" type="var">a3_in_alg</span> <span class="id" type="var">a''_lt_a3</span>]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a''</span> <span class="id" type="var">P2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a3</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">a3</span>,(a'',b))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size3_lex1_mem</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a3</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">b</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a''</span> [<span class="id" type="var">a''_in_alg</span> <span class="id" type="var">b_lt_a''</span>]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_mul_remove_equiv_aux</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">False</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">s'</span> :: <span class="id" type="var">l'</span>) -&gt; <span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">Antirefl</span> <span class="id" type="var">s_eq_s'</span> <span class="id" type="var">sl_lt_s'l'</span>;  <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">sl_lt_s'l'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">k'</span> <span class="id" type="var">k</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_mem_ls_lc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">P</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_mem_ls_lc</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s_mem_ls_lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s_mem_ls</span> | <span class="id" type="var">s_mem_lc</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s'_mem_alg_lc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s'</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span> ++ <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">s'</span> <span class="id" type="var">P'</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s'_mem_alg_lc</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s'_mem_alg_lc</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s'_mem_alg_lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'_mem_alg</span> | <span class="id" type="var">s'_mem_lc</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">lg</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">g</span> <span class="id" type="var">lg</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s'_eq_a</span> : <span class="id" type="var">equiv</span> <span class="id" type="var">s'</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s'_mem_alg</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">_</span> <span class="id" type="var">s_mem_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a'_mem_nil</span>] <span class="id" type="var">b_lt_a'</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Antirefl</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s_eq_s'</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_eq_a</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_a'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_mem_alg</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">alg'</span> [<span class="id" type="var">alg''</span> [<span class="id" type="var">s'_eq_u'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s'_eq_u'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P''</span> : <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l'</span> ((<span class="id" type="var">alg'</span> ++ <span class="id" type="var">alg''</span>) ++ <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_mem_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">ls'</span> [<span class="id" type="var">ls''</span> [<span class="id" type="var">s_eq_u</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_eq_u</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ls'ls''_lt_alg'alg''</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> (<span class="id" type="var">ls'</span> ++ <span class="id" type="var">ls''</span>) -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">a'</span> (<span class="id" type="var">alg'</span> ++ <span class="id" type="var">alg''</span>) /\ <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">a'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_ls'ls''</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">b</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_mem_aglg</span> <span class="id" type="var">b_lt_a'</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a'_mem_aglg</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a'_mem_aglg</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a'_mem_aglg</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a'_mem_alg'</span> | [<span class="id" type="var">u'_eq_a'</span> | <span class="id" type="var">a'_mem_alg''</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">a'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a''</span> [<span class="id" type="var">a''_mem_aglg</span> <span class="id" type="var">a'_lt_a''</span>]].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">diff_mem_remove</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''_eq_u'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">u</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">u''</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">u_eq_u''</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_eq_u''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Antirefl</span> <span class="id" type="var">u''</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">u''</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u''_eq_u'</span> : <span class="id" type="var">equiv</span> <span class="id" type="var">u''</span> <span class="id" type="var">u'</span>).<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u''_eq_u'</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u'_eq_a'</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">u''_eq_u'</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a''_eq_u'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> : <span class="id" type="var">length</span> (<span class="id" type="var">alg'</span> ++ <span class="id" type="var">alg''</span>) = <span class="id" type="var">S</span> (<span class="id" type="var">length</span> <span class="id" type="var">lg</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span>) <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">length_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L''</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">alg'</span> ++ <span class="id" type="var">alg''</span>) <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">lg'</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a'</span> <span class="id" type="var">lg'</span> (<span class="id" type="var">ls'</span> ++ <span class="id" type="var">ls''</span>) <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>;[|apply <span class="id" type="var">equiv_equiv</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_mem_lc</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> [<span class="id" type="var">lc'</span> [<span class="id" type="var">lc''</span> [<span class="id" type="var">s_eq_s''</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_eq_s''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> (<span class="id" type="var">lc'</span> ++ <span class="id" type="var">lc''</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_mem_lc</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> [<span class="id" type="var">lc'</span> [<span class="id" type="var">lc''</span> [<span class="id" type="var">s_eq_s''</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_eq_s''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> (<span class="id" type="var">lc'</span> ++ <span class="id" type="var">lc''</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_antirefl</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3_mem</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_lt_v</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">v_lt_v</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">t_lt_t</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_lt_t</span>  <span class="id" type="keyword">as</span> [ <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">s''</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l</span> <span class="id" type="var">s_le_s'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">f''</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">f_prec_f</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf</span> <span class="id" type="var">L</span> <span class="id" type="var">l_lt_l</span> <span class="id" type="var">H</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf</span> <span class="id" type="var">l_lt_l</span> ]; <span class="id" type="tactic">clear</span> <span class="id" type="var">t_lt_t</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">s'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">s_le_s'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">s_eq_s'</span> | <span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">s_lt_s'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s_eq_s'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>];<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l_lt_l</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">s</span> <span class="id" type="var">t'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">s_lt_t</span> | <span class="id" type="var">s</span> <span class="id" type="var">t'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">s_eq_t</span> <span class="id" type="var">l'_lt_l''</span> | <span class="id" type="var">s</span> <span class="id" type="var">l'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">f</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l_lt_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> := <span class="id" type="var">permut_length</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl0</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_mem_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_mul_remove_equiv_aux</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_closure</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span><br/>
&nbsp;<span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">s</span>) /\<br/>
&nbsp;&nbsp;(<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">False</span>) /\<br/>
&nbsp;&nbsp;(<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">False</span>) /\<br/>
&nbsp;&nbsp;(<span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_trans</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_antirefl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s_le_t</span> <span class="id" type="var">t_le_s</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s_le_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">s_eq_t</span> | <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">s_lt_t</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t_le_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">t_eq_s</span> | <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">t_lt_s</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab96"></a><h2 class="section">Well-foundedness of rpo.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_acc_rpo</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">t'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_t'</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">t_eq_t'</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span>]; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">rpo_lex_rest</span> (<span class="id" type="var">bb</span> <span class="id" type="var">bb'</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
| <span class="id" type="var">Rpo_lex_rest</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, (<span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">length</span> <span class="id" type="var">l'</span> \/ (<span class="id" type="var">length</span> <span class="id" type="var">l'</span> &lt;= <span class="id" type="var">bb</span> /\ <span class="id" type="var">length</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">bb</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb'</span>) <span class="id" type="var">s</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb'</span>) <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rpo_lex_rest</span> <span class="id" type="var">bb</span> <span class="id" type="var">bb'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_rpo_lex_rest</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">bb'</span>, <span class="id" type="var">well_founded</span> (<span class="id" type="var">rpo_lex_rest</span> <span class="id" type="var">bb</span> <span class="id" type="var">bb'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_founded</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb'</span> <span class="id" type="var">l</span>; <span class="id" type="var">revert</span> <span class="id" type="var">bb'</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>] <span class="id" type="var">L</span> <span class="id" type="var">bb'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_k</span> <span class="id" type="var">Acc_k'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_k</span> <span class="id" type="var">Acc_k'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_k</span> <span class="id" type="var">Acc_k'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_a</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb'</span>) <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_k</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> : <span class="id" type="var">term</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb'</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_k</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_k'</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">clear</span> -IHn <span class="id" type="var">Acc_a</span> <span class="id" type="var">L</span> <span class="id" type="var">Acc_l'</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l</span> <span class="id" type="var">L</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_a</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">Acc_a</span> <span class="id" type="var">IHa</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">L</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l'</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span> <span class="id" type="var">bb'</span>).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">IHl</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_al</span> <span class="id" type="var">Acc_l''</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">L'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">L'</span> | [<span class="id" type="var">L1</span> <span class="id" type="var">L2</span>]]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">inversion</span> <span class="id" type="var">L2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">s'</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">u_lt_s</span> | <span class="id" type="var">s'</span> <span class="id" type="var">s''</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">s'_eq_s</span> <span class="id" type="var">k'_lt_l</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> | <span class="id" type="var">u</span> <span class="id" type="var">k'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHa</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l''</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k''</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">k'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">constructor</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l''</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l''</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span>  <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k1</span> <span class="id" type="var">k1'</span> <span class="id" type="var">L''</span> <span class="id" type="var">Acc_l1</span> <span class="id" type="var">Acc_l1'</span> <span class="id" type="var">H1'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">s_eq_a</span> | <span class="id" type="var">s_in_k'</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s_eq_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">s''</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k1''</span> <span class="id" type="var">u_lt_s</span> | <span class="id" type="var">s1'</span> <span class="id" type="var">s''</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k1''</span> <span class="id" type="var">s'_eq_s1</span> <span class="id" type="var">k'_lt_l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> | <span class="id" type="var">u</span> <span class="id" type="var">k1'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_eq_s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">constructor</span> 2; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">constructor</span> 3.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">L''</span> <span class="id" type="var">Acc_l1</span> <span class="id" type="var">Acc_l1'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb'</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_k</span> <span class="id" type="var">Acc_k'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">clear</span> -IHbb <span class="id" type="var">Acc_k</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_a</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb'</span>) <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_k</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> : <span class="id" type="var">term</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb'</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_k</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_k</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_a</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">Acc_a</span> <span class="id" type="var">IHa</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_founded_ind</span> (<span class="id" type="var">IHbb</span> <span class="id" type="var">bb'</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">L</span> <span class="id" type="var">Acc_al</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">s'</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">u_lt_s</span> | <span class="id" type="var">s'</span> <span class="id" type="var">s''</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">s'_eq_s</span> <span class="id" type="var">k'_lt_l</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> | <span class="id" type="var">u</span> <span class="id" type="var">k'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHa</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k''</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">k'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">constructor</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">L</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">L</span> | [<span class="id" type="var">L1</span> <span class="id" type="var">L2</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_al</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span>  <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">k1</span> <span class="id" type="var">k1'</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_l1</span> <span class="id" type="var">Acc_l1'</span> <span class="id" type="var">H1'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">s_eq_a</span> | <span class="id" type="var">s_in_k'</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s_eq_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">s''</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k1''</span> <span class="id" type="var">u_lt_s</span> | <span class="id" type="var">s1'</span> <span class="id" type="var">s''</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k1''</span> <span class="id" type="var">s'_eq_s1</span> <span class="id" type="var">k'_lt_l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> | <span class="id" type="var">u</span> <span class="id" type="var">k1'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_eq_s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">constructor</span> 2; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">constructor</span> 3.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">L'</span> <span class="id" type="var">Acc_l1</span> <span class="id" type="var">Acc_l1'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Definition of a finer grain for multiset extension. 
</div>
<div class="code">
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">rpo_mul_step</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">List_mul_step</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>,  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l'</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">lc</span>) -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lc</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span>.<br/>

<br/>
</div>

<div class="doc">
The plain multiset extension is in the transitive closure of
the finer grain extension. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_mul_trans_clos</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> (<span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span>) (<span class="id" type="var">clos_trans</span> <span class="id" type="var">_</span> (<span class="id" type="var">rpo_mul_step</span> <span class="id" type="var">bb</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">inclusion</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">P'</span> <span class="id" type="var">P</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">ls_lt_alg</span>;<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">lg</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">g</span> <span class="id" type="var">lg</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">ls_lt_alg</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_ls</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a'_eq_a</span> | <span class="id" type="var">a'_in_nil</span>] <span class="id" type="var">b_lt_a'</span>]].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_eq_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>: <span class="id" type="var">exists</span> <span class="id" type="var">ls1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">ls2</span>, <br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">ls</span> (<span class="id" type="var">ls1</span> ++ <span class="id" type="var">ls2</span>) /\<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls1</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">g</span>) /\<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls2</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">a'</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span>) /\ <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">a'</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ls</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">ls</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">intuition</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHls</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ls1</span> [<span class="id" type="var">ls2</span> [<span class="id" type="var">P'</span> [<span class="id" type="var">ls1_lt_g</span> <span class="id" type="var">ls2_lt_alg</span>]]]].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_ls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ls_lt_alg</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a'_eq_a</span> | [<span class="id" type="var">a'_eq_g</span> | <span class="id" type="var">a'_in_lg</span>]] <span class="id" type="var">b_lt_a'</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">ls1</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">ls2</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_s</span> | <span class="id" type="var">b_in_ls2</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_s</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_eq_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls2_lt_alg</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">ls1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">ls2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_s</span> | <span class="id" type="var">b_in_ls1</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_s</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_eq_g</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls1_lt_g</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">ls1</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">ls2</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_s</span> | <span class="id" type="var">b_in_ls2</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls2_lt_alg</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ls1</span> [<span class="id" type="var">ls2</span> [<span class="id" type="var">Pls</span> [<span class="id" type="var">ls1_lt_g</span> <span class="id" type="var">ls2_lt_alg</span>]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">g</span> :: <span class="id" type="var">ls2</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">g</span> <span class="id" type="var">ls1</span> (<span class="id" type="var">ls2</span> ++ <span class="id" type="var">lc</span>)); <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHlg</span> (<span class="id" type="var">g</span> :: <span class="id" type="var">ls2</span> ++ <span class="id" type="var">lc</span>) <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls2</span> (<span class="id" type="var">g</span> :: <span class="id" type="var">lc</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>;[|apply <span class="id" type="var">equiv_equiv</span>|apply (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>;[<span class="id" type="tactic">reflexivity</span>|apply <span class="id" type="var">equiv_equiv</span>|apply (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>;[<span class="id" type="tactic">reflexivity</span>|apply <span class="id" type="var">equiv_equiv</span>|apply (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">rpo_mul_rest</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
| <span class="id" type="var">Rpo_mul_rest</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rpo_mul_rest</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">rpo_mul_step_rest</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
| <span class="id" type="var">Rpo_mul_step_rest</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rpo_mul_step_rest</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_mul_rest_trans_clos</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> (<span class="id" type="var">rpo_mul_rest</span> <span class="id" type="var">bb</span>) (<span class="id" type="var">clos_trans</span> <span class="id" type="var">_</span> (<span class="id" type="var">rpo_mul_step_rest</span> <span class="id" type="var">bb</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">inclusion</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">H'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">P'</span> <span class="id" type="var">P</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">P'</span> <span class="id" type="var">P</span> <span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span>; <br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">P'</span> <span class="id" type="var">P</span> <span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">H</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">lg</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">g</span> <span class="id" type="var">lg</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">P'</span> <span class="id" type="var">P</span> <span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rpo_mul_step_rest</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_ls</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a'_eq_a</span> | <span class="id" type="var">a'_in_nil</span>] <span class="id" type="var">b_lt_a'</span>]].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_eq_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>: <span class="id" type="var">exists</span> <span class="id" type="var">ls1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">ls2</span>, <br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">ls</span> (<span class="id" type="var">ls1</span> ++ <span class="id" type="var">ls2</span>) /\<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls1</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">g</span>) /\<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls2</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">a'</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span>) /\ <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">a'</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ls</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">ls</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">intuition</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHls</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ls1</span> [<span class="id" type="var">ls2</span> [<span class="id" type="var">P'</span> [<span class="id" type="var">ls1_lt_g</span> <span class="id" type="var">ls2_lt_alg</span>]]]].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_ls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ls_lt_alg</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a'_eq_a</span> | [<span class="id" type="var">a'_eq_g</span> | <span class="id" type="var">a'_in_lg</span>]] <span class="id" type="var">b_lt_a'</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">ls1</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">ls2</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_s</span> | <span class="id" type="var">b_in_ls2</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_s</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_eq_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls2_lt_alg</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">ls1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">ls2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_s</span> | <span class="id" type="var">b_in_ls1</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_s</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_eq_g</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls1_lt_g</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">ls1</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">ls2</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_s</span> | <span class="id" type="var">b_in_ls2</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls2_lt_alg</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ls1</span> [<span class="id" type="var">ls2</span> [<span class="id" type="var">Pls</span> [<span class="id" type="var">ls1_lt_g</span> <span class="id" type="var">ls2_lt_alg</span>]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">g</span> :: <span class="id" type="var">ls2</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rpo_mul_step_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">g_eq_s</span> | <span class="id" type="var">s_mem_ls2lc</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_mem_ls2lc</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s_mem_ls2lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s_mem_ls2</span> | <span class="id" type="var">s_mem_lc</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pls</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">g</span> <span class="id" type="var">ls1</span> (<span class="id" type="var">ls2</span> ++ <span class="id" type="var">lc</span>)); <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pls</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHlg</span> (<span class="id" type="var">g</span> :: <span class="id" type="var">ls2</span> ++ <span class="id" type="var">lc</span>) <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">ls2</span> (<span class="id" type="var">g</span> :: <span class="id" type="var">lc</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>;[|apply <span class="id" type="var">equiv_equiv</span>|apply (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>;[<span class="id" type="tactic">reflexivity</span>|apply <span class="id" type="var">equiv_equiv</span>|apply (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">g_eq_s</span> | <span class="id" type="var">s_mem_ls2lc</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_mem_ls2lc</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s_mem_ls2lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s_mem_ls2</span> | <span class="id" type="var">s_mem_lc</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pls</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Splitting in two disjoint cases. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">two_cases_rpo</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">m</span> <span class="id" type="var">n</span>, <br/>
&nbsp;<span class="id" type="var">rpo_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">n</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>) -&gt;<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">n'</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">n</span> (<span class="id" type="var">a'</span> :: <span class="id" type="var">n'</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">n'</span> <span class="id" type="var">m</span>) \/<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">ls</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) /\ <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">n</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">m</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">b</span> <span class="id" type="var">m</span> <span class="id" type="var">n</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">M</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">P'</span> <span class="id" type="var">P</span> <span class="id" type="var">ls_lt_a</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">b_mem_a_lc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">b</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">b</span> <span class="id" type="var">P</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_mem_a_lc</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">b_mem_a_lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_mem_lc</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">ls</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> <span class="id" type="var">c_mem_ls</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_a</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls_lt_a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;  <span class="id" type="tactic">try</span> (<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>). <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">symmetry</span>;<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">b_mem_lc</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">b'</span> [<span class="id" type="var">lc1</span> [<span class="id" type="var">lc2</span> [<span class="id" type="var">b_eq_b'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]];<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_eq_b'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">ls</span> ++ (<span class="id" type="var">lc1</span> ++ <span class="id" type="var">lc2</span>)); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">lc</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_sym</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>;[|apply <span class="id" type="var">equiv_equiv</span>|apply (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>)].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> (<span class="id" type="var">lc1</span> ++ <span class="id" type="var">lc2</span>)); <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut0_cons_inside</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">m</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lc1</span>) <span class="id" type="var">lc2</span> <span class="id" type="var">b_eq_b'</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">lc</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut_map_acc</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> -&gt;<br/>
&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">rpo_mul_step_rest</span> <span class="id" type="var">bb</span>) <span class="id" type="var">l</span> -&gt;  <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo_mul_step_rest</span> <span class="id" type="var">bb</span>) <span class="id" type="var">l'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">P</span> <span class="id" type="var">A1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l''</span> <span class="id" type="var">M2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">A1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">M2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">Acc_l''</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">P''</span> <span class="id" type="var">P'</span> <span class="id" type="var">ls_lt_a</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rpo_mul_step_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul_step</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Multiset extension of rpo on accessible terms lists is well-founded. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_rpo_mul_rest</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span>, <span class="id" type="var">well_founded</span> (<span class="id" type="var">rpo_mul_rest</span> <span class="id" type="var">bb</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">clos_trans</span> <span class="id" type="var">_</span> (<span class="id" type="var">rpo_mul_step_rest</span> <span class="id" type="var">bb</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">inclusion</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_mul_rest_trans_clos</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_clos_trans</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">well_founded</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">m</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>  <span class="id" type="var">P</span> <span class="id" type="var">P'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> := <span class="id" type="var">permut_length</span> <span class="id" type="var">P'</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo_mul_step_rest</span> <span class="id" type="var">bb</span>) (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Acc_s</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span>; <br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_ind</span> <span class="id" type="keyword">with</span> <span class="id" type="var">term</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">IHs</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_ind</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) (<span class="id" type="var">rpo_mul_step_rest</span> <span class="id" type="var">bb</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s_k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Acc_s_l</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (@<span class="id" type="var">two_cases_rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">s'</span> [<span class="id" type="var">n'</span> [<span class="id" type="var">s_eq_s'</span> [<span class="id" type="var">P</span> <span class="id" type="var">H''</span>]]]] | [<span class="id" type="var">ls</span> [<span class="id" type="var">ls_lt_s</span> <span class="id" type="var">P</span>]]].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">list_permut_map_acc</span> <span class="id" type="var">bb</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">n'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span> || <span class="id" type="tactic">auto</span>. <span class="id" type="tactic">symmetry</span>;<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l''</span> <span class="id" type="var">l''_lt_s'_n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">n'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rpo_mul_step_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_s_l</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s''</span> <span class="id" type="var">s''_in_n'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">s''</span> <span class="id" type="var">P</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">list_permut_map_acc</span> <span class="id" type="var">bb</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_sym</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ls</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b</span> <span class="id" type="var">ls</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHs</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ls_lt_s</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHls</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ls_lt_s</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Acc_s_l</span> <span class="id" type="var">Acc_l'</span>]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_s_l</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">rpo_rest</span> (<span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>) : (<span class="id" type="var">symbol</span> * <span class="id" type="var">list</span> <span class="id" type="var">term</span>) -&gt; (<span class="id" type="var">symbol</span> * <span class="id" type="var">list</span> <span class="id" type="var">term</span>) -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;| <span class="id" type="var">Top_gt_rest</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">prec</span> <span class="id" type="var">Prec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_rest</span> <span class="id" type="var">bb</span> (<span class="id" type="var">g</span>, <span class="id" type="var">l'</span>) (<span class="id" type="var">f</span>, <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Top_eq_lex_rest</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span> = <span class="id" type="var">Lex</span> -&gt; (<span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">length</span> <span class="id" type="var">l'</span> \/ <span class="id" type="var">length</span> <span class="id" type="var">l'</span> &lt;= <span class="id" type="var">bb</span> /\ <span class="id" type="var">length</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">bb</span>) -&gt; <span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_rest</span> <span class="id" type="var">bb</span> (<span class="id" type="var">f</span>, <span class="id" type="var">l'</span>) (<span class="id" type="var">f</span>, <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Top_eq_mul_rest</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span> = <span class="id" type="var">Mul</span> -&gt; <span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_rest</span> <span class="id" type="var">bb</span> (<span class="id" type="var">f</span>, <span class="id" type="var">l'</span>) (<span class="id" type="var">f</span>, <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_rpo_rest</span> : <span class="id" type="var">well_founded</span> (<span class="id" type="var">prec</span> <span class="id" type="var">Prec</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span>, <span class="id" type="var">well_founded</span> (<span class="id" type="var">rpo_rest</span> <span class="id" type="var">bb</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">wf_prec</span> <span class="id" type="var">bb</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_founded</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">f</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_founded_induction_type</span> <span class="id" type="var">wf_prec</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">IHf</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Sf</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f'</span>, <span class="id" type="var">f'</span> = <span class="id" type="var">f</span> -&gt; <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f'</span> = <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">Sf</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Sf</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_founded_induction_type</span> (<span class="id" type="var">wf_rpo_lex_rest</span> <span class="id" type="var">bb</span> <span class="id" type="var">bb</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">g</span> <span class="id" type="var">l'</span>] <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f'</span> <span class="id" type="var">g'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">g_prec_f</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">H'</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">H'</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rpo_lex_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Lex</span> = <span class="id" type="var">Mul</span>); [<span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_eq</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">auto</span>].<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_founded_induction_type</span> (<span class="id" type="var">wf_rpo_mul_rest</span> <span class="id" type="var">bb</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">g</span> <span class="id" type="var">l'</span>] <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f'</span> <span class="id" type="var">g'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">g_prec_f</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">H'</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">H'</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Acc_l'</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Lex</span> = <span class="id" type="var">Mul</span>); [<span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_eq</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">auto</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rpo_mul_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_build</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">prec</span> <span class="id" type="var">Prec</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">f_l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f_l</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">f</span>, <span class="id" type="var">l</span>) =&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">t</span>) -&gt;  <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">wf_prec</span> <span class="id" type="var">bb</span> <span class="id" type="var">f_l</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">f_l</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_founded_induction_type</span> (<span class="id" type="var">wf_rpo_rest</span> <span class="id" type="var">wf_prec</span> <span class="id" type="var">bb</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">f_l</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">IH</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3_mem</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_lt_v</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t_lt_v</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">IHl</span> <span class="id" type="var">gk_lt_fl</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">gk_lt_fl</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">s'</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">g'</span> <span class="id" type="var">k'</span> <span class="id" type="var">l'</span> <span class="id" type="var">g_prec_f</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k'</span> <span class="id" type="var">l'</span> <span class="id" type="var">Sf</span> <span class="id" type="var">L</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k'</span> <span class="id" type="var">l'</span> <span class="id" type="var">Sf</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> := <span class="id" type="var">Acc_l</span> <span class="id" type="var">_</span> <span class="id" type="var">t_in_l</span>).<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">s_eq_t</span> | <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">s_lt_t</span> ]; <br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span> ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>) <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_k</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">k</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_mem_k</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">g</span>,k)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_k</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">k</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_mem_k</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">f</span>,k)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_k</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">k</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_mem_k</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">f</span>,k)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul_rest</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab97"></a><h2 class="section">Main theorem: when the precedence is well-founded, so is the rpo.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_rpo</span> : <span class="id" type="var">well_founded</span> (<span class="id" type="var">prec</span> <span class="id" type="var">Prec</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span>, <span class="id" type="var">well_founded</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">wf_prec</span> <span class="id" type="var">bb</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">well_founded</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3_mem</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_lt_t</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">s_lt_t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">acc_build</span> <span class="id" type="var">wf_prec</span> <span class="id" type="var">bb</span> (<span class="id" type="var">f</span>,l)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab98"></a><h2 class="section">RPO is compatible with the instanciation by a substitution.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">equiv</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3_mem</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">s</span> <span class="id" type="var">v_eq_s</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">v_eq_s</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">s</span> <span class="id" type="var">fl_eq_s</span> <span class="id" type="var">sigma</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">fl_eq_s</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">s'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span> <span class="id" type="var">l1_eq_l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span> <span class="id" type="var">P</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1_eq_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">fl_eq_s</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1_eq_l2</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1_eq_l2</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_eq_l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">s'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l'</span> <span class="id" type="var">s1_eq_s'</span> <span class="id" type="var">l1'_eq_l'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut_map</span> (<span class="id" type="var">A</span> := <span class="id" type="var">term</span>) (<span class="id" type="var">B</span> := <span class="id" type="var">term</span>) (<span class="id" type="var">A'</span> := <span class="id" type="var">term</span>) (<span class="id" type="var">B'</span> := <span class="id" type="var">term</span>) (<span class="id" type="var">R</span> := <span class="id" type="var">equiv</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1_in_l1</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_eq_a2</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a1</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">cut</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">s</span>,t) =&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">s</span>,t)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">well_founded_ind</span> <span class="id" type="var">wf_size2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s</span> <span class="id" type="var">t</span>] <span class="id" type="var">IH</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="var">sigma</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">R'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">R'</span> <span class="id" type="var">R''</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">f_lex</span> <span class="id" type="var">L</span> <span class="id" type="var">Rlex</span> <span class="id" type="var">R'</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">f_mul</span> <span class="id" type="var">Rmul</span> <span class="id" type="var">R'</span> <span class="id" type="var">H2</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t'_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">t'_eq_t''</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]];<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t'_eq_t''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">R'</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">s'</span> <span class="id" type="var">R''</span> | <span class="id" type="var">s'</span> <span class="id" type="var">t''</span> <span class="id" type="var">R''</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s</span>,t')); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex2_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l'_sigma</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_mem_l'_sigma</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">s'_eq_s''</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]];<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s'_eq_s''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_eq_s''</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s''_in_l'_sigma</span> : <span class="id" type="var">In</span> <span class="id" type="var">s''</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s''_in_l'_sigma</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s''_in_l'_sigma</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">s_eq_u_sigma</span> <span class="id" type="var">u_in_l'</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">s''</span>; <br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>)) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">u</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span> <span class="id" type="var">Rlex</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="var">Rlex</span> <span class="id" type="var">R'</span> <span class="id" type="var">IH</span> <span class="id" type="var">L</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s'</span> <span class="id" type="var">l'</span> ]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">Rlex</span> <span class="id" type="var">IH</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Rlex</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> <span class="id" type="var">t'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">s'_lt_t'</span> <span class="id" type="var">L</span> | <span class="id" type="var">s''</span> <span class="id" type="var">t'</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">s'_eq_t'</span> <span class="id" type="var">k_lt_k'</span> | ]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_nil</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s'</span>,t')); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s</span> <span class="id" type="var">t</span>] <span class="id" type="var">S</span> <span class="id" type="var">s_lt_t</span> <span class="id" type="var">tau</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s</span>,t)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">o_size2_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_bis</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l'_sigma</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_mem_l'_sigma</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">s'_eq_s''</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]];<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s'_eq_s''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_eq_s''</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s''_in_l'_sigma</span> : <span class="id" type="var">In</span> <span class="id" type="var">s''</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s''_in_l'_sigma</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s''_in_l'_sigma</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">s_eq_u_sigma</span> <span class="id" type="var">u_in_l'</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">s''</span>; <br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>)) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">u</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Rmul</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l0</span> <span class="id" type="var">k0</span> <span class="id" type="var">Pk</span> <span class="id" type="var">Pl</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">a</span>) (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">lg</span>)<br/>
(<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">ls</span>) (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">map_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_map</span> <span class="id" type="keyword">with</span> <span class="id" type="var">equiv</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_b'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">refine</span> (@<span class="id" type="var">permut_map</span> <span class="id" type="var">term</span> <span class="id" type="var">term</span> <span class="id" type="var">term</span> <span class="id" type="var">term</span> <span class="id" type="var">equiv</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span> ++ <span class="id" type="var">lc</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">b_in_l</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_b'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_mem_ls_sigma</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">b_mem_ls_sigma</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">b'</span> [<span class="id" type="var">ls1</span> [<span class="id" type="var">ls2</span> [<span class="id" type="var">b_eq_b'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]];<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_eq_b'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">b'_in_ls_sigma</span> : <span class="id" type="var">In</span> <span class="id" type="var">b'</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">ls</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b'_in_ls_sigma</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b'_in_ls_sigma</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b''</span> [<span class="id" type="var">b''_sigma_eq_b'</span> <span class="id" type="var">b''_in_ls</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">b''</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_mem_alg</span> <span class="id" type="var">b''_lt_a'</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_mem_alg</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a''</span> [<span class="id" type="var">alg'</span> [<span class="id" type="var">alg''</span> [<span class="id" type="var">a'_eq_a''</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]];<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a'_eq_a''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">a''</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_map_iff</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">lg</span>)).<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_b'</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">b''</span>,a'')).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a'_eq_a''</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eq_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">Heq</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">Hlt</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_subst</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_subst</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab99"></a><h2 class="section">RPO is compatible with adding context.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_add_context</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">is_a_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">equiv</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span>) (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">p</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span> ]; <span class="id" type="tactic">intros</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">R</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ctx</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span> ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Status</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span>, <span class="id" type="var">g</span> = <span class="id" type="var">f</span> -&gt; <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">g</span> = <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 (<span class="id" type="tactic">rewrite</span> <span class="id" type="var">replace_at_pos_unfold</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">Status</span> <span class="id" type="var">f</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">Status</span>; <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Status</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u'</span> <span class="id" type="var">l'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_add_context</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">p</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">is_a_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span>) (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">p</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span> ]; <span class="id" type="tactic">intros</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">R</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ctx</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span> ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Status</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span>, <span class="id" type="var">g</span> = <span class="id" type="var">f</span> -&gt; <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">g</span> = <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 (<span class="id" type="tactic">rewrite</span> <span class="id" type="var">replace_at_pos_unfold</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">Status</span> <span class="id" type="var">f</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">Status</span>; <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Status</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">i</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHi</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">List_eq</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_ls</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">exists</span> <span class="id" type="var">s''</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s'</span> <span class="id" type="var">s''</span> /\ <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s''</span> (<span class="id" type="var">replace_at_pos_list</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">i</span> <span class="id" type="var">p</span>)).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_ls</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_ls</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> [<span class="id" type="var">s'_eq_s''</span> | <span class="id" type="var">s'_mem_l</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_eq_s''</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> [<span class="id" type="var">s'_eq_u</span> | <span class="id" type="var">s'_mem_l</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> [<span class="id" type="var">s'_le_s''</span> <span class="id" type="var">s''_mem_l'</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s''</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> [<span class="id" type="var">s'_le_s''</span> <span class="id" type="var">s''_mem_l'</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span>].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>) <span class="id" type="var">nil</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">u</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_s'</span> | <span class="id" type="var">b_mem_nil</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">b_eq_s'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">IHl</span> <span class="id" type="var">i</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> (<span class="id" type="var">u</span> :: <span class="id" type="var">lc</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eq_add_context</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">p</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">is_a_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span>) (<span class="id" type="var">replace_at_pos</span> <span class="id" type="var">ctx</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">p</span> <span class="id" type="var">ctx</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_add_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_add_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">remove_equiv</span> (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; @<span class="id" type="var">None</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span>  <span class="id" type="var">equiv_dec</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; @ <span class="id" type="var">None</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="var">Function</span>  <span class="id" type="var">remove_equiv_list</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) * (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">nil</span> =&gt; (<span class="id" type="var">l1</span>,l2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">_</span> =&gt; (<span class="id" type="var">l1</span>,l2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l2'</span> =&gt;  <span class="id" type="var">remove_equiv_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">l1'</span>,l2') =&gt; (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1'</span>, <span class="id" type="var">l2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_is_sound_some</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">remove_equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">l'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">t'</span> | <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l</span> (<span class="id" type="var">t'</span> :: <span class="id" type="var">l'</span>)}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_dec</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t_eq_a</span> | <span class="id" type="var">t_diff_a</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">R</span>;<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">l''</span> | ].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">l''</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">t_eq_t'</span> <span class="id" type="var">P</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (@<span class="id" type="var">permut0_cons_inside</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> (<span class="id" type="var">t'</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">l''</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_is_sound_none</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>, <span class="id" type="var">remove_equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t'</span> <span class="id" type="var">l</span> -&gt; ~ (<span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> <br/>
&nbsp;&nbsp;[ <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_eq_a</span> <span class="id" type="var">_</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_diff_a</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">t_diff_a</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span> ].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t'</span> [<span class="id" type="var">a_eq_t'</span> | <span class="id" type="var">t'_mem_l</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t_eq_t'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t_diff_a</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_list_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">l1'</span>,l2') =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">lc</span> | <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">lc</span>) /\ <span class="id" type="var">permut0</span> <span class="id" type="var">equiv</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">lc</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2'</span> -&gt; ~ <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>)}<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span><br/>
[ <span class="id" type="var">l1</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">_</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">R</span>].<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">destruct</span> (@<span class="id" type="var">remove_equiv_is_sound_some</span> <span class="id" type="var">t1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">t1_eq_t2</span> <span class="id" type="var">P2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2'</span> <span class="id" type="var">D</span>]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">lc</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">R</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">D</span>]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">lc</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">t1_eq_u1</span> | <span class="id" type="var">u1_mem_l1'</span>] <span class="id" type="var">u2_mem_u2'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := @<span class="id" type="var">remove_equiv_is_sound_none</span> <span class="id" type="var">t1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">u1_eq_u2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H''</span> <span class="id" type="var">u2</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">u1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">D</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, {<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}+{~rpo <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">cut</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2</span>,t1) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}+{~rpo <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">t2</span>,t1)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">well_founded_induction</span> <span class="id" type="var">wf_size2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">t1</span>] <span class="id" type="var">IH</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_lt_t2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_lt_t2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : {<span class="id" type="var">t</span> | <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t</span>}+{~exists <span class="id" type="var">t</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t</span>}).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">t</span> [<span class="id" type="var">t_mem_nil</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_dec</span> <span class="id" type="var">t1</span> <span class="id" type="var">s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t1_eq_s</span> | <span class="id" type="var">t1_diff_s</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s</span>,t1)) <span class="id" type="keyword">as</span> [<span class="id" type="var">t1_lt_s</span> | <span class="id" type="var">not_t1_lt_s</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t2</span> <span class="id" type="var">t1'</span>] <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t2</span>,t1')).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">o_size2_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_bis</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Ok</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">t_mem_l</span> <span class="id" type="var">t1_le_t</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">t</span> [[<span class="id" type="var">s_eq_t</span> | <span class="id" type="var">t_mem_l</span>] <span class="id" type="var">t1_le_t</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1_le_t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t1_diff_s</span>; <span class="id" type="tactic">transitivity</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">not_t1_lt_s</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s_eq_t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">t</span> [<span class="id" type="var">t_mem_l</span> <span class="id" type="var">t1_le_t</span>]] | <span class="id" type="var">H</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">v_lt_fl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">v_lt_fl</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">g_eq_f</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">g_diff_f</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sf</span> := <span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">h</span> =&gt; <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">h</span>) <span class="id" type="var">g_eq_f</span>); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : {<span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">k</span> <span class="id" type="var">l</span>}+{~rpo_lex <span class="id" type="var">bb</span> <span class="id" type="var">k</span> <span class="id" type="var">l</span>}).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">k</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">k</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">k_lt_nil</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">k_lt_nil</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_nil</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t</span>,s)) <span class="id" type="keyword">as</span> [<span class="id" type="var">s_lt_t</span> | <span class="id" type="var">not_s_lt_t</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_dec</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s_eq_t</span> | <span class="id" type="var">s_diff_t</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">k</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k_lt_l</span> | <span class="id" type="var">not_k_lt_l</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t2</span> <span class="id" type="var">t1</span>] <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t2</span>,t1)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">o_size2_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_bis</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">List_eq</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">sk_lt_tl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">sk_lt_tl</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo_lex</span> <span class="id" type="var">bb</span> <span class="id" type="var">k</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">sk_lt_tl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">sk_lt_tl</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k_lt_l</span> | <span class="id" type="var">not_k_lt_l</span>].<br/>
<span class="id" type="keyword">let</span> <span class="id" type="var">P</span> := <span class="id" type="var">constr</span>:(forall (<span class="id" type="var">s</span>:term), <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">s</span> <span class="id" type="var">k</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) <span class="id" type="keyword">in</span> <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : { <span class="id" type="var">P</span> }+{~P}).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k_lt_l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_mem_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">s</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">s_lt_fl</span> | <span class="id" type="var">not_s_lt_fl</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex2</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t2</span> <span class="id" type="var">t1</span>] <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t2</span>,t1)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">o_size2_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex2_bis</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> [<span class="id" type="var">s_eq_s'</span> | <span class="id" type="var">s'_mem_k</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">s_eq_s'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ok</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_k</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_s_lt_fl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_nat_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l</span>) (<span class="id" type="var">length</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_lt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">k</span>) <span class="id" type="var">bb</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_lt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l</span>) <span class="id" type="var">bb</span>).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_lex</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H4</span> | [<span class="id" type="var">H4</span> <span class="id" type="var">H4'</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_irrefl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H4</span> | [<span class="id" type="var">H4</span> <span class="id" type="var">H4'</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_irrefl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">bb</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">right</span>;  <span class="id" type="tactic">intro</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_mem_k</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">right</span> ; <span class="id" type="tactic">intro</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_lt_fl</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">not_k_lt_l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">remove_equiv_list_is_sound</span> <span class="id" type="var">k</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_list</span> <span class="id" type="var">k</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k'</span> <span class="id" type="var">l'</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">Pk</span> [<span class="id" type="var">Pl</span> <span class="id" type="var">D</span>]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Rem</span> : <span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">k</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rpo_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">k'</span> <span class="id" type="var">l'</span>).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span> <span class="id" type="var">k</span> <span class="id" type="var">l'</span> <span class="id" type="var">k'</span> <span class="id" type="var">Pk</span> <span class="id" type="var">Pl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">k</span> <span class="id" type="var">l'</span> <span class="id" type="var">k'</span> <span class="id" type="var">Pk</span> <span class="id" type="var">Pl</span> <span class="id" type="var">D</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">lc</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">c</span> <span class="id" type="var">lc</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">k</span> <span class="id" type="var">l'</span> <span class="id" type="var">k'</span> <span class="id" type="var">Pk</span> <span class="id" type="var">Pl</span> <span class="id" type="var">k_lt_l</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">k_lt_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Rk</span> <span class="id" type="var">Rl</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">IHlc</span> <span class="id" type="var">l</span> <span class="id" type="var">k</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">c</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">k'</span> ++ <span class="id" type="var">c</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">Pk</span> <span class="id" type="var">Pl</span> <span class="id" type="var">k_lt_l</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_mul_remove_equiv_aux</span> <span class="id" type="var">bb</span> <span class="id" type="var">k'</span> <span class="id" type="var">l'</span> <span class="id" type="var">c</span> <span class="id" type="var">c</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_antirefl</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Rk</span> <span class="id" type="var">Rl</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>;[|apply <span class="id" type="var">equiv_equiv</span>|reflexivity].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>;[|apply <span class="id" type="var">equiv_equiv</span>|reflexivity].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">let</span> <span class="id" type="var">P</span> := <span class="id" type="var">constr</span>:(forall <span class="id" type="var">u</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">u</span> <span class="id" type="var">k'</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>,  <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">v</span> <span class="id" type="var">l'</span> /\ <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>) <span class="id" type="keyword">in</span> <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : {<span class="id" type="var">P</span>} + {~ <span class="id" type="var">P</span>}).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IH'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">u</span> <span class="id" type="var">k'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">v</span> <span class="id" type="var">l'</span> -&gt; {<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>}+{~rpo <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">u_mem_k'</span> <span class="id" type="var">v_mem_l'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">v</span>,u)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex1_mem</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l'</span> <span class="id" type="var">IH'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">k</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span> <span class="id" type="var">l'</span> <span class="id" type="var">lc</span> <span class="id" type="var">Pk</span> <span class="id" type="var">Pl</span> <span class="id" type="var">D</span> <span class="id" type="var">IH'</span> <span class="id" type="var">Rem</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">k'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u'</span> <span class="id" type="var">k'</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">IH'</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">let</span> <span class="id" type="var">P</span>:=constr:(forall <span class="id" type="var">v</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">v</span> <span class="id" type="var">l'</span> -&gt; ~rpo <span class="id" type="var">bb</span> <span class="id" type="var">u'</span> <span class="id" type="var">v</span>) <span class="id" type="keyword">in</span> <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : {<span class="id" type="var">v</span> | <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">v</span> <span class="id" type="var">l'</span> /\ <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u'</span> <span class="id" type="var">v</span>}+{P}).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IH''</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">v</span> <span class="id" type="var">l'</span> -&gt; {<span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">u'</span> <span class="id" type="var">v</span>}+{~rpo <span class="id" type="var">bb</span> <span class="id" type="var">u'</span> <span class="id" type="var">v</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_mem_l'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH'</span> <span class="id" type="var">u'</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHk'</span> <span class="id" type="var">IH'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">v'</span> <span class="id" type="var">l'</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH''</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Ok</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> [<span class="id" type="var">v_mem_l'</span> <span class="id" type="var">u'_lt_v</span>]]; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH''</span> <span class="id" type="var">v'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok'</span> | <span class="id" type="var">Ko'</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> [<span class="id" type="var">v'_eq_v</span> | <span class="id" type="var">v_mem_l'</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u'_lt_v</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ko'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">v'_eq_v</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">v</span> [<span class="id" type="var">v_mem_l'</span> <span class="id" type="var">u'_lt_v</span>]] | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHk'</span> <span class="id" type="var">l'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok'</span> | <span class="id" type="var">Ko'</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v'</span> <span class="id" type="var">u_mem_k'</span> <span class="id" type="var">v'_mem_l'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH'</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u'_eq_u</span> | <span class="id" type="var">u_mem_k'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u'_eq_u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ok'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ko'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_mem_k'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">u'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> [<span class="id" type="var">v_mem_l'</span> <span class="id" type="var">u'_lt_v</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Ko</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">v'</span> <span class="id" type="var">l'</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">fk_lt_fl</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_lt_fl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">fk_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">f_prec_f</span> <span class="id" type="var">k''_lt_fl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">k''_lt_l''</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">k_lt_l</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span> <span class="id" type="var">f_prec_f</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">k'_lt_nil</span> := <span class="id" type="var">Rem</span> <span class="id" type="var">k_lt_l</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">k'_lt_nil</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Rk</span> <span class="id" type="var">Rl</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> := <span class="id" type="var">permut_length</span> <span class="id" type="var">Rl</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">bb</span> <span class="id" type="var">v'</span> <span class="id" type="var">l'</span> <span class="id" type="var">k'</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">fk_lt_fl</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_lt_fl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l''</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">fk_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">f_prec_f</span> <span class="id" type="var">k''_lt_fl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">k''_lt_l''</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">k_lt_l</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t'_mem_l</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t'_mem_l</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'_mem_vl'</span> | <span class="id" type="var">t'_mem_lc</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_mem_k'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_le_t'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (@<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>) <span class="id" type="var">t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">bb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">fk_le_t'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>) <span class="id" type="var">t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sf'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">k'_lt_vl'</span> := <span class="id" type="var">Rem</span> <span class="id" type="var">k_lt_l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">k'_lt_vl'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Rk</span> <span class="id" type="var">Rl</span> <span class="id" type="var">ls_lt_alg</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u_mem_ls</span> | <span class="id" type="var">u_mem_lc'</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ls_lt_alg</span> <span class="id" type="var">_</span> <span class="id" type="var">u_mem_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_mem_alg</span> <span class="id" type="var">u_lt_a'</span>]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">D</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rk</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_bool_ok</span> <span class="id" type="var">Prec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">prec_bool</span> <span class="id" type="var">Prec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">g_prec_f</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">not_g_prec_f</span>].<br/>
<span class="id" type="keyword">let</span> <span class="id" type="var">P</span>:=constr:(forall <span class="id" type="var">t</span>, <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">k</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) <span class="id" type="keyword">in</span> <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : {<span class="id" type="var">P</span>}+{~P}).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,s)) <span class="id" type="keyword">as</span> [<span class="id" type="var">s_lt_fl</span> | <span class="id" type="var">not_s_lt_fl</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex2</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t2</span> <span class="id" type="var">t1</span>] <span class="id" type="var">St</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t2</span>,t1)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">o_size2_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size2_lex2_bis</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> [<span class="id" type="var">t_eq_s</span> | <span class="id" type="var">t_mem_k</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">t_eq_s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ok</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">sk_lt_fl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sk_lt_fl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">sk_lt_fl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_s_lt_fl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sk_lt_fl</span>; <span class="id" type="var">left</span>; <br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">gk_lt_fl</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">gk_lt_fl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l''</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">fk_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">f_prec_f</span> <span class="id" type="var">k''_lt_fl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">k''_lt_l''</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">k_lt_l</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">gk_lt_fl</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">gk_lt_fl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l''</span> <span class="id" type="var">t''</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_mem_l</span> <span class="id" type="var">fk_le_t'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">f''</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">f_prec_f</span> <span class="id" type="var">k''_lt_fl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">L</span> <span class="id" type="var">k''_lt_l''</span> <span class="id" type="var">l'_lt_t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">f'</span> <span class="id" type="var">k''</span> <span class="id" type="var">l''</span> <span class="id" type="var">Sf'</span> <span class="id" type="var">k_lt_l</span> ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">prec</span> <span class="id" type="var">Prec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=f); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=f); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">trans_clos_subterm_rpo</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>,  (<span class="id" type="var">trans_clos</span> <span class="id" type="var">direct_subterm</span>) <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">bb</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">s</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span> ] <span class="id" type="var">H</span> | <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">u</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Subterm</span> <span class="id" type="var">bb</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_subterm</span> <span class="id" type="var">bb</span> <span class="id" type="var">u</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">prec_eval</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>) <br/>
&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">prec_bool</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <span class="id" type="keyword">then</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">prec_bool</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span> <span class="id" type="var">f1</span> <span class="id" type="keyword">then</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Uncomparable</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">prec_eval_is_sound</span> :  <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>, <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">prec_eval</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">f1</span> = <span class="id" type="var">f2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">prec</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">prec</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span> <span class="id" type="var">f1</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">f1</span> &lt;&gt; <span class="id" type="var">f2</span> /\ ~prec <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> /\ ~prec <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span> <span class="id" type="var">f1</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">prec_eval</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_eq_f2</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f1_diff_f2</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_bool_ok</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">prec_bool</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_lt_f2</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f1_not_lt_f2</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_bool_ok</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">prec_bool</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span> <span class="id" type="var">f1</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f2_lt_f1</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f2_not_lt_f1</span>].<br/>
<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">result</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) : <span class="id" type="keyword">Set</span> := <br/>
&nbsp;&nbsp;| <span class="id" type="var">Not_found</span> : <span class="id" type="var">result</span> <span class="id" type="var">A</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Not_finished</span> : <span class="id" type="var">result</span> <span class="id" type="var">A</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Found</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">result</span> <span class="id" type="var">A</span>.<br/>

<br/>
<span class="id" type="keyword">Record</span> <span class="id" type="var">rpo_inf</span> : <span class="id" type="keyword">Set</span> := <br/>
&nbsp;&nbsp;{ <span class="id" type="var">bb</span> : <span class="id" type="var">nat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span>*term);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eq_l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span>*term);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv_l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span>*term);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_l_valid</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">rpo_l</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eq_valid</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">rpo_eq_l</span> -&gt; <span class="id" type="var">rpo_eq</span> <span class="id" type="var">bb</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv_l_valid</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">equiv_l</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span><br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">remove_equiv_eval</span> (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">bool</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">t</span> : <span class="id" type="var">term</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">result</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; @<span class="id" type="var">Not_found</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; (<span class="id" type="var">Found</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>  <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Found</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">Found</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Not_found</span> =&gt; @<span class="id" type="var">Not_found</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Not_finished</span> =&gt; @<span class="id" type="var">Not_finished</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; @<span class="id" type="var">Not_finished</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="var">Function</span>  <span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">bool</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) <br/>
&nbsp;&nbsp;{<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : <span class="id" type="var">option</span> ((<span class="id" type="var">list</span> <span class="id" type="var">term</span>) * (<span class="id" type="var">list</span> <span class="id" type="var">term</span>)):=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">l1</span>,l2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">l1</span>,l2)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Found</span> <span class="id" type="var">l2'</span> =&gt;  <span class="id" type="var">remove_equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Not_found</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">l1'</span>,l2') =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1'</span>, <span class="id" type="var">l2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Not_finished</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">equiv_eval_list</span> (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">bool</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) <br/>
{<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : <span class="id" type="var">option</span> <span class="id" type="var">bool</span> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>), (<span class="id" type="var">b</span> :: <span class="id" type="var">l'</span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq_tt_bool</span> <span class="id" type="var">t12</span> <span class="id" type="var">t12'</span> := <br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">t12</span>, <span class="id" type="var">t12'</span> <span class="id" type="keyword">with</span> <br/>
(<span class="id" type="var">t1</span>,t2), (<span class="id" type="var">t1'</span>,t2') =&gt; <span class="id" type="var">andb</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span>) (<span class="id" type="var">eq_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2'</span>)<br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_tt_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t12</span> <span class="id" type="var">t12'</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_tt_bool</span> <span class="id" type="var">t12</span> <span class="id" type="var">t12'</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">t12</span> = <span class="id" type="var">t12'</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">t12</span> &lt;&gt; <span class="id" type="var">t12'</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">eq_tt_bool</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] [<span class="id" type="var">t1'</span> <span class="id" type="var">t2'</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1'</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_t1'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2'</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2'</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_t2'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_t2'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t2_diff_t2'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_t1'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t1_diff_t1'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">n</span> : <span class="id" type="var">nat</span>) (<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">n</span>} : <span class="id" type="var">option</span> <span class="id" type="var">bool</span> := <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">n</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">S</span> <span class="id" type="var">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t1</span>, <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">v1</span>, <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span>  (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">equiv_l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span>  <span class="id" type="var">Some</span> <span class="id" type="var">true</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lex</span> =&gt;  <span class="id" type="var">equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Mul</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>,nil) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_eval_equation</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> =<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">n</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">S</span> <span class="id" type="var">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t1</span>, <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">v1</span>, <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">equiv_l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span>  <span class="id" type="var">Some</span> <span class="id" type="var">true</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lex</span> =&gt;  <span class="id" type="var">equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Mul</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>,nil) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> [ | <span class="id" type="var">n</span>] [<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>] [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">equiv_eval</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_eval_list_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) (<span class="id" type="var">combine</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> &lt;&gt; <span class="id" type="var">length</span> <span class="id" type="var">l2</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) (<span class="id" type="var">combine</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) /\ <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) (<span class="id" type="var">combine</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u2</span>, <span class="id" type="var">u2</span> = <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">u2</span> = <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">L</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t3</span> <span class="id" type="var">t4</span> [<span class="id" type="var">t3t4_eq_t1t2</span> | <span class="id" type="var">t3t4_in_ll</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t3t4_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">L</span> | [<span class="id" type="var">t3</span> [<span class="id" type="var">t4</span> [<span class="id" type="var">H'</span> <span class="id" type="var">H''</span>]]]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t4</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t3</span> [<span class="id" type="var">t4</span> [<span class="id" type="var">H'</span> <span class="id" type="var">H''</span>]]]; <span class="id" type="var">exists</span> <span class="id" type="var">t3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t4</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_eval_is_sound</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Found</span> <span class="id" type="var">l'</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_permut.permut0</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>) <span class="id" type="var">l</span> (<span class="id" type="var">t'</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Not_found</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> <span class="id" type="var">t'</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Not_finished</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> <span class="id" type="var">t'</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> <br/>
&nbsp;&nbsp;[ <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">P</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Pcons</span> (<span class="id" type="var">R</span> := @<span class="id" type="var">eq</span> <span class="id" type="var">term</span>) <span class="id" type="var">a</span> <span class="id" type="var">a</span> (<span class="id" type="var">l</span> := <span class="id" type="var">l</span>) (<span class="id" type="var">t'</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">l'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t'</span> [<span class="id" type="var">a_eq_t'</span> | <span class="id" type="var">t'_in_l</span>]; [<span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">t'_in_l</span> <span class="id" type="var">ptt'_eq_none</span>]]; <br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_eval_list_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">l1'</span>,l2') =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_permut.permut0</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>) <span class="id" type="var">l1</span> (<span class="id" type="var">l1'</span> ++ (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_permut.permut0</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>) <span class="id" type="var">l2</span> (<span class="id" type="var">l2'</span> ++ (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> /\ <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> /\ <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span><br/>
[ <span class="id" type="var">l1</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">R</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">R</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>; <span class="id" type="tactic">intros</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>; <span class="id" type="tactic">intros</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> := <span class="id" type="var">remove_equiv_eval_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> [<span class="id" type="var">pt1t2_eq_true</span> <span class="id" type="var">P</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) <span class="id" type="keyword">as</span> [ [<span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span>] | ].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">F</span>]]]]; <span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2') :: <span class="id" type="var">ll</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2'</span> | <span class="id" type="var">u1u2_in_ll</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">pt1t2_eq_true</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_b</span> <span class="id" type="var">b_eq_c</span>; <span class="id" type="tactic">transitivity</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1'</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">t1_in_l1</span> [<span class="id" type="var">t2_in_l2</span> <span class="id" type="var">p1p2_eq_none</span>]]]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t1'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_permut.permut_inv_right</span> <span class="id" type="var">P</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t2''</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k2'</span> [<span class="id" type="var">t2''_eq_t2'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">P'</span>]]]]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">k2</span> ++ <span class="id" type="var">k2'</span>) <span class="id" type="var">l2'</span> <span class="id" type="var">t2_in_l2</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">k</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">t2_in_l</span> <span class="id" type="var">Q</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Q</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">k'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t2_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t2_in_l1'</span> | [<span class="id" type="var">t2_eq_b</span> | <span class="id" type="var">t2_in_l2'</span>]].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IHk</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IHk</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> := <span class="id" type="var">remove_equiv_eval_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">R</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">F</span>]]]]; <br/>
<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Pcons</span> (<span class="id" type="var">R</span> := @<span class="id" type="var">eq</span> <span class="id" type="var">term</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t1</span> (<span class="id" type="var">l</span> := <span class="id" type="var">l1</span>) <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">l1'</span> ++ <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1_eq_t1</span> | <span class="id" type="var">u1_in_l1'</span>] <span class="id" type="var">u2_in_l2'</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>);<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">R</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u1_in_l1</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">pu1u2_eq_none</span>]]]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> := <span class="id" type="var">remove_equiv_eval_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">t2_in_l2</span> <span class="id" type="var">pt1t2_eq_none</span>]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_is_sound</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">I</span>: <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l</span> (<span class="id" type="var">l_sound</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">l</span> -&gt; <span class="id" type="var">I</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>,  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">I</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">I</span> <span class="id" type="var">l</span> <span class="id" type="var">l_sound</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l_sound</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_impl_in</span> (@<span class="id" type="var">eq</span> (<span class="id" type="var">term</span>*term))).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_tt_bool_ok</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">l</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_eval_is_sound_weak</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v1_eq_v2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v1_diff_v2</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intuition</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>), (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>));<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span> ;<span class="id" type="tactic">eapply</span> <span class="id" type="var">find_is_sound</span> <span class="id" type="keyword">with</span> (1:=equiv_l_valid <span class="id" type="var">rpo_infos</span>);<span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_eq_f2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f1_diff_f2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sf1</span> := <span class="id" type="tactic">f_equal</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span>) <span class="id" type="var">f1_eq_f2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_lex</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t'</span> <span class="id" type="var">l'</span>] <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <br/>
<span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <br/>
<span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">remove_equiv_eval_list_is_sound</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [<span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>] | ].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">H'</span>]]]];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1'</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_nil</span> <span class="id" type="var">P1</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_nil</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_right</span> <span class="id" type="var">P1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t1'</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l1''</span> [<span class="id" type="var">t1_eq_t1'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">Q1</span>]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">t1'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_right</span> <span class="id" type="var">P2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">t2_eq_t2'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">Q2</span>]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">t2'</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_eval_list_fully_evaluates</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">E</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> <br/>
[ <br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H3</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H4</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H3</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H4</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H3</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H4</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span><br/>
| <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l1</span> <span class="id" type="var">u2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E'</span> := <span class="id" type="var">E</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_eval_fully_evaluates</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> <span class="id" type="var">t'</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">remove_equiv_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> &lt;&gt; @<span class="id" type="var">Not_finished</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">E</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> <br/>
&nbsp;&nbsp;[ <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">t'</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">E</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">H</span>); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_eval_list_fully_evaluates</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">remove_equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">E</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv_eval_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span><br/>
[ <span class="id" type="var">l1</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">R</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">R</span><br/>
| <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> := <span class="id" type="var">remove_equiv_eval_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">t2_in_l2</span> <span class="id" type="var">P2</span>]];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l1</span> <span class="id" type="var">u2_in_l2'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">R</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l1</span> <span class="id" type="var">u2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> := <span class="id" type="var">remove_equiv_eval_fully_evaluates</span> <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_eval_terminates</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St1</span>; <br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (1 + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>);<br/>
[<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">equiv_eval_equation</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>), (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>));<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">eq_symb_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">plus_assoc</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t1_in_l1</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">size_unfold</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_direct_subterm</span> <span class="id" type="var">t2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t2_in_l2</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">size_unfold</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_eval_list_fully_evaluates</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span>:= <span class="id" type="var">remove_equiv_eval_list_fully_evaluates</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [[ | <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span>] [ | <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span>]] | ];<br/>
<span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_eval_is_complete_true</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span> ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>; <span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>);<br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span> <span class="id" type="var">t1_eq_t2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="keyword">as</span> <br/>
[ <span class="id" type="var">t</span><br/>
| <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span><br/>
| <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v2</span> <span class="id" type="var">v2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v2</span> <span class="id" type="var">v2</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v2_diff_v2</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">v2</span> = <span class="id" type="var">v2</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)); [<span class="id" type="tactic">reflexivity</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f2_diff_f2</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f2</span> = <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">St</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">t2</span>); [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl2</span> | <span class="id" type="var">left</span>]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>,nil)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">St</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">t2</span>); [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl2</span> | <span class="id" type="var">left</span>]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">equiv_eval_equation</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)); [<span class="id" type="tactic">reflexivity</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Size</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2_in_l2</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">Size</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">Size</span> <span class="id" type="var">St</span> <span class="id" type="var">t1_eq_t2</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">Size</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">t2</span> <span class="id" type="var">l</span> <span class="id" type="var">l2'</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="var">l1_eq_l2'</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Size</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Size</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">St'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">T</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_eval_terminates</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">St'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>,nil)).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">St'</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">St</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="var">St'</span> <span class="id" type="var">T</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">St'</span> <span class="id" type="var">T</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">t1_eq_t2</span> <span class="id" type="var">l1_eq_l2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">remove_equiv_eval_is_sound</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_eval</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2''</span>)) <br/>
&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | | <span class="id" type="var">l'</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">H'</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> : <span class="id" type="var">Some</span> <span class="id" type="var">true</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">St'</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">t'_in_l2</span> <span class="id" type="var">H''</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">T</span> <span class="id" type="var">t1</span> <span class="id" type="var">t'</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">t1_eq_t'</span> <span class="id" type="var">P2</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">l2'</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2''</span> &lt;&gt; <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q</span> : <span class="id" type="var">list_permut.permut0</span> (<span class="id" type="var">eq</span> (<span class="id" type="var">A</span>:=term)) (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>) (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2''</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2''</span>) <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2'</span> <span class="id" type="var">k2</span>].<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">term</span> = <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>); <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1_eq_t''</span> : <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_eq_t'</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t2_eq_t'</span> : <span class="id" type="var">equiv</span> <span class="id" type="var">t2</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">reflexivity</span> || <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut0_cons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>) <span class="id" type="var">l'</span>  <span class="id" type="var">t2_eq_t'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">k2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_b</span> <span class="id" type="var">b_eq_c</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">St'</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">equiv_eval_equation</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)); [<span class="id" type="tactic">reflexivity</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">f</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">equiv_eval_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; ~equiv <span class="id" type="var">t1</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">T</span> := @<span class="id" type="var">equiv_eval_terminates</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := @<span class="id" type="var">equiv_eval_is_complete_true</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">H'</span> <span class="id" type="var">t1_eq_t2</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">term_gt_list</span> (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">comp</span>) <span class="id" type="var">s</span> <span class="id" type="var">l</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">list_forall_option</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">lexico_eval</span> (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">comp</span>) (<span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <span class="id" type="var">term</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : <span class="id" type="var">option</span> <span class="id" type="var">comp</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, (<span class="id" type="var">_</span> :: <span class="id" type="var">_</span>) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">_</span> :: <span class="id" type="var">_</span>), <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1'</span>), (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2'</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lexico_eval_equation</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, (<span class="id" type="var">_</span> :: <span class="id" type="var">_</span>) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">_</span> :: <span class="id" type="var">_</span>), <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1'</span>), (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2'</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>] [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">list_gt_list</span>  (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">comp</span>) <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_forall_option</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">lg</span>) <span class="id" type="var">ls</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">mult_eval</span> (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">comp</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>)  : <span class="id" type="var">option</span> <span class="id" type="var">comp</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">n</span> : <span class="id" type="var">nat</span>) (<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">n</span>} : <span class="id" type="var">option</span> <span class="id" type="var">comp</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">t1</span>, <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span>, <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">x</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">l</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">var_in_term_list</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">l</span>), <span class="id" type="var">Var</span> <span class="id" type="var">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">var_in_term_list</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>), (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">n</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">S</span> <span class="id" type="var">m</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l1_gt_t2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l1_gt_t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l2_gt_t1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span>  =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l2_gt_t1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">prec_eval</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Greater_than</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l2_lt_t1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l2_lt_t1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Less_than</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l1_lt_t2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l1_lt_t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Equivalent</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Mul</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>, <span class="id" type="var">nil</span>) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>, <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">_</span>,nil) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">l1</span>, <span class="id" type="var">l2</span>) =&gt; <span class="id" type="var">mult_eval</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lex</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)) || <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) &amp;&amp; <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">lexico_eval</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
<span class="id" type="keyword">end</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eval_equation</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
<br/>
<br/>
<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">t1</span>, <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span>, <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">x</span>, (<span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">l</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">var_in_term_list</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Term</span> <span class="id" type="var">_</span> <span class="id" type="var">l</span>), <span class="id" type="var">Var</span> <span class="id" type="var">x</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">var_in_term_list</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>), (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">n</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0 =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">S</span> <span class="id" type="var">m</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l1_gt_t2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l1_gt_t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l2_gt_t1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span>  =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l2_gt_t1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">prec_eval</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Greater_than</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l2_lt_t1</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l2_lt_t1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Less_than</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">check_l1_lt_t2</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">check_l1_lt_t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Equivalent</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Mul</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>, <span class="id" type="var">nil</span>) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">nil</span>, <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">_</span>,nil) =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> (<span class="id" type="var">l1</span>, <span class="id" type="var">l2</span>) =&gt; <span class="id" type="var">mult_eval</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Lex</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)) || <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) &amp;&amp; <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">lexico_eval</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">m</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> [ | <span class="id" type="var">n</span>] [<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>] [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">rpo_eval</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">term_gt_list_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">l</span>)) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span> | <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>); [<span class="id" type="tactic">intros</span> [ | | | ] <span class="id" type="var">H</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t</span> | <span class="id" type="var">u_in_l</span>]; [<span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">term_gt_list</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>) <span class="id" type="keyword">as</span> [[ | | | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lexico_eval_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">p</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">comp</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l1</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l2</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">l1</span> = <span class="id" type="var">nil</span> /\ <span class="id" type="var">l2</span> &lt;&gt; <span class="id" type="var">nil</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l1</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l2</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2'</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> /\ (<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span>)) \/ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l1</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> ++ <span class="id" type="var">t1</span> :: <span class="id" type="var">l1'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l2</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">l1</span> &lt;&gt; <span class="id" type="var">nil</span> /\ <span class="id" type="var">l2</span> = <span class="id" type="var">nil</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l1</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> ++ <span class="id" type="var">t1</span> :: <span class="id" type="var">l1'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l2</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> /\ (<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>)) \/ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l1</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> ++ <span class="id" type="var">t1</span> :: <span class="id" type="var">l1'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l2</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> [ | | | ] <span class="id" type="var">Ht</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intros</span> [ | | | ] <span class="id" type="var">Hl</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]; <span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2) :: <span class="id" type="var">ll</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2</span> | <span class="id" type="var">u1u2_in_ll</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">a1</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ha</span> [<span class="id" type="var">H</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2) :: <span class="id" type="var">nil</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2</span> | <span class="id" type="var">u1u2_in_nil</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2) :: <span class="id" type="var">ll</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2</span> | <span class="id" type="var">u1u2_in_ll</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2) :: <span class="id" type="var">ll</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2</span> | <span class="id" type="var">u1u2_in_ll</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">t1_eq_u</span> | <span class="id" type="var">u_in_l1</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> <span class="id" type="var">u_in_l1</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">H'</span>]] | <span class="id" type="var">H'</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">right</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">a1</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">a1</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ha</span> [<span class="id" type="var">H</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2) :: <span class="id" type="var">nil</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2</span> | <span class="id" type="var">u1u2_in_nil</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2) :: <span class="id" type="var">ll</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2</span> | <span class="id" type="var">u1u2_in_ll</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">t1</span>,t2) :: <span class="id" type="var">ll</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">u1u2_eq_t1t2</span> | <span class="id" type="var">u1u2_in_ll</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">u1u2_eq_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">t2_eq_u</span> | <span class="id" type="var">u_in_l2</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> <span class="id" type="var">u_in_l2</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">H'</span>]] | <span class="id" type="var">H'</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u1</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">right</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> [ | | | ] <span class="id" type="var">Hl</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="keyword">as</span> [[ | ] | ].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">a1</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ha</span> [<span class="id" type="var">H</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> [ | | | ] <span class="id" type="var">Hl</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [[ | ] | ].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t1l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">a1</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ha</span> [<span class="id" type="var">H</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t2l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t2l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t2l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t2l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t2l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">term_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">term_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_t2l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_gt_list_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">g</span>, <span class="id" type="var">In</span> <span class="id" type="var">g</span> <span class="id" type="var">lg</span> /\ <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span>; <span class="id" type="var">revert</span> <span class="id" type="var">lg</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ls</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">ls</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">lg</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">list_gt_list</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_option_is_sound</span> <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">lg</span>).<br/>
<span class="id" type="tactic">destruct</span> <br/>
(<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">lg</span>) <span class="id" type="keyword">as</span> [[ | ] | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">g</span> [<span class="id" type="var">g_in_ls</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHls</span> <span class="id" type="var">lg</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">list_gt_list</span>;<br/>
<span class="id" type="tactic">destruct</span> <br/>
(<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s0</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g0</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g0</span> <span class="id" type="var">s0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">lg</span>) <span class="id" type="var">ls</span>) <span class="id" type="keyword">as</span> [[ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">u</span> [<span class="id" type="var">s_eq_u</span> | <span class="id" type="var">u_in_ls</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">g</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span>) <span class="id" type="keyword">as</span> [[ | | | ] | ]; (<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> || <span class="id" type="tactic">discriminate</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="tactic">destruct</span> <br/>
(<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s0</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g0</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g0</span> <span class="id" type="var">s0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">lg</span>) <span class="id" type="var">ls</span>) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_eval_is_sound_weak</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">mult_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt;  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> /\ <span class="id" type="var">p</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt;  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> /\ <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mult_eval</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_gt_list_is_sound</span> <span class="id" type="var">p</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_gt_list</span> <span class="id" type="var">p</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [[ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eval_is_sound_weak</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>. <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>;<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)) <span class="id" type="var">_</span> (<span class="id" type="var">rpo_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">intro</span>;<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>;<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)) <span class="id" type="var">_</span> (<span class="id" type="var">rpo_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">intro</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>;<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> <span class="id" type="var">equiv</span> <span class="id" type="var">_</span> (<span class="id" type="var">equiv_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">intro</span>;<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_sym</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> <span class="id" type="var">equiv</span> <span class="id" type="var">_</span> (<span class="id" type="var">equiv_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">tauto</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>;<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)) <span class="id" type="var">_</span> (<span class="id" type="var">rpo_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>;<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)) <span class="id" type="var">_</span> (<span class="id" type="var">rpo_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>;<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> <span class="id" type="var">equiv</span> <span class="id" type="var">_</span> (<span class="id" type="var">equiv_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hfind</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_sym</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_is_sound</span> <span class="id" type="var">equiv</span> <span class="id" type="var">_</span> (<span class="id" type="var">equiv_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hfind</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E1</span> := <span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">E1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">E1</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_subterm_rpo</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : (<span class="id" type="var">In</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) <span class="id" type="var">l</span> \/ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">trans_clos</span> <span class="id" type="var">direct_subterm</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) <span class="id" type="var">t</span>)) -&gt; <span class="id" type="var">trans_clos</span> <span class="id" type="var">direct_subterm</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">v_in_l</span> | [<span class="id" type="var">t</span> [<span class="id" type="var">t_in_l</span> <span class="id" type="var">H'</span>]]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">list_rec3</span> <span class="id" type="var">size</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">m</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">m</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">m</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>] <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">m</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">plus_le_compat_r</span> 1 (<span class="id" type="var">size</span> <span class="id" type="var">t</span>) (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>));<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">var_in_term_list_equation</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">v_eq_v'</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v_diff_v'</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHm</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">v_in_l</span> | [<span class="id" type="var">t</span> [<span class="id" type="var">t_in_l</span> <span class="id" type="var">H'</span>]]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl'</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l'</span> &lt;= <span class="id" type="var">m</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_unfold</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHm</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl'</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v</span> <span class="id" type="var">l'</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">v_in_l'</span> | [<span class="id" type="var">t</span> [<span class="id" type="var">t_in_l'</span> <span class="id" type="var">H'</span>]]].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHm</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">v_in_l'</span> | [<span class="id" type="var">t</span> [<span class="id" type="var">t_in_l'</span> <span class="id" type="var">H'</span>]]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">v1</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v1</span> <span class="id" type="var">l2</span>); <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">v2</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v2</span> <span class="id" type="var">l1</span>); <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_option_is_sound</span> <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t1_gt_f2l2</span>]]; <span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_option_is_sound</span> <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">t2_in_l2</span> <span class="id" type="var">t2_gt_f1l1</span>]]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Equiv</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_eval_is_sound</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_eq_f2</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Sf1</span> := <span class="id" type="tactic">f_equal</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span>) <span class="id" type="var">f1_eq_f2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf1</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">lexico_eval_is_sound</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">lexico_eval</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="tactic">f_equal</span> (@<span class="id" type="var">length</span> <span class="id" type="var">_</span>) <span class="id" type="var">H1</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="tactic">f_equal</span> (@<span class="id" type="var">length</span> <span class="id" type="var">_</span>) <span class="id" type="var">H2</span>); <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">beq_nat_refl</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Eq_lex</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_nil</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq_list_cons</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E_ll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">Top_eq_lex</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">f1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> <span class="id" type="var">Sf1</span>).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">beq_nat_true</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l2'</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_true</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 2.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">_</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_true</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_in_l1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u_in_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">u_eq_u'</span> <span class="id" type="var">u'_in_l1</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">u'_in_l1</span>) <span class="id" type="keyword">as</span> [ [<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">u'_le_u2</span>]] | <span class="id" type="var">H''</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u'_le_u2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'_eq_u2</span> | <span class="id" type="var">u'_lt_u2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u'</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_eq_u2</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u'</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_lt_u2</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2</span>) <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">leb_complete</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">leb_complete</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">simpl</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">L2</span> <span class="id" type="var">L1</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">Top_eq_lex</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">f1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> <span class="id" type="var">Sf1</span>).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">L1</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">L2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L1</span> <span class="id" type="var">L2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="var">constructor</span> 3].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 3.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 2.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 2.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L1</span> <span class="id" type="var">L2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_in_l1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u_in_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">u_eq_u'</span> <span class="id" type="var">u'_in_l1</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u'_in_l1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u'_in_l1</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u2</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">u1</span>,u2); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">u1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u'</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_in_l1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u_in_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">u_eq_u'</span> <span class="id" type="var">u'_in_l1</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">u'_in_l1</span>) <span class="id" type="keyword">as</span> [ [<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">u'_le_u2</span>]] | <span class="id" type="var">H''</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u'_le_u2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'_eq_u2</span> | <span class="id" type="var">u'_lt_u2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u'</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_eq_u2</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u'</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_lt_u2</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2</span>) <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">Top_eq_lex</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf1</span>).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">beq_nat_true</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">l1'</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_true</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 2.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">_</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">beq_nat_true</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_in_l2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u_in_l2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">u_eq_u'</span> <span class="id" type="var">u'_in_l2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">u'_in_l2</span>) <span class="id" type="keyword">as</span> [ [<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">u'_le_u1</span>]] | <span class="id" type="var">H''</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u'_le_u1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'_eq_u1</span> | <span class="id" type="var">u'_lt_u1</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_eq_u1</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_lt_u1</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">leb_complete</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">leb_complete</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">simpl</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">L2</span> <span class="id" type="var">L1</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">Top_eq_lex</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf1</span>).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">L2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">L1</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L1</span> <span class="id" type="var">L2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="var">constructor</span> 3].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 3.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 2.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 2.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L1</span> <span class="id" type="var">L2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | [<span class="id" type="var">ll</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">Hll</span> [<span class="id" type="var">Ht</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]]]]]].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_in_l2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u_in_l2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">u_eq_u'</span> <span class="id" type="var">u'_in_l2</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u'_in_l2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u'_in_l2</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u1</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">u1</span>,u2); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">u2</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hll</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_in_l2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u_in_l2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">u_eq_u'</span> <span class="id" type="var">u'_in_l2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">u'_in_l2</span>) <span class="id" type="keyword">as</span> [ [<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">u'_le_u1</span>]] | <span class="id" type="var">H''</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u'_le_u1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u'_eq_u1</span> | <span class="id" type="var">u'_lt_u1</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_eq_u1</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u'_lt_u1</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u_eq_u'</span>); <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">u'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) &amp;&amp; <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) &amp;&amp; <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">remove_equiv_eval_list_is_sound</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [[ | <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span>] [ | <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span>]] | ].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]]]; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">Eq_mul</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Sf1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>); <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>); <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E_ll'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E_ll</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">E_ll</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">_</span> <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">transitivity</span> ((<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>) ++ (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">symmetry</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E_ll'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E_ll</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">E_ll</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">_</span> <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">nil</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">transitivity</span> ((<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>) ++ (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E_ll'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E_ll</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">E_ll</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">mult_eval_is_sound_weak</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) (<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>) (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mult_eval</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) (<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>) (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E_ll'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E_ll</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">_</span> <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span> (<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>) (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">transitivity</span> ((<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>) ++ <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">E_ll</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_mem_l1'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_mem_l1'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u1'</span> [<span class="id" type="var">k1</span> [<span class="id" type="var">k1'</span> [<span class="id" type="var">u1_eq_u1'</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u1_eq_u1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1'_in_l1'</span> : <span class="id" type="var">In</span> <span class="id" type="var">u1'</span> (<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H''</span> <span class="id" type="var">_</span> <span class="id" type="var">u1'_in_l1'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2'</span> <span class="id" type="var">u1_lt_u2</span>]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1'</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">u1_lt_u2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'''</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_eq_u1'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">E_ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E_ll'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E_ll</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Top_eq_mul</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">_</span> <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>) (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> ((<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>) ++ <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">E_ll</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E_ll'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">equiv_equiv</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u2</span> <span class="id" type="var">u2_mem_l2'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">u2_mem_l2'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u2'</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k2'</span> [<span class="id" type="var">u2_eq_u2'</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u2_eq_u2'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u2'_in_l2'</span> : <span class="id" type="var">In</span> <span class="id" type="var">u2'</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H''</span> <span class="id" type="var">_</span> <span class="id" type="var">u2'_in_l2'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1'</span> <span class="id" type="var">u2_lt_u1</span>]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2'</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">u2_lt_u1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'''</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">u2_eq_u2'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_lt_f2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1_lt_s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1_mem_l1</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_mem_l1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t1'</span> [<span class="id" type="var">k1</span> [<span class="id" type="var">k1'</span> [<span class="id" type="var">t1_eq_t1'</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_eq_t1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1'_in_l1</span> : <span class="id" type="var">In</span> <span class="id" type="var">t1'</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_eq_t1'</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">l1_lt_s2</span> <span class="id" type="var">t1'</span> <span class="id" type="var">t1'_in_l1</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">t1'</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>));<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1'</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">f2_lt_f1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1_gt_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Top_gt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_mem_l2</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t2_mem_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k2'</span> [<span class="id" type="var">t2_eq_t2'</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t2_eq_t2'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t2'_in_l2</span> : <span class="id" type="var">In</span> <span class="id" type="var">t2'</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">t2_eq_t2'</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">s1_gt_l2</span> <span class="id" type="var">t2'</span> <span class="id" type="var">t2'_in_l2</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> := <span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2'</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2'</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">well_formed_equiv</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t2</span> <span class="id" type="var">_</span> <span class="id" type="var">v_eq_t2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">v_eq_t2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">t2</span> <span class="id" type="var">Wfl</span> <span class="id" type="var">fl_eq_t2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">fl_eq_t2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="var">equiv_same_length</span>  <span class="id" type="var">fl_eq_t2</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wfl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Wl</span> <span class="id" type="var">L</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IH'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span> <span class="id" type="var">IH</span> <span class="id" type="var">H3</span> <span class="id" type="var">H1</span> <span class="id" type="var">L'</span> <span class="id" type="var">L</span> <span class="id" type="var">fl_eq_t2</span> <span class="id" type="var">Wfl</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l_eq_l2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">l_eq_l2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t2</span> | <span class="id" type="var">u_in_l2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH'</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="var">equiv_same_length</span> <span class="id" type="var">fl_eq_t2</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wfl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Wl</span> <span class="id" type="var">L</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IH'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t2</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span> <span class="id" type="var">IH</span> <span class="id" type="var">H3</span> <span class="id" type="var">H1</span> <span class="id" type="var">L'</span> <span class="id" type="var">L</span> <span class="id" type="var">fl_eq_t2</span> <span class="id" type="var">Wfl</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l_eq_l2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">l_eq_l2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l2</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">u_in_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u_in_l1</span> | [<span class="id" type="var">u_eq_b</span> | <span class="id" type="var">u_in_l3</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH'</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">lexico_eval_fully_evaluates</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">t1</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">lexico_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>] <span class="id" type="var">Es2</span> <span class="id" type="var">Es1</span> <span class="id" type="var">E</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">E</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)));<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">intros</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">Es2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Es1</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>]; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">term_gt_list</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">Es2</span> <span class="id" type="var">t1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">t1</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">Es2</span> <span class="id" type="var">t1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">t1</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">pt1s2_eq_none</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">Es2</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_in_l1</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">s2</span> <span class="id" type="var">u1</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">term_gt_list</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">Es1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">Es1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">ps1u2_eq_none</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">Es1</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">u2_in_l2</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">s1</span> <span class="id" type="var">u2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_eval_fully_evaluates</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">p</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> &lt;&gt; <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">mult_eval</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>] <span class="id" type="var">l2</span> <span class="id" type="var">E</span> <span class="id" type="var">E'</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mult_eval</span>, <span class="id" type="var">list_gt_list</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> : <span class="id" type="var">term</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="var">l2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>));<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">list_exists_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">u1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [ [<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">pu1u2_eq_none</span>]] <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">E'</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l1</span> <span class="id" type="var">u2_in_l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">list_exists_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">u2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>)); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [ [<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">pu1u2_eq_none</span>]] <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">E</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1_in_l1</span> <span class="id" type="var">u2_in_l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">p</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eval_terminates</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;&gt; <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St1</span>; <br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (1 + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>);<br/>
[<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intro</span>;<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intro</span>;<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intro</span>;<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intro</span>;<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">T</span> := @<span class="id" type="var">equiv_eval_terminates</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v2</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_option_is_sound</span> <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_option_is_sound</span> <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">status</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) &amp;&amp; <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lexico_eval_fully_evaluates</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t1_in_l1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>).<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>))) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>)) <span class="id" type="keyword">with</span>  (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_eval_list_is_sound</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [[ | <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span>] [ | <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span>]] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">H</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">H'</span>]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">mult_eval_fully_evaluates</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1'</span> <span class="id" type="var">t2_in_l2'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>)) <span class="id" type="keyword">with</span>  (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1'</span> <span class="id" type="var">t2_in_l2'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span> + <span class="id" type="var">size</span> <span class="id" type="var">t1</span>)) <span class="id" type="keyword">with</span>  (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">t1_in_l1</span> [<span class="id" type="var">t2_in_l2</span> <span class="id" type="var">H</span>]]]];<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := @<span class="id" type="var">equiv_eval_terminates</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>)) <span class="id" type="keyword">with</span>  (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">u1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u1</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>))) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u1</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span>  (<span class="id" type="var">list_forall_option_is_sound</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">u2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">u2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u2</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u2</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">u2</span> [<span class="id" type="var">u2_in_l2</span> <span class="id" type="var">H</span>]] <span class="id" type="var">_</span>]; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">IHn</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">u2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">u2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u2</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u2</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">u1</span> [<span class="id" type="var">u1_in_l1</span> <span class="id" type="var">H</span>]] <span class="id" type="var">_</span>]; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">u1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">u1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [ [ | | | ] | ].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u1</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>))) <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">u1</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eval_is_complete_equivalent</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span> <span class="id" type="var">t1_eq_t2</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">abs</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">find_is_sound</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)) <span class="id" type="var">_</span> (<span class="id" type="var">rpo_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">abs</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">h</span>;<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="tactic">intro</span>;<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_antirefl</span> <span class="id" type="keyword">with</span> (1:=H).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_eq_t2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">h</span>. <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">h1</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">abs</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">find_is_sound</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>)) <span class="id" type="var">_</span> (<span class="id" type="var">rpo_l_valid</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">abs</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">h</span>;<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intro</span>;<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_antirefl</span> <span class="id" type="keyword">with</span> (1:=H).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_eq_t2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">h</span>. <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">h2</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">h3</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">h4</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := @<span class="id" type="var">equiv_eval_is_sound</span>  <span class="id" type="var">rpo_infos</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>).<br/>

<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">var_case2</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span> <span class="id" type="var">v</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">rpo</span> <span class="id" type="var">n</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> .<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">m</span> <span class="id" type="var">v</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">v_lt_t</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">v_lt_t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> <span class="id" type="var">u</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">v_le_s</span> | | | ]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">v_le_s</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">v_lt_t</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">v_le_s</span>; <br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">list_rec3</span> <span class="id" type="var">size</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>] <span class="id" type="var">Sl</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">v_le_s</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sl</span>; <span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s_eq_t</span> | <span class="id" type="var">s_in_l</span>].<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">equiv_rpo_equiv_3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_eq_t</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">v_le_s</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">v_le_s</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">var_in_term_list_equation</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_var_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">u1</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_in_k</span> <span class="id" type="var">v_le_s'</span> | | |]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">var_in_term_list_equation</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sk</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">k</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>;<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_size_fold</span> <span class="id" type="var">size</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">k</span> <span class="id" type="var">Sk</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_in_k</span> <span class="id" type="var">v_le_s'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl'</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">plus_le_compat_r</span> 1 (<span class="id" type="var">size</span> <span class="id" type="var">t</span>) (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>));<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">var_in_term_list_equation</span>; <br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">l</span> <span class="id" type="var">Sl'</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">v_le_s</span>); <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v'</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">var_in_term_list</span> <span class="id" type="var">v</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eval_is_complete_less_greater</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span> <span class="id" type="var">t1_lt_t2</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (1 + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>);<br/>
[<span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">TE</span> := @<span class="id" type="var">equiv_eval_terminates</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R</span> := <span class="id" type="var">rpo_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>);<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">T</span> := @<span class="id" type="var">rpo_eval_terminates</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">TE'</span> := @<span class="id" type="var">equiv_eval_terminates</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R'</span> := <span class="id" type="var">rpo_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>);<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">T'</span> := @<span class="id" type="var">rpo_eval_terminates</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> <span class="id" type="var">St</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rpo_eval_equation</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">R</span> <span class="id" type="var">T</span> <span class="id" type="var">R'</span> <span class="id" type="var">T'</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">intro</span> <span class="id" type="var">Heq_1</span>;<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">rpo_l</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">intro</span> <span class="id" type="var">Heq_2</span>;<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">intro</span> <span class="id" type="var">Heq_3</span>;<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_tt_bool</span> (<span class="id" type="var">t2</span>, <span class="id" type="var">t1</span>) (<span class="id" type="var">equiv_l</span> <span class="id" type="var">rpo_infos</span>)); <span class="id" type="tactic">intro</span> <span class="id" type="var">Heq_4</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">T</span> <span class="id" type="var">R'</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">try</span><br/>
(<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t1</span>);[<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span>|<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>;<span class="id" type="tactic">assumption</span>]);<span class="id" type="tactic">try</span> <span class="id" type="var">complete</span> <span class="id" type="tactic">intuition</span>;<br/>
<span class="id" type="tactic">try</span> (<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t1</span>);<br/>
[<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span> |<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_lt_t2</span>; <span class="id" type="tactic">trivial</span>]).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Heq_1</span> <span class="id" type="var">Heq_2</span> <span class="id" type="var">Heq_3</span> <span class="id" type="var">Heq_4</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ];<br/>
<span class="id" type="tactic">try</span> (<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t1</span>); [<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span> |<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_lt_t2</span>; <span class="id" type="tactic">trivial</span>]);<span class="id" type="tactic">try</span> <span class="id" type="var">complete</span> <span class="id" type="tactic">intuition</span>;<br/>
<span class="id" type="tactic">try</span> (<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t1</span>);<br/>
[<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span>|<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">R'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_lt_t2</span>; <span class="id" type="tactic">trivial</span>]).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">TE</span> <span class="id" type="var">TE'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_lt_t2</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">var_case2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_lt_t2</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_lt_t2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_in_l1</span> <span class="id" type="var">t2_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_weak</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHl1l2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Sl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHl2l1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Sl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHl1s2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>))) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_l</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHs2l1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>))) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_l</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHs1l2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHl2s1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> <span class="id" type="var">t2</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">t2</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_lt_t2</span> <span class="id" type="keyword">as</span><br/>
[ <span class="id" type="var">f2'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">u1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2_in_l2</span> <span class="id" type="var">u1_le_s2</span><br/>
| <span class="id" type="var">f2'</span> <span class="id" type="var">f1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">f1_lt_f2</span> <span class="id" type="var">H</span><br/>
| <span class="id" type="var">f</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">Sf</span> <span class="id" type="var">L</span> <span class="id" type="var">l1_lt_l2</span> <span class="id" type="var">H</span><br/>
| <span class="id" type="var">f</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">Sf</span> <span class="id" type="var">l1_lt_l2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_closure</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Antisym</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Antisym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1_lt_l2</span> : <span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_exists_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s2_in_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s2'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">s2_eq_s2'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s2_eq_s2'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s2'_in_l2</span> : <span class="id" type="var">In</span> <span class="id" type="var">s2'</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s2'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_3</span>  <span class="id" type="var">_</span> <span class="id" type="var">s2_eq_s2'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">u1_le_s2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u1_le_s2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">rpo_eval_is_complete_equivalent</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">s2'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">s2'</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">s2'</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHs1l2</span> <span class="id" type="var">s2'</span> <span class="id" type="var">s2'_in_l2</span> <span class="id" type="var">H0</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_lt_l2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">l2_gt_t1</span> : <span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_exists_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s2_in_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s2'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">s2_eq_s2'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s2_eq_s2'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s2'_in_l2</span> : <span class="id" type="var">In</span> <span class="id" type="var">s2'</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s2'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u1_le_s2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">rpo_eval_is_complete_equivalent</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">s2'</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">s2'</span> + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">size</span> <span class="id" type="var">s2'</span>) + <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat_r</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">transitivity</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">s2_eq_s2'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHs1l2</span> <span class="id" type="var">s2'</span> <span class="id" type="var">s2'_in_l2</span> <span class="id" type="var">H0</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">l2_gt_t1</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">clear</span> <span class="id" type="var">R'</span> <span class="id" type="var">T'</span> | <span class="id" type="tactic">clear</span> <span class="id" type="var">R</span> <span class="id" type="var">T</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_closure</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Antisym</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Antisym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_eval_is_sound</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span>  <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_forall_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_l1</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1s2</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_l1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">f2_lt_f1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">prec_transitive</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> [<span class="id" type="var">not_f1_lt_f2</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">absurd</span> (<span class="id" type="var">prec</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_closure</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Antisym</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Antisym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_eval_is_sound</span> <span class="id" type="var">f2</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f2</span> <span class="id" type="var">f1</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">f2_lt_f1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">prec_transitive</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_forall_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_l1</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1s2</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_l1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> [<span class="id" type="var">_</span> <span class="id" type="var">not_f1_lt_f2</span>]]; <span class="id" type="var">absurd</span> (<span class="id" type="var">prec</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">clear</span> <span class="id" type="var">R'</span> <span class="id" type="var">T'</span> | <span class="id" type="tactic">clear</span> <span class="id" type="var">R</span> <span class="id" type="var">T</span>].<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) &amp;&amp; <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">L</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>, <span class="id" type="var">T</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">s1</span> := <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">s1</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">s2</span> := <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_closure</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Antisym</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Antisym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">s1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_eval_is_sound</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_lt_t2</span> <span class="id" type="var">H0</span> <span class="id" type="var">St</span> <span class="id" type="var">IHl1l2</span> <span class="id" type="var">IHl2l1</span> <span class="id" type="var">IHl1s2</span> <span class="id" type="var">IHs2l1</span> <span class="id" type="var">IHs1l2</span> <span class="id" type="var">IHl2s1</span> <span class="id" type="var">R</span> <span class="id" type="var">T</span> <span class="id" type="var">l1_lt_l2</span> <span class="id" type="var">Sl</span>.<br/>
<span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">intros</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">IHl1l2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">H1</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">term_gt_list</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">s2</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_forall_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_t1l1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_lt_s2</span> : <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">u1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">IHl1s2</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_in_t1l1</span> <span class="id" type="var">u1_lt_s2</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := @<span class="id" type="var">rpo_eval_is_complete_equivalent</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">Sl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="var">H3</span>);<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1l2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl2l1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1s2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHs2l1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHs1l2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl2s1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Sl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">f2_diff_f2</span> <span class="id" type="var">_</span>]; <span class="id" type="var">absurd</span> (<span class="id" type="var">f2</span> = <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>; <span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>; <span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">L</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">L</span> | [<span class="id" type="var">L1</span> <span class="id" type="var">L2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">beq_nat_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">leb_correct</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L1</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">leb_correct</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">orb_true_r</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">beq_nat</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|| <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) &amp;&amp; <span class="id" type="var">leb</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">L</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>, <span class="id" type="var">T'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">s1</span> := <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">s1</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">s2</span> := <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">s2</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_closure</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s2</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Antisym</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Antisym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_eval_is_sound</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_lt_t2</span> <span class="id" type="var">H0</span> <span class="id" type="var">St</span> <span class="id" type="var">IHl1l2</span> <span class="id" type="var">IHl2l1</span> <span class="id" type="var">IHl1s2</span> <span class="id" type="var">IHs2l1</span> <span class="id" type="var">IHs1l2</span> <span class="id" type="var">IHl2s1</span> <span class="id" type="var">R'</span> <span class="id" type="var">T'</span> <span class="id" type="var">l1_lt_l2</span> <span class="id" type="var">Sl</span>.<br/>
<span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">IHl1l2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">H1</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">term_gt_list</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">s2</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_forall_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_t1l1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_lt_s2</span> : <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">u1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">IHl1s2</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_in_t1l1</span> <span class="id" type="var">u1_lt_s2</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := @<span class="id" type="var">rpo_eval_is_complete_equivalent</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">Sl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>));<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1l2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl2l1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1s2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHs2l1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHs1l2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl2s1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Sl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">f2_diff_f2</span> <span class="id" type="var">_</span>]; <span class="id" type="var">absurd</span> (<span class="id" type="var">f2</span> = <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>; <span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>; <span class="id" type="var">absurd</span> (@<span class="id" type="var">None</span> <span class="id" type="var">comp</span> = <span class="id" type="var">None</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">L</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">L</span> | [<span class="id" type="var">L1</span> <span class="id" type="var">L2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">beq_nat_refl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">leb_correct</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L1</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">leb_correct</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">orb_true_r</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">s1</span> := <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">s2</span> := <span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">clear</span> <span class="id" type="var">R'</span> <span class="id" type="var">T'</span> | <span class="id" type="tactic">clear</span> <span class="id" type="var">R</span> <span class="id" type="var">T</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span>  <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">s2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>;  <span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_closure</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Antisym</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Antisym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">s1</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_eval_is_sound</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">remove_equiv_eval_list_is_sound</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>] <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>, <span class="id" type="var">T</span>, <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : <span class="id" type="var">rpo_mul</span> (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">Ell</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ell'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Ell</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1t2_in_ll</span>); <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Ell'</span> <span class="id" type="var">l1_lt_l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">ll</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">Ell</span> <span class="id" type="var">l1_lt_l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">_</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">l1</span>; [<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">eq</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">l2</span>; [<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">eq</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_mul_remove_equiv_aux</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ell</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ell</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">list_permut.permut_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">P1</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_sym</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; [<span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">list_permut.permut_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">P2</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_sym</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; [<span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s1</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_lt_t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s1</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mult_eval</span>, <span class="id" type="var">list_gt_list</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mult_eval</span>, <span class="id" type="var">list_gt_list</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>,T.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>)) (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s1</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> : <span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)) (<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_forall_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_l1'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_exists_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_in_l1</span> : <span class="id" type="var">In</span> <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">P1</span> <span class="id" type="var">_</span>]]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_mem_ls_lc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">u1</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">u1</span> <span class="id" type="var">H0</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u1_mem_ls_lc</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u1_mem_ls_lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u1_mem_ls</span> | <span class="id" type="var">u1_mem_lc</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H2</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_mem_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_in_lg</span> <span class="id" type="var">u1_lt_a'</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a'_in_tl2'</span> : <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">a'</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a'</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a'_in_tl2'</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a'_in_tl2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a''</span> [<span class="id" type="var">a''_eq_a'</span> <span class="id" type="var">a''_in_tl2'</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_lt_a''</span> : <span class="id" type="var">rpo</span> (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">u1</span> <span class="id" type="var">a''</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a''_eq_a'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a''_in_l2</span> : <span class="id" type="var">In</span> <span class="id" type="var">a''</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">_</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">IHl1l2</span> <span class="id" type="var">u1</span> <span class="id" type="var">a''</span> <span class="id" type="var">u1_in_l1</span> <span class="id" type="var">a''_in_l2</span> <span class="id" type="var">u1_lt_a''</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_mem_tl2'</span> : <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> /\ <span class="id" type="var">In</span> <span class="id" type="var">u2</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_in_eq</span> <span class="id" type="var">equiv</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">u1</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u1_mem_tl2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u1_eq_u2</span> <span class="id" type="var">u2_in_tl2'</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">_</span> [<span class="id" type="var">P2</span> <span class="id" type="var">H'</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> := <span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_in_l1'</span> <span class="id" type="var">u2_in_tl2'</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Su</span> : <span class="id" type="var">size</span> <span class="id" type="var">u1</span> + <span class="id" type="var">size</span> <span class="id" type="var">u2</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Sl</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">generalize</span> (@<span class="id" type="var">equiv_eval_is_sound</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">Su</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">f2_diff_f2</span> <span class="id" type="var">_</span>]; <span class="id" type="var">absurd</span> (<span class="id" type="var">f2</span> = <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span>  <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">s2</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_closure</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Antisym</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Antisym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">prec_eval_is_sound</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">prec_eval</span> <span class="id" type="var">f2</span> <span class="id" type="var">f2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">remove_equiv_eval_list_is_sound</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv_eval_list</span> (<span class="id" type="var">equiv_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l2'</span> <span class="id" type="var">l1'</span>] <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>, <span class="id" type="var">T'</span>, <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : <span class="id" type="var">rpo_mul</span> (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">Ell</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P1</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ell'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_ll</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">equiv_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Ell</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1t2_in_ll</span>); <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t1_eq_t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Ell'</span> <span class="id" type="var">l1_lt_l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t2</span> <span class="id" type="var">t1</span>] <span class="id" type="var">ll</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">Ell</span> <span class="id" type="var">l1_lt_l2</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l1_lt_l2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">List_mul</span> <span class="id" type="var">_</span> <span class="id" type="var">a</span> <span class="id" type="var">lg</span> <span class="id" type="var">ls</span> <span class="id" type="var">lc</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">l1</span>; [<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">eq</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">l2</span>; [<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_impl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">eq</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_mul_remove_equiv_aux</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">Ell</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ell</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">list_permut.permut_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">P1</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_sym</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; [<span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">list_permut.permut_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">P2</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_sym</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; [<span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_refl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2'</span> <span class="id" type="var">l2'</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s2</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_2</span> <span class="id" type="var">_</span> <span class="id" type="var">R'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_lt_t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s2</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">rpo_antirefl</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">s2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rpo_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mult_eval</span>, <span class="id" type="var">list_gt_list</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mult_eval</span>, <span class="id" type="var">list_gt_list</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R'</span>, <span class="id" type="var">T'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> : <span class="id" type="var">list_forall_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists_option</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">term</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span> (<span class="id" type="var">A</span>:=bool)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)) (<span class="id" type="var">t1'</span> :: <span class="id" type="var">l1'</span>) = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_forall_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u1_in_l1'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_exists_option_is_complete_true</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_in_l1</span> : <span class="id" type="var">In</span> <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">_</span> [<span class="id" type="var">P1</span> <span class="id" type="var">_</span>]]]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_mem_ls_lc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">u1</span> (<span class="id" type="var">ls</span> ++ <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">u1</span> <span class="id" type="var">H0</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Eq</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u1_mem_ls_lc</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u1_mem_ls_lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u1_mem_ls</span> | <span class="id" type="var">u1_mem_lc</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H2</span> <span class="id" type="var">_</span> <span class="id" type="var">u1_mem_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_in_lg</span> <span class="id" type="var">u1_lt_a'</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a'_in_tl2'</span> : <span class="id" type="var">mem</span> <span class="id" type="var">equiv</span> <span class="id" type="var">a'</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">a'</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a'_in_tl2'</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a'_in_tl2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a''</span> [<span class="id" type="var">a''_eq_a'</span> <span class="id" type="var">a''_in_tl2'</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_lt_a''</span> : <span class="id" type="var">rpo</span> (<span class="id" type="var">bb</span> <span class="id" type="var">rpo_infos</span>) <span class="id" type="var">u1</span> <span class="id" type="var">a''</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">equiv_rpo_equiv_1</span> <span class="id" type="var">_</span> <span class="id" type="var">a''_eq_a'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a''_in_l2</span> : <span class="id" type="var">In</span> <span class="id" type="var">a''</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">P2</span> <span class="id" type="var">_</span>]]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">IHl1l2</span> <span class="id" type="var">u1</span> <span class="id" type="var">a''</span> <span class="id" type="var">u1_in_l1</span> <span class="id" type="var">a''_in_l2</span> <span class="id" type="var">u1_lt_a''</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u1_mem_tl2'</span> : <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>, <span class="id" type="var">equiv</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> /\ <span class="id" type="var">In</span> <span class="id" type="var">u2</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_in_eq</span> <span class="id" type="var">equiv</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">equiv_equiv</span> <span class="id" type="var">u1</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u1_mem_tl2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u1_eq_u2</span> <span class="id" type="var">u2_in_tl2'</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [ <span class="id" type="var">_</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> := <span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">u2_in_tl2'</span> <span class="id" type="var">u1_in_l1'</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Su</span> : <span class="id" type="var">size</span> <span class="id" type="var">u2</span> + <span class="id" type="var">size</span> <span class="id" type="var">u1</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Sl</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">generalize</span> (@<span class="id" type="var">equiv_eval_is_sound</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">u2</span> <span class="id" type="var">u1</span> <span class="id" type="var">Su</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">equiv_equiv</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">prec_antisym</span> <span class="id" type="var">Prec</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">f2_diff_f2</span> <span class="id" type="var">_</span>]; <span class="id" type="var">absurd</span> (<span class="id" type="var">f2</span> = <span class="id" type="var">f2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rpo_eval_is_complete</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> + <span class="id" type="var">size</span> <span class="id" type="var">t2</span> &lt;= <span class="id" type="var">n</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">equiv</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">Uncomparable</span> =&gt; ~equiv <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> /\ ~ <span class="id" type="var">rpo</span> <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> /\ ~rpo <span class="id" type="var">rpo_infos</span>.(<span class="id" type="var">bb</span>) <span class="id" type="var">t2</span> <span class="id" type="var">t1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">rpo_eval_is_sound_weak</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>)<br/>
(@<span class="id" type="var">rpo_eval_is_complete_equivalent</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>)<br/>
(@<span class="id" type="var">rpo_eval_is_complete_less_greater</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>)<br/>
(@<span class="id" type="var">rpo_eval_terminates</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">St</span>);<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St</span>;<br/>
<span class="id" type="tactic">generalize</span> (@<span class="id" type="var">rpo_eval_is_complete_less_greater</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> <span class="id" type="var">St</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">rpo_eval</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">n</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ [ | | | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">not_t2_lt_t1</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_diff_t2</span> <span class="id" type="var">not_t1_lt_t2</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">t1_diff_t2</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">not_t1_lt_t2</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">not_t2_lt_t1</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">empty_rpo_infos</span> (<span class="id" type="var">n</span> : <span class="id" type="var">nat</span>) : <span class="id" type="var">rpo_inf</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>;  <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">n</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span>*term)) (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span>*term)) (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span>*term));<span class="id" type="tactic">simpl</span>;<span class="id" type="tactic">tauto</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">add_equiv</span> (<span class="id" type="var">rpo_infos</span>:rpo_inf) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">H</span>:equiv <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) : <span class="id" type="var">rpo_inf</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">rpo_infos</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">case</span> <span class="id" type="var">rpo_infos</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">rpo_infos</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">bb0</span> <span class="id" type="var">rpo_l0</span> <span class="id" type="var">rpo_eq_l0</span> <span class="id" type="var">equiv_l0</span> <span class="id" type="var">rpo_l_valid0</span> <span class="id" type="var">rpo_eq_valid0</span> <span class="id" type="var">equiv_l_valid0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">bb0</span> <span class="id" type="var">rpo_l0</span> <span class="id" type="var">rpo_eq_l0</span> ((<span class="id" type="var">t1</span>,t2)::equiv_l0).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">exact</span> <span class="id" type="var">rpo_l_valid0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">exact</span> <span class="id" type="var">rpo_eq_valid0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">case</span> <span class="id" type="var">H0</span>;  <span class="id" type="tactic">intros</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H2</span>;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H3</span>;<span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">exact</span> (<span class="id" type="var">equiv_l_valid0</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">S</span>.<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>