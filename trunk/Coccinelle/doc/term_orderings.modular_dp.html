<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>term_orderings.modular_dp</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library term_orderings.modular_dp</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_algebra".<br/>

<br/>
</div>

<div class="doc">
<a name="lab82"></a><h1 class="section">Termination of rewriting</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Wellfounded</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Recdef</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">weaved_relation</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equational_theory_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">dp</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">MakeModDP</span> (<span class="id" type="var">E</span> : <span class="id" type="var">EqTh</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">Dp</span> := <span class="id" type="var">dp.MakeDP</span> (<span class="id" type="var">E</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">Dp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">E</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>

<br/>
</div>

<div class="doc">
Interpretation 
</div>
<div class="code">
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">interp_call</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Constr</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>, ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">interp_call</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Defd</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">interp_call</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span>  <span class="id" type="var">R2</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_well_defined_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span> <span class="id" type="var">p</span> <span class="id" type="var">f2</span> <span class="id" type="var">k</span> <span class="id" type="var">H'</span> <span class="id" type="var">Df2</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> <span class="id" type="var">H''</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> ((<span class="id" type="var">length</span> <span class="id" type="var">l'</span>) :: <span class="id" type="var">p</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_subterm</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> <span class="id" type="var">Is</span> <span class="id" type="var">Sub</span> <span class="id" type="var">q</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">Sub'</span> <span class="id" type="var">Dg</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Is</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">p</span> ++ <span class="id" type="var">q</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_one_step_interp_dom</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Sub</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_well_defined_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">Df2</span> <span class="id" type="var">t</span> <span class="id" type="var">t_R_f2l</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">Sub</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">nat</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_well_defined</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">interp_call</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Call_s_t</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Call_s_t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Call_s_t</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Call_s_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f1</span> <span class="id" type="var">l'</span> <span class="id" type="var">s'</span> <span class="id" type="var">not_def_f</span> <span class="id" type="var">s_in_l</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l'</span> <span class="id" type="var">s'</span> <span class="id" type="var">def_f</span> <span class="id" type="var">s_R_fl</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_fl</span> := <span class="id" type="var">H</span> <span class="id" type="var">nil</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>) <span class="id" type="var">def_f</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Acc_fl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_with_subterm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_t</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t'</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Call_s_t</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Call_s_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f1</span> <span class="id" type="var">l</span> <span class="id" type="var">s'</span> <span class="id" type="var">not_def_f2</span> <span class="id" type="var">s_in_l</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l</span> <span class="id" type="var">s'</span> <span class="id" type="var">def_f2</span> <span class="id" type="var">s_R_fl</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Itsigma</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_t</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_subterm2</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_R1_R2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>, <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="var">def_dec</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">R2_var</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Size_t</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); [<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">It</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t1</span> <span class="id" type="var">s1</span> <span class="id" type="var">H'</span> | <span class="id" type="var">f</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">d</span> <span class="id" type="var">g</span> <span class="id" type="var">sigma</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_in_instantiated_term</span> <span class="id" type="var">p</span> <span class="id" type="var">d</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Sub</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">d</span> <span class="id" type="var">p</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>] <span class="id" type="var">Sub'</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">x_in_g</span> := <span class="id" type="var">R1_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_in_subterm</span> <span class="id" type="var">x</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub'</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_subterm2</span> <span class="id" type="var">x</span> <span class="id" type="var">g</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">q</span> <span class="id" type="var">Sub''</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">K</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">It</span> <span class="id" type="var">q</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">g</span> <span class="id" type="var">q</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">M</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Df</span> <span class="id" type="var">H1</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub'</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Sub'</span> [<span class="id" type="var">x</span> [<span class="id" type="var">q</span> [<span class="id" type="var">q'</span> [<span class="id" type="var">K1</span> [<span class="id" type="var">x_in_d</span> [<span class="id" type="var">Sub''</span> <span class="id" type="var">Sub'''</span>]]]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">x_in_g</span> := <span class="id" type="var">R1_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_in_subterm</span> <span class="id" type="var">x</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub''</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_subterm2</span> <span class="id" type="var">x</span> <span class="id" type="var">g</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">q''</span> <span class="id" type="var">Sub4</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">It</span> (<span class="id" type="var">q''</span> ++ <span class="id" type="var">q'</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">g</span> <span class="id" type="var">q''</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub4</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">g</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">It</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_well_defined_2</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">instance</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">d</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">sigma</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> | <span class="id" type="var">Cf</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Size_ls</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">s</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_ls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hlt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">lt</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hls</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">one_step_in_list</span> <span class="id" type="var">H'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">H''</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_lt</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_in_lt</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t_in_l1</span> | [<span class="id" type="var">t_eq_b</span> | <span class="id" type="var">t_in_l2</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Size_ls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">Dg</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">lt</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">lt</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">ti</span> | ].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H''</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L1</span> <span class="id" type="var">H''</span>]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ti_in_lt</span> : <span class="id" type="var">In</span> <span class="id" type="var">ti</span> <span class="id" type="var">lt</span>).<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hlt</span> <span class="id" type="var">_</span> <span class="id" type="var">ti_in_lt</span> <span class="id" type="var">p</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_R1</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>, <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> <span class="id" type="var">R1</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="var">def_dec</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">R2_var</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_dom_R1_R2</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="var">def_dec</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">R2_var</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_rel</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_R2</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>, <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="var">def_dec</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">R2_var</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_dom_R1_R2</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="var">def_dec</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">R2_var</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_rel</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_R1_R2_rwr</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>, <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="var">def_dec</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">R2_var</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_R1_R2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_R1_R2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHtrans_clos</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> (<span class="id" type="var">v1</span> <span class="id" type="var">v2</span> : <span class="id" type="var">variable</span>) : <span class="id" type="var">relation</span> <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Pi1</span> : <span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> :: <span class="id" type="var">nil</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">Pi2</span> : <span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> :: <span class="id" type="var">nil</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">pi_subterm</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">axiom</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">direct_subterm</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> <span class="id" type="var">s'</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">pi'</span> <span class="id" type="var">H1</span> | <span class="id" type="var">pi'</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span> := <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>))).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_subterms_pi</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt; <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>))) <span class="id" type="var">t</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>))) (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">pi</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">R</span> <span class="id" type="var">R_var</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span> <span class="id" type="var">Hl</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span>)))) <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_one_step_list</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="var">absurd</span> ((<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span>)) <span class="id" type="var">t1</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">HPi</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H'</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> <span class="id" type="var">l2</span>) <span class="id" type="var">H2</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">F</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>).<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> =pi); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1_in_ll</span> : <span class="id" type="var">In</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">Acc_l'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">t</span> [<span class="id" type="var">t_eq_t1</span> | <span class="id" type="var">t_in_l</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t2</span> := <span class="id" type="var">Acc_l</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Acc_t2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Acc_l2</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t</span> | <span class="id" type="var">u_in_l1</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l2</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHone_step_list</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Interp_definition</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V0</span> : <span class="id" type="var">variable</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V1</span> : <span class="id" type="var">variable</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V0_diff_V1</span> : <span class="id" type="var">V0</span> &lt;&gt; <span class="id" type="var">V1</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">pi</span> : <span class="id" type="var">symbol</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">bot</span> : <span class="id" type="var">symbol</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R1</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">P2</span> : <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">module_R1_R2</span> : <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">def_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1_red</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2_red</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">FB1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">one_step</span> <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R1_red</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">FB2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">one_step</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R2_red</span> <span class="id" type="var">t</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">R1_R2_red</span> <span class="id" type="var">t</span> := <span class="id" type="var">R1_red</span> <span class="id" type="var">t</span> ++ <span class="id" type="var">R2_red</span> <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">FB12</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R1_R2_red</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s_R_t</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_rel</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_R_t</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">R1_R2_red</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s_R_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s_R1_t</span> | <span class="id" type="var">s_R2_t</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">FB1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">FB2</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">R1_R2_red</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> | <span class="id" type="var">K2</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_rel</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_rel</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">Comb</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">bot</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">t</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">t</span> :: (<span class="id" type="var">Comb</span> <span class="id" type="var">l</span>) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">Interp</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Vcase</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">Interp</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Ccase</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">ll</span> , ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">l'</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Dcase</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">ll</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R1_R2_red</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">l'</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">Comb</span> <span class="id" type="var">l'</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_unicity</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">s1</span> = <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Ht</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> :=interp_well_defined <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">Ht</span>).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">S2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Cf1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hl1'</span> <span class="id" type="var">Hll1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Df1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hl1'</span> <span class="id" type="var">Hll1</span> ]; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Cf2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">Hl2'</span> <span class="id" type="var">Hll2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Df2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">Hl2'</span> <span class="id" type="var">Hll2</span> ]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">ll</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> (<span class="id" type="var">A</span> := <span class="id" type="var">term</span>) <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>))).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s1) <span class="id" type="var">ll1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s2) <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">s1</span> = <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">ss1_in_ll1</span> <span class="id" type="var">ss2_in_ll2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_in_l</span> : <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span>,s1); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Constr</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>) <span class="id" type="var">s</span> <span class="id" type="var">Cf1</span> <span class="id" type="var">s_in_l</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_well_defined_1</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Ht</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">H</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">Hll2</span> <span class="id" type="var">Ht</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span> <span class="id" type="var">H2</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s</span> <span class="id" type="var">s1</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s2</span>] <span class="id" type="var">ll2</span>] <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">s_eq_s'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">try</span> (<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHll1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">tt1_in_ll1</span> <span class="id" type="var">tt2_in_ll2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">ll</span> =&gt; <span class="id" type="var">Comb</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> (<span class="id" type="var">A</span> := <span class="id" type="var">term</span>) <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>))).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s1) <span class="id" type="var">ll1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s2) <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">s1</span> = <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">ss1_in_ll1</span> <span class="id" type="var">ss2_in_ll2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_in_l</span> : <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span>,s1); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Defd</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">Df1</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Hl1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB12</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_well_defined_2</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Ht</span> <span class="id" type="var">Df1</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Hl1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB12</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hl1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hl2</span>;<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">H</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">Hll2</span> <span class="id" type="var">Ht</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span> <span class="id" type="var">H2</span> <span class="id" type="var">H1</span> <span class="id" type="var">Hl1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s</span> <span class="id" type="var">s1</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s2</span>] <span class="id" type="var">ll2</span>] <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">s_eq_s'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">try</span> (<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHll1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">tt1_in_ll1</span> <span class="id" type="var">tt2_in_ll2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_defined</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> -&gt; {<span class="id" type="var">s</span> : <span class="id" type="var">term</span> | <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Ht</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> := <span class="id" type="var">interp_well_defined</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">Ht</span>).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">Vcase</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> | <span class="id" type="var">Cf</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">interp_l</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R1_R2_red</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt; {<span class="id" type="var">u</span> : <span class="id" type="var">term</span> | <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">u</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_red_t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Defd</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">Df</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB12</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB12</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ll</span> : {<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) | <span class="id" type="var">R1_R2_red</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>)}).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">R1_R2_red</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) <span class="id" type="var">interp_l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">interp_sk</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_sk</span> <span class="id" type="var">s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">Isu</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">kk</span> [<span class="id" type="var">Hk</span> <span class="id" type="var">Pk</span>]].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">interp_sk</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">s</span>,u) :: <span class="id" type="var">kk</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> [<span class="id" type="var">tt'_eq_su</span> | <span class="id" type="var">tt'_in_kk</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">tt'_eq_su</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">Hl</span> <span class="id" type="var">Pl</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Comb</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Dcase</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">interp_l</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> -&gt; {<span class="id" type="var">u</span> : <span class="id" type="var">term</span> | <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">u</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Constr</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">Cf</span> <span class="id" type="var">s_in_l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ll</span> : {<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) | <span class="id" type="var">l</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>)}).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span> <span class="id" type="var">interp_l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">interp_sk</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_sk</span> <span class="id" type="var">s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">Isu</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">kk</span> [<span class="id" type="var">Hk</span> <span class="id" type="var">Pk</span>]].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">interp_sk</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">s</span>,u) :: <span class="id" type="var">kk</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> [<span class="id" type="var">tt'_eq_su</span> | <span class="id" type="var">tt'_in_kk</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">tt'_eq_su</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pk</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">Hl</span> <span class="id" type="var">Pl</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ccase</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">project_comb</span> :  <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t</span> (<span class="id" type="var">Comb</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">set</span> (<span class="id" type="var">sigma</span> := (<span class="id" type="var">V0</span>,a) :: (<span class="id" type="var">V1</span>, <span class="id" type="var">Comb</span> <span class="id" type="var">l</span>) :: <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> : <span class="id" type="var">a</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_var_bool_refl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> : <span class="id" type="var">Comb</span> <span class="id" type="var">l</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V1</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_var_bool_refl</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_var_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">V1_eq_V0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">V0_diff_V1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_var_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">V1_eq_V0</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H3</span> : <span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">Comb</span> <span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>, <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t_eq_a</span> | <span class="id" type="var">t_in_l</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span>, <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Comb</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span>, <span class="id" type="var">H2</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">recover_red</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">Df</span> <span class="id" type="var">Idfl</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span> <span class="id" type="var">t_R_fl</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Is</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll</span> <span class="id" type="var">Cf</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll</span> <span class="id" type="var">_</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">project_comb</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">t</span>,t'); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_R_fl_bis</span> := <span class="id" type="var">t_R_fl</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB12</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_R_fl_bis</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_R_fl_bis</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_R_fl_bis</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t_R_fl_bis</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">u</span> <span class="id" type="var">u'</span>] [<span class="id" type="var">u_eq_t</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_eq_t</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">replace</span> <span class="id" type="var">t'</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_unicity</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Interp_subst</span> <span class="id" type="var">lv</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> <span class="id" type="var">lv</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) /\<br/>
&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R1_at_top_aux_1</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> -&gt; ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp_subst</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">_</span> <span class="id" type="var">Ht</span> <span class="id" type="var">Hsigma</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">Hsigma</span> <span class="id" type="var">v</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Ct</span> <span class="id" type="var">Ht</span> <span class="id" type="var">Hsigma</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Ccase</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span>) <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>, <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">t</span>)) <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ct</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_unfold</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_map</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_map</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">u</span> [<span class="id" type="var">H'</span> <span class="id" type="var">u_in_l</span>]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Cu</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f0</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f0</span> <span class="id" type="var">u</span> = <span class="id" type="var">true</span> -&gt; ~ <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f0</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">Hg</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ct</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_unfold</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">g_eq_f</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">g_diff_f</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">u_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> <span class="id" type="var">H1</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_list_app</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">g</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hg</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hu</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">u</span>)).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_well_defined_1</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Ht</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_l</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Cu</span> <span class="id" type="var">Hu</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_u</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hsigma</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">var_list_unfold</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span> <span class="id" type="var">u_in_l</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u_eq_t</span> | <span class="id" type="var">u_in_k</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHk</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R1_at_top_aux_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> -&gt; ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;{<span class="id" type="var">sigma'</span> : <span class="id" type="var">substitution</span> | <span class="id" type="var">Interp_subst</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Ct</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Ht</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">s'</span> : <span class="id" type="var">term</span> | <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) <span class="id" type="var">s'</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_l</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">interp_dom_subst</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Ht</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_l</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">H'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Hs'</span>]; <span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">s'</span> : <span class="id" type="var">term</span> | <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) <span class="id" type="var">s'</span>}) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">l'</span> : <span class="id" type="var">substitution</span> | <span class="id" type="var">Interp_subst</span> <span class="id" type="var">l</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l'</span>}).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">x</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">substitution</span>); <br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">Interp_subst</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> <span class="id" type="var">Hsigma'</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H''</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H''</span> <span class="id" type="var">x</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">x'</span> [<span class="id" type="var">Hx'</span> <span class="id" type="var">Hx''</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">x</span>,x') :: <span class="id" type="var">sigma'</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">Interp_subst</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> [<span class="id" type="var">v_eq_x</span> | <span class="id" type="var">v_in_l</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v</span>;  <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">x</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">x</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">x_diff_x</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">x</span> = <span class="id" type="var">x</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">Hsigma'</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'''</span> <span class="id" type="var">H''''</span>]; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">x</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">v_eq_x</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">v_diff_x</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hx'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> <span class="id" type="var">Hsigma'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R1_at_top</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">S1</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> <span class="id" type="var">S1</span> <span class="id" type="var">R1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">S1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>)-&gt;<br/>
&nbsp;&nbsp;{<span class="id" type="var">sigma'</span> : <span class="id" type="var">substitution</span> &amp; {<span class="id" type="var">s'</span> : <span class="id" type="var">term</span> &amp; {<span class="id" type="var">t'</span> : <span class="id" type="var">term</span> | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp_subst</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) <span class="id" type="var">s'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) <span class="id" type="var">t'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">axiom</span> <span class="id" type="var">S1</span> <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>} } }.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">S1</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">r_R1_l</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Hl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Cl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">f_in_l</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> <span class="id" type="var">Df</span> (<span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">r_R1_l</span>)).<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">r</span> :: <span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>) <span class="id" type="keyword">with</span> ((<span class="id" type="var">r</span> :: <span class="id" type="var">nil</span>) ++ (<span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_list_app</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">f_in_l</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Cr</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">f_in_r</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> <span class="id" type="var">Df</span> (<span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">r_R1_l</span>)).<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">r</span> :: <span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>) <span class="id" type="keyword">with</span> ((<span class="id" type="var">r</span> :: <span class="id" type="var">nil</span>) ++ (<span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_list_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">f_in_r</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R1_at_top_aux_2</span> <span class="id" type="var">l</span> <span class="id" type="var">Cl</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Hl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> <span class="id" type="var">Hsigma</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Hl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Hs'</span>]; <span class="id" type="var">exists</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hsigma'</span> : <span class="id" type="var">Interp_subst</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_r</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hsigma</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_reg</span> <span class="id" type="keyword">with</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S1_in_R1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hr</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_dom_R1</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hl</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S1_in_R1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Hr</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Ht'</span>]; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hs''</span> := <span class="id" type="var">R1_at_top_aux_1</span> <span class="id" type="var">l</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Cl</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hsigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">Hl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Hs''</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ht''</span> := <span class="id" type="var">R1_at_top_aux_1</span> <span class="id" type="var">r</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Cr</span> <span class="id" type="var">Hr</span> <span class="id" type="var">Hsigma'</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">Hr</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">Ht''</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R1_at_top_dp</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">S1</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> <span class="id" type="var">S1</span> <span class="id" type="var">R1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> <span class="id" type="var">p</span>, <span class="id" type="var">S1</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt;  <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> <span class="id" type="var">r</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>)-&gt;<br/>
&nbsp;&nbsp;{<span class="id" type="var">sigma'</span> : <span class="id" type="var">substitution</span> | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp_subst</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">l</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">r</span>) }.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">S1</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> <span class="id" type="var">p</span> <span class="id" type="var">t_R1_l</span> <span class="id" type="var">t_p_eq_r</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Hl</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Cl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">f_in_l</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">Df</span> (<span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_R1_l</span>)).<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>) <span class="id" type="keyword">with</span> ((<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) ++ (<span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_list_app</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">f_in_l</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ct</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> -&gt; ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">f_in_t</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">Df</span> (<span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_R1_l</span>)).<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>) <span class="id" type="keyword">with</span> ((<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) ++ (<span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_list_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">f_in_t</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Cr</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">f_in_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ct</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">symb_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">r</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R1</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_var</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S1_in_R1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Cf</span> : ~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_unfold</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">f</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">R1_at_top</span> <span class="id" type="var">_</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_R1_l</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R1_at_top_aux_2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">Cl</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Hl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> <span class="id" type="var">Hsigma</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma'</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hsigma'</span> : <span class="id" type="var">Interp_subst</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_t</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hsigma</span> <span class="id" type="var">v</span>); <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_reg</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S1_in_R1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hsigma''</span> : <span class="id" type="var">Interp_subst</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_r</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hsigma'</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">var_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">r</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ht</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_dom_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hl</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S1_in_R1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hr</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>)).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> <span class="id" type="var">t_p_eq_r</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> <span class="id" type="var">t_p_eq_r</span> <span class="id" type="var">Ht</span> <span class="id" type="var">t_R1_l</span> <span class="id" type="var">Ct</span> <span class="id" type="var">Cr</span> <span class="id" type="var">H'</span> <span class="id" type="var">Hsigma'</span> <span class="id" type="var">Hsigma''</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">p</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> <span class="id" type="var">t_p_eq_r</span> <span class="id" type="var">Ht</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_p_eq_r</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">t_p_eq_r</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_p_eq_r</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">g</span> <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">ll</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> | ].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H''</span>]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">ll</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHp</span> <span class="id" type="var">ti</span> <span class="id" type="var">r</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_well_defined_1</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Ht</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>.<br/>
<span class="id" type="var">exists</span>  <span class="id" type="var">ti</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">R1_at_top_aux_1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Cl</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hsigma</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">r</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">Hsigma''</span> <span class="id" type="var">v</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))).<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">R1_at_top_aux_1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Cr</span> <span class="id" type="var">Hr</span> <span class="id" type="var">Hsigma''</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R1_case</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">one_step</span> <span class="id" type="var">R1</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> /\ <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> /\ <span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R1_in_R1</span> : <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Size_s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">t_R_s</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">t_R_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'_R_s'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt_R_ls</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t'_R_s'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t3</span> <span class="id" type="var">s3</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t3_R_s3</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R1_at_top</span> <span class="id" type="var">R1</span> <span class="id" type="var">R1_in_R1</span> <span class="id" type="var">s3</span> <span class="id" type="var">t3</span> <span class="id" type="var">t3_R_s3</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">_</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Hs'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">lt</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_dom_R1</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">lt</span>) <span class="id" type="var">Is</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Ht'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hs'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll</span> <span class="id" type="var">Cf</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll</span> | <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll</span> <span class="id" type="var">Df</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Ht'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">g</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">kk</span> <span class="id" type="var">Cg</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hk'</span> <span class="id" type="var">Hkk</span> | <span class="id" type="var">g</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">kk</span> <span class="id" type="var">Dg</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hk'</span> <span class="id" type="var">Hkk</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Size_ls</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">s</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_ls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">ls</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hls</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f'</span> <span class="id" type="var">ls</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hlt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">lt</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f'</span> <span class="id" type="var">lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l''</span> <span class="id" type="var">l'</span> <span class="id" type="var">s'</span> <span class="id" type="var">k''</span> <span class="id" type="var">k'</span> <span class="id" type="var">t'</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">ll</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hll</span> <span class="id" type="var">kk</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hkk</span> ;<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Size_s</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">It</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">ll</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hll</span> <span class="id" type="var">kk</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hkk</span>.<br/>

<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">lt_R_ls</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> <span class="id" type="var">t_R1_s</span> | <span class="id" type="var">s</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt_R1_ls</span>]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hll</span> <span class="id" type="var">kk</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hkk</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s''</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">kk</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t'</span> <span class="id" type="var">t''</span>] <span class="id" type="var">kk</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">replace</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t''_R_s''</span> : <span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t''</span> <span class="id" type="var">s''</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Size_s'</span> : <span class="id" type="var">size</span> <span class="id" type="var">s'</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Size_ls</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Is'</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hls</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">s'</span> <span class="id" type="var">Size_s'</span> <span class="id" type="var">t'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">v</span> [<span class="id" type="var">Hu</span> [<span class="id" type="var">Hv</span> <span class="id" type="var">H1</span>]]]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">s'</span> <span class="id" type="var">Is'</span> <span class="id" type="var">s''</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It'</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t'</span> <span class="id" type="var">It'</span> <span class="id" type="var">t''</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t''_R_s''</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hkl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">u''</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,u') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,u'') <span class="id" type="var">kk</span> -&gt; <span class="id" type="var">u'</span> = <span class="id" type="var">u''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">u''</span> <span class="id" type="var">uu'_in_ll</span> <span class="id" type="var">uu''_in_kk</span>;<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> <span class="id" type="var">u'</span> <span class="id" type="var">u''</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">u</span>,u'); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">ll</span> <span class="id" type="var">kk</span> <span class="id" type="var">H</span> <span class="id" type="var">Hkl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">Hkl</span>;<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u</span> <span class="id" type="var">u'</span>] <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">v</span> <span class="id" type="var">v'</span>] <span class="id" type="var">l2</span>] <span class="id" type="var">H</span> <span class="id" type="var">Hkl</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">u_eq_v</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">v</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hkl</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">v'</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">w</span> <span class="id" type="var">w'</span> <span class="id" type="var">w''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hkl</span> <span class="id" type="var">w</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s''</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">kk</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t'</span> <span class="id" type="var">t''</span>] <span class="id" type="var">kk</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t''_eq_s''</span> : <span class="id" type="var">t''</span> = <span class="id" type="var">s''</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t'</span> <span class="id" type="var">_</span> <span class="id" type="var">t''</span> <span class="id" type="var">s''</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">rwr_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHlt_R1_ls</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Size_ls</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hls</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t''</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s''</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Is</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">recover_red</span> <span class="id" type="var">f'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R2_case</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">one_step</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> /\ <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> /\ <span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Size_s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">t_R_s</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">t_R_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'_R_s'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt_R_ls</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t'_R_s'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t3</span> <span class="id" type="var">s3</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t3_R_s3</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t3</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_dom_R2</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Hs'</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Ht'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">ls</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R2</span> <span class="id" type="var">t3</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R2_var</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Is</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">recover_red</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t3_R_s3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R2</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec</span> <span class="id" type="var">f'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Df'</span> | <span class="id" type="var">Cf'</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Hs'</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">lt</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_dom_R2</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Ht'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Is</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">recover_red</span> <span class="id" type="var">f'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R2</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">lt</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_dom_R2</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Hs'</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Ht'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hs'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll</span> <span class="id" type="var">Cf</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll</span> | <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll</span> <span class="id" type="var">Df</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Ht'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">g</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">kk</span> <span class="id" type="var">Cg</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hk'</span> <span class="id" type="var">Hkk</span> | <span class="id" type="var">g</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">kk</span> <span class="id" type="var">Dg</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hk'</span> <span class="id" type="var">Hkk</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Size_ls</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">s</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_ls</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">ls</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hls</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">ls</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f'</span> <span class="id" type="var">ls</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hlt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">lt</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f'</span> <span class="id" type="var">lt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l''</span> <span class="id" type="var">l'</span> <span class="id" type="var">s'</span> <span class="id" type="var">k''</span> <span class="id" type="var">k'</span> <span class="id" type="var">t'</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">ll</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hll</span> <span class="id" type="var">kk</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hkk</span> ;<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Size_s</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">It</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">ll</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hll</span> <span class="id" type="var">kk</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hkk</span>.<br/>

<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">lt_R_ls</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">l</span> <span class="id" type="var">t_R2_s</span> | <span class="id" type="var">s</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt_R2_ls</span>]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hll</span> <span class="id" type="var">kk</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hkk</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s''</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">kk</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t'</span> <span class="id" type="var">t''</span>] <span class="id" type="var">kk</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">replace</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t''_R_s''</span> : <span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t''</span> <span class="id" type="var">s''</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Size_s'</span> : <span class="id" type="var">size</span> <span class="id" type="var">s'</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Size_ls</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Is'</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hls</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">s'</span> <span class="id" type="var">Size_s'</span> <span class="id" type="var">t'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">v</span> [<span class="id" type="var">Hu</span> [<span class="id" type="var">Hv</span> <span class="id" type="var">H1</span>]]]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">s'</span> <span class="id" type="var">Is'</span> <span class="id" type="var">s''</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It'</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t'</span> <span class="id" type="var">It'</span> <span class="id" type="var">t''</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t''_R_s''</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hkl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">u''</span>, <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,u') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,u'') <span class="id" type="var">kk</span> -&gt; <span class="id" type="var">u'</span> = <span class="id" type="var">u''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">u''</span> <span class="id" type="var">uu'_in_ll</span> <span class="id" type="var">uu''_in_kk</span>;<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> <span class="id" type="var">u'</span> <span class="id" type="var">u''</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">u</span>,u'); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">ll</span> <span class="id" type="var">kk</span> <span class="id" type="var">H</span> <span class="id" type="var">Hkl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">Hkl</span>;<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u</span> <span class="id" type="var">u'</span>] <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">v</span> <span class="id" type="var">v'</span>] <span class="id" type="var">l2</span>] <span class="id" type="var">H</span> <span class="id" type="var">Hkl</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">u_eq_v</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">v</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Hkl</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">v'</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">w</span> <span class="id" type="var">w'</span> <span class="id" type="var">w''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hkl</span> <span class="id" type="var">w</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s''</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">kk</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">t'</span> <span class="id" type="var">t''</span>] <span class="id" type="var">kk</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hk</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">t''_eq_s''</span> : <span class="id" type="var">t''</span> = <span class="id" type="var">s''</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t'</span> <span class="id" type="var">_</span> <span class="id" type="var">t''</span> <span class="id" type="var">s''</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t''</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">rwr_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHlt_R2_ls</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Size_ls</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hls</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hlt</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s''</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Is</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">recover_red</span> <span class="id" type="var">f'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R2</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R1_R2_case_one_step</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> /\ <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> /\ <span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_rel</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_case</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R2_case</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">Hs'</span> [<span class="id" type="var">Ht'</span> <span class="id" type="var">H'</span>]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H''</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R1_R2_case</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> /\ <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> /\ <span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Is</span> <span class="id" type="var">t_R_s</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">t_R_s</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_R2_case_one_step</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHt_R_s</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">Hs'</span> [<span class="id" type="var">Ht'</span> <span class="id" type="var">t'_R_s'</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It2</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">y</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_R1_R2_rwr</span> <span class="id" type="keyword">with</span> <span class="id" type="var">z</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R1_R2_case_one_step</span> <span class="id" type="var">y</span> <span class="id" type="var">x</span> <span class="id" type="var">It2</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> [<span class="id" type="var">t''</span> [<span class="id" type="var">Hs''</span> [<span class="id" type="var">Ht''</span> <span class="id" type="var">t''_R_s''</span>]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t''</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">It2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hs''</span> <span class="id" type="var">Ht'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">technical_lemma_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">S1</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> <span class="id" type="var">S1</span> <span class="id" type="var">R1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">S1</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_s</span> <span class="id" type="var">s'</span> <span class="id" type="var">_t</span> <span class="id" type="var">t'</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">t_S1_s</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_S1_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">sigma</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">t_S1_s</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K</span> <span class="id" type="var">Sub</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">s''</span> <span class="id" type="var">t''</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t''_S1_s''</span> <span class="id" type="var">H</span> <span class="id" type="var">Df</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v''</span> | <span class="id" type="var">f''</span> <span class="id" type="var">l''</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R1</span> <span class="id" type="var">t''</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v''</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_var</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S1_in_R1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">R1_at_top_dp</span> <span class="id" type="var">_</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t''_S1_s''</span> <span class="id" type="var">H</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> [<span class="id" type="var">Isigma</span> [<span class="id" type="var">_</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>]]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Hs</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">Ht</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> (<span class="id" type="var">Dp</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t''_S1_s''</span> <span class="id" type="var">H</span> <span class="id" type="var">Df</span>) | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">technical_lemma</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">S1</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> <span class="id" type="var">S1</span> <span class="id" type="var">R1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">S1</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">t_R_s</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_R_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t''</span> <span class="id" type="var">l2_R_l1</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t_R_s</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Is2</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t2_R_t1</span> : <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l2_R_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> | <span class="id" type="var">l2'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2_R_l1'</span>]; <span class="id" type="tactic">subst</span>; <br/>
&nbsp;&nbsp;[<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t2_R_t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t12</span> | <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2_R_t1'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">t2_R_t1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_R1_R2_rwr</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Is2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> <span class="id" type="var">Hs''</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hs'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Cf'</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll1</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Df</span> <span class="id" type="var">Hl</span> <span class="id" type="var">Hl'</span> <span class="id" type="var">Hll1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hs'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hs''</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f''</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Cf''</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hk'</span> <span class="id" type="var">Hll2</span> | <span class="id" type="var">f''</span> <span class="id" type="var">k'</span> <span class="id" type="var">k''</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Df'</span> <span class="id" type="var">Hk</span> <span class="id" type="var">Hk'</span> <span class="id" type="var">Hll2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (@<span class="id" type="var">snd</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll1</span>) (<span class="id" type="var">map</span> (@<span class="id" type="var">snd</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll2</span>) <span class="id" type="var">t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ill2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">map</span> (@<span class="id" type="var">fst</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll2</span>) -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_well_defined_1</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ill1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">map</span> (@<span class="id" type="var">fst</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll1</span>) -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_well_defined_1</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Is</span> <span class="id" type="var">H</span> <span class="id" type="var">Is2</span> <span class="id" type="var">Hs''</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Ill1</span> <span class="id" type="var">Ill2</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">Hll2</span> <span class="id" type="var">l2_R_l1</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">ll2</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u</span> <span class="id" type="var">u'</span>] <span class="id" type="var">ll2</span>].<br/>
<span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">v</span> <span class="id" type="var">v'</span>] <span class="id" type="var">ll1</span>] <span class="id" type="var">Ill1</span> <span class="id" type="var">Ill2</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">Hll2</span> <span class="id" type="var">l2_R_l1</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">refl_trans_clos_one_step_list_length_eq</span> <span class="id" type="var">l2_R_l1</span>); <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">v</span> <span class="id" type="var">v'</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Ill1</span> <span class="id" type="var">Ill2</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">Hll2</span> <span class="id" type="var">l2_R_l1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">refl_trans_clos_one_step_list_length_eq</span> <span class="id" type="var">l2_R_l1</span>); <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">u_R_v</span> : <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">u</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_one_step_list_refl_trans_clos_one_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">nil</span> (<span class="id" type="var">map</span> (@<span class="id" type="var">fst</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll2</span>) <span class="id" type="var">nil</span> (<span class="id" type="var">map</span> (@<span class="id" type="var">fst</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">u_R_v</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">uv</span> | <span class="id" type="var">uu</span> <span class="id" type="var">vv</span> <span class="id" type="var">u_R_v'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">u_R_v</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Iv</span> := <span class="id" type="var">Ill1</span> <span class="id" type="var">v</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">Iv</span> <span class="id" type="var">v'</span> <span class="id" type="var">u'</span> (<span class="id" type="var">Hll1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) (<span class="id" type="var">Hll2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))).<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Iv</span> := <span class="id" type="var">Ill1</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Iu</span> := <span class="id" type="var">Ill2</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R1_R2_case</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Iv</span> <span class="id" type="var">u_R_v'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">v''</span> [<span class="id" type="var">u''</span> [<span class="id" type="var">Iv'</span> [<span class="id" type="var">Iu'</span> <span class="id" type="var">H</span>]]]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">Iv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hll1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="var">Iv'</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> <span class="id" type="var">Iu</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Hll2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="var">Iu'</span>).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHll2</span> <span class="id" type="var">ll1</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">Ill1</span>) (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">Ill2</span>) (<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">H</span> =&gt; <span class="id" type="var">Hll1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">H</span> =&gt; <span class="id" type="var">Hll2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>))).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span> <span class="id" type="keyword">in</span> <span class="id" type="var">l2_R_l1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> <span class="id" type="var">l2_R_l1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">technical_lemma_1</span> <span class="id" type="var">_</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is2</span> <span class="id" type="var">It</span> <span class="id" type="var">Hs''</span> <span class="id" type="var">Ht'</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">k2</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2</span> <span class="id" type="var">Sub</span>]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v2</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_var</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S1_in_R1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2</span> <span class="id" type="var">Sub</span>]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">D2f</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">D2f</span> (<span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_interp_acc</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">S1</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> <span class="id" type="var">S1</span> <span class="id" type="var">R1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">S1</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span> <span class="id" type="var">Acc_s'</span>;<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">s</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_s'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Acc_s'</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Is</span> <span class="id" type="var">Hs'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_R_s</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t_R_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t''</span> <span class="id" type="var">l2_R_l1</span> <span class="id" type="var">H</span> ]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t_R_s</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Is2</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l2_R_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> | <span class="id" type="var">k2</span> <span class="id" type="var">k1</span> <span class="id" type="var">l2_R_l1'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2_R_l1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_R1_R2_rwr</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t''</span> <span class="id" type="var">_s''</span> <span class="id" type="var">sigma</span> <span class="id" type="var">K'</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K'</span> <span class="id" type="var">Sub</span>];<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s''</span> <span class="id" type="var">t'</span> <span class="id" type="var">p</span> <span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">t''_S1_s''</span> <span class="id" type="var">H'</span> <span class="id" type="var">Df</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">K2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Is2</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R1_at_top_dp</span> <span class="id" type="var">_</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t''_S1_s''</span> <span class="id" type="var">H'</span> <span class="id" type="var">_</span> <span class="id" type="var">Is2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> [<span class="id" type="var">_</span> [<span class="id" type="var">K</span> <span class="id" type="var">_</span>]]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">Ht'</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> <span class="id" type="var">t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">technical_lemma</span> <span class="id" type="var">_</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_interp_acc</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">S1</span>, <span class="id" type="var">inclusion</span> <span class="id" type="var">_</span> <span class="id" type="var">S1</span> <span class="id" type="var">R1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> -&gt;   <span class="id" type="var">Acc</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">S1</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">S1</span> <span class="id" type="var">S1_in_R1</span> <span class="id" type="keyword">wf</span> <span class="id" type="var">s</span> <span class="id" type="var">Is</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Hs'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_interp_acc</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_interp_dom</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Sub</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Interp_definition</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Modular_termination</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V0</span> : <span class="id" type="var">variable</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V1</span> : <span class="id" type="var">variable</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V0_diff_V1</span> : <span class="id" type="var">V0</span> &lt;&gt; <span class="id" type="var">V1</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">pi</span> : <span class="id" type="var">symbol</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">bot</span> : <span class="id" type="var">symbol</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R3</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">def_dec1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R1</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R1</span> <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">def_dec2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R2</span> <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">def_dec3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span>}+{~defined <span class="id" type="var">R3</span> <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1_red</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2_red</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R3_red</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">FB1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">one_step</span> <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R1_red</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">FB2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">one_step</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R2_red</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">FB3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">one_step</span> <span class="id" type="var">R3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R3_red</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">module_R1_R2</span> : <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">module_R1_R3</span> : <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R3_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R1</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R2_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R2</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R3_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R3</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">P1</span> : <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">P2</span> : <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">P3</span> : <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R3</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Indep2</span> :  <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">R3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Indep3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">W2</span> : <span class="id" type="var">well_founded</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">W3</span> : <span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R3</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R132_reg'</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">H1</span> |  <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> [<span class="id" type="var">x_eq_v1</span> | <span class="id" type="var">x_in_nil</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> [<span class="id" type="var">x_eq_v1</span> | <span class="id" type="var">x_in_nil</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R123_reg'</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> [<span class="id" type="var">x_eq_v1</span> | <span class="id" type="var">x_in_nil</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> [<span class="id" type="var">x_eq_v1</span> | <span class="id" type="var">x_in_nil</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R12_var'</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">v</span> : <span class="id" type="var">variable</span>) (<span class="id" type="var">t</span> :term), ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H12</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R123_var'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R132_var'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Incomp12</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R1</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M2</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">D1</span> <span class="id" type="var">D2</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">h'</span> <span class="id" type="var">l1</span> <span class="id" type="var">u1</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">D1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">M2</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">D2</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=f); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Incomp13</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R1</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M3</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">D1</span> <span class="id" type="var">D3</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">h'</span> <span class="id" type="var">l1</span> <span class="id" type="var">u1</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">D1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">M3</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">D3</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=f); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Incomp23</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">D2</span> <span class="id" type="var">D3</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">h'</span> <span class="id" type="var">l2</span> <span class="id" type="var">u2</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">D2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">Indep3</span> <span class="id" type="var">u2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) <span class="id" type="var">f</span> <span class="id" type="var">D3</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">u2</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=f); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Incomp</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>), <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span> -&gt; ~defined <span class="id" type="var">R</span> <span class="id" type="var">pi</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">D</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P</span> <span class="id" type="var">u</span> (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> <span class="id" type="var">l</span>) <span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">F</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Incomp1'</span> := <span class="id" type="var">Incomp</span> <span class="id" type="var">R1</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Incomp2'</span> := <span class="id" type="var">Incomp</span> <span class="id" type="var">R2</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Incomp3'</span> := <span class="id" type="var">Incomp</span> <span class="id" type="var">R3</span> <span class="id" type="var">P3</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Incomp123'</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span> -&gt; <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">D12f</span> <span class="id" type="var">D3f'</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">D12f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">D12f</span>; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">D3f'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f''</span> <span class="id" type="var">l'</span> <span class="id" type="var">u'</span> [<span class="id" type="var">H3</span> | <span class="id" type="var">Hpi</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">D3f'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp13</span> <span class="id" type="var">f</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R1</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H1</span>) (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">u'</span> <span class="id" type="var">H3</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp1'</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R1</span> <span class="id" type="var">pi</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H1</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp23</span> <span class="id" type="var">f</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H2</span>) (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">u'</span> <span class="id" type="var">H3</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp2'</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">pi</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H2</span>)).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_dp_top</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">lt</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;( (<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span> /\ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> /\ <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">g</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> /\ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M2</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module_R1_R3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M3</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_t</span> <span class="id" type="var">_s</span> <span class="id" type="var">sigma</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K</span> <span class="id" type="var">Sub'</span>];<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">p</span> <span class="id" type="var">h</span> <span class="id" type="var">l</span> <span class="id" type="var">H'</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Dh</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">_s</span> <span class="id" type="var">_t</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">ls'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R123_var'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H'</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H12</span> | [ <span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Dh</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">h'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span> [<span class="id" type="var">K12</span> | [<span class="id" type="var">K3</span> | <span class="id" type="var">KPi</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Dh</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H12</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K12</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">M3</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">g</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span> <span class="id" type="var">K3</span>) <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">g</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">g</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">g_diff_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">g</span>=g)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">F</span> := <span class="id" type="var">Indep3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K3</span>) <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">g</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">g</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">g_diff_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">g</span>=g)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">KPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Dh</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">h'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Dh</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K12</span> | [<span class="id" type="var">K3</span> | <span class="id" type="var">KPi</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> | <span class="id" type="var">K2</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">F</span> := <span class="id" type="var">Indep2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>) <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">g</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">g</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">g_diff_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">g</span>=g)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K3</span>).<br/>

<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">KPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_rdp_step_top</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))) <span class="id" type="var">R</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">lt</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;( (<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span> /\ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> /\ <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">g</span>) \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> /\ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">split_dp_top</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l2</span> <span class="id" type="var">lt</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_dp</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">s</span> <span class="id" type="var">t</span> \/ <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R3</span>) <span class="id" type="var">s</span> <span class="id" type="var">t</span> \/<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">t3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">p</span>, <span class="id" type="var">exists</span> <span class="id" type="var">f1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R3</span> <span class="id" type="var">t1</span> <span class="id" type="var">t3</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t1</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">defined</span> <span class="id" type="var">R1</span> <span class="id" type="var">f1</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">t</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t3</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">s</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M3</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_s</span> <span class="id" type="var">_t</span> <span class="id" type="var">_H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">_H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">_H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> <span class="id" type="var">Sub'</span>];<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">H'</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H123</span> | <span class="id" type="var">HPi</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H123</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H12</span> | <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K123</span> | <span class="id" type="var">KPi</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K123</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K12</span> | <span class="id" type="var">K3</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">Dp</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span> <span class="id" type="var">p</span> |idtac]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K12</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">M3</span> <span class="id" type="var">f</span> <span class="id" type="var">t'</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span> <span class="id" type="var">K3</span>) <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">F</span> := <span class="id" type="var">Indep3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K3</span>) <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t'</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">KPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K123</span> | <span class="id" type="var">KPi</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K123</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K12</span> | <span class="id" type="var">K3</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> | <span class="id" type="var">K2</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">p</span>; <span class="id" type="var">exists</span> <span class="id" type="var">f</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K1</span>).<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">F</span> := <span class="id" type="var">Indep2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>) <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t'</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">Dp</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span> <span class="id" type="var">p</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K3</span>).<br/>

<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">KPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">P3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">pi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span>=pi); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_rdp_step</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>))) <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> \/<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R3</span>)) <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> \/<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">f3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">p</span>, <span class="id" type="var">exists</span> <span class="id" type="var">f1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">R3</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f3</span> <span class="id" type="var">l2</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t1</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">defined</span> <span class="id" type="var">R1</span> <span class="id" type="var">f1</span> /\<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">rwr_list</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l2</span>) <span class="id" type="var">l3</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l2</span> = <span class="id" type="var">l3</span>) /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">t</span> = <span class="id" type="var">Term</span> <span class="id" type="var">f3</span> <span class="id" type="var">l3</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">s</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_dp</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H''</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | [<span class="id" type="var">H2</span> | <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t3'</span> [<span class="id" type="var">t1</span> [<span class="id" type="var">p</span> [<span class="id" type="var">f1</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">sigma</span> [<span class="id" type="var">K3</span> [<span class="id" type="var">Sub'</span> [<span class="id" type="var">Df1</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]]]]]]]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t3'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v3</span> | <span class="id" type="var">f3</span> <span class="id" type="var">l3</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R3</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v3</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R3_var</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">f3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">p</span>; <span class="id" type="var">exists</span> <span class="id" type="var">f1</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K1</span> <span class="id" type="var">f_eq_f3</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span>; [<span class="id" type="var">right</span> | <span class="id" type="var">left</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">Pi_red</span> (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>) : <span class="id" type="var">list</span> <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">Pi_red_list</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">Pi_red_list</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t</span> :: <span class="id" type="var">lt</span> =&gt; (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t'</span> =&gt; <span class="id" type="var">t'</span> :: <span class="id" type="var">lt</span>) (<span class="id" type="var">Pi_red</span> <span class="id" type="var">t</span>)) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">t</span> :: <span class="id" type="var">l'</span>) (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">lt</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">pi</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt;map (<span class="id" type="keyword">fun</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">pi</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>) (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">Pi_red_list</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t</span> :: <span class="id" type="var">lt</span> =&gt; (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t'</span> =&gt; <span class="id" type="var">t'</span> :: <span class="id" type="var">lt</span>) (<span class="id" type="var">Pi_red</span> <span class="id" type="var">t</span>)) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">t</span> :: <span class="id" type="var">l'</span>) (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">lt</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">FB_Pi</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">t</span> (<span class="id" type="var">Pi_red</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">f2_eq_f</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span> <span class="id" type="var">f2</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">Pi_red</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">left</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">f2_eq_f</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span> <span class="id" type="var">f2</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">Pi_red</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">pi_diff_pi</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>)]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">In</span> <span class="id" type="var">l1</span> (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHone_step_list</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">t3</span> <span class="id" type="var">l</span>]]].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l'</span>, <span class="id" type="var">In</span> <span class="id" type="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">fix</span> <span class="id" type="var">Pi_red_list</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">term</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span> (<span class="id" type="var">A</span>:=list <span class="id" type="var">term</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t</span> :: <span class="id" type="var">lt</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t'</span> : <span class="id" type="var">term</span> =&gt; <span class="id" type="var">t'</span> :: <span class="id" type="var">lt</span>) (<span class="id" type="var">Pi_red</span> <span class="id" type="var">t</span>) ++<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span> =&gt; <span class="id" type="var">t</span> :: <span class="id" type="var">l'</span>) (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">lt</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">l'</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : <span class="id" type="var">In</span> <span class="id" type="var">l'</span> (<span class="id" type="var">Pi_red_list</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l'</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H''</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">H1'</span> <span class="id" type="var">H1</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">head_step</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">H2'</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">tail_step</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">t3</span> <span class="id" type="var">l</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t_eq_t1</span> | [<span class="id" type="var">t_eq_t2</span> | <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1sigma</span> : <span class="id" type="var">t1</span> = <span class="id" type="var">apply_subst</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">V0</span>,t1) :: (<span class="id" type="var">V1</span>,t2) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V0</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V0</span> <span class="id" type="var">V0</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">V0_diff_V0</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V0</span> = <span class="id" type="var">V0</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2sigma</span> : <span class="id" type="var">Term</span> <span class="id" type="var">pi</span>  (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">apply_subst</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">V0</span>,t1) :: (<span class="id" type="var">V1</span>,t2) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V0</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V0</span> <span class="id" type="var">V0</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">V0_diff_V0</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V0</span> = <span class="id" type="var">V0</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">V1_eq_V0</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V0</span> = <span class="id" type="var">V1</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">V0</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V1</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">V1_diff_V1</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V1</span> = <span class="id" type="var">V1</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span> <span class="id" type="tactic">at</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1sigma</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span> <span class="id" type="tactic">at</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2sigma</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pi1</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1sigma</span> : <span class="id" type="var">t2</span> = <span class="id" type="var">apply_subst</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">V0</span>,t1) :: (<span class="id" type="var">V1</span>,t2) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Var</span> <span class="id" type="var">V1</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">V1_eq_V0</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V0</span> = <span class="id" type="var">V1</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">V0</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V1</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">V1_diff_V1</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V1</span> = <span class="id" type="var">V1</span>)]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2sigma</span> : <span class="id" type="var">Term</span> <span class="id" type="var">pi</span>  (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">apply_subst</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">V0</span>,t1) :: (<span class="id" type="var">V1</span>,t2) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V0</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V0</span> <span class="id" type="var">V0</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">V0_diff_V0</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V0</span> = <span class="id" type="var">V0</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">V1_eq_V0</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V0</span> = <span class="id" type="var">V1</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">V0</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V1</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">V1_diff_V1</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">V1</span> = <span class="id" type="var">V1</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t2</span> <span class="id" type="tactic">at</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1sigma</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">t2</span> <span class="id" type="tactic">at</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2sigma</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pi2</span>.<br/>

<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">def_dec3'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> : <span class="id" type="var">symbol</span>, {<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span>} + {~ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec3</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> | <span class="id" type="var">Cf</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>)).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pi1</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> [<span class="id" type="var">H3</span> | <span class="id" type="var">Hpi</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cf</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R3_var'</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">v</span> : <span class="id" type="var">variable</span>) (<span class="id" type="var">t</span> :term), ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R12_var</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">v</span> : <span class="id" type="var">variable</span>) (<span class="id" type="var">t</span> :term), ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R12_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">variable</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] <span class="id" type="var">x</span> <span class="id" type="var">x_in_s</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_reg</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R2_reg</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">module123'</span> : <span class="id" type="var">module</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M3</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Mod</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Df</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">M3</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Indep3</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H2</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H2</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">W12'</span> : <span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>))) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">W2'</span> := <span class="id" type="var">dp_necessary</span> <span class="id" type="var">_</span> <span class="id" type="var">R12_var'</span> <span class="id" type="var">W2</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">wf_incl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">W2'</span>).<br/>
<span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dp_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_is_dp</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">T12</span> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">wf_interp_acc</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">bot</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">R12_reg</span> <span class="id" type="var">R12_var</span> <span class="id" type="var">R3_var'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">module123'</span> <span class="id" type="var">def_dec3'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">FB12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">FB1</span> <span class="id" type="var">FB2</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">FB12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">FB3</span> <span class="id" type="var">FB_Pi</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> =&gt; <span class="id" type="var">H</span>) <span class="id" type="var">W12'</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">def_dec2'</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> : <span class="id" type="var">symbol</span>, {<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span>} + {~ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec2</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> | <span class="id" type="var">Cf</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>)).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pi1</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">Hpi</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cf</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R2_var'</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">v</span> : <span class="id" type="var">variable</span>) (<span class="id" type="var">t</span> :term), ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R13_var</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">v</span> : <span class="id" type="var">variable</span>) (<span class="id" type="var">t</span> :term), ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R13_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">variable</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] <span class="id" type="var">x</span> <span class="id" type="var">x_in_s</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_reg</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R3_reg</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">module132'</span> : <span class="id" type="var">module</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M3</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">module_R1_R2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Mod</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Df</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">M2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Indep2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H3</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H3</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Hs</span> <span class="id" type="var">Ht</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hs</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">pi</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">pi</span> = <span class="id" type="var">pi</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">T3</span> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">wf_interp_acc</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">bot</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R13_reg</span> <span class="id" type="var">R13_var</span> <span class="id" type="var">R2_var'</span> <span class="id" type="var">module132'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">def_dec2'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">FB12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">FB1</span> <span class="id" type="var">FB3</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">FB12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">FB2</span> <span class="id" type="var">FB_Pi</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R3</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> =&gt; (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)) <span class="id" type="var">W3</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">def_dec123'</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> : <span class="id" type="var">symbol</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">constructor</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">f</span>} +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pi1</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec1</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D1f</span> | <span class="id" type="var">C1f</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D1f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec2</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D2f</span> | <span class="id" type="var">C2f</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D2f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">do</span> 1 <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec3</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D3f</span> | <span class="id" type="var">C3f</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D3f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Cf</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span>  [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C1f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C2f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C3f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=f); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Const</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">def_dec132'</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> : <span class="id" type="var">symbol</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">constructor</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">f</span>} +<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pi1</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec1</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D1f</span> | <span class="id" type="var">C1f</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D1f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec2</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D2f</span> | <span class="id" type="var">C2f</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D2f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec3</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D3f</span> | <span class="id" type="var">C3f</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D3f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Cf</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span>  [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C1f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C3f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C2f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=f); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Const</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">modular_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">def_dec12</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> : <span class="id" type="var">symbol</span>, {<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span>} + {~ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec1</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D1f</span> | <span class="id" type="var">C1f</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D1f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec2</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D2f</span> | <span class="id" type="var">C2f</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D2f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C1f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C2f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Dummy</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span>;<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">Hpi</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | [<span class="id" type="var">H3</span> | <span class="id" type="var">Hpi</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Case12</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Interp_dom</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">D12</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">D12</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H12</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ts</span> := <span class="id" type="var">T12</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">D12'</span> : <span class="id" type="keyword">match</span> <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">Ts</span> <span class="id" type="var">D12'</span> <span class="id" type="var">It</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">It</span> <span class="id" type="var">Ts</span> <span class="id" type="var">D12'</span> <span class="id" type="var">D12</span> <span class="id" type="var">H12</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [[ <span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">D12f</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Simple_step</span> : <br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span><br/>
(<span class="id" type="var">IH</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">y</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp_dom</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">y</span>)<br/>
(<span class="id" type="var">It</span> : <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))<br/>
(<span class="id" type="var">t</span> : <span class="id" type="var">term</span>)<br/>
(<span class="id" type="var">H</span> : <span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)),<br/>
<span class="id" type="var">Acc</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span> <span class="id" type="var">It</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">It</span> <span class="id" type="var">t</span> <span class="id" type="var">Hm</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_t</span> <span class="id" type="var">s</span> <span class="id" type="var">sigma</span> <span class="id" type="var">_Hm</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">_Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_Hm</span> <span class="id" type="var">_Sub</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_s</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">t_R_s</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">_Hm</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_dp_top</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hm</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D12'</span> | [<span class="id" type="var">D13</span> | <span class="id" type="var">D3</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hm</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">D12'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> <span class="id" type="var">Dg</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_R12_s</span> : (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | [<span class="id" type="var">H3</span> | <span class="id" type="var">Hpi</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t_R_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H12</span> | <span class="id" type="var">H3'</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module123'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f''</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H12</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">F</span> := <span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> <span class="id" type="var">k</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) <span class="id" type="var">H3'</span>) <span class="id" type="var">H12</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>))) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">g''</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k''</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">absurd</span> ((<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">instance</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>) <span class="id" type="var">sigma</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> (<span class="id" type="var">Dp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) <span class="id" type="var">p</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span>) | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_not_in_F3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span> : <span class="id" type="var">symbol</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">g</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> -&gt; ~ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">g</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">g_in_s</span> <span class="id" type="var">D3g</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module123'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">M</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">D3g</span> <span class="id" type="var">t_R12_s</span>).<br/>
<span class="id" type="tactic">pattern</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">symb_in_term_list</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="var">cbv</span> <span class="id" type="var">beta</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">g_in_s</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">g</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>)); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">ff</span> <span class="id" type="var">ll</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R12_var</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">f'k'_not_in_F3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span> : <span class="id" type="var">symbol</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">g</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) = <span class="id" type="var">true</span> -&gt; ~ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">g</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">g_in_s</span> <span class="id" type="var">D3g</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module123'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">M</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">D3g</span> <span class="id" type="var">t_R12_s</span>).<br/>
<span class="id" type="tactic">pattern</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">symb_in_term_list</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="var">cbv</span> <span class="id" type="var">beta</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">g_in_s</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">interp_dom_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ff</span> <span class="id" type="var">ll</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&gt;  <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_s'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">K2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">interp_dom_subst</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">_</span> <span class="id" type="var">sigma</span> <span class="id" type="var">It</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_s'</span>).<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>] <span class="id" type="var">h</span> <span class="id" type="var">kk</span> <span class="id" type="var">Sub'</span> <span class="id" type="var">D3h</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module123'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Dg</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">kk</span> <span class="id" type="var">v</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">M</span> <span class="id" type="var">h</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">D3h</span> <span class="id" type="var">H1</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">h</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_in_instantiated_term</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub'</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">subterm_at_pos</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span>) (<span class="id" type="var">i</span> :: <span class="id" type="var">q</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Sub4</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sub5</span> := <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Sub4</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">h'</span> <span class="id" type="var">ll'</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v_in_s</span> : <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ff</span> <span class="id" type="var">ll</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R12_reg</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">var_in_subterm</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) (<span class="id" type="var">p</span> ++ <span class="id" type="var">i</span> :: <span class="id" type="var">q</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_dom_var</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_s</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">h'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">f'k'_not_in_F3</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">h'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub5</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> [<span class="id" type="var">v</span> [<span class="id" type="var">q'</span> [<span class="id" type="var">q''</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">v_in_g''k''</span> [<span class="id" type="var">Sub3</span> <span class="id" type="var">Sub4</span>]]]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v_in_s</span> : <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ff</span> <span class="id" type="var">ll</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R12_reg</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">var_in_subterm</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">Term</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span>) <span class="id" type="var">p</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_dom_var</span> <span class="id" type="var">v</span> <span class="id" type="var">v_in_s</span> <span class="id" type="var">q''</span>); <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">D13</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">D3</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module123'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D12f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H12</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">D3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">k'''</span> <span class="id" type="var">u'</span> <span class="id" type="var">H3</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">F</span> := <span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> <span class="id" type="var">k'''</span> <span class="id" type="var">u'</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>)) <span class="id" type="var">H12</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="var">revert</span> <span class="id" type="var">F</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> =f); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">D3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">D3</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">module123'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M</span>].<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D12f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H12</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">D3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">k'''</span> <span class="id" type="var">u'</span> <span class="id" type="var">H3</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">F</span> := <span class="id" type="var">M</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> <span class="id" type="var">k'''</span> <span class="id" type="var">u'</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>)) <span class="id" type="var">H12</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">l'</span> <span class="id" type="var">s''</span> <span class="id" type="var">l_R_l'</span> <span class="id" type="var">Hm</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Simple_step</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">v</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>] <span class="id" type="var">H</span> <span class="id" type="var">D12</span> <span class="id" type="var">Iu</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">k'</span> <span class="id" type="var">l''</span> <span class="id" type="var">s'''</span> <span class="id" type="var">l'_R_l''</span> <span class="id" type="var">Hm'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>] <span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Dg</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>; [<span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp123'</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">l_R_l'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l1_R_l1'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">l_R_l'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">It</span> (<span class="id" type="var">i</span> :: <span class="id" type="var">p</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">It'</span> := <span class="id" type="var">interp_dom_R1_R2_rwr</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">module123'</span> <span class="id" type="var">def_dec3'</span> <span class="id" type="var">R12_reg</span> <span class="id" type="var">R3_var'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">It</span> (<span class="id" type="var">general_context</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">l1_R_l1'</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">It'</span> (<span class="id" type="var">i</span> :: <span class="id" type="var">p</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Case3</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;( <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>  <span class="id" type="var">D3</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>] <span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">Sub</span> <span class="id" type="var">D2</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">D2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp23</span> <span class="id" type="var">f</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H2</span>) <span class="id" type="var">D3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp3'</span> <span class="id" type="var">D3</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">ls1</span> [<span class="id" type="var">ls2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hti</span> : <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">ti</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_interp_dom</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hti</span> <span class="id" type="var">p</span>); <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">D3'</span> : <span class="id" type="keyword">match</span> <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">g</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ts</span> := <span class="id" type="var">T3</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHl'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">direct_subterm</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">Ts</span> <span class="id" type="var">D3'</span> <span class="id" type="var">IHl'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">Ts</span> <span class="id" type="var">D3'</span> <span class="id" type="var">IHl</span> <span class="id" type="var">D3</span> <span class="id" type="var">IHl'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [[ <span class="id" type="var">v</span> | <span class="id" type="var">_f</span> <span class="id" type="var">l</span>] <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">D3</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Simple_step</span> : <br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span><br/>
(<span class="id" type="var">IH</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">y</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R3</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">_f</span> <span class="id" type="var">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">y</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">g</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">direct_subterm</span> <span class="id" type="var">t</span> <span class="id" type="var">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">y</span>) <br/>
(<span class="id" type="var">D3</span> : <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">_f</span>)<br/>
(<span class="id" type="var">IHl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">direct_subterm</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">_f</span> <span class="id" type="var">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span>)<br/>
(<span class="id" type="var">t</span> : <span class="id" type="var">term</span>)<br/>
(<span class="id" type="var">H</span> : <span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">_f</span> <span class="id" type="var">l</span>)),<br/>
<span class="id" type="var">Acc</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span> <span class="id" type="var">D3</span> <span class="id" type="var">IHl</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">D3</span> <span class="id" type="var">IHl</span> <span class="id" type="var">t</span> <span class="id" type="var">_Hm</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_t</span> <span class="id" type="var">_s</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Hm</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">_Hm</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Hm</span> <span class="id" type="var">_Sub</span>];<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>] <span class="id" type="var">p</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">t_R_s</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hm</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">_s</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_var'</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_R3_s</span> : <span class="id" type="var">R3</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t_R_s</span> <span class="id" type="keyword">as</span> [[ <span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp13</span> <span class="id" type="var">_f</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>) <span class="id" type="var">D3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp23</span> <span class="id" type="var">_f</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="var">D3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">_f</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp3'</span> <span class="id" type="var">D3</span>).<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hm'</span> : <span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">_f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">K2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Dp</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>)  <span class="id" type="var">p</span>  <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Df''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">h''</span> <span class="id" type="var">l''</span> <span class="id" type="var">u''</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">Hpi</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">g''</span> <span class="id" type="var">l''</span> <span class="id" type="var">u''</span>); <span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">g''</span> <span class="id" type="var">l''</span> <span class="id" type="var">u''</span>); <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">g''</span> <span class="id" type="var">l''</span> <span class="id" type="var">u''</span>); <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">g''</span> <span class="id" type="var">l''</span> <span class="id" type="var">u''</span>); <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_dp_top</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hm'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D12'</span> | <span class="id" type="var">DD3</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hm'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">D12'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> <span class="id" type="var">Dg</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">_f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">D12f</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D12f</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f''</span> <span class="id" type="var">k'''</span> <span class="id" type="var">u</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp13</span> <span class="id" type="var">_f</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R1</span> <span class="id" type="var">_f</span> <span class="id" type="var">k'''</span> <span class="id" type="var">u</span> <span class="id" type="var">H1</span>) <span class="id" type="var">D3</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp23</span> <span class="id" type="var">_f</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">_f</span> <span class="id" type="var">k'''</span> <span class="id" type="var">u</span> <span class="id" type="var">H2</span>) <span class="id" type="var">D3</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">D123</span> : <span class="id" type="keyword">match</span> <span class="id" type="var">Term</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> \/ <span class="id" type="var">defined</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">DD3</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">_</span> <span class="id" type="var">D3'</span>] | [<span class="id" type="var">_</span> <span class="id" type="var">D12</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">DD3</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span>) <span class="id" type="var">p</span> <span class="id" type="var">_Sub</span> <span class="id" type="var">Sub</span> <span class="id" type="var">D123</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">p</span> <span class="id" type="var">_Sub</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df''</span> <span class="id" type="var">D123</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">St</span> <span class="id" type="var">p</span> <span class="id" type="var">_Sub</span> <span class="id" type="var">Sub</span> <span class="id" type="var">D123</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHk''</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">q</span>, <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">q</span> = <span class="id" type="var">Some</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">m</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">m</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">m</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Ss</span> <span class="id" type="var">q</span> <span class="id" type="var">Sub'</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">g3</span> <span class="id" type="var">k3</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v_in_s</span> : <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R3_reg</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">var_in_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) (<span class="id" type="var">p</span> ++ <span class="id" type="var">q</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_subterm2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">in_impl_mem</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>) (<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">refl_equal</span> <span class="id" type="var">a</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">v_in_s</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">q'</span> <span class="id" type="var">Sub''</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">q'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q'</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">k</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">k</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">si</span> | ].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H''</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L1</span> <span class="id" type="var">H'''</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">q'</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">si</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sub3</span> := <span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">si</span> <span class="id" type="var">q'</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub''</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hk3</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> <span class="id" type="var">k3</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s'</span> <span class="id" type="var">s'_in_k3</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s'_in_k3</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k3'</span> [<span class="id" type="var">k3''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">k3</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">q</span> ++ (<span class="id" type="var">length</span> <span class="id" type="var">k3'</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g3</span> (<span class="id" type="var">k3'</span> ++ <span class="id" type="var">s'</span> :: <span class="id" type="var">k3''</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g3</span> (<span class="id" type="var">k3'</span> ++ <span class="id" type="var">s'</span> :: <span class="id" type="var">k3''</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">subterm_at_pos_dec</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>)  (<span class="id" type="var">Term</span> <span class="id" type="var">g3</span> <span class="id" type="var">k3</span>)) <span class="id" type="keyword">as</span> [[[ | <span class="id" type="var">i</span> <span class="id" type="var">q'</span>] <span class="id" type="var">_Sub'</span>] | <span class="id" type="var">not_Sub</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_simple_criterion_local</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_var'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_reg'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">def_dec132'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">K2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> := <span class="id" type="var">Dp</span> <span class="id" type="var">R3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">p</span> ++ <span class="id" type="var">q</span>) <span class="id" type="var">g3</span> <span class="id" type="var">k3</span> <span class="id" type="var">t_R3_s</span>).<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'''</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">_Sub'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_R3_s</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">q''</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H3</span>; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">_Sub'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">_Sub'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g3</span> <span class="id" type="var">k3</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>) &lt; <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_subterm_at_pos</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>) <span class="id" type="var">i</span> <span class="id" type="var">q''</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">_Sub'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">_Sub'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g3</span> <span class="id" type="var">k3</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_R3_s</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">H</span> <span class="id" type="var">s'_in_k3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hk3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">H</span> <span class="id" type="var">s'_in_k3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hk3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">_Sub'</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">k</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">H''</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">L</span> <span class="id" type="var">H3</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">q'</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">ti</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">ti</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">ti</span> <span class="id" type="var">q'</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">_Sub'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec132'</span> <span class="id" type="var">g3</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Cg3</span> | <span class="id" type="var">Dg3</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_var'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">H</span> <span class="id" type="var">s'_in_k3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hk3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">q</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">D123</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Dg</span> | <span class="id" type="var">Dg</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R3</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">g3</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k3</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">_f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">K2</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">instance</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g3</span> <span class="id" type="var">k3</span>) <span class="id" type="var">_</span> <span class="id" type="var">sigma</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">_f_eq_g</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Dp</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Term</span> <span class="id" type="var">_f</span> <span class="id" type="var">k</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) <span class="id" type="var">p</span> <span class="id" type="var">g3</span> <span class="id" type="var">k3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">i</span> <span class="id" type="var">p'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_Sub</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_simple_criterion_local</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_var'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_reg'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">def_dec132'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">s'_in_k3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hk3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">s'_in_k3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hk3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_simple_criterion_local</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_var'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_reg'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">def_dec132'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_step_incl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Case12</span> <span class="id" type="var">g3</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k3</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">r</span>] <span class="id" type="var">g4</span> <span class="id" type="var">k4</span> <span class="id" type="var">Sub''</span> <span class="id" type="var">Dg4</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp123'</span> <span class="id" type="var">g4</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub''</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k3</span> <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k3</span>) <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> | ].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> := <span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">k3</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">k3</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">si</span> | ].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H'''</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L1</span> <span class="id" type="var">H''''</span>]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">si_in_lr</span> : <span class="id" type="var">In</span> <span class="id" type="var">si</span> <span class="id" type="var">k3</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">k3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">r</span> <span class="id" type="var">ti</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Dummy</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g3</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">si</span> :: <span class="id" type="var">l2</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">s'_in_k3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hk3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_simple_criterion_local</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_var'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_reg'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">def_dec132'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">p</span> ++ <span class="id" type="var">i</span> :: <span class="id" type="var">q</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">i</span> <span class="id" type="var">q</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">j</span> <span class="id" type="var">q'</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">not_Sub</span> (<span class="id" type="var">j</span> :: <span class="id" type="var">q'</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Dg3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | [<span class="id" type="var">H2</span> | <span class="id" type="var">Hpi</span>]]].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span>  <span class="id" type="var">R3</span> <span class="id" type="var">g'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">g'</span> <span class="id" type="var">l'</span> <span class="id" type="var">u</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">P3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_R3_s</span> <span class="id" type="var">g'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">g'</span> <span class="id" type="var">_</span> <span class="id" type="var">p</span> <span class="id" type="var">Sub</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">symb_in_subterm</span> <span class="id" type="var">g'</span> <span class="id" type="var">_</span> (<span class="id" type="var">i</span> :: <span class="id" type="var">q</span>) <span class="id" type="var">Sub'</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">g'</span> <span class="id" type="var">g'</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">g'</span> <span class="id" type="var">g'</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">g_diff_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">g'</span>=g')]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_k3</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_k3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">s'_in_k3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hk3</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_acc_ddp</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R132_var'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHk''</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">nat</span>); <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">l'</span> <span class="id" type="var">s''</span> <span class="id" type="var">l_R_l'</span> <span class="id" type="var">Hm</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Simple_step</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">v</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>] <span class="id" type="var">H</span> <span class="id" type="var">D3'</span> <span class="id" type="var">Iu</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">k'</span> <span class="id" type="var">l''</span> <span class="id" type="var">s'''</span> <span class="id" type="var">l'_R_l''</span> <span class="id" type="var">Hm'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u'</span> <span class="id" type="var">u'_in_l'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">exists</span> <span class="id" type="var">u</span>, <span class="id" type="var">In</span> <span class="id" type="var">u</span> <span class="id" type="var">l</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">u'</span> <span class="id" type="var">u</span>)).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_R_l'</span> <span class="id" type="var">u'_in_l'</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">k1</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">k2</span>] <span class="id" type="var">H</span> <span class="id" type="var">u_in_k1</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">refl_trans_clos_one_step_list_length_eq</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ht1t2</span> <span class="id" type="var">Hk1k2</span>].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">u_in_k1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">u_in_k1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u_eq_t2</span> | <span class="id" type="var">u_in_k2</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHk1</span> <span class="id" type="var">k2</span> <span class="id" type="var">Hk1k2</span> <span class="id" type="var">u_in_k2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">u_in_k1</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">u_in_l</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u''</span> | <span class="id" type="var">u1'</span> <span class="id" type="var">u1</span> <span class="id" type="var">H1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_u</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_one_step</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">modular_termination</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_necessary</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R123_var'</span>.<br/>

<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R123_var'</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | [<span class="id" type="var">H3</span> | <span class="id" type="var">Hpi</span>]].<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_pi</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">P1</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">P2</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">P3</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_ll</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | <span class="id" type="var">H3</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_simple_criterion_local</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R123_var'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R123_reg'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">def_dec123'</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec12</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D12</span> | <span class="id" type="var">C12</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Case12</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>] <span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">Sub</span> <span class="id" type="var">D3</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Incomp123'</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">ls1</span> [<span class="id" type="var">ls2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hti</span> : <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">ti</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_interp_dom</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hti</span> <span class="id" type="var">p</span>); <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec3</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D3'</span> | <span class="id" type="var">C3</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">ddp_step_incl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Case3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Dummy</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">l'</span> <span class="id" type="var">s''</span> <span class="id" type="var">l_R_l'</span> <span class="id" type="var">_Hm</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_t</span> <span class="id" type="var">s</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Hm</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">_Hm</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Hm</span> <span class="id" type="var">_Sub</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_s</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>] <span class="id" type="var">p</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">t_R_s</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R123_var'</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t_R_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H12</span> | [<span class="id" type="var">H3</span> | <span class="id" type="var">HPi</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C12</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H12</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C3</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_pi</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">HPi</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Modular_termination</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">def_dec_rules</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">rule_list</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>} + {~ <span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">rule_list</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">R</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">rule_list</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">l</span> <span class="id" type="var">r</span>] <span class="id" type="var">rule_list</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Equiv</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">R'</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Equiv'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> : <span class="id" type="var">term</span>, <span class="id" type="var">R'</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>, <span class="id" type="var">r</span>) <span class="id" type="var">rule_list</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">r1</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">R'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHrule_list</span> <span class="id" type="var">R'</span> <span class="id" type="var">Equiv'</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> | <span class="id" type="var">Cf</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f'</span> <span class="id" type="var">k'</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cf</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R'</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f'</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f'</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_f'</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_f'</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">k'</span> <span class="id" type="var">r</span>); <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f''</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cf</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R'</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">modular_termination_lift</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">V0</span> <span class="id" type="var">V1</span> : <span class="id" type="var">variable</span>), <span class="id" type="var">V0</span> &lt;&gt; <span class="id" type="var">V1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span>, <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> -&gt; <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span> -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rule_list1</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rule_list2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rule_list3</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">R3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>) -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R3</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span> <span class="id" type="var">M12</span> <span class="id" type="var">M13</span> <br/>
<span class="id" type="var">rule_list1</span> <span class="id" type="var">Equiv1</span> <span class="id" type="var">R1_var</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">P1</span><br/>
<span class="id" type="var">rule_list2</span> <span class="id" type="var">Equiv2</span> <span class="id" type="var">R2_var</span> <span class="id" type="var">R2_reg</span> <span class="id" type="var">P2</span><br/>
<span class="id" type="var">rule_list3</span> <span class="id" type="var">Equiv3</span> <span class="id" type="var">R3_var</span> <span class="id" type="var">R3_reg</span> <span class="id" type="var">P3</span><br/>
<span class="id" type="var">Indep2</span> <span class="id" type="var">Indep3</span> <span class="id" type="var">W12</span> <span class="id" type="var">W3</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">modular_termination</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span> <br/>
(<span class="id" type="var">def_dec_rules</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv1</span>)<br/>
(<span class="id" type="var">def_dec_rules</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv2</span>)<br/>
(<span class="id" type="var">def_dec_rules</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv3</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span><br/>
(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">iff_sym</span> (<span class="id" type="var">compute_red_is_correct</span> <span class="id" type="var">_</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>))<br/>
(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">iff_sym</span> (<span class="id" type="var">compute_red_is_correct</span> <span class="id" type="var">_</span> <span class="id" type="var">R2_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>))<br/>
(<span class="id" type="keyword">fun</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">iff_sym</span> (<span class="id" type="var">compute_red_is_correct</span> <span class="id" type="var">_</span> <span class="id" type="var">R3_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R1_reg</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R2_reg</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R3_reg</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv3</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R3_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H3</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">P1</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">P2</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">P3</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_criterion</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R12_var'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R1_reg</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R2_reg</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> [<span class="id" type="var">x_eq_v1</span> | <span class="id" type="var">x_in_nil</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> [<span class="id" type="var">x_eq_v2</span> | <span class="id" type="var">x_in_nil</span>]; [<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec_rules</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv1</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D1</span> | <span class="id" type="var">C1</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H1</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span>); <span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">def_dec_rules</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Equiv2</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">D2</span> | <span class="id" type="var">C2</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">D2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span>); <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">pi</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_pi</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_pi</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="var">right</span>; <br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>)).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pi1</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Const</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R1</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_pi</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">wf_incl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">W12</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">Empty_R</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> := .<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">module_empty</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">module</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Mod</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_rules_empty</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">Empty_R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">nil</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Empty_R_reg</span> :<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">nil</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">lr_in_nil</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">lr_in_nil</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">modular_termination_indep_lift</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">V0</span> <span class="id" type="var">V1</span> : <span class="id" type="var">variable</span>), <span class="id" type="var">V0</span> &lt;&gt; <span class="id" type="var">V1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span>, <br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rule_list2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list2</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rule_list3</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">R3</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> <span class="id" type="var">R3</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">R2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>) -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span> <br/>
<span class="id" type="var">rule_list2</span> <span class="id" type="var">Equiv2</span> <span class="id" type="var">R2_var</span> <span class="id" type="var">R2_reg</span> <span class="id" type="var">P2</span><br/>
<span class="id" type="var">rule_list3</span> <span class="id" type="var">Equiv3</span> <span class="id" type="var">R3_var</span> <span class="id" type="var">R3_reg</span> <span class="id" type="var">P3</span><br/>
<span class="id" type="var">Indep2</span> <span class="id" type="var">Indep3</span> <span class="id" type="var">W12</span> <span class="id" type="var">W3</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span>  <span class="id" type="var">ddp_step_incl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H2</span> | <span class="id" type="var">H3</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">modular_termination_lift</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span> <br/>
(<span class="id" type="var">module_empty</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">module_empty</span> <span class="id" type="var">R3</span>)) <span class="id" type="keyword">with</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)) <span class="id" type="var">rule_list2</span> <span class="id" type="var">rule_list3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_rules_empty</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">inclusion</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">R2</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R2</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">HE</span> | <span class="id" type="var">H2</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">HE</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_step_incl</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">refl_trans_incl</span> (<span class="id" type="var">one_step_list_incl</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step_incl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>)) <span class="id" type="var">H0</span>).<br/>
<span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">HE</span> | <span class="id" type="var">H3</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">HE</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H3</span> <span class="id" type="var">Sub</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">Dp</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t3</span> <span class="id" type="var">p</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> <span class="id" type="var">_</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">modular_termination_hierarch_lift</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">V0</span> <span class="id" type="var">V1</span> : <span class="id" type="var">variable</span>), <span class="id" type="var">V0</span> &lt;&gt; <span class="id" type="var">V1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>, <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span> -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rule_list1</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list1</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rule_list3</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rule_list3</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R3</span>)) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> <span class="id" type="var">R3</span> <span class="id" type="var">M13</span> <br/>
<span class="id" type="var">rule_list1</span> <span class="id" type="var">Equiv1</span> <span class="id" type="var">R1_var</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">P1</span><br/>
<span class="id" type="var">rule_list3</span> <span class="id" type="var">Equiv3</span> <span class="id" type="var">R3_var</span> <span class="id" type="var">R3_reg</span> <span class="id" type="var">P3</span><br/>
<span class="id" type="var">W12</span> <span class="id" type="var">W3</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>) (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R3</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">apply</span>  <span class="id" type="var">ddp_step_incl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">H3</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">modular_termination_lift</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">R3</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">rule_list1</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)) <span class="id" type="var">rule_list3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Mod</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">HE</span>]; <span class="id" type="tactic">case</span> <span class="id" type="var">HE</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_rules_empty</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">HE</span>]; <span class="id" type="tactic">case</span> <span class="id" type="var">HE</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">HE</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_step_incl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> | <span class="id" type="var">HE</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">HE</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Record</span> <span class="id" type="var">rwr_rel</span> (<span class="id" type="var">pi</span> : <span class="id" type="var">F.Symb.A</span>) : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">mk_set</span> <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ident</span> : <span class="id" type="var">nat</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Rel</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rules</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">REquiv</span> : (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">Rel</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">RR_var</span> : (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">RR_reg</span> : (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>));<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">RP</span> : (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>))))<br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Equiv_empty</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> <span class="id" type="var">r</span> : <span class="id" type="var">term</span>), <span class="id" type="var">Empty_R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">nil</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R_var_empty</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> <span class="id" type="var">r</span> : <span class="id" type="var">term</span>), <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">nil</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R_reg_empty</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">nil</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_empty</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">nil</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">pi</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">rwr_rel_empty</span> <span class="id" type="var">pi</span> : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">mk_set</span> <span class="id" type="var">pi</span> 0 <span class="id" type="var">Empty_R</span> <span class="id" type="var">nil</span> <span class="id" type="var">Equiv_empty</span> <span class="id" type="var">R_var_empty</span> <span class="id" type="var">R_reg_empty</span> (<span class="id" type="var">P_empty</span> <span class="id" type="var">pi</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Equiv_comb</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules1</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> <span class="id" type="var">r</span> : <span class="id" type="var">term</span>), (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) (<span class="id" type="var">rules1</span> ++ <span class="id" type="var">rules2</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span> <span class="id" type="var">Equiv1</span> <span class="id" type="var">Equiv2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv1</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Equiv2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv1</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Equiv2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R_var_comb</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> <span class="id" type="var">r</span> : <span class="id" type="var">term</span>), <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) (<span class="id" type="var">rules1</span> ++ <span class="id" type="var">rules2</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span> <span class="id" type="var">R1_var</span> <span class="id" type="var">R2_var</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span> <span class="id" type="var">v</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; [<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_var</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H'</span> <span class="id" type="var">v</span>) | <span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_var</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H'</span> <span class="id" type="var">v</span>)].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">R_reg_comb</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) (<span class="id" type="var">rules1</span> ++ <span class="id" type="var">rules2</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span>, <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">v</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span> <span class="id" type="var">R1_reg</span> <span class="id" type="var">R2_reg</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span> <span class="id" type="var">v</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; [<span class="id" type="tactic">apply</span> (<span class="id" type="var">R1_reg</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H'</span> <span class="id" type="var">v</span>) | <span class="id" type="tactic">apply</span> (<span class="id" type="var">R2_reg</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H'</span> <span class="id" type="var">v</span>)].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_comb</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules1</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">rules2</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))) -&gt;<br/>
(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) (<span class="id" type="var">rules1</span> ++ <span class="id" type="var">rules2</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>)))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rules1</span> <span class="id" type="var">rules2</span> <span class="id" type="var">pi</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; [<span class="id" type="tactic">apply</span> (<span class="id" type="var">P1</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H'</span> <span class="id" type="var">f</span>) | <span class="id" type="tactic">apply</span> (<span class="id" type="var">P2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H'</span> <span class="id" type="var">f</span>)].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">rwr_rel_comb</span> <span class="id" type="var">pi</span> (<span class="id" type="var">R1</span> <span class="id" type="var">R2</span> : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>)  : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">mk_set</span> <span class="id" type="var">pi</span> (<span class="id" type="var">ident</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>)) (<span class="id" type="var">rules</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> ++ <span class="id" type="var">rules</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Equiv_comb</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R_var_comb</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R_reg_comb</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P_comb</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">modular_termination_indep_list_lift</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">V0</span> <span class="id" type="var">V1</span> : <span class="id" type="var">variable</span>), <span class="id" type="var">V0</span> &lt;&gt; <span class="id" type="var">V1</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> (<span class="id" type="var">list_rel</span> : <span class="id" type="var">list</span> (<span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>)) <span class="id" type="var">R'</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">L'</span> <span class="id" type="var">L''</span> <span class="id" type="var">L'''</span>, <span class="id" type="var">list_rel</span> = <span class="id" type="var">L'</span> ++ <span class="id" type="var">R1</span> :: <span class="id" type="var">L''</span> ++ <span class="id" type="var">R2</span> :: <span class="id" type="var">L'''</span> -&gt; <span class="id" type="var">ident</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> &lt;&gt; <span class="id" type="var">ident</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">In</span> <span class="id" type="var">R</span> <span class="id" type="var">list_rel</span> -&gt;   <span class="id" type="var">module</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">In</span> <span class="id" type="var">R</span> <span class="id" type="var">list_rel</span> -&gt;   <span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>))) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>)) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>, <span class="id" type="var">In</span> <span class="id" type="var">R1</span> <span class="id" type="var">list_rel</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">R2</span> <span class="id" type="var">list_rel</span> -&gt; <span class="id" type="var">ident</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span> &lt;&gt; <span class="id" type="var">ident</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) <span class="id" type="var">f</span> -&gt; (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>) <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">fold_left</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">acc</span> <span class="id" type="var">Rr</span> =&gt; <span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">Rr</span>) <span class="id" type="var">acc</span>)  <span class="id" type="var">list_rel</span>  (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> <span class="id" type="var">L</span> <span class="id" type="var">R'</span> <span class="id" type="var">U</span> <span class="id" type="var">W'</span> <span class="id" type="var">ML</span> <span class="id" type="var">WL</span> <span class="id" type="var">IL</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">fold_incl</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">L0</span> : <span class="id" type="var">list</span> (<span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>)) (<span class="id" type="var">P0</span> <span class="id" type="var">P1</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>),<br/>
<span class="id" type="var">inclusion</span> <span class="id" type="var">term</span> <span class="id" type="var">P0</span> <span class="id" type="var">P1</span> -&gt;<br/>
<span class="id" type="var">inclusion</span> <span class="id" type="var">term</span><br/>
&nbsp;&nbsp;(<span class="id" type="var">fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">acc</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) (<span class="id" type="var">Rr</span> : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">Rr</span>) <span class="id" type="var">acc</span>) <span class="id" type="var">L0</span> <span class="id" type="var">P0</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">acc</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) (<span class="id" type="var">Rr</span> : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">Rr</span>) <span class="id" type="var">acc</span>) <span class="id" type="var">L0</span> <span class="id" type="var">P1</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">L'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">R''</span> <span class="id" type="var">L''</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P1_in_P2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHL''</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H''</span> | <span class="id" type="var">H1</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P1_in_P2</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Gen</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">R0</span> : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>), <span class="id" type="var">module</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>))) (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>)) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">R2</span>, <span class="id" type="var">In</span> <span class="id" type="var">R2</span> <span class="id" type="var">L</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) <span class="id" type="var">f</span> -&gt; (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R2</span>) <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span>, <span class="id" type="var">In</span> <span class="id" type="var">R1</span> <span class="id" type="var">L</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span>, <span class="id" type="var">defined</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R1</span>) <span class="id" type="var">f</span> -&gt; (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">symb_in_term_list</span> <span class="id" type="var">f</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">false</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">ddp_step</span> (<span class="id" type="var">fold_left</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">acc</span> <span class="id" type="var">Rr</span> =&gt; <span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">Rr</span>) <span class="id" type="var">acc</span>)  <span class="id" type="var">L</span>  (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>)) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))))).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">L</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">R</span> <span class="id" type="var">L</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">R0</span> <span class="id" type="var">M0</span> <span class="id" type="var">W0</span> <span class="id" type="var">I1</span> <span class="id" type="var">I2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">modular_termination_hierarch_lift</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span>) <span class="id" type="keyword">with</span> (<span class="id" type="var">rules</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">rules</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>).<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span><br/>
(<span class="id" type="var">ddp_step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">acc</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) (<span class="id" type="var">Rr</span> : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">Rr</span>) <span class="id" type="var">acc</span>) <span class="id" type="var">L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> (<span class="id" type="var">rwr_rel_comb</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span> <span class="id" type="var">R0</span>))) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ddp_step_incl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">fold_incl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [[<span class="id" type="var">H'</span> | <span class="id" type="var">H0</span>] | <span class="id" type="var">Hpi</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHL</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">L'</span> <span class="id" type="var">L''</span> <span class="id" type="var">L'''</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">U</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> (<span class="id" type="var">R</span> :: <span class="id" type="var">L'</span>) <span class="id" type="var">L''</span> <span class="id" type="var">L'''</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R1_in_L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ML</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R1_in_L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">WL</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R1_in_L</span> <span class="id" type="var">R2_in_L</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IL</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Mod</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Df</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H0</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">ML</span> <span class="id" type="var">R</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="keyword">as</span> [<span class="id" type="var">M'</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">M'</span> <span class="id" type="var">f'</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) <span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">M0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">M0</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">M0</span> <span class="id" type="var">f'</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) <span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H0</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">M</span> := <span class="id" type="var">modular_termination_lift</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">V0_diff_V1</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) <br/>
(<span class="id" type="var">ML</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="var">M0</span><br/>
<span class="id" type="var">_</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>)<br/>
<span class="id" type="var">_</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>)<br/>
<span class="id" type="var">_</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>)<br/>
(<span class="id" type="var">I2</span> <span class="id" type="var">R</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))<br/>
(<span class="id" type="var">I1</span> <span class="id" type="var">R</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">ddp_step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rddp_step_incl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H0</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H'</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H0</span>]] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">modular_termination_hierarch_lift</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0_diff_V1</span>) <span class="id" type="keyword">with</span> (<span class="id" type="var">rules</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">rules</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">ML</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">REquiv</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_var</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RR_reg</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">RP</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>)) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rddp_step_incl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H</span> | <span class="id" type="var">H'</span>] | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">WL</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R2</span> <span class="id" type="var">R2_in_L</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">Df</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H0</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IL</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R</span> <span class="id" type="var">R2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R2_in_L</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">L''</span> [<span class="id" type="var">L'''</span> <span class="id" type="var">H'</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">U</span> <span class="id" type="var">R</span> <span class="id" type="var">R2</span> <span class="id" type="var">nil</span> <span class="id" type="var">L''</span> <span class="id" type="var">L'''</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) <span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">I1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Def</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R0</span>) <span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H0</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R1_in_L</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">Df</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H0</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IL</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R1</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R1_in_L</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">L''</span> [<span class="id" type="var">L'''</span> <span class="id" type="var">H'</span>]].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">U</span> <span class="id" type="var">R</span> <span class="id" type="var">R1</span> <span class="id" type="var">nil</span> <span class="id" type="var">L''</span> <span class="id" type="var">L'''</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">I2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">wf_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">ddp_step</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">acc</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) (<span class="id" type="var">Rr</span> : <span class="id" type="var">rwr_rel</span> <span class="id" type="var">pi</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">Rr</span>) <span class="id" type="var">acc</span>) <span class="id" type="var">L</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> <span class="id" type="var">R'</span>) (<span class="id" type="var">Rel</span> <span class="id" type="var">pi</span> (<span class="id" type="var">rwr_rel_empty</span> <span class="id" type="var">pi</span>))) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rddp_step_incl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">fold_incl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">fold_incl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">Hpi</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Gen</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Mod</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_t</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">l'</span> <span class="id" type="var">s''</span> <span class="id" type="var">l_R_l'</span> <span class="id" type="var">_Hm</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Hm</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">_Hm</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Hm</span> <span class="id" type="var">_Sub</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Hm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">p</span> <span class="id" type="var">g''</span> <span class="id" type="var">k''</span> <span class="id" type="var">t_R_s</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">case</span> <span class="id" type="var">t_R_s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R2</span> <span class="id" type="var">_</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">Df</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Df</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">_</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">MakeModDP</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>