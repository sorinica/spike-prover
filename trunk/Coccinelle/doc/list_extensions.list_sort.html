<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>list_extensions.list_sort</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library list_extensions.list_sort</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>

<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Multiset</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">list_permut</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">ordered_set</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Recdef</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span> :=<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> : <span class="id" type="var">a</span> = <span class="id" type="var">b</span>); [<span class="id" type="tactic">exact</span> <span class="id" type="var">a_eq_b</span> | <span class="id" type="tactic">clear</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">rename</span> <span class="id" type="var">Dummy</span> <span class="id" type="var">into</span> <span class="id" type="var">a_eq_b</span>].<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="keyword">Sort</span>.<br/>

<br/>
<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">DOS</span> : <span class="id" type="var">ordered_set.S</span>.<br/>

<br/>
<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">LPermut</span>  :  <br/>
&nbsp;&nbsp;<span class="id" type="var">list_permut.S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Definition</span> <span class="id" type="var">EDS.A</span> := <span class="id" type="var">DOS.A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="keyword">Definition</span> <span class="id" type="var">EDS.eq_A</span> := @<span class="id" type="var">eq</span> <span class="id" type="var">DOS.A</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab13"></a><h3 class="section">Decomposition of the list wrt a pivot.</h3>

</div>
<div class="code">
<span class="id" type="var">Function</span> <span class="id" type="var">partition</span> (<span class="id" type="var">pivot</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) * (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; (<span class="id" type="var">nil</span>, <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l'</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">partition</span> <span class="id" type="var">pivot</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span>,l2) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">o_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">pivot</span> <span class="id" type="keyword">then</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span>) <span class="id" type="keyword">else</span> (<span class="id" type="var">l1</span>, <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">quicksort</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">remove_list</span> (<span class="id" type="var">la</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">la</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">la'</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">b</span> :: <span class="id" type="var">l'</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">remove_list</span> <span class="id" type="var">la'</span> <span class="id" type="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_list</span> <span class="id" type="var">la</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">rmv</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">rmv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab14"></a><h3 class="section">Definition of a sorted list.</h3>

</div>
<div class="code">
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">is_sorted</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">is_sorted_nil</span> : <span class="id" type="var">is_sorted</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">is_sorted_cons1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">is_sorted</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">is_sorted_cons2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l</span>, <span class="id" type="var">o</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">is_sorted</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">is_sorted</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">is_sorted</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">in_remove_list</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span>, <span class="id" type="var">is_sorted</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">is_sorted</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_list</span> <span class="id" type="var">la</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">rmv</span>, ~ (<span class="id" type="var">permut</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">rmv</span>) <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">rmv</span> =&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">rmv</span>) <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">quicksort_equation</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span> (<span class="id" type="var">A</span>:=A)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">h</span> :: <span class="id" type="var">tl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l1</span>, <span class="id" type="var">l2</span>) := <span class="id" type="var">partition</span> <span class="id" type="var">h</span> <span class="id" type="var">tl</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">quicksort</span> <span class="id" type="var">l1</span> ++ <span class="id" type="var">h</span> :: <span class="id" type="var">quicksort</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">quick_permut</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">quick_permut_bis</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">length_quicksort</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">length</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>) = <span class="id" type="var">length</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">in_quick_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">sorted_tl_sorted</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="var">is_sorted</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">is_sorted</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">quick_sorted</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">is_sorted</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">sort_is_unique</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">is_sorted</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">is_sorted</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">l1</span> = <span class="id" type="var">l2</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="keyword">Sort</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab15"></a><h2 class="section">Definition of quicksort over lists.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">DOS1</span> : <span class="id" type="var">ordered_set.S</span>) &lt;: <span class="id" type="keyword">Sort</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">DOS</span> := <span class="id" type="var">DOS1</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">DOS</span> := <span class="id" type="var">DOS1</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">EDS</span> := <span class="id" type="var">decidable_set.Convert</span>(<span class="id" type="var">DOS1</span>).<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">LPermut</span>   &lt;:  <br/>
&nbsp;&nbsp;<span class="id" type="var">list_permut.S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Definition</span> <span class="id" type="var">EDS.A</span> := <span class="id" type="var">DOS.A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="keyword">Definition</span> <span class="id" type="var">EDS.eq_A</span> := @<span class="id" type="var">eq</span> <span class="id" type="var">DOS.A</span> :=<br/>
<span class="id" type="var">list_permut.Make</span> <span class="id" type="var">EDS</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">A</span>) ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">mem_morph</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_permut_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">List.cons</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">A</span>) ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">add_A_morph</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">length</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">permut</span> ==&gt; (@<span class="id" type="var">eq</span> <span class="id" type="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">length_morph</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_length</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab16"></a><h3 class="section">Decomposition of the list wrt a pivot.</h3>

</div>
<div class="code">
<span class="id" type="var">Function</span> <span class="id" type="var">partition</span> (<span class="id" type="var">pivot</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) * (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; (<span class="id" type="var">nil</span>, <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l'</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">partition</span> <span class="id" type="var">pivot</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span>,l2) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">o_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">pivot</span> <span class="id" type="keyword">then</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span>) <span class="id" type="keyword">else</span> (<span class="id" type="var">l1</span>, <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">quicksort</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) { <span class="id" type="keyword">measure</span> (@<span class="id" type="var">length</span> <span class="id" type="var">A</span>) <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">h</span> :: <span class="id" type="var">tl</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">partition</span> <span class="id" type="var">h</span> <span class="id" type="var">tl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span>, <span class="id" type="var">l2</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">quicksort</span> <span class="id" type="var">l1</span> ++ <span class="id" type="var">h</span> :: <span class="id" type="var">quicksort</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_l</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">e_l_eq_e_l</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">e_l</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>) <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l'</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">rec_res</span> <span class="id" type="var">e'_lt_e</span> <span class="id" type="var">_</span> | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l'</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">rec_res</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hpart</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hpart</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l'</span>)); [<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">rec_res</span>) | <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_n_S</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">rec_res</span>).<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_l</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">e_l_eq_e_l</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">e_l</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l'</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">rec_res</span> <span class="id" type="var">e'_lt_e</span> <span class="id" type="var">_</span> | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l'</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">rec_res</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hpart</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hpart</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_n_S</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">rec_res</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l'</span>)); [<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">rec_res</span>) | <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>].<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab17"></a><h3 class="section">The result of quicksort is a permutation of the original list.</h3>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">partition_list_permut1</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="keyword">let</span> (<span class="id" type="var">l1</span>,l2) := <span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="keyword">in</span> <span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>; <span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l'</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">rec_res</span> <span class="id" type="var">e'_lt_e</span> <span class="id" type="var">_</span> | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l'</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">rec_res</span> <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">rec_res</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">rec_res</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">quick_permut</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span>; <span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">S1</span> <span class="id" type="var">S2</span>]; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P</span> := <span class="id" type="var">partition_list_permut1</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">S1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">S2</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">quick_permut_bis</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab18"></a><h3 class="section">Definition of a sorted list.</h3>

</div>
<div class="code">
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">is_sorted</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">is_sorted_nil</span> : <span class="id" type="var">is_sorted</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">is_sorted_cons1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">is_sorted</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">is_sorted_cons2</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l</span>, <span class="id" type="var">o</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">is_sorted</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">is_sorted</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Hint</span> <span class="id" type="var">Constructors</span> <span class="id" type="var">is_sorted</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab19"></a><h3 class="section">The result of quicksort is a sorted list.</h3>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">sorted_tl_sorted</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="var">is_sorted</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">is_sorted</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">quick_sorted_aux1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">is_sorted</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">is_sorted</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">o</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">o</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">is_sorted</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e1</span> <span class="id" type="var">l1</span> ]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">S1</span> <span class="id" type="var">S2</span> <span class="id" type="var">L1</span> <span class="id" type="var">L2</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">intros</span>; <br/>
[<span class="id" type="tactic">apply</span> <span class="id" type="var">is_sorted_cons1</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">is_sorted_cons2</span> ]; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">L2</span> <span class="id" type="var">e2</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e1'</span> <span class="id" type="var">l1</span>] ; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">is_sorted_cons2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">L1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">S1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">S1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">L1</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">quick_sorted_aux3</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span>, <span class="id" type="keyword">let</span> (<span class="id" type="var">l1</span>,_) := <span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="keyword">in</span> <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">o</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">a'_lt_e</span> <span class="id" type="var">_</span> | <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">_H</span> <span class="id" type="var">_</span> ].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> [<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a_in_l1'</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">o_bool_ok</span> <span class="id" type="var">a'</span> <span class="id" type="var">e</span>); <span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a'_lt_e</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">quick_sorted_aux4</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span>, <span class="id" type="keyword">let</span> (<span class="id" type="var">_</span>,l2) := <span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="keyword">in</span> <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">o</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">partition</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">a'_lt_e</span> <span class="id" type="var">_</span> | <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">IH</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">a'_ge_e</span> <span class="id" type="var">_</span> ].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> [<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a_in_l1'</span>]; [<span class="id" type="tactic">subst</span> | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">o_bool_ok</span> <span class="id" type="var">a'</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a'_ge_e</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">a'_ge_e'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">o_total</span> <span class="id" type="var">e</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">intros</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">o</span> <span class="id" type="var">a'</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">quick_sorted</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">is_sorted</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">S1</span> <span class="id" type="var">S2</span>].<br/>
<span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_sorted_aux1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_ql1</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> := <span class="id" type="var">quick_sorted_aux3</span> <span class="id" type="var">l'</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">quick_permut</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_ql2</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> := <span class="id" type="var">quick_sorted_aux4</span> <span class="id" type="var">l'</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">quick_permut</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab20"></a><h3 class="section">There is a unique sorted list equivalent up to a permutation to a given list.</h3>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">sorted_cons_min</span> : <br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span>, <span class="id" type="var">is_sorted</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">e'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">e'</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">o</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span> <span class="id" type="var">S</span> <span class="id" type="var">e'</span> [<span class="id" type="var">e'_eq_e</span> | <span class="id" type="var">e'_in_l</span>].<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">e'</span> <span class="id" type="var">e</span> <span class="id" type="var">e'_eq_e</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">o_proof</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">O</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">O</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">R</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">e</span> <span class="id" type="var">S</span> <span class="id" type="var">e'</span> <span class="id" type="var">e'_in_l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e</span> <span class="id" type="var">S</span> <span class="id" type="var">e'</span> <span class="id" type="var">e'_in_l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span> ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">_</span> <span class="id" type="var">e'</span> <span class="id" type="var">e'_in_nil</span>; <span class="id" type="tactic">elim</span> <span class="id" type="var">e'_in_nil</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">S</span> <span class="id" type="var">e'</span> [<span class="id" type="var">e'_eq_a</span> | <span class="id" type="var">e'_in_l</span>].<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">e'</span> <span class="id" type="var">a</span> <span class="id" type="var">e'_eq_a</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">e'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">o_proof</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">O</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">O</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">_</span> <span class="id" type="var">T</span> <span class="id" type="var">_</span> ]; <span class="id" type="tactic">apply</span> <span class="id" type="var">T</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">sort_is_unique</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">is_sorted</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">is_sorted</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">l1</span> = <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e1</span> <span class="id" type="var">l1</span> ]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">S1</span> <span class="id" type="var">S2</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">a_eq_b</span> <span class="id" type="var">P'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="var">dummy</span> <span class="id" type="var">e1</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">k1</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">k2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">S1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">S2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e1_eq_a1</span> : <span class="id" type="var">b</span> = <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">O</span>:= <span class="id" type="var">o_proof</span>); <span class="id" type="tactic">inversion</span> <span class="id" type="var">O</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">AS</span> ]; <span class="id" type="tactic">apply</span> <span class="id" type="var">AS</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">O</span> <span class="id" type="var">AS</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">sorted_cons_min</span> <span class="id" type="var">S1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">sorted_cons_min</span> <span class="id" type="var">S2</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> (<span class="id" type="var">k1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">k2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sorted_tl_sorted</span> <span class="id" type="keyword">with</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sorted_tl_sorted</span> <span class="id" type="keyword">with</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Some usefull properties on the result of quicksort. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">length_quicksort</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">length</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>) = <span class="id" type="var">length</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_length</span> <span class="id" type="keyword">with</span> <span class="id" type="var">EDS.eq_A</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_quick_in</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">quicksort</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_permut_in</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_quicksort_cons</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">quicksort</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">in_quick_in</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
What happens when a sorted list is removed from another one.
</div>
<div class="code">
<span class="id" type="var">Function</span> <span class="id" type="var">remove_list</span> (<span class="id" type="var">la</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">la</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">la'</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">b</span> :: <span class="id" type="var">l'</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">remove_list</span> <span class="id" type="var">la'</span> <span class="id" type="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_list</span> <span class="id" type="var">la</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">rmv</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">rmv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_remove_list</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span>, <span class="id" type="var">is_sorted</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">is_sorted</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_list</span> <span class="id" type="var">la</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">rmv</span>, ~ (<span class="id" type="var">permut</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">rmv</span>) <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">rmv</span> =&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">rmv</span>) <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">la</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">la</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">la</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span> <span class="id" type="var">Sla</span> <span class="id" type="var">_</span> <span class="id" type="var">rmv</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">permut_length</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">la</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">la</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span> <span class="id" type="var">Sala</span> <span class="id" type="var">Sel</span> ; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl</span> := <span class="id" type="var">sorted_tl_sorted</span> <span class="id" type="var">Sel</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sla</span> := <span class="id" type="var">sorted_tl_sorted</span> <span class="id" type="var">Sala</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_e</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove_list</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span> <span class="id" type="var">Sla</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove_list</span> <span class="id" type="var">la</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rmv</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">rmv</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">rmv</span>); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_diff_e</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove_list</span> <span class="id" type="var">l</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">la</span>) <span class="id" type="var">Sala</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove_list</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">la</span>) <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">rmv</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">rmv</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e_in_larm</span> : <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">e</span> ((<span class="id" type="var">a</span> :: <span class="id" type="var">la</span>) ++ <span class="id" type="var">rmv</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">e</span> <span class="id" type="var">P</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e_in_larm</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">e_in_larm</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e_in_larm</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_a</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_diff_e</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">e'_in_larm</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">e'_in_larm</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e'_in_larm</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_la</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_diff_e</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">O</span> := <span class="id" type="var">o_proof</span>); <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">O</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">AS</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">AS</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sorted_cons_min</span> <span class="id" type="keyword">with</span> <span class="id" type="var">la</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">Sala</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sorted_cons_min</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">Sel</span> | <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_rmv</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_rmv</span>);<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_eq_e'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">M</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">rmv</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P'</span> := <span class="id" type="var">permut_add_inside</span> ((<span class="id" type="var">a</span> :: <span class="id" type="var">la</span>) ++ <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span> <span class="id" type="var">nil</span> <span class="id" type="var">l</span> (<span class="id" type="var">sym_eq</span> <span class="id" type="var">e_eq_e'</span>)); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>