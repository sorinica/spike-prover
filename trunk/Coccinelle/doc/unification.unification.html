<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>unification.unification</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library unification.unification</h1>

<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab117"></a><h1 class="section">Unit Equational theory on a term algebra</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_algebra".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_orderings".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "ac_matching".<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Max</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">weaved_relation</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">list_sort</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equational_theory</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">ac</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">rpo</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab118"></a><h2 class="section">Module Type EqTh, an equational theory over a term algebra.</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">ACU</span>.<br/>

<br/>
<span class="id" type="keyword">Declare Module</span> <span class="id" type="var">F</span> : <span class="id" type="var">Signature</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">F</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">unit_theory_type</span> : <span class="id" type="keyword">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">LU</span> : <span class="id" type="var">Symb.A</span> -&gt; <span class="id" type="var">unit_theory_type</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">RU</span> : <span class="id" type="var">Symb.A</span> -&gt; <span class="id" type="var">unit_theory_type</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">U</span> : <span class="id" type="var">Symb.A</span> -&gt; <span class="id" type="var">unit_theory_type</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Nothing</span> : <span class="id" type="var">unit_theory_type</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">is_coherent</span> (<span class="id" type="var">unit_theory</span> : <span class="id" type="var">Symb.A</span> -&gt; <span class="id" type="var">unit_theory_type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">LU</span> <span class="id" type="var">u</span> =&gt; <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">Free</span> 2 /\ <span class="id" type="var">arity</span> <span class="id" type="var">u</span> = <span class="id" type="var">Free</span> 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">RU</span> <span class="id" type="var">u</span> =&gt; <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">Free</span> 2 /\ <span class="id" type="var">arity</span> <span class="id" type="var">u</span> = <span class="id" type="var">Free</span> 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">U</span> <span class="id" type="var">u</span> =&gt; (<span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">Free</span> 2 \/ <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">C</span> \/ <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span>) /\ (<span class="id" type="var">arity</span> <span class="id" type="var">u</span> = <span class="id" type="var">Free</span> 0)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Nothing</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">unit_theory</span> : <span class="id" type="var">Symb.A</span> -&gt; <span class="id" type="var">unit_theory_type</span>.<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">unit_theory_is_coherent</span> : <span class="id" type="var">is_coherent</span> <span class="id" type="var">unit_theory</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">ACU</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">Cf_eq_ac1</span> : <span class="id" type="var">cf_eq_ac.S</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Acu1</span> : <span class="id" type="var">ACU</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">F</span>:=Cf_eq_ac1.<span class="id" type="var">Ac.EqTh.T.F</span>).<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Cf_eq_ac</span> := <span class="id" type="var">Cf_eq_ac1</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Cf_eq_ac1</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Ac</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">EqTh</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Acu1</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">X</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="keyword">Sort</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">LPermut</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">unit_one_step_at_top</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">left_unit</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">u</span> \/ <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">unit_one_step_at_top</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">right_unit</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">RU</span> <span class="id" type="var">u</span> \/ <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">unit_one_step_at_top</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">unit_th</span> := <span class="id" type="var">th_eq</span> <span class="id" type="var">unit_one_step_at_top</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">acu</span> := <span class="id" type="var">th_eq</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">ac_one_step_at_top</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">no_need_of_instance</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">axiom</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">sym_refl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]]; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">unit_nf</span> (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>) =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) :: <span class="id" type="var">nil</span>) <br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">LU</span> <span class="id" type="var">u</span> =&gt; <span class="id" type="keyword">let</span> <span class="id" type="var">ut1</span> := <span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">ut1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">ut1</span> :: (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">RU</span> <span class="id" type="var">u</span> =&gt; <span class="id" type="keyword">let</span> <span class="id" type="var">ut2</span> := <span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">ut2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) :: <span class="id" type="var">ut2</span> :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">U</span> <span class="id" type="var">u</span> =&gt; <span class="id" type="keyword">let</span> <span class="id" type="var">ut1</span> := <span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">ut2</span> := <span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">ut1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">ut2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="keyword">if</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">ut2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">ut1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">ut1</span> :: <span class="id" type="var">ut2</span> :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Nothing</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) :: (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l</span>)<br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">ac_const</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">c</span> <span class="id" type="var">t</span>, <span class="id" type="var">ac</span> (<span class="id" type="var">Term</span> <span class="id" type="var">c</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">t</span> = <span class="id" type="var">Term</span> <span class="id" type="var">c</span> <span class="id" type="var">nil</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> [ <span class="id" type="var">v</span> | <span class="id" type="var">f</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]] <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">S</span> := <span class="id" type="var">ac_size_eq</span> <span class="id" type="var">H</span>); <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">S</span>;<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0).<br/>
<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">pattern</span> 0 <span class="id" type="tactic">at</span> 2; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">unit_nf_nothing</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">UT</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">t3</span> <span class="id" type="var">l</span>]]].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">l1</span>]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">l1</span>]];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> [ | <span class="id" type="var">s2</span> <span class="id" type="var">l2</span>]]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">l1</span>]];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> [ | <span class="id" type="var">s2</span> <span class="id" type="var">l2</span>]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">well_formed_unit_nf</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">well_formed</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">Wt</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">Wt</span>; <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl</span> <span class="id" type="var">Ar</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Wl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wl'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u</span>, <span class="id" type="var">In</span> <span class="id" type="var">u</span> (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">well_formed_bool</span> <span class="id" type="var">u</span> = <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq</span> | <span class="id" type="var">In_u</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>]; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl0</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; [ <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>]; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">length_map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">t3</span> <span class="id" type="var">l</span> ]]]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Wl'</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">arity</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ | | [ | <span class="id" type="var">n</span>]]; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">discriminate</span> || <span class="id" type="tactic">trivial</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">arity</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ | | [ | <span class="id" type="var">n</span>]]; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">discriminate</span> || <span class="id" type="tactic">trivial</span>).<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wl'</span>; [<span class="id" type="tactic">reflexivity</span> | <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | ].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span>  (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl'</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl'</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span>  (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl'</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">arity</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ | | <span class="id" type="var">n</span>]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">beq_nat_refl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Bool.andb_true_r</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">t1</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">t3</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wl''</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> : <span class="id" type="var">term</span>, <span class="id" type="var">In</span> <span class="id" type="var">u</span> (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl'</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">IHl</span> <span class="id" type="var">Wl</span> <span class="id" type="var">Wl'</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l</span> <span class="id" type="var">Wl''</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span>  <span class="id" type="var">unit_nf_is_sound</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">unit_th</span> <span class="id" type="var">t</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">unit_th</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">a</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ha</span> := <span class="id" type="var">IH</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ha</span> := <span class="id" type="var">IH</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Hl</span> : <span class="id" type="var">rwr_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>)) (<span class="id" type="var">b</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">l</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> [<span class="id" type="var">t_eq_b</span> | <span class="id" type="var">t_in_l</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">right</span>; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>.<br/>

<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">t3</span> <span class="id" type="var">l</span> ]]]; <br/>
[<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span> | <span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">UT</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">UT</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">UT</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">UT</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_eq_u</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">t2_eq_u</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_eq_u</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">t2_eq_u</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_unit_th_unit_nf_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">one_step</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span> = <span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t1</span> <span class="id" type="var">t2'</span> <span class="id" type="var">H'</span> | ]; <span class="id" type="tactic">subst</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>] <span class="id" type="var">u2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H''</span> <span class="id" type="var">v1_sigma</span> <span class="id" type="var">u2_sigma</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">H''</span> | [<span class="id" type="var">H''</span> | <span class="id" type="var">H''</span>]].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">u22</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">Ufu</span> | <span class="id" type="var">u21</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">Ufu</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v1_sigma</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">Ufu</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ufu</span> | <span class="id" type="var">Ufu</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ufu</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v1_sigma</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">Ufu</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ufu</span> | <span class="id" type="var">Ufu</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ufu</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2'</span> <span class="id" type="var">H'</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2'</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">no_need_of_instance</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> <span class="id" type="var">f'</span> <span class="id" type="var">u</span> [<span class="id" type="var">Ufu</span> | <span class="id" type="var">Ufu</span>] | <span class="id" type="var">t2'</span> <span class="id" type="var">f'</span> <span class="id" type="var">u</span> [<span class="id" type="var">Ufu</span> | <span class="id" type="var">Ufu</span>]]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ufu</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> <span class="id" type="var">f'</span> <span class="id" type="var">u</span> [<span class="id" type="var">Ufu</span> | <span class="id" type="var">Ufu</span>] | <span class="id" type="var">t2'</span> <span class="id" type="var">f'</span> <span class="id" type="var">u</span> [<span class="id" type="var">Ufu</span> | <span class="id" type="var">Ufu</span>]]; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ufu</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <br/>
[<span class="id" type="tactic">intros</span>  <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">u_diff_u</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t_diff_u</span>].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l</span> = <span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span> ]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t'</span> <span class="id" type="var">t2</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span> | <span class="id" type="var">t'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">t</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">t</span>)) <span class="id" type="var">t2</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span> :: <span class="id" type="var">l</span>)); <span class="id" type="tactic">refine</span> (<span class="id" type="var">IHl0</span> <span class="id" type="var">_</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'</span>);<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHl</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">t3</span> <span class="id" type="var">l</span>]]];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> [ | <span class="id" type="var">s2</span> [ | <span class="id" type="var">s3</span> <span class="id" type="var">l2</span>]]]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">unit_th_is_unit_nf_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">unit_th</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> &lt;-&gt; <span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span> = <span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">split</span>.<br/>

<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>; [ <span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_eq</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">y</span>); <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_unit_th_unit_nf_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">unit_th</span>, <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>); <br/>
[<span class="id" type="var">idtac</span> | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span> ]; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">unit_nf_is_idempotent</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">unit_nf</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span>) = <span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">unit_th_is_unit_nf_eq</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t</span>) <span class="id" type="var">t</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">unit_th</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">unit_for_AC</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">LU</span> <span class="id" type="var">_</span> | <span class="id" type="var">RU</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">U</span> <span class="id" type="var">_</span> | <span class="id" type="var">Nothing</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">unit_theory_is_coherent</span> <span class="id" type="var">f</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">H</span> <span class="id" type="var">_</span> ]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">unit_for_C</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, (<span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">C</span> \/ <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">LU</span> <span class="id" type="var">_</span> | <span class="id" type="var">RU</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">U</span> <span class="id" type="var">_</span> | <span class="id" type="var">Nothing</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> [ <span class="id" type="var">Ar</span> | <span class="id" type="var">Ar</span> ]; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">unit_theory_is_coherent</span> <span class="id" type="var">f</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">H</span> <span class="id" type="var">_</span> ]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acu_is_ac_on_unit_nf</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">ac</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) &lt;-&gt; <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>, <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">ac_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">No_need_of_inst</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">axiom</span> (<span class="id" type="var">sym_refl</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">ac_one_step_at_top</span> <span class="id" type="var">unit_one_step_at_top</span>)) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">sym_refl</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">ac_one_step_at_top</span> <span class="id" type="var">unit_one_step_at_top</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H</span> | <span class="id" type="var">H</span>] | [[<span class="id" type="var">H</span> | <span class="id" type="var">H</span>] | <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_axiom</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">c_axiom</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_axiom</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">c_axiom</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u3</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="var">th_eq</span> <span class="id" type="var">ac_one_step_at_top</span><br/>
&nbsp;&nbsp;(<span class="id" type="var">unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">u1</span> :: <span class="id" type="var">u2</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">u3</span> :: <span class="id" type="var">nil</span>)))<br/>
&nbsp;&nbsp;(<span class="id" type="var">unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">u1</span> :: <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">u2</span> :: <span class="id" type="var">u3</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u3</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">UT</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span>, <span class="id" type="var">g</span> = <span class="id" type="var">f</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">unit_for_AC</span> <span class="id" type="var">_</span> <span class="id" type="var">Ar</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | ];<br/>
<span class="id" type="tactic">try</span> <span class="id" type="var">contradiction</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">UT</span> <span class="id" type="var">f</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">UT</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u1_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u2_diff_u</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span>  (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u1_eq_u</span> |  <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u3</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u3</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u3_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u3_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span> :: <span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span> :: <span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [ <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u3</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u3</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u3_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u3_diff_u</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u2_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span> :: <span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span> :: <span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span> :: <span class="id" type="var">unit_nf</span> <span class="id" type="var">u3</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span> :: <span class="id" type="var">unit_nf</span> <span class="id" type="var">u3</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span>  <span class="id" type="var">H'</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">C</span> \/ <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="var">th_eq</span> <span class="id" type="var">ac_one_step_at_top</span><br/>
&nbsp;&nbsp;(<span class="id" type="var">unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">u1</span> :: <span class="id" type="var">u2</span> :: <span class="id" type="var">nil</span>)))<br/>
&nbsp;&nbsp;(<span class="id" type="var">unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">u2</span> :: <span class="id" type="var">u1</span> :: <span class="id" type="var">nil</span>)))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">Ar</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">UT</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span>, <span class="id" type="var">g</span> = <span class="id" type="var">f</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">unit_for_C</span> <span class="id" type="var">_</span> <span class="id" type="var">Ar</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | ];<br/>
<span class="id" type="tactic">try</span> <span class="id" type="var">contradiction</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">UT</span> <span class="id" type="var">f</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">UT</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u1_diff_u</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u2_diff_u</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">u1_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">u2_eq_u</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">u2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">u2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">u2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">rwr_inv</span> <span class="id" type="var">_</span> (<span class="id" type="var">sym_refl</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">ac_one_step_at_top</span> <span class="id" type="var">unit_one_step_at_top</span>))<br/>
(<span class="id" type="var">rwr</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">ac_one_step_at_top</span>)) <span class="id" type="var">unit_nf</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">S_t1</span>; <br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); [<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>)]; <br/>
[<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">S_t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H'</span> | <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">H</span> | <span class="id" type="var">H</span>] | [[<span class="id" type="var">H</span> | <span class="id" type="var">H</span>] | <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u3</span> <span class="id" type="var">Af</span> | <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">Af</span>].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">unit_th_is_unit_nf_eq</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t2</span>)); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">unit_th</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span> <br/>
| <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> ].<br/>

<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u3</span> <span class="id" type="var">Af</span> | <span class="id" type="var">f</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">Af</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">unit_th_is_unit_nf_eq</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>)); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">unit_th</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span> <br/>
| <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> ].<br/>

<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>

<br/>
<span class="id" type="tactic">subst</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">S_l1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">t</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">In_t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_n_Sm_le</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)); [<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">rwr_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">ac_one_step_at_top</span>)) (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">map</span> <span class="id" type="var">unit_nf</span> <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">S_t1</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t1'</span> <span class="id" type="var">t2</span> <span class="id" type="var">l1'</span>  <span class="id" type="var">H'</span> | <span class="id" type="var">t1'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S_l1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S_l1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">S_t1</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">UT</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span>, <span class="id" type="var">g</span> = <span class="id" type="var">f</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">rwr_list_length_eq</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_map</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>]]]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s2</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">u2</span> <span class="id" type="var">l2</span>]]]; <br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span> <span class="id" type="var">H''</span> | <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span> <span class="id" type="var">H''</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span> <span class="id" type="var">H''</span> | <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span> <span class="id" type="var">H''</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s1_acu_s2</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">s1</span> (<span class="id" type="var">S_l1</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="var">s2</span> <span class="id" type="var">H''</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | ];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">UT</span> <span class="id" type="var">f</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_u</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">s1_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s1_acu_s2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> <span class="id" type="var">s1_acu_s2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">s2_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">s2_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s1_acu_s2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s1_acu_s2</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">s1_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S_l1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_u</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">s1_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s1_acu_s2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> <span class="id" type="var">s1_acu_s2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">s2_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">s2_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s1_acu_s2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s1_acu_s2</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">s1_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span> <span class="id" type="var">H'''</span> | <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span> <span class="id" type="var">H'''</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1_acu_t2</span> := <span class="id" type="var">IHn</span> <span class="id" type="var">t1</span> (<span class="id" type="var">S_l1</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))) <span class="id" type="var">t2</span> <span class="id" type="var">H'''</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | <span class="id" type="var">u</span> | ];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">UT</span> <span class="id" type="var">f</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> ); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_acu_t2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_acu_t2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t2_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">t2_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_acu_t2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_acu_t2</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>));[<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_acu_t2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_acu_t2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t2_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">t2_eq_u</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_acu_t2</span>;  <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ac_const</span> <span class="id" type="var">u</span> <span class="id" type="var">_</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_acu_t2</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_diff_u</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'''</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">Free</span> <span class="id" type="var">n</span> -&gt; (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t</span>) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">l1</span> = <span class="id" type="var">l2</span> \/ <span class="id" type="var">rwr_list</span> <span class="id" type="var">acu</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Wl1</span> <span class="id" type="var">Wl2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_cf_eq</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_nothing</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_map</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">Wl2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">l2</span> <span class="id" type="var">Wl2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">Wl2</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ws1</span> := <span class="id" type="var">Wl1</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ws2</span> := <span class="id" type="var">Wl2</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="var">right</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H''</span> <span class="id" type="var">_</span>];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H''</span>  (<span class="id" type="var">cf_eq_ac</span> (<span class="id" type="var">well_formed_unit_nf</span> <span class="id" type="var">_</span> <span class="id" type="var">Ws1</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">well_formed_unit_nf</span> <span class="id" type="var">_</span> <span class="id" type="var">Ws2</span>) <span class="id" type="var">H'</span>));<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">Wl1</span>) <span class="id" type="var">l2</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">Wl2</span>) <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1_eq_l2</span> | <span class="id" type="var">l1_acu_l2</span>];<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free_sound</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">rwr_list</span> <span class="id" type="var">acu</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span>  <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_clos</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">acu</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">Free</span> 2 -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">Ws1</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Ws2</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_size_eq</span> <span class="id" type="var">H'</span>) (<span class="id" type="var">ac_cf_eq</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">S</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s1_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>;<br/>
[ <span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]<br/>
| <span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
(<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span><br/>
| <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span><br/>
| <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>]).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>,     <br/>
&nbsp;&nbsp;((<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">s1_eq_u</span> <span class="id" type="var">H</span>] | [<span class="id" type="var">u_eq_s2</span> <span class="id" type="var">H</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_ru</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">Free</span> 2 -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">RU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">Ws1</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Ws2</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_size_eq</span> <span class="id" type="var">H'</span>) (<span class="id" type="var">ac_cf_eq</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">S</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t1_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>;<br/>
[ <span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]<br/>
| <span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
(<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span><br/>
| <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span><br/>
| <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>]).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_ru_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">RU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;((<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [[<span class="id" type="var">t1_eq_u</span> <span class="id" type="var">H</span>] | [<span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]];<br/>
&nbsp;[<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>]; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_u</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">Free</span> 2 -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">Ws1</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Ws2</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_size_eq</span> <span class="id" type="var">H'</span>) (<span class="id" type="var">ac_cf_eq</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">S</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s1_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span>  (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t1_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>;<br/>
[ <span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]<br/>
| <span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
(<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span><br/>
| <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span><br/>
| <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>]).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_u_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;((<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>)) -&gt;  <br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <br/>
[ [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | [ [<span class="id" type="var">t1_eq_u</span> <span class="id" type="var">H</span>] | [[ <span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>] | [ [<span class="id" type="var">s1_eq_u</span> <span class="id" type="var">H</span> ] | [ <span class="id" type="var">u_eq_s2</span> <span class="id" type="var">H</span> ]]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_c</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">C</span> -&gt; (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/ (<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">Ws1</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Ws2</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_cf_eq</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_nothing</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">Sort.quick_permut</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) :: <span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">Sort.quick_permut</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) :: <span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">permut_trans</span>  <span class="id" type="var">H'</span> (<span class="id" type="var">permut_sym</span>  <span class="id" type="var">H''</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_permut.permut_length_2</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> <br/>
[[<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">t1_eq_t2</span>] | [<span class="id" type="var">s1_eq_t2</span> <span class="id" type="var">s2_eq_t1</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_c_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">C</span> -&gt; (<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/ (<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> [[<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">t1_eq_t2</span>] | [<span class="id" type="var">s1_eq_t2</span> <span class="id" type="var">t1_eq_s2</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">s1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">ac_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">s1_eq_t2</span> <span class="id" type="var">t1_eq_s2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_cu</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">C</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/ (<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">Ws1</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Ws2</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_size_eq</span> <span class="id" type="var">H'</span>) (<span class="id" type="var">ac_cf_eq</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">S</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s1_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t1_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_u</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">unit_nf_is_idempotent</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ws1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Wt1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UT</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_u</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">Sort.quick_permut</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) :: <span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">Sort.quick_permut</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) :: <span class="id" type="var">canonical_form</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">permut_trans</span>  <span class="id" type="var">H'</span> (<span class="id" type="var">permut_sym</span>  <span class="id" type="var">H''</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_permut.permut_length_2</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> <br/>
[[<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">t1_eq_t2</span>] | [<span class="id" type="var">s1_eq_t2</span> <span class="id" type="var">s2_eq_t1</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_unit_nf</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_cu_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">C</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) \/ (<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> <span class="id" type="var">s1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) /\ <span class="id" type="var">acu</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>))) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span>:: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>) -&gt;  <br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">u</span> <span class="id" type="var">Af</span> <span class="id" type="var">UT</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <br/>
[ [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] | <br/>
[ [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] |<br/>
[ [<span class="id" type="var">t1_eq_u</span> <span class="id" type="var">H</span>] | <br/>
[ [ <span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>] | <br/>
[ [<span class="id" type="var">s1_eq_u</span> <span class="id" type="var">H</span> ] | <br/>
[ <span class="id" type="var">u_eq_s2</span> <span class="id" type="var">H</span> ] ]]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">s1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">ac_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">s1_eq_u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">u_eq_s2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">clash</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">f</span>&lt;&gt; <span class="id" type="var">g</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">Nothing</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_g</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>); <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>]]]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s2</span> [ | <span class="id" type="var">t2</span> [ | <span class="id" type="var">u2</span> <span class="id" type="var">l2</span>]]];<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free_lu</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">LU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_u</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>); <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>]]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free_lu_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">LU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTg</span> [ <span class="id" type="var">H</span> <span class="id" type="var">u_eq_s2</span> ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free_ru</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">RU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">s2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_u</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_eq_u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>); <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>]]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free_ru_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">RU</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTg</span> [ <span class="id" type="var">H</span> <span class="id" type="var">u_eq_t2</span> ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free_u</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">Nothing</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_u</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_u</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_u</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">s2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_u</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_eq_u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>); <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s1</span> [ | <span class="id" type="var">t1</span> [ | <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>]]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_free_u_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">u</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">u</span> <span class="id" type="var">l1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTg</span> [ [<span class="id" type="var">H</span> <span class="id" type="var">u_eq_s2</span>] | [ <span class="id" type="var">H</span> <span class="id" type="var">u_eq_t2</span>] ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">u</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t2</span> <span class="id" type="var">u_eq_t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu_lu</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">LU</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">G</span> := <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_uf</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_uf</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s1_eq_uf</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="var">revert</span> <span class="id" type="var">G</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_ug</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">G</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_uf</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu_lu_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">LU</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> [ [ <span class="id" type="var">H</span> <span class="id" type="var">s1_eq_uf</span>] | [ <span class="id" type="var">H</span> <span class="id" type="var">s2_eq_ug</span> ]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu_ru</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">RU</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">G</span> := <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span>  (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_uf</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_uf</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s1_eq_uf</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="var">revert</span> <span class="id" type="var">G</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_ug</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">G</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_uf</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu_ru_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">RU</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> [ [ <span class="id" type="var">H</span> <span class="id" type="var">s1_eq_uf</span> ] | [ <span class="id" type="var">H</span> <span class="id" type="var">t2_eq_ug</span> ] ].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu_u</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">G</span> := <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_uf</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_uf</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s1_eq_uf</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="var">revert</span> <span class="id" type="var">G</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_ug</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">G</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_ug</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_ug</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_lu_u_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">LU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> [ [ <span class="id" type="var">H</span> <span class="id" type="var">s1_eq_uf</span> ] | [ [ <span class="id" type="var">H</span> <span class="id" type="var">s2_eq_ug</span> ]  |  [ <span class="id" type="var">H</span> <span class="id" type="var">t2_eq_ug</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_ru_ru</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">RU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">RU</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">G</span> := <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_uf</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_uf</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t1_eq_uf</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_uf</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="var">revert</span> <span class="id" type="var">G</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_ug</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">G</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_diff_uf</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>); <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_ru_ru_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">RU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">RU</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> [ [<span class="id" type="var">H</span> <span class="id" type="var">uf_eq_t1</span> ] | [<span class="id" type="var">H</span> <span class="id" type="var">ug_eq_t2</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">uf_eq_t1</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">ug_eq_t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_ru_u</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">RU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">G</span> := <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_uf</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_uf</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t1_eq_uf</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_uf</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="var">revert</span> <span class="id" type="var">G</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_ug</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">G</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_diff_uf</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_ug</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_diff_uf</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_ug</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_ru_u_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">RU</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> [ [ <span class="id" type="var">H</span> <span class="id" type="var">t1_eq_uf</span> ] | [ [ <span class="id" type="var">H</span> <span class="id" type="var">s2_eq_ug</span> ]  |  [ <span class="id" type="var">H</span> <span class="id" type="var">t2_eq_ug</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_uf</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_u_u</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">f_diff_g</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)));<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">_</span> <span class="id" type="var">H'</span> ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">G</span> := <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTf</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_uf</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_uf</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s1_eq_uf</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_eq_uf</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_diff_uf</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">th_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t1_eq_uf</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_eq_uf</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">G</span>; <span class="id" type="var">revert</span> <span class="id" type="var">G</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_ug</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">G</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">s2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_diff_uf</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">t2_diff_ug</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">acu_is_ac_on_unit_nf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">G</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t2_eq_ug</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1_diff_uf</span> <span class="id" type="var">t2_eq_ug</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">unit_nf_is_sound</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">UTg</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">ac_top_eq</span> <span class="id" type="var">H</span>);<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_ug</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">s2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">t2_eq_ug</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">unit_nf</span> <span class="id" type="var">t2</span> = <span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mutate_u_u_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">unit_theory</span> <span class="id" type="var">f</span> = <span class="id" type="var">U</span> <span class="id" type="var">uf</span> -&gt; <span class="id" type="var">unit_theory</span> <span class="id" type="var">g</span> = <span class="id" type="var">U</span> <span class="id" type="var">ug</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s1</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t1</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">s2</span>) \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">s2</span> /\ <span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">acu</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acu</span>, <span class="id" type="var">th_eq</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">uf</span> <span class="id" type="var">ug</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span> <span class="id" type="var">UTf</span> <span class="id" type="var">UTg</span><br/>
[ [<span class="id" type="var">H</span> <span class="id" type="var">uf_eq_s1</span>] | [ [ <span class="id" type="var">H</span> <span class="id" type="var">uf_eq_t1</span> ] | [ [ <span class="id" type="var">H</span> <span class="id" type="var">ug_eq_s2</span> ] | [ <span class="id" type="var">ug_eq_t2</span> <span class="id" type="var">H</span> ] ]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">s1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">uf</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">uf_eq_t1</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">left_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">s2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">ug</span> <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">unit_one_step_at_top</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">ug_eq_t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">H</span> | [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>]]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>];<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">union</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_in_rwr_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">right_unit</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>