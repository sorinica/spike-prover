<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>list_extensions.more_list</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library list_extensions.more_list</h1>

<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab24"></a><h1 class="section">Some additional properties for the Coq lists.</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Bool</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">length_app</span> := <span class="id" type="var">app_length</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">length_map</span> := <span class="id" type="var">map_length</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">tail_prop</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> :  <span class="id" type="keyword">Type</span>, <span class="id" type="keyword">forall</span> (<span class="id" type="var">P</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span>), <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">b</span> (<span class="id" type="var">a</span>::l) -&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Ar</span> <span class="id" type="var">P</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">b</span> <span class="id" type="var">In_b</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">tail_set</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>, <span class="id" type="keyword">forall</span> (<span class="id" type="var">P</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Set</span>), <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">b</span> (<span class="id" type="var">a</span>::l) -&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Ar</span> <span class="id" type="var">P</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">b</span> <span class="id" type="var">In_b</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab25"></a><h2 class="section">How to add or remove an element, how to split a list</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_list</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span> = <span class="id" type="var">l3</span> ++ <span class="id" type="var">l4</span> -&gt;<br/>
&nbsp;&nbsp;{<span class="id" type="var">l</span> | <span class="id" type="var">l1</span> = <span class="id" type="var">l3</span> ++ <span class="id" type="var">l</span> /\ <span class="id" type="var">l4</span> = <span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>} + {<span class="id" type="var">l</span> | <span class="id" type="var">l3</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">l</span> /\ <span class="id" type="var">l2</span> = <span class="id" type="var">l</span> ++ <span class="id" type="var">l4</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> [ | <span class="id" type="var">a3</span> <span class="id" type="var">l3</span>] <span class="id" type="var">l4</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">a1_eq_a3</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a3</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span> <span class="id" type="var">l4</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_insert</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">e</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_l1_l2</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_l1_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a_in_l1</span> | <span class="id" type="var">a_in_l2</span>]; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">diff_in_remove</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">e</span> <span class="id" type="var">a</span>, <span class="id" type="var">a</span> &lt;&gt; <span class="id" type="var">e</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span> <span class="id" type="var">a_diff_e</span> <span class="id" type="var">a_in_l1_e_l2</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_l1_e_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a_in_l1</span> | [<span class="id" type="var">a_eq_e</span> | <span class="id" type="var">a_in_l2</span>]]; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <br/>
[<span class="id" type="var">left</span><br/>
| <span class="id" type="var">absurd</span> (<span class="id" type="var">a</span>=e); <span class="id" type="tactic">subst</span><br/>
| <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_split</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>)  (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a_eq_e</span> | <span class="id" type="var">a_in_l</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">e</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">a_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l''</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_split_set</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">eq_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> : <span class="id" type="var">A</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; {<span class="id" type="var">l1</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> &amp; { <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> | <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>}}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_a</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">e_diff_a</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_el</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_in_el</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_a</span> | <span class="id" type="var">a_in_l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">e</span> = <span class="id" type="var">a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l''</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_in_split_set</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) <br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span> <span class="id" type="var">b</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span> = <span class="id" type="var">k1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">k2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" type="var">l</span> | <span class="id" type="var">l1</span> = <span class="id" type="var">k1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l</span> /\ <span class="id" type="var">k2</span> = <span class="id" type="var">l</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>} +<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" type="var">l</span> | <span class="id" type="var">k1</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> /\ <span class="id" type="var">l2</span> = <span class="id" type="var">l</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">k2</span>} +<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" type="var">a</span> = <span class="id" type="var">b</span> /\ <span class="id" type="var">l1</span> = <span class="id" type="var">k1</span> /\ <span class="id" type="var">l2</span> = <span class="id" type="var">k2</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span>; <span class="id" type="var">revert</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l2</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">k1</span>].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2_eq_k2</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2_eq_k</span> <span class="id" type="var">a_eq_b1</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">k1</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l_eq_k2</span> <span class="id" type="var">a1_eq_b</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l_eq_k</span> <span class="id" type="var">a1_eq_b1</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">l_eq_k</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">H</span> | <span class="id" type="var">H</span>] | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_b</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">insert_1</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">r1</span> <span class="id" type="var">r2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">a</span> <span class="id" type="var">b</span> : <span class="id" type="var">A</span>), <span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span> = <span class="id" type="var">r1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">r2</span> -&gt;<br/>
&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">r1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">r2'</span>, <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span> = <span class="id" type="var">r1'</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">r2'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">r1</span> <span class="id" type="var">r2</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">r1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">r2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">r1</span>] <span class="id" type="var">r2</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">a1_eq</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">r1'</span> [<span class="id" type="var">r2'</span> <span class="id" type="var">H'</span>]]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">b1</span> :: <span class="id" type="var">r1'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">r2'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">insert_2</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">r1</span> <span class="id" type="var">r2</span> <span class="id" type="var">r3</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> : <span class="id" type="var">A</span>), <br/>
&nbsp;&nbsp;<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span> = <span class="id" type="var">r1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">r2</span> ++ <span class="id" type="var">b'</span> :: <span class="id" type="var">r3</span> -&gt;<br/>
&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">r1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">r2'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">r3'</span>, <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span> = <span class="id" type="var">r1'</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">r2'</span> ++ <span class="id" type="var">b'</span> :: <span class="id" type="var">r3'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">r1</span> <span class="id" type="var">r2</span> <span class="id" type="var">r3</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">r1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">r2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">r3</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">r1</span>] <span class="id" type="var">r2</span> <span class="id" type="var">r3</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">a1_eq</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">insert_1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>  <span class="id" type="var">r2</span> <span class="id" type="var">r3</span> <span class="id" type="var">a</span> <span class="id" type="var">b'</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">r2'</span> [<span class="id" type="var">r3'</span> <span class="id" type="var">H'</span>]]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">r2'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">r3'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span> <span class="id" type="var">r1</span>  <span class="id" type="var">r2</span> <span class="id" type="var">r3</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">r1'</span> [<span class="id" type="var">r2'</span> [<span class="id" type="var">r3'</span> <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">b1</span> :: <span class="id" type="var">r1'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">r2'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">r3'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab26"></a><h2 class="section">Properties of map.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_id</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) <span class="id" type="var">l</span>, <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">t</span>) <span class="id" type="var">l</span> = <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_eq</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> <span class="id" type="var">g</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span>) <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">g</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">map</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_map_set</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span>) <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;{<span class="id" type="var">k1</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> &amp; {<span class="id" type="var">k2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> | <span class="id" type="var">l</span> = <span class="id" type="var">k1</span> ++ <span class="id" type="var">k2</span> /\ <span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">k1</span> = <span class="id" type="var">l1</span> /\ <span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">k2</span> = <span class="id" type="var">l2</span>}}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 4.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="var">exists</span> <span class="id" type="var">nil</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_map_set</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k1</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">k1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_map_set</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">eqB_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">b1</span> <span class="id" type="var">b2</span> : <span class="id" type="var">B</span>, {<span class="id" type="var">b1</span> = <span class="id" type="var">b2</span>}+{b1 &lt;&gt; <span class="id" type="var">b2</span>}) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span>) <span class="id" type="var">b</span> <span class="id" type="var">l</span>, <br/>
<span class="id" type="var">In</span> <span class="id" type="var">b</span> (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; {<span class="id" type="var">a</span> : <span class="id" type="var">A</span> | <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">b</span> /\ <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eqB_dec</span> <span class="id" type="var">f</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eqB_dec</span> <span class="id" type="var">b</span> (<span class="id" type="var">f</span> <span class="id" type="var">a1</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">b_eq_fa1</span> | <span class="id" type="var">b_diff_fa1</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">b_in_fa1_fl</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> [<span class="id" type="var">fa_eq_b</span> <span class="id" type="var">a_in_l</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_fa1_fl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">fa1_eq_b</span> | <span class="id" type="var">b_in_fl</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">b_diff_fa1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">flat_map_app</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">B</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">flat_map</span> <span class="id" type="var">f</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) = (<span class="id" type="var">flat_map</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) ++ (<span class="id" type="var">flat_map</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span>; <span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">flat_map_app</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab27"></a><h2 class="section">Iterators.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_left_in_acc</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">list</span> <span class="id" type="var">B</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">B</span>) <span class="id" type="var">x</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">acc</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">In</span> <span class="id" type="var">y</span> <span class="id" type="var">acc</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">y</span> (<span class="id" type="var">f</span> <span class="id" type="var">acc</span> <span class="id" type="var">x</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">acc</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">acc</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">fold_left</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">acc</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">Hf</span> <span class="id" type="var">acc</span> <span class="id" type="var">x_in_acc</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hf</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">Hf</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">left</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">fold_left_in_acc_split</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">B</span>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">g</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">acc</span> <span class="id" type="var">x</span> =&gt; (<span class="id" type="var">f</span> <span class="id" type="var">x</span>) ++ <span class="id" type="var">acc</span> <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span>  <span class="id" type="var">acc1</span> <span class="id" type="var">acc2</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">fold_left</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> (<span class="id" type="var">acc1</span> ++ <span class="id" type="var">acc2</span>)) &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">fold_left</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">acc1</span>) \/ <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">acc2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">acc1</span> <span class="id" type="var">acc2</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">revert</span> <span class="id" type="var">acc1</span> <span class="id" type="var">acc2</span>;<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">y</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">acc1</span> <span class="id" type="var">acc2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">g</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">fold_left2</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="var">C</span> -&gt; <span class="id" type="var">A</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l1</span> : <span class="id" type="var">list</span> <span class="id" type="var">B</span>) (<span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">C</span>)  <br/>
&nbsp;&nbsp;{<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : <span class="id" type="var">option</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">a</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">b</span> :: <span class="id" type="var">t1</span>, <span class="id" type="var">c</span> :: <span class="id" type="var">t2</span> =&gt; <span class="id" type="var">fold_left2</span> <span class="id" type="var">f</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab28"></a><h2 class="section">length and size</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">length_add</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">a</span>, <span class="id" type="var">length</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>) = <span class="id" type="var">S</span> (<span class="id" type="var">length</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_length</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_length</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab29"></a><h2 class="section">A measure on lists based on a measure on elements.</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">list_size</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">size</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">nat</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; 0<br/>
&nbsp;&nbsp;| <span class="id" type="var">h</span> :: <span class="id" type="var">tl</span> =&gt; <span class="id" type="var">size</span> <span class="id" type="var">h</span> + <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">tl</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_size_tl_compat</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">size</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">nat</span>) <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span>, <span class="id" type="var">size</span> <span class="id" type="var">a</span> &lt; <span class="id" type="var">size</span> <span class="id" type="var">b</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) &lt; <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">size</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_lt_compat_r</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_size_app</span>:<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">size</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">nat</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) = <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l1</span> + <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_size_fold</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">size</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">nat</span>) <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">size_list</span> (<span class="id" type="var">l0</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t</span> :: <span class="id" type="var">lt</span> =&gt; <span class="id" type="var">size</span> <span class="id" type="var">t</span> + <span class="id" type="var">size_list</span> <span class="id" type="var">lt</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">l</span> = <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_size_size_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">size1</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">nat</span>) (<span class="id" type="var">size2</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">nat</span>) <span class="id" type="var">l</span>,<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">size1</span> <span class="id" type="var">a</span> = <span class="id" type="var">size2</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="var">list_size</span> <span class="id" type="var">size1</span> <span class="id" type="var">l</span> = <span class="id" type="var">list_size</span> <span class="id" type="var">size2</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">size1</span> <span class="id" type="var">size2</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">size1_eq_size2</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">size1_eq_size2</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">size2</span> <span class="id" type="var">a</span> + <span class="id" type="var">n</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>;<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size1_eq_size2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab30"></a><h2 class="section">Induction principles for list.</h2>

 Induction on the length. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="var">list_rec2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">P</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">n</span>:nat) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">length</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">P</span> <span class="id" type="var">l</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">P</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">P</span> <span class="id" type="var">H</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">length</span> <span class="id" type="var">l</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Induction on the the size. 
</div>
<div class="code">
<span class="id" type="keyword">Definition</span> <span class="id" type="var">list_rec3</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">size</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">nat</span>) :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Type</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> (<span class="id" type="var">n</span>:nat) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">P</span> <span class="id" type="var">l</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">P</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">size</span> <span class="id" type="var">P</span> <span class="id" type="var">H</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab31"></a><h2 class="section">Properties on the nth element.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nth_error_nil</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">n</span>, @<span class="id" type="var">nth_error</span> <span class="id" type="var">A</span> <span class="id" type="var">nil</span> <span class="id" type="var">n</span> = <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nth_error_ok_in</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">n</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">n</span> = <span class="id" type="var">Some</span> <span class="id" type="var">a</span> -&gt; {<span class="id" type="var">l1</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> &amp; {<span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> | <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">n</span> /\ <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>}}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_nil</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">n</span>] <span class="id" type="var">a</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">n</span> <span class="id" type="var">a</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H'</span>]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a'</span> :: <span class="id" type="var">l1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nth_error_at_pos</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">l1</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>, <span class="id" type="var">nth_error</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) = @<span class="id" type="var">Some</span> <span class="id" type="var">A</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nth_error_remove</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">n</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">nth_error</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">k'</span>) (<span class="id" type="keyword">if</span> <span class="id" type="var">le_lt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">k</span>) <span class="id" type="var">n</span> <span class="id" type="keyword">then</span> <span class="id" type="var">S</span> <span class="id" type="var">n</span> <span class="id" type="keyword">else</span> <span class="id" type="var">n</span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">nth_error</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">k'</span>) <span class="id" type="var">n</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">b</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">k</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">k'</span> <span class="id" type="var">m</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">length</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">m</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">m</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHk</span> <span class="id" type="var">k'</span> <span class="id" type="var">m</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_lt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">k</span>) <span class="id" type="var">m</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k_le_m</span> | <span class="id" type="var">k_gt_m</span>];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_lt_dec</span> (<span class="id" type="var">S</span> (<span class="id" type="var">length</span> <span class="id" type="var">k</span>)) (<span class="id" type="var">S</span> <span class="id" type="var">m</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">k_le_m'</span> | <span class="id" type="var">k_gt_m'</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">S</span> <span class="id" type="var">m</span> &lt;= <span class="id" type="var">m</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">S</span> <span class="id" type="var">m</span> &lt;= <span class="id" type="var">m</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nth_error_none</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">n</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) , <span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">n</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">length</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">n</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">n</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">case</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_O_n</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">nth_error_none</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nth_error_almost_id</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> (<span class="id" type="var">a1</span> <span class="id" type="var">a2</span> : <span class="id" type="var">A</span>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">nth_error</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">a1</span> :: <span class="id" type="var">l'</span>) <span class="id" type="var">n</span> = <span class="id" type="var">nth_error</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">l'</span>) <span class="id" type="var">n</span> \/<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">nth_error</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">a1</span> :: <span class="id" type="var">l'</span>) <span class="id" type="var">n</span> = <span class="id" type="var">Some</span> <span class="id" type="var">a1</span> /\ <span class="id" type="var">nth_error</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">l'</span>) <span class="id" type="var">n</span> = <span class="id" type="var">Some</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> [ | <span class="id" type="var">n</span>] <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">nth_error_almost_id</span> <span class="id" type="var">A</span> <span class="id" type="var">n</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nth_error_map</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">i</span>,<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">i</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">f_li</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">li</span> =&gt; <span class="id" type="var">f_li</span> = <span class="id" type="var">f</span> <span class="id" type="var">li</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">li</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span> ]; <br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">i</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> ]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">list_eq_bool</span> <span class="id" type="var">A</span> (<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">l1</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">false</span> | <span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span> =&gt; <span class="id" type="var">andb</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">list_eq_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_eq_bool_ok</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_bool</span> <br/>
&nbsp;&nbsp;(<span class="id" type="var">eq_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_eq_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">l1</span> = <span class="id" type="var">l2</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">l1</span> &lt;&gt; <span class="id" type="var">l2</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">eq_bool_ok</span>.<br/>
<span class="id" type="var">fix</span> 1; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; (<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>]).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_eq_a2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a1_diff_a2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_eq_bool_ok</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">list_eq_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_diff_l2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">f_equal2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1l1_eq_a2l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l1_diff_l2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">a1l1_eq_a2l2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1l1_eq_a2l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_diff_a2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">a1l1_eq_a2l2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Eq_bool</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">eqA</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">eq_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">eqA</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; ~ <span class="id" type="var">eqA</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">mem</span> (<span class="id" type="var">e</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">e'</span> :: <span class="id" type="var">l</span> =&gt; (<span class="id" type="var">eqA</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>) \/ <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_eq_mem</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eqA</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>, <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">E</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>; <span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">a_mem_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_b</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_mem_l</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_eq_mem</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_in_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <span class="id" type="var">mem</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> &lt;-&gt; (<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> /\ <span class="id" type="var">In</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a''</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a''</span> <span class="id" type="var">a''_in_l</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a''</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a''</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a''</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''_in_l</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_impl_mem</span> : (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="var">In</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">refl_eq</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">e_in_l</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_in_eq</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>); <span class="id" type="var">exists</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> (<span class="id" type="var">refl_eq</span> <span class="id" type="var">e</span>) | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_impl_in</span> : (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">a</span> = <span class="id" type="var">b</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">eq_is_eq</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_mem_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> [<span class="id" type="var">e_eq_a</span> | <span class="id" type="var">e_mem_l</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">eq_is_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_impl_in</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">mem_bool</span> (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">bool</span> :=<br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">false</span><br/>
| <span class="id" type="var">b</span> :: <span class="id" type="var">k</span> =&gt; <span class="id" type="var">orb</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>) (<span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">k</span>)<br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_bool_ok</span>  : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> | <span class="id" type="var">false</span> =&gt; ~mem <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_b</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">k</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_k</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_not_in_k</span> <span class="id" type="var">a_in_bk</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">a_in_bk</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">a_in_bk</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">a_diff_b</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">a_not_in_k</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_bool_app</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) = <span class="id" type="var">orb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_bool_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">orb_assoc</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_or_app</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">m</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">mem</span> <span class="id" type="var">a</span> <span class="id" type="var">m</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">m</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">m</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> [<span class="id" type="var">a_mem_l</span> | <span class="id" type="var">a_mem_m</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_mem_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_e</span> | <span class="id" type="var">a_mem_l</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">a_mem_lm</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_mem_lm</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a_mem_lm</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_e</span> | <span class="id" type="var">a_mem_lm</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">a_mem_lm</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a_mem_l</span> | <span class="id" type="var">a_mem_m</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_insert</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span> <span class="id" type="var">a_mem_l1l2</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_mem_l1l2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a_mem_l1l2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_e1</span> | <span class="id" type="var">a_mem_l1l2</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">diff_mem_remove</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span>, ~eqA  <span class="id" type="var">a</span> <span class="id" type="var">e</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span> <span class="id" type="var">a_diff_e</span> <span class="id" type="var">a_in_l1el2</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_in_l1el2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_a</span> | <span class="id" type="var">a_mem_l2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_in_l1el2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e1_eq_a</span> | <span class="id" type="var">a_mem_l1el2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">remove</span> (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">None</span><br/>
| <span class="id" type="var">h</span> :: <span class="id" type="var">tl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">h</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">tl</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">false</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">a</span> <span class="id" type="var">tl</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">rmv</span> =&gt; <span class="id" type="var">Some</span> (<span class="id" type="var">h</span> :: <span class="id" type="var">rmv</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_remove</span> :  <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>,<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; ~mem <span class="id" type="var">a</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l'</span> =&gt; {<span class="id" type="var">a'</span> : <span class="id" type="var">A</span> &amp; {<span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> &amp; {<span class="id" type="var">l''</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> | <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> /\ <span class="id" type="var">l</span> = <span class="id" type="var">l'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">l''</span> /\ <span class="id" type="var">remove</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">l''</span>)}}}<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <span class="id" type="var">l</span> <span class="id" type="var">l_eq_nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">a_eq_a'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">a_diff_a'</span> <span class="id" type="var">IH</span> <span class="id" type="var">rmv</span> <span class="id" type="var">H</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">l</span> <span class="id" type="var">a'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l_eq_a'_l'</span> <span class="id" type="var">a_diff_a'</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_in_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>; <span class="id" type="var">revert</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">a''</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">l'''</span> [<span class="id" type="var">H'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">H'''</span>]]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a''</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a'</span> :: <span class="id" type="var">l''</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l'''</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a_in_l'</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_diff_a'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a_in_l'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_split_set</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <span class="id" type="var">mem</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt;<br/>
{<span class="id" type="var">a'</span> : <span class="id" type="var">A</span> &amp; {<span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> &amp; {<span class="id" type="var">l''</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> | <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> /\ <span class="id" type="var">l</span> = <span class="id" type="var">l'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">l''</span> /\ <span class="id" type="var">remove</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">l''</span>)}}}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">a_mem_l</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_not_mem_l</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">remove_equiv</span>  (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) * (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) := <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; (<span class="id" type="var">l1</span>,  <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">x1</span> :: <span class="id" type="var">l1'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">x1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l2'</span> =&gt; <span class="id" type="var">remove_equiv</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">l1''</span>, <span class="id" type="var">l2''</span>) =&gt; ((<span class="id" type="var">x1</span> :: <span class="id" type="var">l1''</span>) , <span class="id" type="var">l2''</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">included_list</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span>:list <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l1</span>} : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">x</span>::l1 =&gt; <span class="id" type="var">andb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">included_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">included_list_sound</span> : <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span>, <span class="id" type="var">eqA</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> -&gt; <span class="id" type="var">eqA</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> -&gt; <span class="id" type="var">eqA</span> <span class="id" type="var">a1</span> <span class="id" type="var">a3</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="var">included_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">true</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">x</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">eq_trans</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">fix</span> 1.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>;<span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">x</span> <span class="id" type="var">abs</span>;<span class="id" type="tactic">elim</span> <span class="id" type="var">abs</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">x</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">case</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a_mem_l2</span> <span class="id" type="var">Heq</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_mem_l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">a_mem_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">a_mem_l2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> [<span class="id" type="var">a_eq_a'</span> <span class="id" type="var">a'_in_l2</span>] <span class="id" type="var">x_eq_a</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_in_eq</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">eq_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">included_list_sound</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">case</span> (<span class="id" type="var">andb_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> );<span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab32"></a><h2 class="section">Association lists.</h2>

<a name="lab33"></a><h3 class="section">find.</h3>

</div>
<div class="code">
<span class="id" type="var">Function</span> <span class="id" type="var">find</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> <span class="id" type="var">B</span> :=<br/>
&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;| (<span class="id" type="var">a1</span>,b1) :: <span class="id" type="var">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">Some</span> <span class="id" type="var">b1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_find_eq</span> : <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eqA</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>, <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>  = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">find</span> (<span class="id" type="var">B</span> := <span class="id" type="var">B</span>) <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">find</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">eq_proof</span>.<br/>
<span class="id" type="var">fix</span> 4.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a''</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a''</span>); <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">a''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'_diff_a''</span> <span class="id" type="var">a_eq_a''</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">eqA</span> <span class="id" type="var">a'</span> <span class="id" type="var">a''</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a'</span> <span class="id" type="var">a''</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a'_diff_a''</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">eq_proof</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Req</span> <span class="id" type="var">Teq</span> <span class="id" type="var">Seq</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Teq</span> <span class="id" type="var">a'</span> <span class="id" type="var">a</span> <span class="id" type="var">a''</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Seq</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a''</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a''</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'_eq_a''</span> <span class="id" type="var">a_diff_a''</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a''</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a''</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_diff_a''</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">eq_proof</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Req</span> <span class="id" type="var">Teq</span> <span class="id" type="var">Seq</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Teq</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a''</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a'</span> <span class="id" type="var">a''</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a'_eq_a''</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">eq_find_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_diff</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1</span> = <span class="id" type="var">false</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">b</span>, <span class="id" type="var">find</span> <span class="id" type="var">a2</span> (<span class="id" type="var">l1</span> ++ (<span class="id" type="var">a1</span>,b) :: <span class="id" type="var">l2</span>) = <span class="id" type="var">find</span> (<span class="id" type="var">B</span>:= <span class="id" type="var">B</span>) <span class="id" type="var">a2</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 5.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a2_diff_a1</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">a2_diff_a1</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">find_diff</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_mem</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>)  (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>)  (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)) (<span class="id" type="var">b</span> : <span class="id" type="var">B</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span> -&gt; {<span class="id" type="var">a'</span> : <span class="id" type="var">A</span> &amp; {<span class="id" type="var">l1</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>) &amp; {<span class="id" type="var">l2</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>) | <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> /\ <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ (<span class="id" type="var">a'</span>,b) :: <span class="id" type="var">l2</span> } } }.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a1</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">b1_eq_b</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">A</span>*B)) ; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">find_mem</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">F</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">a1</span>,b1) :: <span class="id" type="var">l1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_not_mem</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eqA</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>)  (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">b</span> : <span class="id" type="var">B</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)) (<span class="id" type="var">dom</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;~mem <span class="id" type="var">a</span> <span class="id" type="var">dom</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a'</span>, <span class="id" type="var">mem</span> <span class="id" type="var">a'</span> <span class="id" type="var">dom</span> -&gt; <span class="id" type="var">find</span> <span class="id" type="var">a'</span> ((<span class="id" type="var">a</span>,b) :: <span class="id" type="var">l</span>) = <span class="id" type="var">find</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">dom</span> <span class="id" type="var">a_not_in_dom</span> <span class="id" type="var">a'</span> <span class="id" type="var">a'_in_dom</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a'</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a'_eq_a</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_not_in_dom</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">dom</span> <span class="id" type="var">a'_eq_a</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_not_found</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">a</span> <span class="id" type="var">a'</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">b</span> : <span class="id" type="var">B</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)), <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> = <span class="id" type="var">true</span> -&gt; ~In (<span class="id" type="var">a'</span>,b) <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 5.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Abs</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_diff_a1</span> <span class="id" type="var">F</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_diff_a1</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">find_not_found</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">F</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_app</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>)  <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)),<br/>
&nbsp;&nbsp;<span class="id" type="var">find</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">a</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">l1</span>) <span class="id" type="keyword">then</span> <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">else</span> <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">find_app</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_map</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> <span class="id" type="var">C</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">B</span> -&gt; <span class="id" type="var">C</span>),<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">b</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">a</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xval</span> : <span class="id" type="var">A</span> * <span class="id" type="var">B</span> =&gt; (<span class="id" type="var">fst</span> <span class="id" type="var">xval</span>, <span class="id" type="var">f</span> (<span class="id" type="var">snd</span> <span class="id" type="var">xval</span>))) <span class="id" type="var">l</span>) = <span class="id" type="var">Some</span> (<span class="id" type="var">f</span> <span class="id" type="var">b</span>)<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">a</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xval</span> : <span class="id" type="var">A</span> * <span class="id" type="var">B</span> =&gt; (<span class="id" type="var">fst</span> <span class="id" type="var">xval</span>, <span class="id" type="var">f</span> (<span class="id" type="var">snd</span> <span class="id" type="var">xval</span>))) <span class="id" type="var">l</span>) = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 5.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span>  <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">find_map</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">find_map2</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> <span class="id" type="var">C</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>) -&gt; <span class="id" type="var">C</span>),<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">b</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> /\ <span class="id" type="var">find</span> <span class="id" type="var">a</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xval</span> : <span class="id" type="var">A</span> * <span class="id" type="var">B</span> =&gt; (<span class="id" type="var">fst</span> <span class="id" type="var">xval</span>, <span class="id" type="var">f</span> <span class="id" type="var">xval</span>)) <span class="id" type="var">l</span>) = <span class="id" type="var">Some</span> (<span class="id" type="var">f</span> (<span class="id" type="var">a'</span>,b))<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">find</span> <span class="id" type="var">a</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xval</span> : <span class="id" type="var">A</span> * <span class="id" type="var">B</span> =&gt; (<span class="id" type="var">fst</span> <span class="id" type="var">xval</span>, <span class="id" type="var">f</span> <span class="id" type="var">xval</span>)) <span class="id" type="var">l</span>) = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">C</span> <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a1</span> <span class="id" type="var">b1</span>] <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_a1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Merge</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">eqB</span> : <span class="id" type="var">relation</span> <span class="id" type="var">B</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">eqB_bool</span> : <span class="id" type="var">B</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="var">bool</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">eqB_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eqB_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">eqB</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; ~ <span class="id" type="var">eqB</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">merge</span> (<span class="id" type="var">partial_res</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span>*B)) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> (<span class="id" type="var">list</span> (<span class="id" type="var">A</span>*B)) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">partial_res</span><br/>
&nbsp;&nbsp;| ((<span class="id" type="var">a</span>,b) <span class="id" type="keyword">as</span> <span class="id" type="var">p</span>) :: <span class="id" type="var">l</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">partial_res</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">b'</span> =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">eqB_bool</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="keyword">then</span> <span class="id" type="var">merge</span> <span class="id" type="var">partial_res</span> <span class="id" type="var">l</span> <span class="id" type="keyword">else</span> <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">merge</span> (<span class="id" type="var">p</span> :: <span class="id" type="var">partial_res</span>) <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">merge_correct</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eqA</span> -&gt; (<span class="id" type="var">reflexive</span> <span class="id" type="var">_</span> <span class="id" type="var">eqB</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">merge</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l</span> =&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span> -&gt; (<span class="id" type="var">exists</span> <span class="id" type="var">b'</span>, <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b'</span> /\ <span class="id" type="var">eqB_bool</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> = <span class="id" type="var">true</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span> -&gt; (<span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span> \/ (<span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> = <span class="id" type="var">None</span> /\ <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">b1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">b2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b1</span> \/ <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b1) <span class="id" type="var">l2</span>) /\ <span class="id" type="var">In</span> (<span class="id" type="var">a'</span>,b2) <span class="id" type="var">l2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> = <span class="id" type="var">true</span> /\ <span class="id" type="var">eqB_bool</span> <span class="id" type="var">b2</span> <span class="id" type="var">b1</span> = <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">RB</span>; <span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">find</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">F</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eqB_bool</span> <span class="id" type="var">b2</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">b2_eq_b</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">merge_correct</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">merge</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H1</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b'</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">b'</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">F</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">eq_find_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_diff_a2</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b'</span> <span class="id" type="var">F'</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a2</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">F'</span>); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">eq_find_eq</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">l1</span> <span class="id" type="var">a_eq_a2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">FF</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">FF</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">FF</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">F''</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">F''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">F''</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">F''</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F''</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_a2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">b1</span> [<span class="id" type="var">b1'</span> [[<span class="id" type="var">F'</span> | <span class="id" type="var">F'</span>] [<span class="id" type="var">F''</span> [<span class="id" type="var">a_eq_a'</span> <span class="id" type="var">b1_diff_b1'</span>]]]]]]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b1'</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">b2_diff_b</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a2_diff_a2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a2_diff_a2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">eq_proof</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">R</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">merge_correct</span> ((<span class="id" type="var">a2</span>,b2) :: <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">merge</span> ((<span class="id" type="var">a2</span>,b2) :: <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H1</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_a2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">eq_find_eq</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">l1</span> <span class="id" type="var">a_eq_a2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H1a</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1a</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b'</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">b'</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">b2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a2</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H1a</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1a</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eqB_bool_ok</span> <span class="id" type="var">b2</span> <span class="id" type="var">b2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eqB_bool</span> <span class="id" type="var">b2</span> <span class="id" type="var">b2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">b2_diff_b2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">b2_diff_b2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">RB</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_diff_a2</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">H2</span> <span class="id" type="var">a</span> <span class="id" type="var">b'</span> <span class="id" type="var">F'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H3</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">F'</span>); <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a2</span> [<span class="id" type="var">F''</span> | <span class="id" type="var">FF</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">eq_find_eq</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">l1</span> <span class="id" type="var">a_eq_a2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">FF</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">F''</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">b1</span> [<span class="id" type="var">b1'</span> [[<span class="id" type="var">F'</span> | <span class="id" type="var">F'</span>] [<span class="id" type="var">F''</span> [<span class="id" type="var">a_eq_a'</span> <span class="id" type="var">b1_diff_b1'</span>]]]]]]].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">F'</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a2</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">F'</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">b1</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b1'</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a2_diff_a'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a2_diff_a'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">eq_proof</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Re</span> <span class="id" type="var">Te</span> <span class="id" type="var">Se</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Te</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Se</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a2</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_diff_a2</span> <span class="id" type="var">F'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b1'</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b1'</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">merge_inv</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eqA</span> -&gt; (<span class="id" type="var">reflexive</span> <span class="id" type="var">_</span> <span class="id" type="var">eqB</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span>*B)), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> <span class="id" type="var">b1</span> <span class="id" type="var">c1</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a1</span>,b1) <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">a1'</span>,c1) <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">eqB_bool</span> <span class="id" type="var">b1</span> <span class="id" type="var">c1</span> =true) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a2</span> <span class="id" type="var">a2'</span> <span class="id" type="var">b2</span> <span class="id" type="var">c2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a2</span>,b2) <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">a2'</span>,c2) <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a2'</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">eqB_bool</span> <span class="id" type="var">b2</span> <span class="id" type="var">c2</span> = <span class="id" type="var">true</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">merge</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l</span> =&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) <span class="id" type="var">l</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">a'</span>,c) <span class="id" type="var">l</span> -&gt; <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">eqB_bool</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> = <span class="id" type="var">true</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">RB</span>; <span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Inv1</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">Inv1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">Inv1</span> <span class="id" type="var">Inv2</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">find</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">H</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eqB_bool</span> <span class="id" type="var">b2</span> <span class="id" type="var">b</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">b2_eq_b</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">b2_diff_b</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">merge_inv</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">Inv1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b'</span> <span class="id" type="var">c</span> <span class="id" type="var">ab_in_l2</span> <span class="id" type="var">ac_in_l2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Inv2</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b'</span> <span class="id" type="var">c</span>).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">I</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">merge_inv</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b'</span> <span class="id" type="var">c</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">ab_in_l1</span>] [<span class="id" type="var">H2</span> | <span class="id" type="var">ac_in_l1</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b'</span> <span class="id" type="var">c</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eqB_bool_ok</span> <span class="id" type="var">b2</span> <span class="id" type="var">b2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eqB_bool</span> <span class="id" type="var">b2</span> <span class="id" type="var">b2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">b2_diff_b2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">b2_diff_b2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">RB</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a</span> <span class="id" type="var">b'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">find_not_found</span> <span class="id" type="var">c</span> <span class="id" type="var">l1</span> <span class="id" type="var">H</span> <span class="id" type="var">H3</span> <span class="id" type="var">ac_in_l1</span>).<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span> <span class="id" type="var">c</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">find_not_found</span> (<span class="id" type="var">a'</span> := <span class="id" type="var">a</span>) <span class="id" type="var">b'</span> <span class="id" type="var">l1</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span> <span class="id" type="var">ab_in_l1</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a</span>) (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2_diff_a</span> <span class="id" type="var">a_eq_a2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a2_diff_a</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">eq_proof</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Se</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">Se</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Inv1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b'</span> <span class="id" type="var">c</span> <span class="id" type="var">ab_in_l2</span> <span class="id" type="var">ac_in_l2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Inv2</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b'</span> <span class="id" type="var">c</span>).<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Merge</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab34"></a><h3 class="section">number of occurences of the first element of a pair.</h3>

</div>
<div class="code">
<span class="id" type="var">Function</span> <span class="id" type="var">nb_occ</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>)  (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; 0<br/>
&nbsp;&nbsp;| (<span class="id" type="var">a'</span>,_) :: <span class="id" type="var">tl</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>) <span class="id" type="keyword">then</span> <span class="id" type="var">S</span> (<span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> <span class="id" type="var">tl</span>) <span class="id" type="keyword">else</span> <span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> <span class="id" type="var">tl</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nb_occ_app</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">a</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)), <br/>
&nbsp;&nbsp;<span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> (<span class="id" type="var">l1</span>++l2) = <span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> + <span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nb_occ_app</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">nb_occ_app</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">none_nb_occ_O</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)), <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = 0.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">none_nb_occ_O</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">some_nb_occ_Sn</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)) <span class="id" type="var">b</span>, <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">b</span> -&gt; 1 &lt;= <span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_O_n</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">some_nb_occ_Sn</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">reduce_assoc_list</span> :<br/>
&nbsp;&nbsp;<span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eqA</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)),  {<span class="id" type="var">l'</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>) | (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">nb_occ</span> <span class="id" type="var">a</span> <span class="id" type="var">l'</span> &lt;= 1) /\ (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> = <span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l'</span>)}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">eq_proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">B</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">B</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_O_n</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">reduce_assoc_list</span> <span class="id" type="var">_</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">find</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b'</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">find_mem</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">F</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">k'</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">k1</span> ++ (<span class="id" type="var">a'</span>,b) :: <span class="id" type="var">k2</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H1</span> <span class="id" type="var">a''</span>); <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nb_occ_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H1</span> <span class="id" type="var">a''</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nb_occ_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a''</span> <span class="id" type="var">a'</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''_eq_a'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="var">le_S_n</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">L'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">L''</span> | ]; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span> <span class="id" type="var">L'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L1</span> : <span class="id" type="var">nb_occ</span> <span class="id" type="var">a''</span> <span class="id" type="var">k1</span> = 0).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">L''</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">nb_occ</span> <span class="id" type="var">a''</span> <span class="id" type="var">k1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a''</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''_eq_a</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">L1</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">k1</span>; <span class="id" type="var">fix</span> <span class="id" type="var">IHk</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a''_eq_a'</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a''</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHk</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''_diff_a</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">eqA</span> <span class="id" type="var">a''</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a''</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a''_diff_a</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">eq_proof</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Req</span> <span class="id" type="var">Teq</span> <span class="id" type="var">Seq</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Teq</span> <span class="id" type="var">a''</span> <span class="id" type="var">a'</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a''</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a''_eq_a'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Seq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''_diff_a'</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a''</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a''_eq_a</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">eqA</span> <span class="id" type="var">a''</span> <span class="id" type="var">a'</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a''</span> <span class="id" type="var">a'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a''_diff_a'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">eq_proof</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Req</span> <span class="id" type="var">Teq</span> <span class="id" type="var">Seq</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Teq</span> <span class="id" type="var">a''</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a''</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a''_eq_a</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">k1</span>; <span class="id" type="var">fix</span> <span class="id" type="var">IHk</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">a''_diff_a'</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHk</span>; <span class="id" type="tactic">reflexivity</span>.<br/>

<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">a</span>,b) :: <span class="id" type="var">k'</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">a'</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a'_eq_a</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">eq_find_eq</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">k'</span> <span class="id" type="var">a'_eq_a</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">none_nb_occ_O</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">F</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">a''</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Eq_bool</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_map_set</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">eqB</span> <span class="id" type="var">eqB_bool</span> <br/>
(<span class="id" type="var">eqB_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eqB_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">eqB</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; ~ <span class="id" type="var">eqB</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>)<br/>
(<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span>) <span class="id" type="var">b</span> <span class="id" type="var">l</span>, <br/>
<span class="id" type="var">mem</span> <span class="id" type="var">eqB</span> <span class="id" type="var">b</span> (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; {<span class="id" type="var">a</span> : <span class="id" type="var">A</span> | <span class="id" type="var">eqB</span> <span class="id" type="var">b</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) /\ <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eqB</span> <span class="id" type="var">eqB_bool</span> <span class="id" type="var">eqB_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eqB_bool_ok</span> <span class="id" type="var">b</span> (<span class="id" type="var">f</span> <span class="id" type="var">a1</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">eqB_bool</span> <span class="id" type="var">b</span> (<span class="id" type="var">f</span> <span class="id" type="var">a1</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">b_eq_fa1</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">b_diff_fa1</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">b_in_fa1_fl</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> [<span class="id" type="var">fa_eq_b</span> <span class="id" type="var">a_in_l</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_fa1_fl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">fa1_eq_b</span> | <span class="id" type="var">b_in_fl</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">b_diff_fa1</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">list_forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="var">ifb</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) (<span class="id" type="var">list_forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_forall_app</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_forall</span> <span class="id" type="var">f</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) = <span class="id" type="var">andb</span> (<span class="id" type="var">list_forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">list_forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_forall_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">P_bool</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">list_forall</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> &lt;-&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">P_bool</span> <span class="id" type="var">a</span> = <span class="id" type="var">true</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">a</span> <span class="id" type="var">Abs</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">P_bool</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">intro</span> <span class="id" type="var">Pa</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pl</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_al</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">b_in_al</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">b_in_al</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">Pa</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">list_forall_is_sound</span> <span class="id" type="var">A</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">exact</span> <span class="id" type="var">Pl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pal</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Pal</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_forall_is_sound</span> <span class="id" type="var">A</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pal</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_forall_impl</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> <span class="id" type="var">f'</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f'</span> <span class="id" type="var">a</span> = <span class="id" type="var">true</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">list_forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) = <span class="id" type="var">true</span> -&gt; (<span class="id" type="var">list_forall</span> <span class="id" type="var">f'</span> <span class="id" type="var">l</span>) = <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">f'</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Ha</span> := <span class="id" type="var">Hl</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Ha</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">false</span> = <span class="id" type="var">true</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">list_forall2</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">B</span>){<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span>, <span class="id" type="var">l'</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>), (<span class="id" type="var">b</span> :: <span class="id" type="var">l'</span>) =&gt; <span class="id" type="var">ifb</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>) (<span class="id" type="var">list_forall2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>) <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span>, <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_forall2_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">B</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">list_forall2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> = <span class="id" type="var">true</span> &lt;-&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">length</span> <span class="id" type="var">l</span> = <span class="id" type="var">length</span> <span class="id" type="var">l'</span> /\ <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) (<span class="id" type="var">combine</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>) -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> = <span class="id" type="var">true</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b</span> <span class="id" type="var">l'</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">l'</span>) <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a0</span> <span class="id" type="var">b0</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">l'</span>) <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H1</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">l'</span>)); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">list_forall_option</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <br/>
&nbsp;&nbsp;{<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">list_forall_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_forall_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_forall_option_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> @<span class="id" type="var">list_forall_option</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; (<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">False</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Fa</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">b</span> = <span class="id" type="var">a</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">b</span> = <span class="id" type="var">f</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">Fa</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">Fa</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Fa</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>]; [<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span> | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_false</span>]] <span class="id" type="var">IHl</span>].<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> [<span class="id" type="var">c_eq_a</span> | <span class="id" type="var">c_in_l</span>]; <br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span>; <span class="id" type="tactic">discriminate</span><br/>
| <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_none</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>]; <br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span> | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_false</span>]] <span class="id" type="var">IHl</span>].<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> [<span class="id" type="var">c_eq_a</span> | <span class="id" type="var">c_in_l</span>]; <br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_none</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_forall_option_is_complete_true</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" type="var">list_forall_option</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)));<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_forall_option_is_complete_false</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">None</span> -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" type="var">list_forall_option</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a_in_nil</span> <span class="id" type="var">_</span>]] <span class="id" type="var">_</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">b</span> [[<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>] <span class="id" type="var">fb_eq_false</span>]] <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">fb_eq_false</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">c</span> [<span class="id" type="var">c_in_l</span> <span class="id" type="var">fc_eq_none</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">H</span> <span class="id" type="var">c</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">c_in_l</span>) <span class="id" type="var">fc_eq_none</span>); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> <span class="id" type="var">c_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_forall_option_is_sound</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">c</span> [<span class="id" type="var">c_in_l</span> <span class="id" type="var">fc_eq_none</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">H</span> <span class="id" type="var">c</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">c_in_l</span>) <span class="id" type="var">fc_eq_none</span>); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">list_exists</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="var">ifb</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="var">true</span> (<span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_app</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) = <span class="id" type="var">orb</span> (<span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span> &lt;-&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">true</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">Abs</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">a'</span>, <span class="id" type="var">a'</span> = <span class="id" type="var">a</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a'</span> = <span class="id" type="var">f</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">fa</span> | <span class="id" type="var">not_fa</span>]; <span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> ((<span class="id" type="var">proj1</span> <span class="id" type="var">IHl</span>) <span class="id" type="var">H'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_in_l</span> <span class="id" type="var">fa'</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a'_in_l</span>] <span class="id" type="var">fa'</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">fa'</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">false</span> = <span class="id" type="var">true</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> <span class="id" type="var">IHl</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_is_complete_false</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">false</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">false</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">b</span> [<span class="id" type="var">a_eq_b</span> | <span class="id" type="var">b_in_l</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>); [<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>); [<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_impl</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> <span class="id" type="var">f'</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f'</span> <span class="id" type="var">a</span> = <span class="id" type="var">true</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) = <span class="id" type="var">true</span> -&gt; (<span class="id" type="var">list_exists</span> <span class="id" type="var">f'</span> <span class="id" type="var">l</span>) = <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">f'</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Ha</span> := <span class="id" type="var">Hl</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Ha</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f'</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">list_exists_option</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">bool</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <br/>
&nbsp;{<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">option</span> <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; (<span class="id" type="var">list_exists_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_exists_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_option_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> @<span class="id" type="var">list_exists_option</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">false</span> =&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; (<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">None</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span> -&gt; <span class="id" type="var">False</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Fa</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">b</span> = <span class="id" type="var">a</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">b</span> = <span class="id" type="var">f</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">Fa</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">Fa</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Fa</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_true</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>]; [<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span> | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [ [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_none</span>]] <span class="id" type="var">IHl</span>]; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> [<span class="id" type="var">c_eq_a</span> | <span class="id" type="var">c_in_l</span>]; <br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_true</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>]; <br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span> | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">_</span> <span class="id" type="var">IHl</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>]; <br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Fa</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_option_is_complete_true</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" type="var">list_exists_option</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a_in_nil</span> <span class="id" type="var">fa_eq_true</span>]]; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">b</span> [[<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>] <span class="id" type="var">fb_eq_true</span>]]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">fb_eq_true</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_option_is_complete_false</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" type="var">list_exists_option</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">Some</span> <span class="id" type="var">false</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_option_is_complete_none</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">None</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> = <span class="id" type="var">Some</span> <span class="id" type="var">true</span> -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" type="var">list_exists_option</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">None</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a_in_nil</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [[<span class="id" type="var">a_eq_t</span> | <span class="id" type="var">a_in_l</span>] <span class="id" type="var">fa_eq_none</span>]] <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">fa_eq_none</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_option_is_sound</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a_in_l</span> <span class="id" type="var">fa_eq_true</span>]]; <br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">t</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">t</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">H'</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_option_is_sound</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_option</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">as</span> [ [ | ] | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">fb_eq_true</span>]]; <br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">list_exists_rest</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">P</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l</span> <br/>
(<span class="id" type="var">P_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; {<span class="id" type="var">P</span> <span class="id" type="var">a</span>}+{~P <span class="id" type="var">a</span>}) : <span class="id" type="var">bool</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">P_dec</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">false</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">P_dec</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">true</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">P_dec'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> : <span class="id" type="var">A</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; {<span class="id" type="var">P</span> <span class="id" type="var">a</span>} + {~ <span class="id" type="var">P</span> <span class="id" type="var">a</span>}).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_dec</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">P_dec'</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_exists_rest_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">P</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l</span> <span class="id" type="var">P_dec</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">list_exists_rest</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span> <span class="id" type="var">P_dec</span>= <span class="id" type="var">true</span> &lt;-&gt;  (<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">P</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">P_dec</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">Abs</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P_dec</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Pa</span> | <span class="id" type="var">not_Pa</span>].<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">Pb</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [[<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>] <span class="id" type="var">Pb</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">P</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">mapi</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span>  <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; ((<span class="id" type="var">f</span> <span class="id" type="var">a</span>) :: <span class="id" type="var">l</span>) :: (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">k</span> =&gt; <span class="id" type="var">a</span> :: <span class="id" type="var">k</span>) (<span class="id" type="var">mapi</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapi_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>) <span class="id" type="var">l</span> <span class="id" type="var">l'</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">l'</span> (<span class="id" type="var">mapi</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) &lt;-&gt; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span> /\ <span class="id" type="var">l'</span> = <span class="id" type="var">l1</span> ++ (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>] [<span class="id" type="var">a</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">l''</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K</span> <span class="id" type="var">K'</span>]]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K</span> <span class="id" type="var">K'</span>]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">f</span> <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">mapii</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span>  <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt; (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> =&gt; <span class="id" type="var">b</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">f</span> <span class="id" type="var">a</span>)) ++ (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">k</span> =&gt; <span class="id" type="var">a</span> :: <span class="id" type="var">k</span>) (<span class="id" type="var">mapii</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapii_spec</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">l</span> <span class="id" type="var">l'</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">l'</span> (<span class="id" type="var">mapii</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) &lt;-&gt; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">exists</span> <span class="id" type="var">b</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">b</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) /\ <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span> /\ <span class="id" type="var">l'</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>] [<span class="id" type="var">a</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">_</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rename</span> <span class="id" type="var">H'</span> <span class="id" type="var">into</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">l''</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K</span> [<span class="id" type="var">K'</span> <span class="id" type="var">K''</span>]]]]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K</span> [<span class="id" type="var">K'</span> <span class="id" type="var">K''</span>]]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">DepFun</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">dep_fun</span> : <span class="id" type="keyword">Set</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Dep_fun</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">f</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">dep_fun</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">o_length</span> (<span class="id" type="var">lf1</span> <span class="id" type="var">lf2</span>: <span class="id" type="var">dep_fun</span>) := <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">lf1</span>, <span class="id" type="var">lf2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Dep_fun</span> <span class="id" type="var">l1</span> <span class="id" type="var">_</span>, <span class="id" type="var">Dep_fun</span> <span class="id" type="var">l2</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> &lt; <span class="id" type="var">length</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">wf_length</span> : <span class="id" type="var">well_founded</span> <span class="id" type="var">o_length</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">well_founded</span>, <span class="id" type="var">o_length</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l</span> <span class="id" type="var">f</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">length</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">y</span> <span class="id" type="var">f</span>] <span class="id" type="var">Abs</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">length</span> <span class="id" type="var">y</span> &lt; 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">y</span> <span class="id" type="var">f</span>] <span class="id" type="var">Sy</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Sy</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">Sx</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">dep_fun_tail</span> (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">f</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">dep_fun</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">f'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">f</span> <span class="id" type="var">t</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">t_in_l</span>)).<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">Dep_fun</span> <span class="id" type="var">l</span> <span class="id" type="var">f'</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">map_dep_call</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">f</span>, <span class="id" type="var">o_length</span> (<span class="id" type="var">dep_fun_tail</span> <span class="id" type="var">f</span>) (<span class="id" type="var">Dep_fun</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) <span class="id" type="var">f</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">F_mapii</span>: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">lf</span> : <span class="id" type="var">dep_fun</span>) (<span class="id" type="var">mrec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">lf'</span>, <span class="id" type="var">o_length</span> <span class="id" type="var">lf'</span> <span class="id" type="var">lf</span> -&gt; <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>)), <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l</span> <span class="id" type="var">f</span>] <span class="id" type="var">mrec</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">nil</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> =&gt; <span class="id" type="var">b</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">f</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) ++ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">k</span> =&gt; <span class="id" type="var">a</span> :: <span class="id" type="var">k</span>) (<span class="id" type="var">mrec</span> (<span class="id" type="var">dep_fun_tail</span> <span class="id" type="var">f</span>) (<span class="id" type="var">map_dep_call</span> <span class="id" type="var">f</span>)))).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">mapii_dep</span> : <span class="id" type="var">dep_fun</span> -&gt; <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
<span class="id" type="keyword">Fix</span> <span class="id" type="var">wf_length</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">lf</span> =&gt; <span class="id" type="var">list</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>)) <span class="id" type="var">F_mapii</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapii_dep_unfold</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">lf</span> : <span class="id" type="var">dep_fun</span>, <span class="id" type="var">mapii_dep</span> <span class="id" type="var">lf</span> = @<span class="id" type="var">F_mapii</span> <span class="id" type="var">lf</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">y</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">mapii_dep</span> <span class="id" type="var">y</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">lf</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mapii_dep</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">Fix_eq</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">lf</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">lf</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l</span> <span class="id" type="var">f</span>] <span class="id" type="var">F</span> <span class="id" type="var">G</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">F_mapii</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapii_dep_spec</span> :<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> : <span class="id" type="var">A</span>, {<span class="id" type="var">a1</span> = <span class="id" type="var">a2</span>}+{a1 &lt;&gt; <span class="id" type="var">a2</span>}) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_l</span> <span class="id" type="var">a_in_l'</span>, <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_l</span> = <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_l'</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">In</span> <span class="id" type="var">l'</span> (<span class="id" type="var">mapii_dep</span> (<span class="id" type="var">Dep_fun</span> <span class="id" type="var">l</span> <span class="id" type="var">f</span>)) &lt;-&gt; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">exists</span> <span class="id" type="var">a_in_l</span>, <span class="id" type="var">exists</span> <span class="id" type="var">b</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>,  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">b</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_l</span>) /\ <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l2</span> /\ <span class="id" type="var">l'</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">eqA</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">proof_ir</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>] [<span class="id" type="var">a</span> [<span class="id" type="var">a_in_l</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">_</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]]]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mapii_dep_unfold</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rename</span> <span class="id" type="var">H'</span> <span class="id" type="var">into</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">or_introl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">fix</span> <span class="id" type="var">In</span> (<span class="id" type="var">a</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">b</span> :: <span class="id" type="var">m</span> =&gt; <span class="id" type="var">b</span> = <span class="id" type="var">a</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">a</span> <span class="id" type="var">l</span>) (<span class="id" type="var">refl_equal</span> <span class="id" type="var">a</span>));<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">dep_fun_tail</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_in_l</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K</span> [<span class="id" type="var">K'</span> <span class="id" type="var">K''</span>]]]]]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">or_intror</span> (<span class="id" type="var">a</span> = <span class="id" type="var">a'</span>) <span class="id" type="var">a'_in_l</span>);<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">proof_ir</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">a'_in_l</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K</span> [<span class="id" type="var">K'</span> <span class="id" type="var">K''</span>]]]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">intros</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">a'</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mapii_dep_unfold</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">proof_ir</span> <span class="id" type="var">a</span> <span class="id" type="var">a'_in_l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mapii_dep_unfold</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">dep_fun_tail</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eqA</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a_diff_a'</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a_in_l</span> : <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">proof_ir</span> <span class="id" type="var">a</span> <span class="id" type="var">a'_in_l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a'_in_l'</span> : <span class="id" type="var">In</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a'_in_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a'_eq_a</span> | <span class="id" type="var">a'_in_l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">a</span> = <span class="id" type="var">a'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a'_in_l'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">proof_ir</span> <span class="id" type="var">a'</span> <span class="id" type="var">a'_in_l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a''</span> <span class="id" type="var">a''_in_l1</span> <span class="id" type="var">a''_in_l2</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">proof_ir</span> <span class="id" type="var">a''</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mapii_dep_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> (<span class="id" type="var">t_in_l</span> : <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>), <span class="id" type="var">f</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span> = <span class="id" type="var">g</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">mapii_dep</span> (<span class="id" type="var">Dep_fun</span> <span class="id" type="var">l</span> <span class="id" type="var">f</span>) = <span class="id" type="var">mapii_dep</span> (<span class="id" type="var">Dep_fun</span> <span class="id" type="var">l</span> <span class="id" type="var">g</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">mapii_dep_unfold</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">ll</span> =&gt;<br/>
&nbsp;<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">b</span> :: <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">g</span> <span class="id" type="var">a</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">or_introl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">fix</span> <span class="id" type="var">In</span> (<span class="id" type="var">a0</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">l0</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l0</span>} : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l0</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">b</span> :: <span class="id" type="var">m</span> =&gt; <span class="id" type="var">b</span> = <span class="id" type="var">a0</span> \/ <span class="id" type="var">In</span> <span class="id" type="var">a0</span> <span class="id" type="var">m</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) <span class="id" type="var">a</span> <span class="id" type="var">l</span>) (<span class="id" type="var">refl_equal</span> <span class="id" type="var">a</span>))) ++<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">k</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span> =&gt; <span class="id" type="var">a</span> :: <span class="id" type="var">k</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">dep_fun_tail</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">DepFun</span>.<br/>

<br/>

<br/>
</div>

<div class="doc">
map_without_repetition applies a function to the elements of a list,
but only a single time when there are several consecutive occurences of the
same element. Moreover, the function is supposed to return an option as a result,
in order to simulate exceptions, and the abnormal results are discarted.

</div>
<div class="code">

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">map_without_repetition</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">B</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> <span class="id" type="var">B</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">b1</span> =&gt; <span class="id" type="var">b1</span> :: <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a2</span> :: <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">map_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">map_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">b1</span> =&gt; <span class="id" type="var">b1</span> :: (<span class="id" type="var">map_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">prop_map_without_repetition</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;(<span class="id" type="var">eq_bool_ok</span> :forall <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> : <span class="id" type="var">A</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">P</span> : <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">True</span> <br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">f_a</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">f_a</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">b</span> (<span class="id" type="var">map_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span>; <span class="id" type="var">fix</span> 1; <span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">prop_map_without_repetition</span> <span class="id" type="var">l</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>)); <span class="id" type="var">revert</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">b'</span> <span class="id" type="var">Pb'</span> [<span class="id" type="var">b_eq_b'</span> | <span class="id" type="var">b_in_nil</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">b_in_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_a2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_a2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">case</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">In</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">b'</span> <span class="id" type="var">Pb'</span> [<span class="id" type="var">b_eq_b'</span> | <span class="id" type="var">b_in_mapl</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">exists_map_without_repetition</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;(<span class="id" type="var">eq_bool_ok</span> :forall <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> : <span class="id" type="var">A</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;(<span class="id" type="var">P</span> : <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">a</span>,  <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">b</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">b</span> (<span class="id" type="var">map_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) /\ <span class="id" type="var">P</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span>; <span class="id" type="var">fix</span> 1; <span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">F</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">exists_map_without_repetition</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a'_in_nil</span>] <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">Pb</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_a2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_a2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a'_in_a2l</span>] <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span> <span class="id" type="var">a2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [[<span class="id" type="var">a_eq_a'</span> | <span class="id" type="var">a'_in_a2l</span>] <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">Pb</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_map</span> <span class="id" type="var">Pb</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">case</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
map12_without_repetition is similar to map_without_repetition, but the 
applied function returns two optional results instead of one.

</div>
<div class="code">

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">map12_without_repetition</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Type</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="var">f</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">option</span> <span class="id" type="var">B</span> * <span class="id" type="var">option</span> <span class="id" type="var">B</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> <span class="id" type="var">B</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b1</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">b1</span> :: <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c1</span>) =&gt; <span class="id" type="var">c1</span> :: <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b1</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c1</span>) =&gt; <span class="id" type="var">b1</span> :: <span class="id" type="var">c1</span> :: <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">a2</span> :: <span class="id" type="var">_</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">map12_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">map12_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b1</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">b1</span> :: <span class="id" type="var">map12_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c1</span>) =&gt; <span class="id" type="var">c1</span> :: <span class="id" type="var">map12_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b1</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c1</span>) =&gt; <span class="id" type="var">b1</span> :: <span class="id" type="var">c1</span> :: <span class="id" type="var">map12_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">prop_map12_without_repetition</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span>  (<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;(<span class="id" type="var">eq_bool_ok</span> :forall <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> : <span class="id" type="var">A</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> : <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">True</span> <br/>
&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span><br/>
&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c</span>) =&gt; <span class="id" type="var">P</span> <span class="id" type="var">c</span><br/>
&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c</span>) =&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">P</span> <span class="id" type="var">c</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">d</span>, <span class="id" type="var">In</span> <span class="id" type="var">d</span> (<span class="id" type="var">map12_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">P</span> <span class="id" type="var">d</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span>; <span class="id" type="var">fix</span> 1; <span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">prop_map12_without_repetition</span> <span class="id" type="var">l</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>)); <span class="id" type="var">revert</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">b'</span> | ] [<span class="id" type="var">b''</span> | ]].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Pb'</span> <span class="id" type="var">Pb''</span>] [<span class="id" type="var">b_eq_b'</span> | [<span class="id" type="var">b_eq_b''</span> | <span class="id" type="var">b_in_nil</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b''</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb'</span> [<span class="id" type="var">b_eq_b'</span> | <span class="id" type="var">b_in_nil</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb''</span> [<span class="id" type="var">b_eq_b''</span> | <span class="id" type="var">b_in_nil</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b''</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_a2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_a2</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Hl</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_map</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">b'</span> | ] [<span class="id" type="var">b''</span> | ]].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Pb'</span> <span class="id" type="var">Pb''</span>] <span class="id" type="var">Hl</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_b'</span> | [<span class="id" type="var">b_eq_b''</span> | <span class="id" type="var">b_in_map</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb'</span> <span class="id" type="var">Hl</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_b'</span> | <span class="id" type="var">b_in_map</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb''</span> <span class="id" type="var">Hl</span> <span class="id" type="var">b</span> [<span class="id" type="var">b_eq_b''</span> | <span class="id" type="var">b_in_map</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">Hl</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_map</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">exists_map12_without_repetition</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> (<span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <br/>
&nbsp;(<span class="id" type="var">eq_bool_ok</span> :forall <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> : <span class="id" type="var">A</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">a1</span> = <span class="id" type="var">a2</span> | <span class="id" type="var">false</span> =&gt; <span class="id" type="var">a1</span> &lt;&gt; <span class="id" type="var">a2</span> <span class="id" type="keyword">end</span>)<br/>
&nbsp;(<span class="id" type="var">P</span> : <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">f</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;((<span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="keyword">match</span> <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b</span>, <span class="id" type="var">None</span>) =&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">None</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c</span>) =&gt; <span class="id" type="var">P</span> <span class="id" type="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">Some</span> <span class="id" type="var">b</span>, <span class="id" type="var">Some</span> <span class="id" type="var">c</span>) =&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span> \/ <span class="id" type="var">P</span> <span class="id" type="var">c</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">d</span>, <span class="id" type="var">In</span> <span class="id" type="var">d</span> (<span class="id" type="var">map12_without_repetition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) /\ <span class="id" type="var">P</span> <span class="id" type="var">d</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span>; <span class="id" type="var">fix</span> 1; <span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a_in_nil</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">IH</span> := <span class="id" type="var">exists_map12_without_repetition</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a0</span> [[<span class="id" type="var">a0_eq_a</span> | <span class="id" type="var">a0_in_l</span>] <span class="id" type="var">H</span>]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a0</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="var">revert</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">b'</span> | ] [<span class="id" type="var">b''</span> | ]].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Pb'</span> | <span class="id" type="var">Pb''</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b''</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb''</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b''</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_a2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_a2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">symmetry</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">b'</span> | ] [<span class="id" type="var">b''</span> | ]].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Pb'</span> | <span class="id" type="var">Pb''</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b''</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b'</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Pb''</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b''</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">d</span> [<span class="id" type="var">d_in_map</span> <span class="id" type="var">Pd</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a0</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">d</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">d_in_map</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">a0_in_l</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">b'</span> | ] [<span class="id" type="var">b''</span> | ]].<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>