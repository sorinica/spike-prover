<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>list_extensions.weaved_relation</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library list_extensions.weaved_relation</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Wellfounded</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">TransClosure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">more_list</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">one_step_list</span> <span class="id" type="var">A</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) : <span class="id" type="var">relation</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">head_step</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l</span>, <span class="id" type="var">R</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">tail_step</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_incl</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> (<span class="id" type="var">R1</span> <span class="id" type="var">R2</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>), (<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="var">R1</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> -&gt; <span class="id" type="var">R2</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">one_step_list</span> <span class="id" type="var">R1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">one_step_list</span> <span class="id" type="var">R2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R1_in_R2</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b1</span> <span class="id" type="var">b2</span> <span class="id" type="var">l</span> <span class="id" type="var">H1</span> | <span class="id" type="var">b</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">Hk</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R1_in_R2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_incl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_length_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span>; <span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b1</span> <span class="id" type="var">b2</span> <span class="id" type="var">l</span> <span class="id" type="var">H1</span> | <span class="id" type="var">b</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">Hk</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">one_step_list_length_eq</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hk</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">trans_clos_one_step_list_length_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_length_eq</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">one_step_list_length_eq</span> <span class="id" type="var">H1</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">refl_trans_clos_one_step_list_length_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> | <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_one_step_list_length_eq</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_one_step_list_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span>) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_al</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">product_o</span>  <span class="id" type="var">R</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>)) (<span class="id" type="var">a</span>,l)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_and</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_list_1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) <span class="id" type="keyword">with</span> ((<span class="id" type="var">fst</span> (<span class="id" type="var">a</span>,l) :: (<span class="id" type="var">snd</span> (<span class="id" type="var">a</span>,l)))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">acc_one_step_list_1</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">a</span>,l) <span class="id" type="var">Acc_al</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_al</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">al</span> <span class="id" type="var">Acc_al</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_al</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">a</span> <span class="id" type="var">l</span>] <span class="id" type="var">Acc_al</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">l'</span>] <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">a'</span>,l)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">CaseA</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">a</span>,l')).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">CaseB</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_one_step_list_2</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 4.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_split</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> <span class="id" type="var">t_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> <span class="id" type="var">K</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">acc_one_step_list_2</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">s</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l1</span>; <span class="id" type="var">fix</span> <span class="id" type="var">Hone_step</span> 1.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hone_step</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_one_step_list</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span>) &lt;-&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_list_1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_list_2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_in_list</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> <span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">t</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">R</span> <span class="id" type="var">t'</span> <span class="id" type="var">t</span> /\  <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span> /\ <span class="id" type="var">l'</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHH'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">l3</span> [<span class="id" type="var">l4</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">l3</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l4</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_chop</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">k1</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">length</span> <span class="id" type="var">k1</span> = <span class="id" type="var">length</span> <span class="id" type="var">k2</span> -&gt; <span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span> (<span class="id" type="var">k1</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">k2</span> ++ <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">k1</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">k1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b</span> <span class="id" type="var">k2</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">k</span> <span class="id" type="var">K</span> | <span class="id" type="var">t</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">J</span> : <span class="id" type="var">l1</span> = <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="var">fix</span> <span class="id" type="var">l1_eq_l2</span> 1.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">k1</span>] [ | <span class="id" type="var">b</span> <span class="id" type="var">k2</span>] <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">J</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">J</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">J</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">J</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">l1_eq_l2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">J</span>).<br/>
&nbsp;<span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">J</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_chop</span> <span class="id" type="keyword">with</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_list_chop</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">k1</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">length</span> <span class="id" type="var">k1</span> = <span class="id" type="var">length</span> <span class="id" type="var">k2</span> -&gt; <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">k2</span> ++ <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">k1</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">ll1</span> := <span class="id" type="var">k1</span> ++ <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">ll1</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ll1</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="var">clearbody</span> <span class="id" type="var">ll1</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">ll2</span> := <span class="id" type="var">k2</span> ++ <span class="id" type="var">l2</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ll2</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="var">clearbody</span> <span class="id" type="var">ll2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">k1</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">H</span> | <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">ll3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_chop</span> <span class="id" type="keyword">with</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="var">exists</span> <span class="id" type="var">k3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>, <span class="id" type="var">length</span> <span class="id" type="var">k1</span> = <span class="id" type="var">length</span> <span class="id" type="var">k3</span> /\ <span class="id" type="var">ll2</span> = <span class="id" type="var">k3</span> ++ <span class="id" type="var">l3</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">one_step_list_length_eq</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">ll2</span>  <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">k1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">ll2</span> <span class="id" type="var">l1</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="var">exists</span> <span class="id" type="var">ll2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b</span> <span class="id" type="var">ll2</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHk1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k3</span> [<span class="id" type="var">l3</span> [<span class="id" type="var">L'</span> <span class="id" type="var">H</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">k3</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k3</span> [<span class="id" type="var">l3</span> [<span class="id" type="var">L'</span> <span class="id" type="var">K3</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l3</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_chop</span> <span class="id" type="keyword">with</span> <span class="id" type="var">k1</span> <span class="id" type="var">k3</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHH2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">k3</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_list_expand_strong</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> <span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l'</span> <span class="id" type="var">l</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">t</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span> /\ <span class="id" type="var">l'</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2'</span> /\ <span class="id" type="var">trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">t'</span> <span class="id" type="var">t</span> /\ <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l2'</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span> | <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">one_step_in_list</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">split</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">one_step_in_list</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHH'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">k1</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k2'</span> [<span class="id" type="var">K1</span> [<span class="id" type="var">K2</span> [<span class="id" type="var">K3</span> <span class="id" type="var">K4</span>]]]]]]]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_in_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [[[<span class="id" type="var">k</span> [<span class="id" type="var">J1</span> <span class="id" type="var">J2</span>]] | [<span class="id" type="var">k</span> [<span class="id" type="var">J1</span> <span class="id" type="var">J2</span>]]] | [<span class="id" type="var">k</span> [<span class="id" type="var">J1</span> <span class="id" type="var">J2</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">u</span> :: <span class="id" type="var">k2</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">u'</span> :: <span class="id" type="var">k2'</span>); <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>]].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_chop</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">k1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">k2</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">k2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]]]]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H5</span> : <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k2</span> | <span class="id" type="var">k3</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span> ((<span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2'</span>) <span class="id" type="keyword">with</span> ((<span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2'</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_list_expand</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> <span class="id" type="var">l'</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l'</span> <span class="id" type="var">l</span> &lt;-&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">t</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span> /\ <span class="id" type="var">l'</span> = <span class="id" type="var">l1'</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2'</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1'</span> <span class="id" type="var">l1</span> /\ <span class="id" type="var">trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">t'</span> <span class="id" type="var">t</span> /\ <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l2'</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rwr_list_expand_strong</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]]]]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>]]]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">t'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">H3</span> [<span class="id" type="var">H4</span> <span class="id" type="var">H5</span>]]]]]]]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k1</span> | <span class="id" type="var">k1'</span> <span class="id" type="var">k1</span> <span class="id" type="var">K3</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rwr_list_expand_strong</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">k1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>]]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">k1'</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rwr_list_expand_strong</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">k1'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>]]; <span class="id" type="tactic">try</span> <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="var">revert</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">K</span> | <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">k</span> <span class="id" type="var">K</span> | <span class="id" type="var">a</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">K</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">k2</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">revert</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">k</span> <span class="id" type="var">K</span> | <span class="id" type="var">a</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">K</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">rwr_list</span> <span class="id" type="var">A</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) := <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">rwr_list_length_eq</span> := <span class="id" type="var">trans_clos_one_step_list_length_eq</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_list_cons</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">l</span>, <span class="id" type="var">trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> -&gt; <span class="id" type="var">rwr_list</span> <span class="id" type="var">R</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">a2</span> :: <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">H</span> | <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_list_tail</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">rwr_list</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">rwr_list</span> <span class="id" type="var">R</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_list_split</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> -&gt; <span class="id" type="var">rwr_list</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">rwr_list</span> <span class="id" type="var">R</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">a2</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_tail</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_list_cons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_refl_trans_clos_one_step</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span>, <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">k1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">s</span> :: <span class="id" type="var">l2</span>) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">k2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">l</span> := <span class="id" type="var">l1</span> ++ <span class="id" type="var">s</span> :: <span class="id" type="var">l2</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">l</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="var">clearbody</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">k</span> := <span class="id" type="var">k1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">k2</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">k</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="var">clearbody</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">u'</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span> | <span class="id" type="var">u</span> <span class="id" type="var">l</span> <span class="id" type="var">k'</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">k1</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">K3</span> <span class="id" type="var">K4</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_eq_t</span> : <span class="id" type="var">s</span> = <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">L</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">k1</span>] <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>] <span class="id" type="var">l2</span> <span class="id" type="var">s</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">k1</span>] <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>, <span class="id" type="var">H2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">K3</span> <span class="id" type="var">K4</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">K3</span> <span class="id" type="var">K4</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHH</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>) (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">refl_trans_clos_one_step_list_refl_trans_clos_one_step</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span>, <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">k1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">s</span> :: <span class="id" type="var">l2</span>) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">k2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">l</span> := <span class="id" type="var">l1</span> ++ <span class="id" type="var">s</span> :: <span class="id" type="var">l2</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">l</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="var">clearbody</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">k</span> := <span class="id" type="var">k1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">k2</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">k</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="var">clearbody</span> <span class="id" type="var">k</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> | <span class="id" type="var">l'</span> <span class="id" type="var">k'</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_eq_t</span> : <span class="id" type="var">s</span> = <span class="id" type="var">t</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">k1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">k1</span>] <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">_</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">k2</span> <span class="id" type="var">l2</span> <span class="id" type="var">L</span> <span class="id" type="var">H0</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span> <span class="id" type="var">k'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> <span class="id" type="var">k'</span> <span class="id" type="var">H</span> | <span class="id" type="var">l'</span> <span class="id" type="var">ll</span> <span class="id" type="var">k'</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span> <span class="id" type="var">k'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">one_step_list_refl_trans_clos_one_step</span> (<span class="id" type="var">R</span> := <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span> <span class="id" type="var">L</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> : <span class="id" type="var">length</span> <span class="id" type="var">l'</span> = <span class="id" type="var">length</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_length_eq</span> <span class="id" type="keyword">with</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : <span class="id" type="var">exists</span> <span class="id" type="var">ll1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">ll2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u</span>, <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">ll1</span> /\ <span class="id" type="var">ll</span> = <span class="id" type="var">ll1</span> ++ <span class="id" type="var">u</span> :: <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">ll</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">ll</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="var">exists</span> <span class="id" type="var">ll</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll1</span> [<span class="id" type="var">ll2</span> [<span class="id" type="var">u</span> [<span class="id" type="var">L'</span> <span class="id" type="var">H</span>]]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">ll1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">ll2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll1</span> [<span class="id" type="var">ll2</span> [<span class="id" type="var">u</span> [<span class="id" type="var">L''</span> <span class="id" type="var">H''</span>]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">one_step_list_refl_trans_clos_one_step</span> (<span class="id" type="var">R</span> := <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l'</span> <span class="id" type="var">ll</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHH'</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> <span class="id" type="var">u</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">L''</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) (<span class="id" type="var">s</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>) &lt;-&gt; (<span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> /\ <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> | <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">k1</span> := <span class="id" type="var">s</span> :: <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">k1</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">k1</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="var">clearbody</span> <span class="id" type="var">k1</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">k2</span> := <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> := <span class="id" type="var">refl_equal</span> <span class="id" type="var">k2</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">k2</span> <span class="id" type="tactic">at</span> 2 <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="var">clearbody</span> <span class="id" type="var">k2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span> | <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHH'</span> <span class="id" type="var">t2</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; [<span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHH'</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">l3</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l3</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> | <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">y</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">K1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">K1</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">y</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">refl_trans_clos_one_step_list_refl_trans_clos</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">A</span>)), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) (<span class="id" type="var">map</span> (@<span class="id" type="var">fst</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll</span>) (<span class="id" type="var">map</span> (@<span class="id" type="var">snd</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll</span>)) &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,t) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">ll</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a</span> <span class="id" type="var">b</span>] <span class="id" type="var">ll</span>]; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">st_in_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> [<span class="id" type="var">st_eq_ab</span> | <span class="id" type="var">st_in_ll</span>]; <br/>
&nbsp;&nbsp;[<span class="id" type="tactic">injection</span> <span class="id" type="var">st_eq_ab</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span> | <span class="id" type="var">revert</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">st_in_ll</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHll</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">refl_trans_clos_one_step_list_refl_trans_clos_alt</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> (<span class="id" type="var">f</span> <span class="id" type="var">g</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span>) <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> <span class="id" type="var">R</span>) (<span class="id" type="var">map</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">map</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>)) &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">R</span> (<span class="id" type="var">f</span> <span class="id" type="var">t</span>) (<span class="id" type="var">g</span> <span class="id" type="var">t</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_nil</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> [<span class="id" type="var">t_eq_a</span> | <span class="id" type="var">t_in_l</span>]; [<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span> | <span class="id" type="var">revert</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHl</span>; <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>