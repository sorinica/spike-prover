<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>ac_matching.cf_eq_ac</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library ac_matching.cf_eq_ac</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_algebra".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_orderings".<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">weaved_relation</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">list_sort</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">ac</span>.<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">S</span>.<br/>

<br/>
<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Ac</span> : <span class="id" type="var">ac.S</span>.<br/>

<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Ac.EqTh.T</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">cf_eq_ac</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">S</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">Ac1</span> : <span class="id" type="var">ac.S</span>) &lt;: <span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">Ac</span> := <span class="id" type="var">Ac1</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Ac</span> := <span class="id" type="var">Ac1</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Ac1</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">EqTh</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="keyword">Sort</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">X</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">LPermut</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_cf</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">u1</span> = <span class="id" type="var">nil</span> \/<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">u2</span> = <span class="id" type="var">nil</span> \/<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">t1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> /\ <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">ac</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">u1</span> /\ <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">u2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; [<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_permut.permut_length</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Wt</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_g</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P</span> : <span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> <span class="id" type="var">canonical_form</span> <span class="id" type="var">l</span>)) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">elim</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">Wl</span> <span class="id" type="var">Ll</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l</span>]; [<span class="id" type="var">absurd</span> (0=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l</span>]; [<span class="id" type="var">absurd</span> (1=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t3</span> <span class="id" type="var">l</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">length</span> <span class="id" type="var">l</span>)))=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>];<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">map</span> <span class="id" type="var">canonical_form</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="keyword">with</span> <br/>
((<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">flatten_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wt1</span> := <span class="id" type="var">Wl</span> <span class="id" type="var">t1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span>  (<span class="id" type="var">refl_equal</span> <span class="id" type="var">t1</span>)));<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wt2</span> := <span class="id" type="var">Wl</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span>  (<span class="id" type="var">refl_equal</span> <span class="id" type="var">t2</span>))));<br/>
<span class="id" type="tactic">elim</span> (<span class="id" type="var">ac_syntactic</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k3</span> [<span class="id" type="var">k4</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P3</span> <span class="id" type="var">P4</span>]]]]]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">t1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">k3</span> <span class="id" type="var">k4</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">P1</span>); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk3</span> | [<span class="id" type="var">Hk4</span> | [<span class="id" type="var">t11</span> [<span class="id" type="var">t12</span> [<span class="id" type="var">Wt11</span> [<span class="id" type="var">Wt12</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">Q11</span> <span class="id" type="var">Q12</span>]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">P2</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">t21</span> [<span class="id" type="var">t22</span> [<span class="id" type="var">Wt21</span> [<span class="id" type="var">Wt22</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">Q21</span> <span class="id" type="var">Q22</span>]]]]]]]].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_nil</span> <span class="id" type="keyword">with</span> <span class="id" type="var">term</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t21</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t1</span> | [<span class="id" type="var">u_eq_t2</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">t2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t22</span> :: <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t22</span> :: <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q22</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>;<br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> ((<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">canonical_form</span> <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_flatten</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_nil</span> <span class="id" type="keyword">with</span> <span class="id" type="var">term</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t22</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t1</span> | [<span class="id" type="var">u_eq_t21</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>, <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">t2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q22</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> ((<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">canonical_form</span> <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P1</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q21</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="var">exists</span> <span class="id" type="var">t11</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t12</span> | [<span class="id" type="var">u_eq_t2</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>, <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q12</span>; <br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> ((<span class="id" type="var">canonical_form</span> <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t12</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t11</span> | [<span class="id" type="var">u_eq_t2</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>, <span class="id" type="var">th_eq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: <span class="id" type="var">t11</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: <span class="id" type="var">t11</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">P2</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q11</span>;<br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> ((<span class="id" type="var">canonical_form</span> <span class="id" type="var">t11</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>));<br/>
<span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t12</span> | [<span class="id" type="var">u_eq_t22</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t11</span> | [<span class="id" type="var">u_eq_t21</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>) :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> ::  <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> ::  <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t21</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t11</span>:: <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t12</span> :: <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q12</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q22</span>.<br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">t12</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">t22</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q11</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q21</span>.<br/>
<span class="id" type="tactic">transitivity</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">t11</span> :: <span class="id" type="var">nil</span>) ++  <span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">t21</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">assert</span> ( <span class="id" type="var">Ll</span> := <span class="id" type="var">list_permut.permut_length</span> <span class="id" type="var">P'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">P'</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; [<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ll</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ll</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ll</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ll</span>;<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">syntactic_dec</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">a3</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k1</span> <span class="id" type="var">k4</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span>  (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k1</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span>  (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span>  (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k1</span>-&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span>  (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">ac</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">IH</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">k1</span> <span class="id" type="var">k4</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P3</span> <span class="id" type="var">P4</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">commutativity</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">a3</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k2</span> -&gt;<br/>
&nbsp;<span class="id" type="var">ac</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">IH</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P3</span> <span class="id" type="var">P4</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span>  (<span class="id" type="var">a2</span> :: <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">associativity</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="keyword">forall</span>  <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a3</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a3</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a4</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k4</span>, <span class="id" type="var">k1</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k2</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k4</span> = <span class="id" type="var">nil</span> \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">k2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k4</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span>  (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k2</span> ++ <span class="id" type="var">k4</span>) -&gt;<br/>
&nbsp;<span class="id" type="var">ac</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">IH</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k4</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h1</span> <span class="id" type="var">k1</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h2</span> <span class="id" type="var">k2</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k4</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h4</span> <span class="id" type="var">k4</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P3</span> <span class="id" type="var">P4</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">P1</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">Wt1</span> [<span class="id" type="var">Wt2</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span>]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">P4</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk2'</span> | [<span class="id" type="var">Hk4</span> | [<span class="id" type="var">t2'</span> [<span class="id" type="var">t4</span> [<span class="id" type="var">Wt2'</span> [<span class="id" type="var">Wt4</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">Q2'</span> <span class="id" type="var">Q4</span>]]]]]]]]; <br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Q4</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wt24</span> : <span class="id" type="var">well_formed</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t2</span> | [<span class="id" type="var">u_eq_t4</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Q1</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q4</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">swap_left</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="keyword">forall</span>  <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a3</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a3</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a4</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">k4</span>, <span class="id" type="var">k2</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k3</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k4</span> = <span class="id" type="var">nil</span> \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k3</span> ++ <span class="id" type="var">k4</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k2</span> ++ <span class="id" type="var">k4</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">ac</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">IH</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">k4</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h2</span> <span class="id" type="var">k2</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k3</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h3</span> <span class="id" type="var">k3</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k4</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h4</span> <span class="id" type="var">k4</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P3</span> <span class="id" type="var">P4</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">P2</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">t3</span> [<span class="id" type="var">t4</span> [<span class="id" type="var">Wt3</span> [<span class="id" type="var">Wt4</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">Q3</span> <span class="id" type="var">Q4</span>]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">P4</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk2'</span> | [<span class="id" type="var">Hk4</span> | [<span class="id" type="var">t2'</span> [<span class="id" type="var">t4'</span> [<span class="id" type="var">Wt2'</span> [<span class="id" type="var">Wt4'</span> [<span class="id" type="var">H4</span> [<span class="id" type="var">Q2'</span> <span class="id" type="var">Q4'</span>]]]]]]]]; <br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Q2'</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2'</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: <span class="id" type="var">t2'</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wt24</span> : <span class="id" type="var">well_formed</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2'</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t2'</span> | [<span class="id" type="var">u_eq_t4</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Q3</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q2'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q4</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">swap_right</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="keyword">forall</span>  <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a3</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a3</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a4</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span>, <span class="id" type="var">k1</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k2</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k3</span> = <span class="id" type="var">nil</span> \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">k2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k3</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">k3</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="var">k2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">ac</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">IH</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h1</span> <span class="id" type="var">k1</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>]; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h2</span> <span class="id" type="var">k2</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k3</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h3</span> <span class="id" type="var">k3</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P3</span> <span class="id" type="var">P4</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">P1</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">Wt1</span> [<span class="id" type="var">Wt2</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span>]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">P3</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1'</span> | [<span class="id" type="var">Hk3</span> | [<span class="id" type="var">t1'</span> [<span class="id" type="var">t3</span> [<span class="id" type="var">Wt1'</span> [<span class="id" type="var">Wt3</span> [<span class="id" type="var">H3</span> [<span class="id" type="var">Q1'</span> <span class="id" type="var">Q3</span>]]]]]]]]; <br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Q3</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wt13</span> : <span class="id" type="var">well_formed</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t1</span> | [<span class="id" type="var">u_eq_t3</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q3</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Q2</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">middle_commutativity</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">n</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="keyword">forall</span>  <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a3</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a3</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">size</span> <span class="id" type="var">a4</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">a4</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">k4</span>, <span class="id" type="var">k1</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k2</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k3</span> = <span class="id" type="var">nil</span> \/ <span class="id" type="var">k4</span> = <span class="id" type="var">nil</span> \/<br/>
&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">k2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k3</span> ++ <span class="id" type="var">k4</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k1</span> ++ <span class="id" type="var">k3</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">k2</span> ++ <span class="id" type="var">k4</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">ac</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">IH</span> <span class="id" type="var">f</span> <span class="id" type="var">Af</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">a4</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">k4</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h1</span> <span class="id" type="var">k1</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>]; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h2</span> <span class="id" type="var">k2</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k3</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h3</span> <span class="id" type="var">k3</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>]; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k4</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h4</span> <span class="id" type="var">k4</span>]; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P3</span> <span class="id" type="var">P4</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">P1</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">t1</span> [<span class="id" type="var">t2</span> [<span class="id" type="var">Wt1</span> [<span class="id" type="var">Wt2</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span>]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">P2</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk3</span> | [<span class="id" type="var">Hk4</span> | [<span class="id" type="var">t3</span> [<span class="id" type="var">t4</span> [<span class="id" type="var">Wt3</span> [<span class="id" type="var">Wt4</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">Q3</span> <span class="id" type="var">Q4</span>]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">P3</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1'</span> | [<span class="id" type="var">Hk3'</span> | [<span class="id" type="var">t1'</span> [<span class="id" type="var">t3'</span> [<span class="id" type="var">Wt1'</span> [<span class="id" type="var">Wt3'</span> [<span class="id" type="var">H3</span> [<span class="id" type="var">Q1'</span> <span class="id" type="var">Q3'</span>]]]]]]]];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_cf</span> <span class="id" type="var">Af</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">P4</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk2'</span> | [<span class="id" type="var">Hk4'</span> | [<span class="id" type="var">t2'</span> [<span class="id" type="var">t4'</span> [<span class="id" type="var">Wt2'</span> [<span class="id" type="var">Wt4'</span> [<span class="id" type="var">H4</span> [<span class="id" type="var">Q2'</span> <span class="id" type="var">Q4'</span>]]]]]]]]; <br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span>  (<span class="id" type="var">t2</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span>  ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span>  ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t3</span> :: <span class="id" type="var">t2</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span>  (<span class="id" type="var">t3</span> :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">l_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>)) :: (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">r_assoc</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>)) :: <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wt13</span> : <span class="id" type="var">well_formed</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">t3</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t1</span> | [<span class="id" type="var">u_eq_t3</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q3</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wt24</span> : <span class="id" type="var">well_formed</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">t4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_fold</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t2</span> | [<span class="id" type="var">u_eq_t4</span> | <span class="id" type="var">In_u_nil</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Q4</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">length</span> (<span class="id" type="var">A</span>:=term))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">permut</span> ==&gt; (@<span class="id" type="var">eq</span> <span class="id" type="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">length_morph</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut.permut_length</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">cf_eq_ac</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">well_formed</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">well_formed</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">canonical_form</span> <span class="id" type="var">t1</span> = <span class="id" type="var">canonical_form</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">St1</span>; <span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">v1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>] <span class="id" type="var">St1</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f</span> <span class="id" type="var">l2</span>] <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">H</span>;<br/>
[<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span> | <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">discriminate</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">St2</span> : <span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) &lt;= <span class="id" type="var">S</span> <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">size_size</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">size_size</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">f1_eq_f</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f1</span>; <span class="id" type="var">destruct_arity</span> <span class="id" type="var">f</span> <span class="id" type="var">m</span> <span class="id" type="var">Af</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl1</span> <span class="id" type="var">Ll1</span>];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl2</span> <span class="id" type="var">Ll2</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">absurd</span> (0=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">absurd</span> (1=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a3</span> <span class="id" type="var">l1</span>]; [<span class="id" type="tactic">clear</span> <span class="id" type="var">Ll1</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">length</span> <span class="id" type="var">l1</span>)))=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a3</span> <span class="id" type="var">l2</span>]; [<span class="id" type="var">absurd</span> (0=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a4</span> <span class="id" type="var">l2</span>]; [<span class="id" type="var">absurd</span> (1=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a5</span> <span class="id" type="var">l2</span>]; [<span class="id" type="tactic">clear</span> <span class="id" type="var">Ll2</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)))=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>];<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa1</span> := <span class="id" type="var">Wl1</span> <span class="id" type="var">a1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)));<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa2</span> := <span class="id" type="var">Wl1</span> <span class="id" type="var">a2</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))));<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa3</span> := <span class="id" type="var">Wl2</span> <span class="id" type="var">a3</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)));<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa4</span> := <span class="id" type="var">Wl2</span> <span class="id" type="var">a4</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))));<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_0_r</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St1</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_0_r</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa1</span> : <span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a1</span> + <span class="id" type="var">size</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa2</span> : <span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a1</span> + <span class="id" type="var">size</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa3</span> : <span class="id" type="var">size</span> <span class="id" type="var">a3</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a3</span> + <span class="id" type="var">size</span> <span class="id" type="var">a4</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa4</span> : <span class="id" type="var">size</span> <span class="id" type="var">a4</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a3</span> + <span class="id" type="var">size</span> <span class="id" type="var">a4</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">elim</span> (<span class="id" type="var">ac_syntactic</span> <br/>
(<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>))<br/>
(<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>))<br/>
(<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span> :: <span class="id" type="var">nil</span>))<br/>
(<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k3</span> [<span class="id" type="var">k4</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P3</span> <span class="id" type="var">P4</span>]]]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h1</span> <span class="id" type="var">k1</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">k4</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h4</span> <span class="id" type="var">k4</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">commutativity</span> <span class="id" type="keyword">with</span> <span class="id" type="var">n</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span>; <span class="id" type="tactic">trivial</span>;<br/>
[<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span> | <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P4</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">swap_left</span> <span class="id" type="var">IHn</span> <span class="id" type="var">Af</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> <br/>
<span class="id" type="var">k2</span> <span class="id" type="var">k3</span> (<span class="id" type="var">h4</span> :: <span class="id" type="var">k4</span>)); <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">Hk3</span> | [<span class="id" type="var">Hk4</span> | <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_size_aux3</span> <span class="id" type="var">Af</span> <span class="id" type="var">Wa1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">intro</span>;<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_size_aux3</span> <span class="id" type="var">Af</span> <span class="id" type="var">Wa3</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">intro</span>;<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">swap_right</span> <span class="id" type="var">IHn</span> <span class="id" type="var">Af</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> <br/>
(<span class="id" type="var">h1</span> :: <span class="id" type="var">k1</span>) <span class="id" type="var">k2</span> <span class="id" type="var">k3</span>);<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">Hk3</span> | <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_size_aux3</span> <span class="id" type="var">Af</span> <span class="id" type="var">Wa4</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P4</span>; <span class="id" type="tactic">intro</span>;<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">size_size_aux3</span> <span class="id" type="var">Af</span> <span class="id" type="var">Wa2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">intro</span>;<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P4</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h2</span> <span class="id" type="var">k2</span>]; <span class="id" type="tactic">destruct</span> <span class="id" type="var">k3</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">h3</span> <span class="id" type="var">k3</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">syntactic_dec</span> <span class="id" type="var">IHn</span> <span class="id" type="var">Af</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">P3</span> <span class="id" type="var">P4</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">associativity</span> <span class="id" type="var">IHn</span> <span class="id" type="var">Af</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <br/>
(<span class="id" type="var">h1</span>::k1) (<span class="id" type="var">h3</span> :: <span class="id" type="var">k3</span>) (<span class="id" type="var">h4</span>::k4));<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk3</span> | [<span class="id" type="var">Hk4</span> | <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">associativity</span> <span class="id" type="var">IHn</span> <span class="id" type="var">Af</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span> (<span class="id" type="var">h1</span>::k1) (<span class="id" type="var">h2</span> :: <span class="id" type="var">k2</span>) (<span class="id" type="var">h4</span>::k4)).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">Hk4</span> | <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P3</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">middle_commutativity</span> <span class="id" type="var">IHn</span> <span class="id" type="var">Af</span> <span class="id" type="var">Sa1</span> <span class="id" type="var">Wa1</span> <span class="id" type="var">Sa2</span> <span class="id" type="var">Wa2</span> <span class="id" type="var">Sa3</span> <span class="id" type="var">Wa3</span> <span class="id" type="var">Sa4</span> <span class="id" type="var">Wa4</span><br/>
(<span class="id" type="var">h1</span> :: <span class="id" type="var">k1</span>) (<span class="id" type="var">h2</span> :: <span class="id" type="var">k2</span>) (<span class="id" type="var">h3</span> :: <span class="id" type="var">k3</span>) (<span class="id" type="var">h4</span> :: <span class="id" type="var">k4</span>));<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">Hk1</span> | [<span class="id" type="var">Hk2</span> | [<span class="id" type="var">Hk3</span> | [<span class="id" type="var">Hk4</span> | <span class="id" type="var">H'</span>]]]].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">map</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>);<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> <span class="id" type="var">_</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>));<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">quick_permut</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl1</span> <span class="id" type="var">Ll1</span>];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl2</span> <span class="id" type="var">Ll2</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">absurd</span> (0=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>]; [<span class="id" type="var">absurd</span> (1=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a3</span> <span class="id" type="var">l1</span>]; [<span class="id" type="tactic">clear</span> <span class="id" type="var">Ll1</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">length</span> <span class="id" type="var">l1</span>)))=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a3</span> <span class="id" type="var">l2</span>]; [<span class="id" type="var">absurd</span> (0=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a4</span> <span class="id" type="var">l2</span>]; [<span class="id" type="var">absurd</span> (1=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span> | <span class="id" type="var">idtac</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a5</span> <span class="id" type="var">l2</span>]; [<span class="id" type="tactic">clear</span> <span class="id" type="var">Ll2</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)))=2); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>];<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa1</span> := <span class="id" type="var">Wl1</span> <span class="id" type="var">a1</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)));<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa2</span> := <span class="id" type="var">Wl1</span> <span class="id" type="var">a2</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))));<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa3</span> := <span class="id" type="var">Wl2</span> <span class="id" type="var">a3</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)));<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wa4</span> := <span class="id" type="var">Wl2</span> <span class="id" type="var">a4</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))));<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_0_r</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St1</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_0_r</span> <span class="id" type="keyword">in</span> <span class="id" type="var">St2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa1</span> : <span class="id" type="var">size</span> <span class="id" type="var">a1</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a1</span> + <span class="id" type="var">size</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa2</span> : <span class="id" type="var">size</span> <span class="id" type="var">a2</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a1</span> + <span class="id" type="var">size</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa3</span> : <span class="id" type="var">size</span> <span class="id" type="var">a3</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a3</span> + <span class="id" type="var">size</span> <span class="id" type="var">a4</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sa4</span> : <span class="id" type="var">size</span> <span class="id" type="var">a4</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">a3</span> + <span class="id" type="var">size</span> <span class="id" type="var">a4</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">elim</span> (@<span class="id" type="var">list_permut.permut_length_2</span> <span class="id" type="var">_</span> <span class="id" type="var">term</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">term</span>) (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a1</span>) (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a2</span>)<br/>
(<span class="id" type="var">canonical_form</span> <span class="id" type="var">a3</span>) (<span class="id" type="var">canonical_form</span> <span class="id" type="var">a4</span>)).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">D1</span> <span class="id" type="var">D2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">C1</span> <span class="id" type="var">C2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">comm</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">a3</span> :: <span class="id" type="var">a1</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> <span class="id" type="var">nil</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">context_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f</span> (<span class="id" type="var">_</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">quicksort</span> (<span class="id" type="var">map</span> <span class="id" type="var">canonical_form</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)));<br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span> |  <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">auto</span> ].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac</span>, <span class="id" type="var">th_eq</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">list_eq_bool</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_diff_l2</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">th_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt1</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl1</span> <span class="id" type="var">_</span>];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_unfold</span> <span class="id" type="var">Wt2</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl2</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span>, <span class="id" type="var">In</span> <span class="id" type="var">t1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">t1</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">In_t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">lt_le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">Wl2</span> <span class="id" type="var">l1_diff_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">St1</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">St2</span> <span class="id" type="var">H</span> <span class="id" type="var">Wl2</span> <span class="id" type="var">l1_diff_l2</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">Wl2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : <span class="id" type="var">ac</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Sl1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Wl2</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">list_eq_bool</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_diff_l2</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l1</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">sym_refl</span> <span class="id" type="var">ac_one_step_at_top</span>))) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Sl1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Wl2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>