<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>list_extensions.dickson</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library list_extensions.dickson</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>

<br/>
</div>

<div class="doc">
 *Dickson Lemma: the multiset extension of a well-founded ordering is well-founded.
 
</div>
<div class="code">

<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Multiset</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">list_permut</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">ordered_set</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span> :=<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> : <span class="id" type="var">a</span> = <span class="id" type="var">b</span>); [<span class="id" type="tactic">exact</span> <span class="id" type="var">a_eq_b</span> | <span class="id" type="tactic">clear</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">rename</span> <span class="id" type="var">Dummy</span> <span class="id" type="var">into</span> <span class="id" type="var">a_eq_b</span>].<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">D</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">DS</span> : <span class="id" type="var">decidable_set.S</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">LP</span> : <span class="id" type="var">list_permut.S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Definition</span> <span class="id" type="var">EDS.A</span> := <span class="id" type="var">DS.A</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="keyword">Definition</span> <span class="id" type="var">EDS.eq_A</span> := (@<span class="id" type="var">eq</span> <span class="id" type="var">DS.A</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab1"></a><h2 class="section">Definition of the multiset extension of a relation.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">multiset_extension_step</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) : <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">rmv_case</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">multiset_extension_step</span></span> is compatible with permutation. 
</div>
<div class="code">
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">list_permut_multiset_extension_step_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">list_permut_multiset_extension_step_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l2</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Parametric</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) : (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span>  <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">iff</span> <br/>
&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">mult_morph</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab2"></a><h3 class="section">Accessibility lemmata.</h3>

</div>
<div class="code">
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">list_permut_acc</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l2</span>.<br/>

<br/>
</div>

<div class="doc">
Main lemma. 
</div>
<div class="code">
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">dickson</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">well_founded</span> <span class="id" type="var">R</span> -&gt; <span class="id" type="var">well_founded</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">dickson_strong</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">context_trans_clos_multiset_extension_step_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>).<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">consn</span> (<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)) : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">e</span>,_) :: <span class="id" type="var">ll</span> =&gt; <span class="id" type="var">e</span>:: (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">appendn</span> (<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)) : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">_</span>,l) :: <span class="id" type="var">ll</span> =&gt; <span class="id" type="var">l</span> ++ (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">multiset_closure</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, {<span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>}+{~R <span class="id" type="var">x</span> <span class="id" type="var">y</span>}) -&gt; <span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">p</span> <span class="id" type="var">q</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">l</span>, <span class="id" type="var">exists</span> <span class="id" type="var">pq</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">p</span> ((<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) /\<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">q</span> ((<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) /\<br/>
&nbsp;&nbsp;<span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">nil</span> /\<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">la</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">l</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) /\<br/>
&nbsp;&nbsp;((<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~R <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">False</span>).<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">D</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">DS1</span> : <span class="id" type="var">decidable_set.S</span>).<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">DS</span> := <span class="id" type="var">decidable_set.Convert</span> (<span class="id" type="var">DS1</span>).<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">LP</span> := <span class="id" type="var">list_permut.Make</span> (<span class="id" type="var">DS</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab3"></a><h2 class="section">Definition of the multiset extension of a relation.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">multiset_extension_step</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) : <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">rmv_case</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>

<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" type="var">multiset_extension_step</span></span> is compatible with permutation. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut_multiset_extension_step_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">P</span> <span class="id" type="var">M1</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">M1</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">k1</span> <span class="id" type="var">k</span> <span class="id" type="var">l1'</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span> <span class="id" type="var">la_R_a</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">rmv_case</span> (<span class="id" type="var">l1</span>:=l2) (<span class="id" type="var">l2</span>:=l) (<span class="id" type="var">l</span>:=l1') <span class="id" type="var">R</span> <span class="id" type="var">la</span> <span class="id" type="var">la_R_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut_multiset_extension_step_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">P</span> <span class="id" type="var">M1</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">M1</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">k1</span> <span class="id" type="var">k</span> <span class="id" type="var">l1'</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span> <span class="id" type="var">la_R_a</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">rmv_case</span> (<span class="id" type="var">l1</span>:=l) (<span class="id" type="var">l2</span>:=l2) (<span class="id" type="var">l</span>:=l1') <span class="id" type="var">R</span> <span class="id" type="var">la</span> <span class="id" type="var">la_R_a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Parametric</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) : (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span>  <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">iff</span> <br/>
&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">mult_morph</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P12</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">P34</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">intro</span> <span class="id" type="var">R13</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">R24</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l4</span>; <span class="id" type="tactic">auto</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If n &lt;&lt; {a} U m, then 
      either, there exists n' such that n = {a} U n' and n' &lt;&lt; m,
      or, there exists k, such that n = k U m, and k &lt;&lt; {a}. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">two_cases</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">m</span> <span class="id" type="var">n</span>, <br/>
&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">n</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>) -&gt;<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">n'</span>, <span class="id" type="var">permut</span> <span class="id" type="var">n</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">n'</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">n'</span> <span class="id" type="var">m</span>) \/<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">k</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">k</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">n</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">m</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">m</span> <span class="id" type="var">n</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">M</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span> <span class="id" type="var">b</span> <span class="id" type="var">H</span> <span class="id" type="var">H0</span> <span class="id" type="var">H1</span>];<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">DS1.eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">b</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_b</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>)].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> <span class="id" type="var">la</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">auto</span>.<br/>

<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_is_sound</span> <span class="id" type="var">b</span> <span class="id" type="var">m</span>); <span class="id" type="tactic">case</span> (@<span class="id" type="var">remove</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">b</span> <span class="id" type="var">m</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">m'</span> <span class="id" type="var">P</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">m'</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> <span class="id" type="var">H0</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">m'</span>).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">permut_app1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_cons</span> <span class="id" type="var">b</span> <span class="id" type="var">b</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">m'</span>) <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">permut_cons_inside</span> (<span class="id" type="var">e1</span> := <span class="id" type="var">a</span>) (<span class="id" type="var">e2</span> := <span class="id" type="var">a</span>) <span class="id" type="var">m</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">m'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">permut_cons_inside</span> (<span class="id" type="var">e1</span> := <span class="id" type="var">a</span>) (<span class="id" type="var">e2</span> := <span class="id" type="var">a</span>) (<span class="id" type="var">la</span> ++ <span class="id" type="var">m'</span>) <span class="id" type="var">la</span> <span class="id" type="var">m'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">rmv_case</span> (<span class="id" type="var">l1</span>:=la ++ <span class="id" type="var">m'</span>) (<span class="id" type="var">l2</span>:= <span class="id" type="var">m</span>) (<span class="id" type="var">l</span>:= <span class="id" type="var">m'</span>) <span class="id" type="var">R</span> <span class="id" type="var">la</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">auto</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">b_not_mem_m</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">b_mem_am</span> : <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> <span class="id" type="var">H1</span>); <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_mem_am</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">b_mem_am</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">b_mem_am</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_diff_b</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">b_not_mem_m</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab4"></a><h3 class="section">Accessibility lemmata.</h3>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut_acc</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Meq</span> <span class="id" type="var">A1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">M2</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">A1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dickson_aux1</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">a</span>,<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">b</span> :: <span class="id" type="var">m</span>)) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m</span> -&gt; <br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">m'</span>, (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m'</span> <span class="id" type="var">m</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">m'</span>)) -&gt;<br/>
&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">IH2_a</span> <span class="id" type="var">m</span> <span class="id" type="var">Acc_m</span> <span class="id" type="var">IHa_M</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">elim</span> (<span class="id" type="var">two_cases</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">n'</span> [<span class="id" type="var">P</span> <span class="id" type="var">M</span>]]; <span class="id" type="tactic">refine</span> (<span class="id" type="var">list_permut_acc</span> <span class="id" type="var">P</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">IHa_M</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">k</span> [<span class="id" type="var">M</span> <span class="id" type="var">P</span>]]; <span class="id" type="tactic">refine</span> (<span class="id" type="var">list_permut_acc</span> <span class="id" type="var">P</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH2_a</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">M</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHk</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">M</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dickson_aux2</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">m</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">b</span> :: <span class="id" type="var">m</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">m</span> <span class="id" type="var">Acc_m</span> <span class="id" type="var">a</span> <span class="id" type="var">IH2_a</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Acc_iter</span>  (<span class="id" type="var">R</span>:= <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>)<br/>
(<span class="id" type="keyword">fun</span> <span class="id" type="var">m</span> =&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m</span> -&gt; <br/>
<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>))); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">m</span> <span class="id" type="var">Acc_m</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">m</span> <span class="id" type="var">H</span> <span class="id" type="var">Acc_m</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">dickson_aux1</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">m</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dickson_aux3</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span>, <span class="id" type="var">Acc</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m</span> -&gt;<br/>
<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">Acc_a</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Acc_iter</span>  (<span class="id" type="var">R</span>:= <span class="id" type="var">R</span>)<br/>
(<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">m</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">m</span> -&gt; <br/>
<span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">m</span>))); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">a</span> <span class="id" type="var">Acc_a</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">H</span> <span class="id" type="var">Acc_a</span> <span class="id" type="var">m</span> <span class="id" type="var">Acc_m</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">dickson_aux2</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
</div>

<div class="doc">
Main lemma. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dickson</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">well_founded</span> <span class="id" type="var">R</span> -&gt; <span class="id" type="var">well_founded</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Wf_R</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">well_founded</span> <span class="id" type="keyword">in</span> *;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">m</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">m</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">m</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">m</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span> = <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut_nil</span> (<span class="id" type="var">R</span> := <span class="id" type="var">eq_A</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">dickson_aux3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dickson_strong</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">m</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">m</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">m</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">m</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span> = <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut_nil</span> (<span class="id" type="var">R</span> := <span class="id" type="var">eq_A</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">dickson_aux3</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHm</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab5"></a><h2 class="section">More results on transitive closure of mult_step</h2>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut_trans_clos_multiset_extension_step_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">l2</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l</span> <span class="id" type="var">P</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut_trans_clos_multiset_extension_step_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">l</span> <span class="id" type="var">l1</span> -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">l</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l3</span> <span class="id" type="var">l</span> <span class="id" type="var">P</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_multiset_extension_step_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l12</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span> <span class="id" type="var">H</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rmv_case</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span>++l1) (<span class="id" type="var">l</span>++l2) (<span class="id" type="var">l</span>++l12) <span class="id" type="var">la</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">la</span> ++ <span class="id" type="var">l12</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l12</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_trans_clos_multiset_extension_step_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">context_multiset_extension_step_app1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">y</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_multiset_extension_step_app1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_multiset_extension_step_cons</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~R <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_l1</span> <span class="id" type="var">a_l2</span> <span class="id" type="var">lc</span> <span class="id" type="var">lb</span> <span class="id" type="var">b</span> <span class="id" type="var">H'</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a_mem_blc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cons_permut_mem</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_mem_blc</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a_mem_blc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_b</span> | <span class="id" type="var">a_mem_lc</span>].<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span>;<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">a_mem_lb_lc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">lb</span> ++ <span class="id" type="var">lc</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">cons_permut_mem</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_mem_lb_lc</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_mem_lb_lc</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_mem_lb</span> | <span class="id" type="var">a_mem_lc</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>); [<span class="id" type="tactic">apply</span> (<span class="id" type="var">irrefl_R</span> <span class="id" type="var">a</span>) | <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_mem_lc</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">lc'</span> [<span class="id" type="var">lc''</span> [<span class="id" type="var">a_eq_a'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a_eq_a'</span>;<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span> <span class="id" type="var">lc</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">rmv_case</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span>:=l1) (<span class="id" type="var">l2</span>:= <span class="id" type="var">l2</span>) (<span class="id" type="var">l</span>:=lc' ++ <span class="id" type="var">lc''</span>) <span class="id" type="var">lb</span> (<span class="id" type="var">a</span>:=a)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">permut_cons_inside</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">permut_cons_inside</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>

<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_mem_lc</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">lc'</span> [<span class="id" type="var">lc''</span> [<span class="id" type="var">a_eq_a'</span> [<span class="id" type="var">H''</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a_eq_a'</span>;<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span> <span class="id" type="var">lc</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">rmv_case</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span>:=l1) (<span class="id" type="var">l2</span>:= <span class="id" type="var">l2</span>) (<span class="id" type="var">l</span>:=lc' ++ <span class="id" type="var">lc''</span>) <span class="id" type="var">lb</span> (<span class="id" type="var">a</span>:=b)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">permut_cons_inside</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">permut_cons_inside</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">simpl</span>  <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_context_multiset_extension_step_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>,  (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~R <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_2</span> <span class="id" type="keyword">with</span> ((<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_multiset_extension_step_1</span> <span class="id" type="keyword">with</span> ((<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) ++ <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_multiset_extension_step_cons</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_multiset_extension_step_app2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l12</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span> <span class="id" type="var">H</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>].<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">rmv_case</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span>++l) (<span class="id" type="var">l2</span>++l) (<span class="id" type="var">l12</span>++l) <span class="id" type="var">la</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">consn</span> (<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)) : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">e</span>,_) :: <span class="id" type="var">ll</span> =&gt; <span class="id" type="var">e</span>:: (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_consn</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">ll</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>) &lt;-&gt; <span class="id" type="var">exists</span> <span class="id" type="var">la</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">ll</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">ll</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>) <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">b</span> <span class="id" type="var">lb</span> <span class="id" type="var">ll</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_b</span> | <span class="id" type="var">a_in_cnsl</span>].<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">a_eq_b</span>;<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">lb</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a_in_cnsl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">la</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">la</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">la</span> [<span class="id" type="var">ala_eq_blb</span> | <span class="id" type="var">ala_in_ll</span>]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">ala_eq_blb</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">exists</span> <span class="id" type="var">la</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">consn_app</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span>, <span class="id" type="var">consn</span> (<span class="id" type="var">ll1</span> ++ <span class="id" type="var">ll2</span>) = <span class="id" type="var">consn</span> <span class="id" type="var">ll1</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">ll2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a</span> <span class="id" type="var">la</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHll1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">appendn</span> (<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)) : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">_</span>,l) :: <span class="id" type="var">ll</span> =&gt; <span class="id" type="var">l</span> ++ (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">appendn_app</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span>, <span class="id" type="var">appendn</span> (<span class="id" type="var">ll1</span> ++ <span class="id" type="var">ll2</span>) = <span class="id" type="var">appendn</span> <span class="id" type="var">ll1</span> ++ <span class="id" type="var">appendn</span> <span class="id" type="var">ll2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a</span> <span class="id" type="var">la</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHll1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_appendn</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">ll</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>) -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>, <span class="id" type="var">exists</span> <span class="id" type="var">lb</span>, <span class="id" type="var">In</span> (<span class="id" type="var">b</span>,lb) <span class="id" type="var">ll</span> /\ <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">lb</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">ll</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>) <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">b</span> <span class="id" type="var">lb</span> <span class="id" type="var">ll</span> <span class="id" type="var">H2</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_mem_lb</span> | <span class="id" type="var">a_mem_appl</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">lb</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">a_mem_appl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">c</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]; <br/>
<span class="id" type="var">exists</span> <span class="id" type="var">c</span>; <span class="id" type="var">exists</span> <span class="id" type="var">lc</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">multiset_closure_aux</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">l</span> <span class="id" type="var">pq</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">p</span> ((<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">q</span> ((<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">nil</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">la</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">l</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">p</span> <span class="id" type="var">q</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">x</span> <span class="id" type="var">lx</span>] <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">pq</span> <span class="id" type="var">Pp</span> <span class="id" type="var">Pq</span> <span class="id" type="var">H</span>; <span class="id" type="var">absurd</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>) = <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">pq</span> <span class="id" type="var">Pp</span> <span class="id" type="var">Pq</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">lx_lt_x</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">lx</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">x</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">y</span> <span class="id" type="var">ly</span>] <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pp</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">rmv_case</span> <span class="id" type="var">R</span> <span class="id" type="var">lx</span> <span class="id" type="var">lx_lt_x</span> <span class="id" type="var">Pp</span> <span class="id" type="var">Pq</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">x</span> :: <span class="id" type="var">ly</span> ++ (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pp</span>;<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">rmv_case</span> <span class="id" type="var">R</span> <span class="id" type="var">lx</span> <span class="id" type="var">lx_lt_x</span> <span class="id" type="var">Pp</span> (<span class="id" type="var">permut_refl</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">list_permut_trans_clos_multiset_extension_step_2</span>  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut_sym</span> <span class="id" type="var">Pq</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">context_trans_clos_multiset_extension_step_app1</span> <span class="id" type="var">R</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">ly</span> ++ <span class="id" type="var">appendn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">pq</span>) (<span class="id" type="var">y</span> :: <span class="id" type="var">consn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">pq</span>) (<span class="id" type="var">x</span> :: <span class="id" type="var">nil</span>)); <br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">IHl</span> (<span class="id" type="var">ly</span> ++ <span class="id" type="var">appendn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">pq</span>) (<span class="id" type="var">y</span> :: <span class="id" type="var">consn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">pq</span>) <span class="id" type="var">pq</span>); <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span> <span class="id" type="var">H1</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_la</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">multiset_closure_aux2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">le</span> <span class="id" type="var">l</span> <span class="id" type="var">pq</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">p</span> ((<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">q</span> (<span class="id" type="var">le</span> ++ (<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">nil</span> \/ <span class="id" type="var">le</span> &lt;&gt; <span class="id" type="var">nil</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">la</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">l</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">p</span> <span class="id" type="var">q</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">le</span> <span class="id" type="var">l</span> <span class="id" type="var">pq</span> <span class="id" type="var">Pp</span> <span class="id" type="var">Pq</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">multiset_closure_aux</span> <span class="id" type="var">R</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span> ((<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">x</span> =&gt; (<span class="id" type="var">x</span>, @<span class="id" type="var">nil</span> <span class="id" type="var">A</span>)) <span class="id" type="var">le</span>) ++ <span class="id" type="var">l</span>) <span class="id" type="var">pq</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">pq</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Pq</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">le</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">le</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">le</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">pq</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Pq</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">le</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">le</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">app_eq_nil</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H''</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">l_eq_nil</span> <span class="id" type="var">le_eq_nil</span>];<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">le_diff_nil</span> | <span class="id" type="var">l_diff_nil</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">l</span> = <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">le</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">le</span>].<br/>
<span class="id" type="var">absurd</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span> = <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Pq</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">le</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">le</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>] <span class="id" type="var">b</span> <span class="id" type="var">b_in_la</span>; <br/>
[<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">contradiction</span> | <span class="id" type="tactic">apply</span> (<span class="id" type="var">IHle</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span>); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">LDS</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">A</span> := (<span class="id" type="var">A</span> * (<span class="id" type="var">list</span> <span class="id" type="var">A</span>))%type.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq_A</span> := @<span class="id" type="var">eq</span> <span class="id" type="var">A</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_proof</span> : <span class="id" type="var">equivalence</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_A</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">eq_A</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">a3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Relation</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_A</span> <br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">Relation_Definitions.equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">EQA</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">eq_bool_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>: <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l1</span>, <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span>, (<span class="id" type="var">_</span> :: <span class="id" type="var">_</span>) =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>), <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>), (<span class="id" type="var">a2</span> :: <span class="id" type="var">l2</span>) =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">DS1.eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">then</span> <span class="id" type="var">eq_bool_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">else</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">al1</span> <span class="id" type="var">al2</span> : <span class="id" type="var">bool</span> :=  <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">al1</span>, <span class="id" type="var">al2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">e1</span>,l1), (<span class="id" type="var">e2</span>,l2) =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">DS1.eq_bool</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="keyword">then</span> <span class="id" type="var">eq_bool_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">else</span> <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_bool_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">al1</span> <span class="id" type="var">al2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">al1</span> <span class="id" type="var">al2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">al1</span> = <span class="id" type="var">al2</span> | <span class="id" type="var">false</span> =&gt; ~al1 = <span class="id" type="var">al2</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">e1</span> <span class="id" type="var">l1</span>] [<span class="id" type="var">e2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">DS1.eq_bool_ok</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">DS1.eq_bool</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">e1_eq_e2</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">e1_diff_e2</span>].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> :  <span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">l1</span> = <span class="id" type="var">l2</span> | <span class="id" type="var">false</span> =&gt; ~l1 = <span class="id" type="var">l2</span> <span class="id" type="keyword">end</span>).<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>] [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">DS1.eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">DS1.eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_eq_a2</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">a1_diff_a2</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok0</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_diff_l2</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l1_diff_l2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_diff_a2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool_list</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_eq_l2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_diff_l2</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l1_diff_l2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">e1_diff_e2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">LDS</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">LEDS</span> := <span class="id" type="var">decidable_set.Convert</span>(<span class="id" type="var">LDS</span>).<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">LLP</span> := <span class="id" type="var">list_permut.Make</span> (<span class="id" type="var">LEDS</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_consn</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span>, <span class="id" type="var">LLP.permut</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll1</span>) (<span class="id" type="var">consn</span> <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a</span> <span class="id" type="var">la</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">ll2</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_nil</span> (<span class="id" type="var">LLP.permut_sym</span> <span class="id" type="var">P</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ala_in_ll2</span> : <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">ala_in_ll2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll2'</span> [<span class="id" type="var">ll2''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">LLP.permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHll1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">LEDS.eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_appendn</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span>, <span class="id" type="var">LLP.permut</span> <span class="id" type="var">ll1</span> <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll1</span>) (<span class="id" type="var">appendn</span> <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a</span> <span class="id" type="var">la</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">ll2</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_nil</span> (<span class="id" type="var">LLP.permut_sym</span> <span class="id" type="var">P</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ala_in_ll2</span> : <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">in_permut_in</span> <span class="id" type="var">P</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">ala_in_ll2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll2'</span> [<span class="id" type="var">ll2''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> <span class="id" type="var">_</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> <span class="id" type="var">_</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHll1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">LLP.permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">LEDS.eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">multiset_closure_aux3</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">lc</span> <span class="id" type="var">cns</span>, <span class="id" type="var">permut</span> (<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) (<span class="id" type="var">lc</span> ++ <span class="id" type="var">cns</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, <span class="id" type="var">exists</span> <span class="id" type="var">ll'</span>,  <span class="id" type="var">LLP.permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">ll</span> ++ <span class="id" type="var">ll'</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>)  <span class="id" type="var">lc</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll'</span>) <span class="id" type="var">cns</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">consnl</span> <span class="id" type="var">lccns</span>, <span class="id" type="var">permut</span> <span class="id" type="var">consnl</span> <span class="id" type="var">lccns</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">lc</span> <span class="id" type="var">cns</span> ,  <span class="id" type="var">consnl</span> = <span class="id" type="var">consn</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">lccns</span> = <span class="id" type="var">lc</span> ++ <span class="id" type="var">cns</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, <span class="id" type="var">exists</span> <span class="id" type="var">ll'</span>,  <span class="id" type="var">LLP.permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">ll</span> ++ <span class="id" type="var">ll'</span>) /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>)  <span class="id" type="var">lc</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll'</span>) <span class="id" type="var">cns</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">consnl</span> <span class="id" type="var">lccns</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">a1'</span> <span class="id" type="var">consnl</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span> <span class="id" type="var">P</span>].<br/>
<span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">a1</span> <span class="id" type="var">l1</span>] <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">c</span> <span class="id" type="var">lc</span>].<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">c'</span> <span class="id" type="var">cns</span>] <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)); <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">cns</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">lc</span> <span class="id" type="var">cns</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">b1</span> <span class="id" type="var">l1</span>] <span class="id" type="var">l</span>] <span class="id" type="var">lc</span> <span class="id" type="var">cns</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">split_list</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span> [[<span class="id" type="var">k</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]] | [<span class="id" type="var">k</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHP</span> <span class="id" type="var">l</span> <span class="id" type="var">lc</span> (<span class="id" type="var">k</span> ++ <span class="id" type="var">k2</span>) (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">ll'</span> [<span class="id" type="var">Q1</span> [<span class="id" type="var">Q2</span> <span class="id" type="var">Q3</span>]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">b1</span>,l1) :: <span class="id" type="var">ll'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">LLP.permut_cons_inside</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">k'</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H4</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHP</span> <span class="id" type="var">l</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>) (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">ll'</span> [<span class="id" type="var">Q1</span> [<span class="id" type="var">Q2</span> <span class="id" type="var">Q3</span>]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">ll</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">b1</span>,l1) :: <span class="id" type="var">ll'</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">LLP.permut_cons_inside</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">a</span> <span class="id" type="var">k2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IH</span> := <span class="id" type="var">IHP</span> <span class="id" type="var">l</span> (<span class="id" type="var">k1</span> ++ <span class="id" type="var">k'</span>) <span class="id" type="var">cns</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">ll'</span> [<span class="id" type="var">Q1</span> [<span class="id" type="var">Q2</span> <span class="id" type="var">Q3</span>]]]].<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">b1</span>, <span class="id" type="var">l1</span>) :: <span class="id" type="var">ll</span>); <span class="id" type="var">exists</span> <span class="id" type="var">ll'</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">LLP.permut_cons</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">lc</span> <span class="id" type="var">cns</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> (<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) (<span class="id" type="var">lc</span> ++ <span class="id" type="var">cns</span>) <span class="id" type="var">P</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>) (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">multiset_closure</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">p</span> <span class="id" type="var">q</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">l</span>, <span class="id" type="var">exists</span> <span class="id" type="var">pq</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">p</span> ((<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) /\<br/>
&nbsp;&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">q</span> ((<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">pq</span>) /\<br/>
&nbsp;&nbsp;<span class="id" type="var">l</span> &lt;&gt; <span class="id" type="var">nil</span> /\<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="keyword">forall</span> <span class="id" type="var">la</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">l</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) /\<br/>
&nbsp;&nbsp;((<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~R <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">False</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">p_lt_q</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">p_lt_q</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">p_lt_q</span> | <span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">r</span> <span class="id" type="var">p_lt_q</span> <span class="id" type="var">q_lt_r</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">p_lt_q</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">pq</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span> <span class="id" type="var">la_lt_a</span> <span class="id" type="var">Pp</span> <span class="id" type="var">Pq</span>].<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">a</span>,la) :: <span class="id" type="var">nil</span>); <span class="id" type="var">exists</span> <span class="id" type="var">pq</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>] <span class="id" type="var">b</span> <span class="id" type="var">b_in_lx</span>; <br/>
[<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">b</span> [<span class="id" type="var">a_eq_b</span> | <span class="id" type="var">Abs</span>] <span class="id" type="var">b_in_la</span>.<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> <span class="id" type="var">a_eq_b</span>;<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">irrefl_R</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">p_lt_q</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> <span class="id" type="var">q</span> <span class="id" type="var">pq</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span> <span class="id" type="var">la_lt_a</span> <span class="id" type="var">Pp</span> <span class="id" type="var">Pq</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHq_lt_r</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">qr</span> [<span class="id" type="var">Pq'</span> [<span class="id" type="var">Pr</span> [<span class="id" type="var">l_diff_nil</span> [<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">app_disj_cns</span>]]]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a_in_appl_qr</span> : <span class="id" type="var">mem</span> <span class="id" type="var">EDS.eq_A</span> <span class="id" type="var">a</span> ((<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>) ++ <span class="id" type="var">qr</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">Pq'</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">permut_sym</span> <span class="id" type="var">Pq</span>))).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_in_appl_qr</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">EDS.eq_bool_ok</span> <span class="id" type="var">a</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">DS1.eq_bool</span> <span class="id" type="var">a</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_appl</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_not_in_appl</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_appendn</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_appl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> [<span class="id" type="var">lx</span> [<span class="id" type="var">xlx_in_l</span> <span class="id" type="var">a_in_lx</span>]]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_lx</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">lx'</span> [<span class="id" type="var">lx''</span> [<span class="id" type="var">a_eq_a'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">lx</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">xlx_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>; <span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">rewrite</span> &lt;-  <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">permut_sym</span> <span class="id" type="var">Pq</span>) <span class="id" type="var">Pq'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">Pq'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Pq'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_is_sound</span> (<span class="id" type="var">consn</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">l''</span>)) <span class="id" type="var">la</span>).<br/>
<span class="id" type="tactic">destruct</span> (@<span class="id" type="var">remove_equiv</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_bool</span>  (<span class="id" type="var">consn</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">l''</span>)) <span class="id" type="var">la</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">cns</span> <span class="id" type="var">la'</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">Pcns</span> [<span class="id" type="var">Pla</span> <span class="id" type="var">cns_disj_la'</span>]]];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">multiset_closure_aux3</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">l''</span>) <span class="id" type="var">lc</span> <span class="id" type="var">cns</span> <span class="id" type="var">Pcns</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">ll'</span> [<span class="id" type="var">P'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]];<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">x</span>, <span class="id" type="var">lx'</span> ++ <span class="id" type="var">lx''</span> ++ <span class="id" type="var">la'</span> ++ (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>)) :: <span class="id" type="var">ll'</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">lc</span> ++ <span class="id" type="var">qr</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">pq</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> ((<span class="id" type="var">lc</span> ++ <span class="id" type="var">la'</span>) ++ <span class="id" type="var">pq</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> ((<span class="id" type="var">lc</span> ++ <span class="id" type="var">la'</span>) ++ (<span class="id" type="var">appendn</span> <span class="id" type="var">l'</span> ++ <span class="id" type="var">lx'</span> ++ <span class="id" type="var">lx''</span> ++ <span class="id" type="var">appendn</span> <span class="id" type="var">l''</span> ++ <span class="id" type="var">qr</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">do</span> 5 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> <span class="id" type="var">_</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="tactic">do</span> 5 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_appendn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">consn</span> (<span class="id" type="var">l'</span> ++ (<span class="id" type="var">x</span>, <span class="id" type="var">lx'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">lx''</span>) :: <span class="id" type="var">l''</span>) ++ <span class="id" type="var">qr</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">cns</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">consn</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">l''</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> <span class="id" type="var">ly</span> [<span class="id" type="var">yly_eq_xly</span> | <span class="id" type="var">yly_in_ll''</span>] <span class="id" type="var">b</span> <span class="id" type="var">b_in_ly</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">yly_eq_xly</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">y</span> <span class="id" type="var">ly</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">yly_eq_xly</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_ly</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_ly</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_ly</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_lx</span> | <span class="id" type="var">b_in_la_app</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> (<span class="id" type="var">lx'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">lx''</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_la_app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_la_app</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_la</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> <span class="id" type="var">Pla</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> (<span class="id" type="var">lx'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">lx''</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_appendn</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">b_in_app</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">y</span> [<span class="id" type="var">ly</span> [<span class="id" type="var">yly_in_ll</span> <span class="id" type="var">b_in_ly</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">y</span> <span class="id" type="var">ly</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_permut.in_permut_in</span> <span class="id" type="var">P'</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">y_in_lc</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">y</span> <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">y</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_consn</span>; <span class="id" type="var">exists</span> <span class="id" type="var">ly</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">y</span> <span class="id" type="var">Pla</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> (<span class="id" type="var">lx'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">lx''</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">y</span> <span class="id" type="var">ly</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_permut.in_permut_in</span> <span class="id" type="var">P'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">b</span> [<span class="id" type="var">x_eq_b</span> | <span class="id" type="var">b_in_cns</span>] <span class="id" type="var">b_in_lx_la_app</span>;<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_lx_la_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_lx_la_app</span>.<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">b</span> <span class="id" type="var">x</span> <span class="id" type="var">x_eq_b</span>;<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_lx_la_app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_lx_la_app</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_lx_la</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_lx_la</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_lx_la</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_lx</span> | <span class="id" type="var">b_in_la</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">irrefl_R</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> (<span class="id" type="var">lx'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">lx''</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">irrefl_R</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">x</span> <span class="id" type="var">Pla</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> (<span class="id" type="var">lx'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">lx''</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_disj_cns</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">x</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">appendn_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">x</span> (<span class="id" type="var">permut_appendn</span> <span class="id" type="var">P'</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_app</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_app</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_lx_la_app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_lx_la_app</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_lx_la</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_lx_la</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_lx_la</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_lx</span> | <span class="id" type="var">b_in_la</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_disj_cns</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">consn_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> (<span class="id" type="var">permut_consn</span> <span class="id" type="var">P'</span>));<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">cns_disj_la'</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> <span class="id" type="var">H2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_disj_cns</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> (<span class="id" type="var">permut_consn</span> <span class="id" type="var">P'</span>));<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">appendn_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> (<span class="id" type="var">permut_appendn</span> <span class="id" type="var">P'</span>)) <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_app</span>; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_app</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_app</span> | <span class="id" type="var">b_in_app</span>];<br/>
[<span class="id" type="var">left</span> | <span class="id" type="tactic">simpl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a_in_qr</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">qr</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_in_appl_qr</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_in_appl</span> | <span class="id" type="var">a_in_qr</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_qr</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">qr'</span> [<span class="id" type="var">qr''</span> [<span class="id" type="var">a_eq_a'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">qr</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">permut_sym</span> <span class="id" type="var">Pq</span>) <span class="id" type="var">Pq'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">Pq'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Pq'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Pq'</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_is_sound</span> (<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) <span class="id" type="var">la</span>);<br/>
<span class="id" type="tactic">destruct</span> (@<span class="id" type="var">remove_equiv</span> <span class="id" type="var">A</span> <span class="id" type="var">eq_bool</span> (<span class="id" type="var">consn</span> <span class="id" type="var">l</span>) <span class="id" type="var">la</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">cns</span> <span class="id" type="var">la'</span>];<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">Pcns</span> [<span class="id" type="var">Pla</span> <span class="id" type="var">cns_disj_la'</span>]]];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">multiset_closure_aux3</span> <span class="id" type="var">l</span> <span class="id" type="var">lc</span> <span class="id" type="var">cns</span> <span class="id" type="var">Pcns</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">ll'</span> [<span class="id" type="var">P'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]].<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">a</span>, <span class="id" type="var">la'</span> ++ (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>)) :: <span class="id" type="var">ll'</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">lc</span> ++ (<span class="id" type="var">qr'</span> ++ <span class="id" type="var">qr''</span>)); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">la</span> ++ <span class="id" type="var">pq</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">la</span> ++ (<span class="id" type="var">appendn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">qr'</span> ++ <span class="id" type="var">qr''</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">do</span> 4 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> ((<span class="id" type="var">lc</span> ++ <span class="id" type="var">la'</span>) ++ <span class="id" type="var">appendn</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>);<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_appendn</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">consn</span> <span class="id" type="var">l</span> ++ <span class="id" type="var">qr'</span> ++ <span class="id" type="var">a'</span> :: <span class="id" type="var">qr''</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>;<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll'</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_consn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">LLP.permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">ll</span> ++ <span class="id" type="var">ll'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">LLP.list_permut_app_app</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">LLP.permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> <span class="id" type="var">ly</span> [<span class="id" type="var">yly_eq_aly</span> | <span class="id" type="var">yly_in_ll'</span>] <span class="id" type="var">b</span> <span class="id" type="var">b_in_ly</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">yly_eq_aly</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">y</span> <span class="id" type="var">ly</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">yly_eq_aly</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_ly</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_ly</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_la'</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> <span class="id" type="var">Pla</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_appendn</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">b_in_app</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">z</span> [<span class="id" type="var">lz</span> [<span class="id" type="var">zlz_in_ll</span> <span class="id" type="var">b_in_lz</span>]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">z</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">z</span> <span class="id" type="var">lz</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_permut.in_permut_in</span> <span class="id" type="var">P'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">z</span> <span class="id" type="var">Pla</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">z</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_consn</span>; <span class="id" type="var">exists</span> <span class="id" type="var">lz</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">y</span> <span class="id" type="var">ly</span>); <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_permut.in_permut_in</span> <span class="id" type="var">P'</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">irrefl_R</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_a_cns</span> <span class="id" type="var">b_in_la_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_la_app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_la_app</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_la</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_a_cns</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_cns</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_la</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_la</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_la'</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">irrefl_R</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">Pla</span>); <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> <span class="id" type="var">b_eq_a</span>;<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_appendn</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">b_in_app</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">z</span> [<span class="id" type="var">lz</span> [<span class="id" type="var">zlz_in_ll</span> <span class="id" type="var">b_in_lz</span>]]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">irrefl_R</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">z</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">z</span> <span class="id" type="var">lz</span>); <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_permut.in_permut_in</span> <span class="id" type="var">P'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">z</span> <span class="id" type="var">Pla</span>); <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">z</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">mem_consn</span>; <span class="id" type="var">exists</span> <span class="id" type="var">lz</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">b_in_la</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_la</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_in_la'</span> | <span class="id" type="var">b_in_app</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">cns_disj_la'</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> <span class="id" type="var">H2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_disj_cns</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> (<span class="id" type="var">permut_consn</span> <span class="id" type="var">P'</span>)); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> (<span class="id" type="var">permut_appendn</span> <span class="id" type="var">P'</span>)); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">b_in_a_cns</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_cns</span>].<br/>
<span class="id" type="var">dummy</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> <span class="id" type="var">b_eq_a</span>;<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">a_not_in_appl</span>;<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">permut_appendn</span> <span class="id" type="var">P'</span>));<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_disj_cns</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> (<span class="id" type="var">permut_consn</span> <span class="id" type="var">P'</span>)); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">b</span> (<span class="id" type="var">permut_appendn</span> <span class="id" type="var">P'</span>)); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_trans_clos_multiset_extension_step_cons</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~R <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">a</span> :: <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">multiset_closure</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">q</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">p_diff_nil</span> [<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">cns_disj_app</span>]]]]]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">q</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">DS1.eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">q</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_q</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_not_in_q</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_q</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">q'</span> [<span class="id" type="var">q''</span> [<span class="id" type="var">a_eq_a'</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">q</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">multiset_closure_aux</span> <span class="id" type="var">R</span> (<span class="id" type="var">q'</span> ++ <span class="id" type="var">q''</span>) <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">p_diff_nil</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a''</span> <span class="id" type="var">la</span> <span class="id" type="var">ala'_in_ll</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">app_lt_cns</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">cns_disj_app</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a_in_cns_ll_q</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">q</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">P2</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_in_cns_ll_q</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_in_cns_ll_q</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_in_cns_ll</span> | <span class="id" type="var">a_in_q</span>]; <br/>
[<span class="id" type="tactic">trivial</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">q</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intro</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a_in_app_ll_q</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">q</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">P1</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a_in_app_ll_q</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a_in_app_ll_q</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a_in_app_ll</span> | <span class="id" type="var">a_in_q</span>]; <br/>
[<span class="id" type="tactic">trivial</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">q</span>); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_context_trans_clos_multiset_extension_step_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, <span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~R <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_trans_clos_multiset_extension_step_cons</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nil_is_the_smallest</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">nil</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">e'</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">e'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">refine</span> (@<span class="id" type="var">rmv_case</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">nil</span> <span class="id" type="var">nil</span> <span class="id" type="var">e</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">auto</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">e'</span> :: <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">refine</span> (@<span class="id" type="var">rmv_case</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">e'</span> :: <span class="id" type="var">l</span>) <span class="id" type="var">nil</span> <span class="id" type="var">e</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">permut_cons_inside</span> (<span class="id" type="var">e1</span> := <span class="id" type="var">e'</span>) (<span class="id" type="var">e2</span> := <span class="id" type="var">e'</span>) (<span class="id" type="var">e</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">e</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Mult</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R_bool_ok</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">R_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">true</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">false</span> =&gt; ~ <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">mult</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">comp</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">nil</span>, <span class="id" type="var">nil</span>) =&gt; <span class="id" type="var">Equivalent</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">l1</span>, <span class="id" type="var">l2</span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>) <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Greater_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">false</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="var">l2</span>) <span class="id" type="var">l1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">true</span> =&gt; <span class="id" type="var">Less_than</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">false</span> =&gt; <span class="id" type="var">Uncomparable</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">greater_case</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>) <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span> = <span class="id" type="var">true</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">le</span>, <span class="id" type="var">exists</span> <span class="id" type="var">ll</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">le</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span>  <span class="id" type="var">l2</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span>, <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,la) <span class="id" type="var">ll</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">b</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">b</span> <span class="id" type="var">la</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>);  <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1</span>); <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> (<span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_exists_is_sound</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">t1</span>) <span class="id" type="var">l1</span>);<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">t1</span>) <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">proj1</span> <span class="id" type="var">H</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a1</span> [<span class="id" type="var">a1_in_l1</span> <span class="id" type="var">a2_R_a1</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a2_R_a1'</span> : <span class="id" type="var">R</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">R_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a2_R_a1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">A</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">False</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_l1</span> <span class="id" type="var">x_in_l2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">E</span> <span class="id" type="var">x</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">greater_case</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> <span class="id" type="var">E'</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>) <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">case_eq</span> <span class="id" type="var">l1</span>; [<span class="id" type="tactic">intros</span> <span class="id" type="var">l1_eq_nil</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">b1</span> <span class="id" type="var">k1</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">le</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">app_lt_cns</span>]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a1_mem_cns_ll_le</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a1</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">le</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a1</span> <span class="id" type="var">P1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_mem_cns_ll_le</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">a1_mem_cns_ll_le</span>; [<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_mem_cns_ll</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a1_mem_le</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">mem_consn</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">a1_mem_cns_ll</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">la</span> <span class="id" type="var">ala_in_ll</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">ala_in_ll</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">ll'</span> [<span class="id" type="var">ll''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">ll</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">le</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">ll'</span> ++ (<span class="id" type="var">a1</span>, <span class="id" type="var">a2</span> :: <span class="id" type="var">la</span>) :: <span class="id" type="var">ll''</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">consn_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">appendn_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span> <span class="id" type="var">xlx_in_ll</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_lx</span>;<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">xlx_in_ll</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">xlx_ll'</span> | <span class="id" type="tactic">intros</span> [<span class="id" type="var">xlx_eq_a1la</span> | <span class="id" type="var">xlx_in_ll''</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">xlx_eq_a1la</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">b_in_lx</span>; [<span class="id" type="tactic">intros</span> <span class="id" type="var">b_eq_a2</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">b_in_la</span>];<br/>
&nbsp;[<span class="id" type="var">dummy</span> <span class="id" type="var">b</span> <span class="id" type="var">a2</span> <span class="id" type="var">b_eq_a2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">b</span> | <span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">a1</span> <span class="id" type="var">la</span>)]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_mem_le</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">a1'</span> [<span class="id" type="var">le'</span> [<span class="id" type="var">le''</span> [<span class="id" type="var">a1_eq_a1'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_eq_a1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">le</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">le'</span> ++ <span class="id" type="var">le''</span>); <span class="id" type="var">exists</span> ((<span class="id" type="var">a1</span>, <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>) :: <span class="id" type="var">ll</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">le'</span> ++ <span class="id" type="var">a1'</span> :: <span class="id" type="var">le''</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span> [<span class="id" type="var">xlx_eq_a1_e2</span> | <span class="id" type="var">xlx_in_ll</span>] <span class="id" type="var">b</span> <span class="id" type="var">b_in_lx</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">xlx_eq_a1_e2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span>;<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">b_in_lx</span>; [<span class="id" type="tactic">intros</span> <span class="id" type="var">b_eq_e2</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">Abs</span>]; <br/>
[<span class="id" type="var">dummy</span> <span class="id" type="var">b</span> <span class="id" type="var">a2</span> <span class="id" type="var">b_eq_e2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">x</span> <span class="id" type="var">lx</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">list_forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">A</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Bool.ifb</span> (<span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">a2</span>) <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="var">l2</span>)) <span class="id" type="var">l1</span>); <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">list_forall</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">A</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Bool.ifb</span> (<span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">a2</span>) <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="var">l2</span>)) <span class="id" type="var">l1</span>); <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_is_sound</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">mult</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Equivalent</span> =&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Less_than</span> =&gt; <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Greater_than</span> =&gt; <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mult</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_is_sound</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">case</span> (@<span class="id" type="var">remove_equiv</span> <span class="id" type="var">DS1.A</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> [<span class="id" type="var">l</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">E</span>]]].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k1</span>; [ <span class="id" type="var">idtac</span>| <span class="id" type="tactic">intros</span> <span class="id" type="var">e1'</span> <span class="id" type="var">l1'</span>]; (<span class="id" type="tactic">case</span> <span class="id" type="var">k2</span>; [ <span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">e2'</span> <span class="id" type="var">l2'</span>]); <span class="id" type="tactic">intros</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">E</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">multiset_closure_aux2</span> <span class="id" type="var">R</span> (<span class="id" type="var">p</span> := <span class="id" type="var">l1</span>) (<span class="id" type="var">q</span> := <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">le</span> := <span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>) (<span class="id" type="var">l</span> := <span class="id" type="var">nil</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">multiset_closure_aux2</span> <span class="id" type="var">R</span> (<span class="id" type="var">p</span> := <span class="id" type="var">l2</span>) (<span class="id" type="var">q</span> := <span class="id" type="var">l1</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">le</span> := <span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>) (<span class="id" type="var">l</span> := <span class="id" type="var">nil</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">greater_case</span> (<span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>) (<span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>) <span class="id" type="var">E</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">DS1.A</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">DS1.A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>)) (<span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">le</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">P1'</span> [<span class="id" type="var">P2'</span> <span class="id" type="var">app_lt_cns</span>]]]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">multiset_closure_aux2</span> <span class="id" type="var">R</span> (<span class="id" type="var">p</span> := <span class="id" type="var">l2</span>) (<span class="id" type="var">q</span> := <span class="id" type="var">l1</span>) (<span class="id" type="var">le</span> := <span class="id" type="var">le</span>)  (<span class="id" type="var">l</span> := <span class="id" type="var">ll</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">le</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">le</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ass_app</span> <span class="id" type="var">le</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">x</span> <span class="id" type="var">lx</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">le</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">le</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">permut_length</span> <span class="id" type="var">P1'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span>; <br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">S</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1'</span>) = 0); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">DS1.A</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> (<span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> (<span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>) -&gt; <span class="id" type="var">False</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">H2</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">E</span> <span class="id" type="var">x</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">greater_case</span> (<span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>) (<span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>) <span class="id" type="var">E'</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> *;<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">DS1.A</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">DS1.A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>)) (<span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">le</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">P2'</span> [<span class="id" type="var">P1'</span> <span class="id" type="var">app_lt_cns</span>]]]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">multiset_closure_aux2</span> <span class="id" type="var">R</span> (<span class="id" type="var">p</span> := <span class="id" type="var">l1</span>) (<span class="id" type="var">q</span> := <span class="id" type="var">l2</span>) (<span class="id" type="var">le</span> := <span class="id" type="var">le</span>)  (<span class="id" type="var">l</span> := <span class="id" type="var">ll</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">e1'</span> :: <span class="id" type="var">l1'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">e2'</span> :: <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">le</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">le</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">ass_app</span> <span class="id" type="var">le</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">x</span> <span class="id" type="var">lx</span>] <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">le</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e</span> <span class="id" type="var">le</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">permut_length</span> <span class="id" type="var">P2'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span>; <br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">S</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2'</span>) = 0); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_is_complete_equiv</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mult</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Equivalent</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P1</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P2</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">A</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">nil</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">nil</span> -&gt; <span class="id" type="var">False</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">generalize</span> (@<span class="id" type="var">remove_equiv_is_complete</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> <span class="id" type="var">nil</span> <span class="id" type="var">nil</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">E</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mult</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">case</span> (@<span class="id" type="var">remove_equiv</span> <span class="id" type="var">DS1.A</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> [<span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span>].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q1</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_nil</span> <span class="id" type="var">Q1</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_nil</span> <span class="id" type="var">Q2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_is_complete_greater_aux</span> :<br/>
&nbsp;<span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>) <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span>) = <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2_disj_l1</span> <span class="id" type="var">ll2_lt_ll1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">l2_lt_l1</span> := <span class="id" type="var">remove_context_trans_clos_multiset_extension_step_app1</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l</span> <span class="id" type="var">ll2_lt_ll1</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">ll2_lt_ll1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">multiset_closure</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">l2_lt_l1</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">ll_diff_nil</span> [<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">cns_disj_app</span>]]]]]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">cns_disj_app</span> <span class="id" type="var">irrefl_R</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">cns_disj_app</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">cns_disj_app</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">lc_eq_nil</span> : <span class="id" type="var">lc</span> = <span class="id" type="var">nil</span>).<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">P2</span> <span class="id" type="var">P1</span> <span class="id" type="var">cns_disj_app</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">lc</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">lc</span>; [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">c</span> <span class="id" type="var">lc</span> <span class="id" type="var">P2</span> <span class="id" type="var">P1</span> <span class="id" type="var">cns_disj_app</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">l2_disj_l1</span> <span class="id" type="var">c</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">c</span> <span class="id" type="var">P1</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">c</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">lc</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Compat</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">ta</span> <span class="id" type="var">ta'</span> <span class="id" type="var">tb</span> <span class="id" type="var">tb'</span> : <span class="id" type="var">A</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">ta</span> <span class="id" type="var">tb</span> -&gt; <span class="id" type="var">eq_A</span> <span class="id" type="var">ta'</span> <span class="id" type="var">tb'</span> -&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">ta</span> <span class="id" type="var">ta'</span> = <span class="id" type="var">R_bool</span> <span class="id" type="var">tb</span> <span class="id" type="var">tb'</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">eq_A</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">b'</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="var">b_eq_b'</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_list_forall_exists</span> <span class="id" type="var">R_bool</span> <span class="id" type="var">R_bool</span> <span class="id" type="var">Compat</span> <span class="id" type="var">P2</span> <span class="id" type="var">P1</span>); <br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Compat</span> <span class="id" type="var">cns_disj_app</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">ll_diff_nil</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a</span> <span class="id" type="var">la</span>] <span class="id" type="var">ll</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_forall_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Bool.andb_true_iff</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">la</span> (<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">a</span> <span class="id" type="var">la</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)));<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">la</span> <span class="id" type="var">app_lt_cns</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">la</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">la</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b</span> <span class="id" type="var">la</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">R_bool_ok</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">R_bool</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">b_R_a</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">not_b_R_a</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHla</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_b_R_a</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">la_lt_a</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_forall_impl</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">A</span> =&gt;  <span class="id" type="var">Bool.ifb</span> (<span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">a</span>) <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">b_in_all</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">R_bool</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">simpl</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHll</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">lb</span> <span class="id" type="var">blb_in_ll</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">app_lt_cns</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_irrefl</span> :<br/>
&nbsp;<span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l</span> <span class="id" type="var">l_lt_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">app_nil_end</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">l_lt_l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">nil_lt_nil</span> := <span class="id" type="var">remove_context_trans_clos_multiset_extension_step_app1</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">nil</span> <span class="id" type="var">nil</span> <span class="id" type="var">l</span> <span class="id" type="var">l_lt_l</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">l_lt_l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">l2</span> = <span class="id" type="var">nil</span> -&gt; <span class="id" type="var">False</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">T</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span> | <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">la</span> <span class="id" type="var">a</span> <span class="id" type="var">la_lt_a</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">permut_length</span> <span class="id" type="var">P2</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHH2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">nil_lt_nil</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_is_complete_greater</span> :<br/>
&nbsp;<span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">mult</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Greater_than</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2_lt_l1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_is_sound</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">mult</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span> [<span class="id" type="var">l</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">k1_disj_k2</span>]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">lk2_lt_lk1</span> : <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">k2</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">k1</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_trans_clos_multiset_extension_step_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_trans_clos_multiset_extension_step_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> := @<span class="id" type="var">mult_is_complete_greater_aux</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">k1_disj_k2</span> <span class="id" type="var">lk2_lt_lk1</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Dummy</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Dummy</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Dummy</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">lk2_lt_lk1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k1</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">k2</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">T</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mult_irrefl</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">T</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_is_complete_less_than</span> :<br/>
&nbsp;<span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mult</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> = <span class="id" type="var">Less_than</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1_lt_l2</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">multiset_closure</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">l1_lt_l2</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">lc</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">ll_diff_nil</span> [<span class="id" type="var">app_lt_cns</span> <span class="id" type="var">disj</span>]]]]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">cns_disj_app</span> := <span class="id" type="var">disj</span> <span class="id" type="var">irrefl_R</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">disj</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q1</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">lc</span> ++ <span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_swapp</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q2</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">lc</span> ++ <span class="id" type="var">consn</span> <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_swapp</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">app_disj_cns</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">A</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span>) -&gt; <span class="id" type="var">False</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_app</span> <span class="id" type="var">x_in_cns</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">cns_disj_app</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_is_complete</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span> <span class="id" type="var">app_disj_cns</span>) (<span class="id" type="var">mult_is_sound</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mult</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">case</span> (@<span class="id" type="var">remove_equiv</span> <span class="id" type="var">DS1.A</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> [<span class="id" type="var">Q1'</span> <span class="id" type="var">Q2'</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> := <span class="id" type="var">mult_is_complete_greater_aux</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">lc</span> <span class="id" type="var">k2</span> <span class="id" type="var">k1</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">A</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Dummy</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Dummy</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Dummy</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">ll_diff_nil</span> <span class="id" type="var">Q1'</span> <span class="id" type="var">Q2'</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">k1</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">k2</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">ll</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">ll_diff_nil</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ll_diff_nil</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> <span class="id" type="var">la</span>] <span class="id" type="var">ll'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Q2'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> := <span class="id" type="var">permut_length</span> <span class="id" type="var">Q2'</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">k1</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">k1</span> <span class="id" type="var">ll_diff_nil</span> <span class="id" type="var">Q1'</span> <span class="id" type="var">Q2'</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">DS1.A</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">DS1.A</span> =&gt; <span class="id" type="var">R_bool</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">a1</span> :: <span class="id" type="var">k1</span>)) <span class="id" type="var">k2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2_lt_l1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">mult_irrefl</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_k2</span> <span class="id" type="var">x_in_k1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">cns_disj_app</span> <span class="id" type="var">x</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">x</span> <span class="id" type="var">Q2'</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">x</span> <span class="id" type="var">Q1'</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_trans_clos_multiset_extension_step_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">k1</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">appendn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_swapp</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_trans_clos_multiset_extension_step_2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">k2</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">consn</span> <span class="id" type="var">ll</span> ++ <span class="id" type="var">lc</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_swapp</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mult_is_complete</span> : <br/>
&nbsp;<span class="id" type="var">transitive</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">mult</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Uncomparable</span> =&gt; ~ <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~trans_clos (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;~trans_clos (<span class="id" type="var">multiset_extension_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mult_is_sound</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) (@<span class="id" type="var">mult_is_complete_equiv</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(@<span class="id" type="var">mult_is_complete_greater</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) (@<span class="id" type="var">mult_is_complete_less_than</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">irrefl_R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mult</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H1</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H3</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H2</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Mult</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">NatMul</span> := <span class="id" type="var">Make</span> (<span class="id" type="var">ordered_set.Nat</span>).<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>