<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>list_extensions.list_permut</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library list_extensions.list_permut</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>

<br/>
</div>

<div class="doc">
<a name="lab6"></a><h1 class="section">Permutation over lists, and finite multisets.</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">decidable_set</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equiv_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">permut0</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) : (<span class="id" type="var">list</span> <span class="id" type="var">A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Pnil</span> : <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">nil</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Pcons</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_nil</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">nil</span> -&gt; <span class="id" type="var">l</span> = <span class="id" type="var">nil</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">P'</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_impl</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> <span class="id" type="var">R'</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">R'</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>) -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">R'</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">Compat</span> <span class="id" type="var">P</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">k</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Compat</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_strong</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span> <span class="id" type="var">k1</span> <span class="id" type="var">l2</span> <span class="id" type="var">k2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">k1</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">k2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a1</span> :: <span class="id" type="var">k1</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">k2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u1</span> <span class="id" type="var">l1</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">l2</span> <span class="id" type="var">k2</span> <span class="id" type="var">a1_R_a2</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">k1</span> <span class="id" type="var">l2</span> <span class="id" type="var">k2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">b1</span> <span class="id" type="var">b2</span> <span class="id" type="var">l</span> <span class="id" type="var">k</span> <span class="id" type="var">k'</span> <span class="id" type="var">b1_R_b2</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_list</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q'</span> := @<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">u1</span> <span class="id" type="var">b2</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a1</span> :: <span class="id" type="var">k1</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">l</span>) <span class="id" type="var">k'</span> <span class="id" type="var">b1_R_b2</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Q'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q'</span> := @<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">u1</span> <span class="id" type="var">b2</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a1</span> :: <span class="id" type="var">k1</span>) (<span class="id" type="var">k</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>) <span class="id" type="var">k'</span> <span class="id" type="var">b1_R_b2</span>).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Q'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H2</span> <span class="id" type="var">b2_eq_u</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">u</span> <span class="id" type="var">k'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q'</span> := @<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">u1</span> <span class="id" type="var">b2</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a1</span> :: <span class="id" type="var">k1</span>) <span class="id" type="var">k</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">k2</span>) <span class="id" type="var">b1_R_b2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Q'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_inv_left_strong</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">a</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l1''</span>) <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2''</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">l2</span> = <span class="id" type="var">l2'</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2''</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">l1''</span>) (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">l1'</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">a</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1'</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2'</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l2''</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1'</span> <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a1_R_b</span> <span class="id" type="var">Q</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Q</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">b'</span> [<span class="id" type="var">k2'</span> [<span class="id" type="var">k2''</span> [<span class="id" type="var">a_R_b'</span> [<span class="id" type="var">H</span> <span class="id" type="var">Q'</span>]]]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Q</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_list</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [[ | <span class="id" type="var">b''</span> <span class="id" type="var">l</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">k2'</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">nil</span>); <span class="id" type="var">exists</span> <span class="id" type="var">k2''</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b''</span>; <span class="id" type="var">exists</span> <span class="id" type="var">k2'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2''</span>); <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">b'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l</span>); <span class="id" type="var">exists</span> <span class="id" type="var">k2''</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_inv_right</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">b</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> (<span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1''</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">l1</span> = <span class="id" type="var">l1'</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l1''</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">l1''</span>) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">b</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">a_R_b'</span> <span class="id" type="var">Q</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1'</span> <span class="id" type="var">l1'</span>]; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Q</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> [<span class="id" type="var">k1'</span> [<span class="id" type="var">k1''</span> [<span class="id" type="var">a_R_b</span> [<span class="id" type="var">H</span> <span class="id" type="var">Q'</span>]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">k1'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">k1''</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b'</span> (<span class="id" type="var">k1'</span> ++ <span class="id" type="var">k1''</span>) <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_inv_right_strong</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">b</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2''</span>) -&gt; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1''</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">l1</span> = <span class="id" type="var">l1'</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l1''</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">l1''</span>) (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">b</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">k2</span> <span class="id" type="var">a_R_b'</span> <span class="id" type="var">Q</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_in_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">H2'</span> | <span class="id" type="var">H2'</span>] | <span class="id" type="var">H2'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Q</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l1''</span> [<span class="id" type="var">a_R_b</span> [<span class="id" type="var">H</span> <span class="id" type="var">Q'</span>]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">l1'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l1''</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Q</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Q</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> [<span class="id" type="var">k1'</span> [<span class="id" type="var">k1''</span> [<span class="id" type="var">a_R_b</span> [<span class="id" type="var">H</span> <span class="id" type="var">Q'</span>]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">k1'</span>); <span class="id" type="var">exists</span> <span class="id" type="var">k1''</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b'_eq_b</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a1</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_rev</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut0</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">permut_strong</span> <span class="id" type="var">B</span> <span class="id" type="var">A</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>) <span class="id" type="var">b</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">_</span>) <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Permutation is compatible with length. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_length</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span> = <span class="id" type="var">length</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">length_app</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_refl</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span>) -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">refl_R</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span class="id" type="var">nil</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_R</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_R</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_sym</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">b</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">sym_R</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut_strong</span> (<span class="id" type="var">R</span> := <span class="id" type="var">R</span>) <span class="id" type="var">b</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>) <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sym_R</span>; <span class="id" type="tactic">trivial</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_R</span>; <span class="id" type="tactic">trivial</span>; [<span class="id" type="var">right</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_trans</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span>,<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">b</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">c</span> <span class="id" type="var">l3</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">c</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l3</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l3</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_right</span> <span class="id" type="var">P1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a1</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l1''</span> [<span class="id" type="var">a1_R_a2</span> [<span class="id" type="var">H</span> <span class="id" type="var">Q1</span>]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2'</span> <span class="id" type="var">a3</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l3'</span> <span class="id" type="var">l3''</span> <span class="id" type="var">a2_R_a3</span> <span class="id" type="var">Q2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_cons_inside</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span>, <span class="id" type="var">In</span> <span class="id" type="var">a1</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">b1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">a2</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">b2</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a2</span> <span class="id" type="var">b1</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_right_strong</span> (<span class="id" type="var">R</span> := <span class="id" type="var">R</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l1''</span> [<span class="id" type="var">a'_R_b</span> [<span class="id" type="var">H</span> <span class="id" type="var">P'</span>]]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1'</span> <span class="id" type="var">l1'</span>]; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a''</span> <span class="id" type="var">b'</span> <span class="id" type="var">l'</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k2'</span> <span class="id" type="var">a''_R_b'</span> <span class="id" type="var">P''</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">b</span> <span class="id" type="var">a1'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_add_inside</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span>, <span class="id" type="var">In</span> <span class="id" type="var">a1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l1'</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">b1</span> (<span class="id" type="var">l2</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">a2</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l1'</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">b2</span> (<span class="id" type="var">l2</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a2</span> <span class="id" type="var">b1</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">a</span> :: <span class="id" type="var">l1'</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l2'</span>) -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l1'</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">trans_R</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_left_strong</span> (<span class="id" type="var">R</span> := <span class="id" type="var">R</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">b'</span> [<span class="id" type="var">k2</span> [<span class="id" type="var">k2'</span> [<span class="id" type="var">a_R_b'</span> [<span class="id" type="var">H</span> <span class="id" type="var">P'</span>]]]]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_in_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>] | <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_right_strong</span> (<span class="id" type="var">R</span> := <span class="id" type="var">R</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">k1'</span> [<span class="id" type="var">k1''</span> [<span class="id" type="var">a'_R_b'</span> [<span class="id" type="var">H</span> <span class="id" type="var">P''</span>]]]]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_right_strong</span> (<span class="id" type="var">R</span> := <span class="id" type="var">R</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">k1'</span> [<span class="id" type="var">k1''</span> [<span class="id" type="var">a'_R_b'</span> [<span class="id" type="var">H</span> <span class="id" type="var">P''</span>]]]]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_R</span> <span class="id" type="keyword">with</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">exists_dec</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">P</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> -&gt; {<span class="id" type="var">P</span> <span class="id" type="var">a</span>}+{~P <span class="id" type="var">a</span>}) -&gt;<br/>
&nbsp;&nbsp;{<span class="id" type="var">a</span> | <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">P</span> <span class="id" type="var">a</span>}+{~exists <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">P</span> <span class="id" type="var">a</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span> <span class="id" type="var">P_dec</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">a</span> [<span class="id" type="var">a_in_nil</span> <span class="id" type="var">_</span>]]; <span class="id" type="var">absurd</span> (<span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">P_dec</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Pa</span> | <span class="id" type="var">not_Pa</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Ok</span> | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_dec</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Ok</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">b</span> [<span class="id" type="var">b_in_l</span> <span class="id" type="var">P_b</span>]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">b</span> [[<span class="id" type="var">b_eq_a</span> | <span class="id" type="var">b_in_l</span>] <span class="id" type="var">Pb</span>]].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_Pa</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ko</span>; <span class="id" type="var">exists</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">split_all</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">list</span> (<span class="id" type="var">A</span> * (<span class="id" type="var">list</span> <span class="id" type="var">A</span> * <span class="id" type="var">list</span> <span class="id" type="var">A</span>)) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; @<span class="id" type="var">nil</span> <span class="id" type="var">_</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">a</span> :: <span class="id" type="var">l</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">a</span>,(@nil <span class="id" type="var">_</span>, <span class="id" type="var">l</span>)) :: <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">bl'</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">bl'</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">b</span>,(l',l'')) =&gt; (<span class="id" type="var">b</span>, (<span class="id" type="var">a</span> :: <span class="id" type="var">l'</span>,l'')) <span class="id" type="keyword">end</span>) (<span class="id" type="var">split_all</span> <span class="id" type="var">l</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_all_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">l</span>  : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span>, <span class="id" type="var">In</span> (<span class="id" type="var">b</span>,(l',l'')) (<span class="id" type="var">split_all</span> <span class="id" type="var">l</span>) &lt;-&gt; <span class="id" type="var">l</span> = <span class="id" type="var">l'</span> ++ <span class="id" type="var">b</span> :: <span class="id" type="var">l''</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">H</span> | <span class="id" type="var">H</span> ].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">c</span> [<span class="id" type="var">k'</span> <span class="id" type="var">k''</span>]] [<span class="id" type="var">H</span> <span class="id" type="var">H'</span>]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">a</span> :: <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">IHl</span> <span class="id" type="var">b</span> <span class="id" type="var">k'</span> <span class="id" type="var">l''</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">l'</span>];<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">b</span>,(l',l'')); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_dec</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>, <span class="id" type="var">In</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span> -&gt; {<span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>}+{~R <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>}) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>}+{~permut0 <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">R_dec</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> : <span class="id" type="var">B</span> * (<span class="id" type="var">list</span> <span class="id" type="var">B</span> * <span class="id" type="var">list</span> <span class="id" type="var">B</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">a</span> (<span class="id" type="var">split_all</span> <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;{(<span class="id" type="keyword">fun</span> <span class="id" type="var">bll'</span> : <span class="id" type="var">B</span> * (<span class="id" type="var">list</span> <span class="id" type="var">B</span> * <span class="id" type="var">list</span> <span class="id" type="var">B</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">b</span>, <span class="id" type="var">y</span>) := <span class="id" type="var">bll'</span> <span class="id" type="keyword">in</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">l</span>, <span class="id" type="var">l'</span>) := <span class="id" type="var">y</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a</span>} +<br/>
&nbsp;&nbsp;{~<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">bll'</span> : <span class="id" type="var">B</span> * (<span class="id" type="var">list</span> <span class="id" type="var">B</span> * <span class="id" type="var">list</span> <span class="id" type="var">B</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">b</span>, <span class="id" type="var">y</span>) := <span class="id" type="var">bll'</span> <span class="id" type="keyword">in</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">l</span>, <span class="id" type="var">l'</span>) := <span class="id" type="var">y</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a</span>}).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">b</span> [<span class="id" type="var">l</span> <span class="id" type="var">l'</span>]] <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_all_is_sound</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">R_dec</span> <span class="id" type="var">a1</span> <span class="id" type="var">b</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a1_R_b</span> | <span class="id" type="var">not_a1_R_b</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l'</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">P</span> | <span class="id" type="var">not_P</span>].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_dec</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">P</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">a1_R_b</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_a1_R_b</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">list_exists_rest_is_sound</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">bll'</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">bll'</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" type="var">b</span>,(l,l')) =&gt; <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>) (<span class="id" type="var">split_all</span> <span class="id" type="var">l2</span>) <span class="id" type="var">P_dec</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists_rest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">bll'</span> : <span class="id" type="var">B</span> * (<span class="id" type="var">list</span> <span class="id" type="var">B</span> * <span class="id" type="var">list</span> <span class="id" type="var">B</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">b</span>, <span class="id" type="var">y</span>) := <span class="id" type="var">bll'</span> <span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> (<span class="id" type="var">l</span>, <span class="id" type="var">l'</span>) := <span class="id" type="var">y</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b</span> /\ <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l'</span>)) (<span class="id" type="var">split_all</span> <span class="id" type="var">l2</span>) <span class="id" type="var">P_dec</span>).<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">destruct</span> ((<span class="id" type="var">proj1</span> <span class="id" type="var">H</span>) (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [[<span class="id" type="var">b</span> [<span class="id" type="var">l</span> <span class="id" type="var">l'</span>]] [<span class="id" type="var">H'</span> [<span class="id" type="var">a1_R_b</span> <span class="id" type="var">P</span>]]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_all_is_sound</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">false</span> = <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">b</span>,(l0,l3)); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">split_all_is_sound</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_map</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">A'</span> <span class="id" type="var">B'</span>: <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) (<span class="id" type="var">R'</span> : <span class="id" type="var">A'</span> -&gt; <span class="id" type="var">B'</span> -&gt; <span class="id" type="keyword">Prop</span>) (<span class="id" type="var">f1</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A'</span>) (<span class="id" type="var">f2</span> : <span class="id" type="var">B</span> -&gt; <span class="id" type="var">B'</span>) <br/>
&nbsp;&nbsp;<span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">b</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> -&gt; <span class="id" type="var">R'</span> (<span class="id" type="var">f1</span> <span class="id" type="var">a</span>) (<span class="id" type="var">f2</span> <span class="id" type="var">b</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R'</span> (<span class="id" type="var">map</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">map</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">A'</span> <span class="id" type="var">B'</span> <span class="id" type="var">R</span> <span class="id" type="var">R'</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">Compat</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">P'</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Compat</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">map_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b'</span> <span class="id" type="var">a_in_l1</span> <span class="id" type="var">b'_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Compat</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_length_1</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">b</span> :: <span class="id" type="var">nil</span>)  -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">b'</span> <span class="id" type="var">l'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">a_R_b'</span> <span class="id" type="var">P'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1'</span> [ | <span class="id" type="var">b1'</span> <span class="id" type="var">l1'</span>]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_length_2</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">b1</span> :: <span class="id" type="var">nil</span>) (<span class="id" type="var">a2</span> :: <span class="id" type="var">b2</span> :: <span class="id" type="var">nil</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> /\ <span class="id" type="var">R</span> <span class="id" type="var">b1</span> <span class="id" type="var">b2</span>) \/ (<span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b2</span> /\ <span class="id" type="var">R</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">P'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">c1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">c2</span> [ | <span class="id" type="var">d2</span> <span class="id" type="var">l2</span>]].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut_length_1</span> <span class="id" type="var">P'</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">d1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">c2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut_length_1</span> <span class="id" type="var">P'</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_size</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">size</span> <span class="id" type="var">size'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">a'</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">R</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> -&gt; <span class="id" type="var">size</span> <span class="id" type="var">a</span> = <span class="id" type="var">size'</span> <span class="id" type="var">a'</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l1</span> = <span class="id" type="var">list_size</span> <span class="id" type="var">size'</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">size</span> <span class="id" type="var">size'</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> ]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">E</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">P'</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_size_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E</span> <span class="id" type="var">a1</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl1</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_size_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">plus_assoc</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">list_size</span> <span class="id" type="var">size'</span> <span class="id" type="var">l2'</span> + <span class="id" type="var">n</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_comm</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a_in_la</span> <span class="id" type="var">a_in_l'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">in_permut_in</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">A</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> &lt;-&gt; <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">A</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span> <span class="id" type="var">a</span> <span class="id" type="var">a_in_l2</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">permut_inv_right_strong</span> (<span class="id" type="var">R</span> := @<span class="id" type="var">eq</span> <span class="id" type="var">A</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>) <br/>
&nbsp;&nbsp;<span class="id" type="keyword">as</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">l1'</span> [<span class="id" type="var">l1''</span> [<span class="id" type="var">a_eq_a'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Permutation is compatible with append. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_app</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l1'</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span> <span class="id" type="var">l2'''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_swapp</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l1'</span>) (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span> <span class="id" type="var">l2'''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Instance</span> <span class="id" type="var">equivalence_coercion</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>) (<span class="id" type="var">E</span> : <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span>) : <span class="id" type="var">Equivalence</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> [<span class="id" type="var">E1</span> <span class="id" type="var">E2</span> <span class="id" type="var">E3</span>].<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>), <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">E</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>).<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">permut_cons_inside</span> <span class="id" type="var">A</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (@<span class="id" type="var">nil</span> <span class="id" type="var">_</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_R_b1</span> <span class="id" type="var">a2_R_b1</span> <span class="id" type="var">a2_R_b2</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_app2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>), <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">E</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>).<br/>

<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">u</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">permut_add_inside</span> <span class="id" type="var">A</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">u</span> <span class="id" type="var">u</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_R_b1</span> <span class="id" type="var">a2_R_b1</span> <span class="id" type="var">a2_R_b2</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">E</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_list_exists</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span>  (<span class="id" type="var">A</span> <span class="id" type="var">B</span> : <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">f</span> <span class="id" type="var">f'</span>,  (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">t</span> = <span class="id" type="var">f'</span> <span class="id" type="var">t'</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> -&gt; <span class="id" type="var">list_exists</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> = <span class="id" type="var">list_exists</span> <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">f'</span> <span class="id" type="var">E</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_exists_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">E</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_R_b</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">f'</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists</span> <span class="id" type="var">f'</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">list_exists_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_list_forall_exists</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">A'</span> <span class="id" type="var">B'</span>: <span class="id" type="keyword">Set</span>) (<span class="id" type="var">R</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">B</span> -&gt; <span class="id" type="keyword">Prop</span>) (<span class="id" type="var">R'</span> : <span class="id" type="var">A'</span> -&gt; <span class="id" type="var">B'</span> -&gt; <span class="id" type="keyword">Prop</span>) <span class="id" type="var">f</span> <span class="id" type="var">f'</span>,  <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">ta</span> <span class="id" type="var">ta'</span> <span class="id" type="var">tb</span> <span class="id" type="var">tb'</span>, <span class="id" type="var">R</span> <span class="id" type="var">ta</span> <span class="id" type="var">tb</span> -&gt; <span class="id" type="var">R'</span> <span class="id" type="var">ta'</span> <span class="id" type="var">tb'</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">ta</span> <span class="id" type="var">ta'</span> = <span class="id" type="var">f'</span> <span class="id" type="var">tb</span> <span class="id" type="var">tb'</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">la</span> <span class="id" type="var">la'</span> <span class="id" type="var">lb</span> <span class="id" type="var">lb'</span>,  <span class="id" type="var">permut0</span> <span class="id" type="var">R</span> <span class="id" type="var">la</span> <span class="id" type="var">lb</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">R'</span> <span class="id" type="var">la'</span> <span class="id" type="var">lb'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="var">la'</span>) <span class="id" type="var">la</span> = <br/>
&nbsp;&nbsp;<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> =&gt; <span class="id" type="var">f'</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="var">lb'</span>) <span class="id" type="var">lb</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">B</span> <span class="id" type="var">A'</span> <span class="id" type="var">B'</span> <span class="id" type="var">R</span> <span class="id" type="var">R'</span> <span class="id" type="var">f</span> <span class="id" type="var">f'</span> <span class="id" type="var">E</span> <span class="id" type="var">la</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">la</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">la</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">la'</span> <span class="id" type="var">lb</span> <span class="id" type="var">lb'</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2'</span> <span class="id" type="var">k2''</span> <span class="id" type="var">a_R_b</span> <span class="id" type="var">Q</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_forall_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHla</span> <span class="id" type="var">la'</span> (<span class="id" type="var">k2'</span> ++ <span class="id" type="var">k2''</span>) <span class="id" type="var">lb'</span> <span class="id" type="var">Q</span> <span class="id" type="var">P'</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">list_forall_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E'</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">t</span> : <span class="id" type="var">A'</span>) (<span class="id" type="var">t'</span> : <span class="id" type="var">B'</span>), <span class="id" type="var">R'</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">t</span> = <span class="id" type="var">f'</span> <span class="id" type="var">b</span> <span class="id" type="var">t'</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_list_exists</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R'</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">A'</span> =&gt; <span class="id" type="var">f</span> <span class="id" type="var">a</span> <span class="id" type="var">t2</span>) (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">B'</span> =&gt; <span class="id" type="var">f'</span> <span class="id" type="var">b</span> <span class="id" type="var">t2</span>) <span class="id" type="var">E'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P'</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">B'</span> =&gt; <span class="id" type="var">f'</span> <span class="id" type="var">b</span> <span class="id" type="var">t2</span>) <span class="id" type="var">lb'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">list_forall</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t1</span> : <span class="id" type="var">B</span> =&gt; <span class="id" type="var">list_exists</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t2</span> : <span class="id" type="var">B'</span> =&gt; <span class="id" type="var">f'</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>) <span class="id" type="var">lb'</span>) <span class="id" type="var">k2'</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Srel</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">eq_A</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">eq_proof</span> : <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_permut0_mem</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span>  <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> (<span class="id" type="var">a</span>:A), <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">a</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> - <span class="id" type="var">eq_proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">P</span> <span class="id" type="var">e_mem_l1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">a1_eq_b</span> <span class="id" type="var">P'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">e_mem_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_a1</span> | <span class="id" type="var">e_mem_l1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a0</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_refl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_sym</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_trans</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l3</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_b</span> <span class="id" type="var">b_eq_c</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_morph0</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">A</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x0</span> <span class="id" type="var">y0</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x0</span> <span class="id" type="var">y0</span> -&gt; (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">x0</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">y</span> <span class="id" type="var">y0</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut0_mem</span> <span class="id" type="var">e1</span> <span class="id" type="var">P</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> [<span class="id" type="var">e1_eq_a</span> | <span class="id" type="var">e1_mem_l</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">e1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cons_permut0_mem</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">mem_morph0</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">P</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_cons</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">e2</span> :: <span class="id" type="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1_eq_e2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>) <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">replace</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">nil</span> ++ <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_eq_b1</span> <span class="id" type="var">a2_eq_b1</span> <span class="id" type="var">a2_eq_b2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_add_inside</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span>,  <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">l4</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e1</span> :: <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">e2</span> :: <span class="id" type="var">l4</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">e1_eq_e2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_add_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_eq_b1</span> <span class="id" type="var">a2_eq_b1</span> <span class="id" type="var">a2_eq_b2</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_cons_inside</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) &lt;-&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e2</span> :: <span class="id" type="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1_eq_e2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_add_inside</span> <span class="id" type="var">nil</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1_eq_e2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Permutation is compatible with append. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">eq_proof</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut0_app2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_app2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">eq_proof</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Srel</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Parametric</span> <span class="id" type="var">Relation</span> (<span class="id" type="var">A</span>:Set) (<span class="id" type="var">eq_A</span>:relation <span class="id" type="var">A</span>) (<span class="id" type="var">eq_proof</span>:  <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span>) : (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span>)<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">permut0_refl</span> <span class="id" type="var">eq_proof</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">permut0_sym</span> <span class="id" type="var">eq_proof</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> (<span class="id" type="var">permut0_trans</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">LP</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Parametric</span> <span class="id" type="var">Morphism</span>  (<span class="id" type="var">A</span>:Set) (<span class="id" type="var">eq_A</span>:relation <span class="id" type="var">A</span>) (<span class="id" type="var">eq_proof</span>:  <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span>) : (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">mem_morph2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">exact</span> (<span class="id" type="var">mem_morph0</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Parametric</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">A</span>:Set) (<span class="id" type="var">eq_A</span>:relation <span class="id" type="var">A</span>) (<span class="id" type="var">eq_proof</span>:  <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span>) : (<span class="id" type="var">List.cons</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">add_A_morph</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- (@<span class="id" type="var">permut0_cons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Parametric</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">A</span>:Set) (<span class="id" type="var">eq_A</span>:relation <span class="id" type="var">A</span>) (<span class="id" type="var">eq_proof</span>:  <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span>) : (<span class="id" type="var">List.app</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">app_morph</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_trans</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">SRel2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">A</span> : <span class="id" type="keyword">Set</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">eq_A</span> : <span class="id" type="var">relation</span> <span class="id" type="var">A</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">eq_proof</span> : <span class="id" type="var">equivalence</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Variable</span> <span class="id" type="var">eq_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">eq_bool_ok</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">eq_A</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="var">false</span> =&gt; ~eq_A <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">ac_syntactic_aux</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">l4</span>) -&gt;<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>, <br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u2</span>) /\<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l2</span> (<span class="id" type="var">u3</span> ++ <span class="id" type="var">u4</span>) /\<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l3</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u3</span>) /\<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l4</span> (<span class="id" type="var">u2</span> ++ <span class="id" type="var">u4</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l4</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_refl</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_refl</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_refl</span> <span class="id" type="var">eq_proof</span>).<br/>

<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a1_in_l3l4</span> := @<span class="id" type="var">cons_permut0_mem</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">eq_proof</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a1</span>) <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_in_l3l4</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a1_in_l3l4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1_in_l3</span> | <span class="id" type="var">a1_in_l4</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_in_l3</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a1'</span> [<span class="id" type="var">l3'</span> [<span class="id" type="var">l3''</span> [<span class="id" type="var">a1_eq_a1'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_eq_a1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l3</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l3'</span> ++ <span class="id" type="var">l3''</span>) <span class="id" type="var">l4</span> <span class="id" type="var">P</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u3</span> [<span class="id" type="var">u4</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P3</span> <span class="id" type="var">P4</span>]]]]]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">u1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_sym</span> <span class="id" type="var">eq_proof</span>). <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">permut0_sym</span> <span class="id" type="var">eq_proof</span>). <span class="id" type="tactic">assumption</span>.<br/>

<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_in_l4</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a1'</span> [<span class="id" type="var">l4'</span> [<span class="id" type="var">l4''</span> [<span class="id" type="var">a1_eq_a1'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_eq_a1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l4</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> (<span class="id" type="var">l4'</span> ++ <span class="id" type="var">l4''</span>) <span class="id" type="var">P</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u3</span> [<span class="id" type="var">u4</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P3</span> <span class="id" type="var">P4</span>]]]]]]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">u2</span>); <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>; <span class="id" type="tactic">intuition</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>. <span class="id" type="var">constructor</span>;<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_sym</span>; [<span class="id" type="var">constructor</span>;<span class="id" type="tactic">auto</span>|].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut0_cons_inside</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">constructor</span>;<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">constructor</span>;<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut0_app_app</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_swapp</span>;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_refl</span>;<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">ac_syntactic</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l4</span> ++ <span class="id" type="var">l3</span>) -&gt;<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>, <br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l1</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u2</span>) /\<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l2</span> (<span class="id" type="var">u3</span> ++ <span class="id" type="var">u4</span>) /\<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l3</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u3</span>) /\<br/>
&nbsp;<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">l4</span> (<span class="id" type="var">u2</span> ++ <span class="id" type="var">u4</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ac_syntactic_aux</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>). <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut0_app_app</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut0_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l4</span> ++ <span class="id" type="var">l3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut0_app_app</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">SRel2</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">S</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">EDS</span> : <span class="id" type="var">decidable_set.ES</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> <span class="id" type="var">permut</span> := (<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span>).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_refl</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">permut</span> <span class="id" type="var">l</span> <span class="id" type="var">l</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_sym</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_trans</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l3</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Immediate</span> <span class="id" type="var">permut_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">permut_sym</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">mem_permut_mem</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>

<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">cons_permut_mem</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_cons</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">e2</span> :: <span class="id" type="var">l2</span>)).<br/>

<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_add_inside</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span>,  <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">l4</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e1</span> :: <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">e2</span> :: <span class="id" type="var">l4</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_cons_inside</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e2</span> :: <span class="id" type="var">l2</span>)).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_app2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l</span>).<br/>

<br/>
&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">list_permut_app_app</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">permut_bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">permut_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">kk1</span>} :  <span class="id" type="var">bool</span> :=  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>=&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">EDS.eq_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">permut_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">permut_bool_ok</span> : <br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">permut_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> | <span class="id" type="var">false</span> =&gt; ~permut <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Parameter</span> <span class="id" type="var">ac_syntactic</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l4</span> ++ <span class="id" type="var">l3</span>) -&gt;<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>, <br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u2</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">u3</span> ++ <span class="id" type="var">u4</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l3</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u3</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l4</span> (<span class="id" type="var">u2</span> ++ <span class="id" type="var">u4</span>)).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">remove_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; ~mem <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">x</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">remove_equiv_nil_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l</span> <span class="id" type="var">nil</span> = (<span class="id" type="var">l</span>,nil).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">remove_equiv_is_sound</span>: <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">l1'</span>, <span class="id" type="var">l2'</span>) =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1'</span>) /\ <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="var">False</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">remove_equiv_is_complete</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1'</span>) -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) <span class="id" type="var">l1'</span> /\ <span class="id" type="var">permut</span> (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) <span class="id" type="var">l2'</span>).<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">remove_equiv_permut</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>))  (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>)).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Relation</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">permut</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> <span class="id" type="var">permut_refl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> <span class="id" type="var">permut_sym</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">as</span> <span class="id" type="var">LP</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">mem_morph2</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">List.app</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">app_morph</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">List.cons</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">add_A_morph</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">S</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab7"></a><h2 class="section">Definition of permutation over lists.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">EDS1</span> : <span class="id" type="var">decidable_set.ES</span>) : <span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">EDS</span>:= <span class="id" type="var">EDS1</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">EDS</span> &lt;: <span class="id" type="var">decidable_set.ES</span> := <span class="id" type="var">EDS1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Notation</span> <span class="id" type="var">permut</span> := (<span class="id" type="var">permut0</span> <span class="id" type="var">eq_A</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab8"></a><h2 class="section">Permutation is a equivalence relation.</h2>

      Reflexivity. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" type="keyword">Theorem</span> <span class="id" type="var">permut_refl</span> :  <span class="id" type="keyword">forall</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>), <span class="id" type="var">permut</span> <span class="id" type="var">l</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Symetry. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" type="keyword">Theorem</span> <span class="id" type="var">permut_sym</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_b</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Immediate</span> <span class="id" type="var">permut_refl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Hint</span> <span class="id" type="keyword">Resolve</span> <span class="id" type="var">permut_sym</span>.<br/>

<br/>
</div>

<div class="doc">
Transitivity. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" type="keyword">Theorem</span> <span class="id" type="var">permut_trans</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l3</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_b</span> <span class="id" type="var">b_eq_c</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Relation</span> (<span class="id" type="var">list</span> <span class="id" type="var">A</span>) <span class="id" type="var">permut</span> <br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> <span class="id" type="var">permut_refl</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">symmetry</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> <span class="id" type="var">permut_sym</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span> <span class="id" type="var">proved</span> <span class="id" type="tactic">by</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">as</span> <span class="id" type="var">LP</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab9"></a><h2 class="section">Compatibility Properties.</h2>

      Permutation is compatible with mem. 
</div>
<div class="code">
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_permut_mem</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">P</span> <span class="id" type="var">e_mem_l1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a'</span> <span class="id" type="var">b</span> <span class="id" type="var">l'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">a1_eq_b</span> <span class="id" type="var">P'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">e_mem_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_a1</span> | <span class="id" type="var">e_mem_l1</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">mem_morph</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">EDS1.A</span>, <span class="id" type="var">EDS1.eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x0</span> <span class="id" type="var">y0</span> : <span class="id" type="var">list</span> <span class="id" type="var">EDS1.A</span>, <span class="id" type="var">permut</span> <span class="id" type="var">x0</span> <span class="id" type="var">y0</span> -&gt; (<span class="id" type="var">mem</span> <span class="id" type="var">EDS1.eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">x0</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">EDS1.eq_A</span> <span class="id" type="var">y</span> <span class="id" type="var">y0</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">e1</span> <span class="id" type="var">P</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">clear</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> [<span class="id" type="var">e1_eq_a</span> | <span class="id" type="var">e1_mem_l</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">e1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">iff</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">mem_morph2</span>.<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">mem_morph</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cons_permut_mem</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">mem_morph</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">P</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Permutation is compatible with addition and removal of common elements 
</div>
<div class="code">

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_cons</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">e2</span> :: <span class="id" type="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1_eq_e2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (@<span class="id" type="var">Pcons</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>) <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">replace</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">nil</span> ++ <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_eq_b1</span> <span class="id" type="var">a2_eq_b1</span> <span class="id" type="var">a2_eq_b2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">List.cons</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">eq_A</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">add_A_morph</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e1_eq_e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- (@<span class="id" type="var">permut_cons</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_add_inside</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span>,  <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">l4</span>) &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e1</span> :: <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">e2</span> :: <span class="id" type="var">l4</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">e1_eq_e2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_strong</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_add_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">b1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_eq_b1</span> <span class="id" type="var">a2_eq_b1</span> <span class="id" type="var">a2_eq_b2</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a2</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">b1</span>; <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_cons_inside</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e2</span> :: <span class="id" type="var">l2</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1_eq_e2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">permut_add_inside</span> <span class="id" type="var">nil</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1_eq_e2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Permutation is compatible with append. 
</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_app1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_app1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">EDS.eq_proof</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_app2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_app2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">EDS.eq_proof</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">Morphism</span> (<span class="id" type="var">List.app</span> (<span class="id" type="var">A</span>:=A)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">signature</span> <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span> ==&gt; <span class="id" type="var">permut</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> <span class="id" type="var">app_morph</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">list_permut_app_app</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_swapp</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">permut_bool</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fix</span> <span class="id" type="var">permut_bool</span> (<span class="id" type="var">kk1</span> <span class="id" type="var">kk2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">kk1</span>} :  <span class="id" type="var">bool</span> :=  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">_</span>=&gt; <span class="id" type="var">false</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> :: <span class="id" type="var">k1</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">t1</span> <span class="id" type="var">kk2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">k2</span> =&gt; <span class="id" type="var">permut_bool</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">permut_bool_ok</span> : <br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">permut_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> <span class="id" type="var">true</span> =&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> | <span class="id" type="var">false</span> =&gt; ~permut <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">EDS1.eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k2</span> [<span class="id" type="var">a2</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">a1_eq_a2</span> [<span class="id" type="var">H</span> <span class="id" type="var">H'</span>]]]]]; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">permut_bool_ok</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">permut_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">k2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Pcons</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">not_P</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_P</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">k2</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_cons_inside</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">a1_eq_a2</span>); <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_diff_a2</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_diff_a2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a1</span> <span class="id" type="var">P</span>); <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab10"></a><h2 class="section">Link with AC syntactic decomposition.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">ac_syntactic_aux</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) (<span class="id" type="var">l3</span> ++ <span class="id" type="var">l4</span>) -&gt;<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>, <br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u2</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">u3</span> ++ <span class="id" type="var">u4</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l3</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u3</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l4</span> (<span class="id" type="var">u2</span> ++ <span class="id" type="var">u4</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> (<span class="id" type="var">nil</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">l4</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>

<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a1_in_l3l4</span> := <span class="id" type="var">cons_permut_mem</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a1</span>) <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_in_l3l4</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">a1_in_l3l4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a1_in_l3</span> | <span class="id" type="var">a1_in_l4</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">EDS1.eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_in_l3</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a1'</span> [<span class="id" type="var">l3'</span> [<span class="id" type="var">l3''</span> [<span class="id" type="var">a1_eq_a1'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_eq_a1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l3</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_comm_cons</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l3'</span> ++ <span class="id" type="var">l3''</span>) <span class="id" type="var">l4</span> <span class="id" type="var">P</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u3</span> [<span class="id" type="var">u4</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P3</span> <span class="id" type="var">P4</span>]]]]]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">u1</span>); <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">auto</span>.<br/>

<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">EDS1.eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_in_l4</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a1'</span> [<span class="id" type="var">l4'</span> [<span class="id" type="var">l4''</span> [<span class="id" type="var">a1_eq_a1'</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">a1_eq_a1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l4</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_ass</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> (<span class="id" type="var">l4'</span> ++ <span class="id" type="var">l4''</span>) <span class="id" type="var">P</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> [<span class="id" type="var">u2</span> [<span class="id" type="var">u3</span> [<span class="id" type="var">u4</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> [<span class="id" type="var">P3</span> <span class="id" type="var">P4</span>]]]]]]];<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">a1</span> :: <span class="id" type="var">u2</span>); <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>; <span class="id" type="tactic">intuition</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">ac_syntactic</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>) (<span class="id" type="var">l4</span> ++ <span class="id" type="var">l3</span>) -&gt;<br/>
&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">u1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u2</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u3</span>, <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>, <br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u2</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">u3</span> ++ <span class="id" type="var">u4</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l3</span> (<span class="id" type="var">u1</span> ++ <span class="id" type="var">u3</span>) /\<br/>
&nbsp;<span class="id" type="var">permut</span> <span class="id" type="var">l4</span> (<span class="id" type="var">u2</span> ++ <span class="id" type="var">u4</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">l4</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">ac_syntactic_aux</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l2</span> ++ <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l4</span> ++ <span class="id" type="var">l3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">list_permut_app_app</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_is_sound</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; ~mem <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l</span> (<span class="id" type="var">x</span> :: <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>);<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>); [ <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> [<span class="id" type="var">x'</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">x_eq_x'</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]]]] | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_permut</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span>, <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span> = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">P</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_is_sound</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">remove_is_sound</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_cons</span> <span class="id" type="var">a</span> <span class="id" type="var">a</span> <span class="id" type="var">l'</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">P'</span> <span class="id" type="var">a_not_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_not_in_l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">P'</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">a_not_in_l1</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">a_not_in_l1</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a</span> <span class="id" type="var">P'</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_eq_eq</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">a'</span> -&gt;  <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l1</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l2</span> =&gt; <span class="id" type="var">l1</span> = <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span> = <span class="id" type="var">None</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">b</span> <span class="id" type="var">l</span>] <span class="id" type="var">a</span> <span class="id" type="var">a'</span> <span class="id" type="var">a_eq_a'</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a_eq_b</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a_diff_b</span>].<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a'_eq_b</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a'_diff_b</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">D</span> := <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a'_diff_b</span> <span class="id" type="keyword">in</span> <span class="id" type="var">D</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">D</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E</span> := <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_eq_b</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">a'_eq_b</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">a'_diff_b</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">D</span> := <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a_diff_b</span> <span class="id" type="keyword">in</span> <span class="id" type="var">D</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">D</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>) <span class="id" type="keyword">with</span> <span class="id" type="var">a'</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E</span> := <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a'</span> <span class="id" type="var">b</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">a'_eq_b</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_eq_eq</span> <span class="id" type="var">l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_eq_a'</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a'</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_nil_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l</span> <span class="id" type="var">nil</span> = (<span class="id" type="var">l</span>,nil).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">remove_equiv_nil_2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_is_sound</span>: <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="keyword">match</span> <span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| (<span class="id" type="var">l1'</span>, <span class="id" type="var">l2'</span>) =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1'</span>) /\ <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="var">False</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span> <span class="id" type="var">H''</span>].<br/>
<span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">A</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">H'</span>]]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">permut_cons</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1''</span>) (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e1</span>))); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'''</span> := <span class="id" type="var">remove_is_sound</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">permut_cons</span> <span class="id" type="var">l2'</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2''</span>) (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e1</span>))); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'''</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'''</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l</span> [<span class="id" type="var">P1</span> [<span class="id" type="var">P2</span> <span class="id" type="var">H'</span>]]]; <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> [<span class="id" type="var">x_eq_e1</span> | <span class="id" type="var">x_mem_l1'</span>] <span class="id" type="var">x_mem_l2'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> := <span class="id" type="var">remove_is_sound</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">mem_morph</span> <span class="id" type="var">x_eq_e1</span> (<span class="id" type="var">permut_refl</span> <span class="id" type="var">l2</span>))).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">x</span> <span class="id" type="var">P2</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H'</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_is_complete</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l1'</span>) -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">l2'</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">permut</span> (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) <span class="id" type="var">l1'</span> /\ <span class="id" type="var">permut</span> (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) <span class="id" type="var">l2'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|  <span class="id" type="var">H1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e1</span> <span class="id" type="var">l1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span> <span class="id" type="var">H''</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k2'</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">E</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l'</span>].<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">k1'</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">a1'</span> <span class="id" type="var">k1''</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P1</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">l1''</span> <span class="id" type="var">l2''</span> <span class="id" type="var">H''</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e1_in_l_k1'</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">k1'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">e1</span> <span class="id" type="var">P1</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e1_in_l_k1'</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Subcase</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l1''</span> <span class="id" type="var">k1'</span> /\ <span class="id" type="var">permut</span> <span class="id" type="var">l2''</span> <span class="id" type="var">k2'</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e1_in_l</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_is_sound</span> <span class="id" type="var">e1</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e1</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q1</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">k1'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_cons</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">k1'</span>) (<span class="id" type="var">e1</span> := <span class="id" type="var">e1</span>) (<span class="id" type="var">e2</span> := <span class="id" type="var">e1</span>)) <span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">k1'</span>).<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_is_sound</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">P2'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q2</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l2'</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">k2'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_cons</span> <span class="id" type="var">l2'</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">k2'</span>) (<span class="id" type="var">e1</span> := <span class="id" type="var">e1</span>) (<span class="id" type="var">e2</span> := <span class="id" type="var">e1</span>)) <span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">k2'</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">l'</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k2'</span> <span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span> <span class="id" type="var">E</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">PP1</span> <span class="id" type="var">PP2</span>]; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">in</span> <span class="id" type="var">PP1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">in</span> <span class="id" type="var">PP2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">e1_in_l_k1'</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">e1_in_l</span> | <span class="id" type="var">e1_in_k1'</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Subcase</span> <span class="id" type="var">e1_in_l</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R</span> := <span class="id" type="var">remove_is_sound</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e1_in_l2</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">e1</span> <span class="id" type="var">R</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">e1</span> <span class="id" type="var">P2</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">e1_in_l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e1_in_l2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">e1_in_l2</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">e1_in_l</span> | <span class="id" type="var">e1_in_k2'</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Subcase</span> <span class="id" type="var">e1_in_l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">E</span> <span class="id" type="var">_</span> <span class="id" type="var">e1_in_k1'</span> <span class="id" type="var">e1_in_k2'</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'''</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R</span> := <span class="id" type="var">remove_is_sound</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e1_in_l_k1'</span> : <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">k1'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">e1</span> <span class="id" type="var">P1</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e1_in_l_k1'</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">e1_in_l_k1'</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">e1_in_l</span> | <span class="id" type="var">e1_in_k1'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">e1</span> <span class="id" type="var">P2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_is_sound</span> <span class="id" type="var">e1</span> <span class="id" type="var">k1'</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e1</span> <span class="id" type="var">k1'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k'</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Q1</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">k'</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_cons</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">k'</span>) (<span class="id" type="var">e1</span> := <span class="id" type="var">e1</span>) (<span class="id" type="var">e2</span> := <span class="id" type="var">e1</span>)) <span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">k1'</span>).<br/>
<span class="id" type="tactic">exact</span> <span class="id" type="var">P1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">e1</span> :: <span class="id" type="var">k'</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span> | <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>)].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">EDS1.A</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">k'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">x</span> <span class="id" type="var">k2'</span> -&gt; <span class="id" type="var">False</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_k</span> <span class="id" type="var">x_in_k2'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">E</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">x</span> <span class="id" type="var">P</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">l</span> <span class="id" type="var">k'</span> <span class="id" type="var">k2'</span> <span class="id" type="var">Q1</span> <span class="id" type="var">P2</span> <span class="id" type="var">E'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">e1</span> :: <span class="id" type="var">k'</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span> <span class="id" type="tactic">by</span> <span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_permut_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l2</span>, (<span class="id" type="var">permut</span> (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">P1</span> <span class="id" type="var">l2</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_is_sound</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">remove_equiv_is_sound</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l</span> [<span class="id" type="var">Q1</span> [<span class="id" type="var">Q2</span> <span class="id" type="var">H</span>]]].<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k2'</span> <span class="id" type="var">H1'</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">Q1'</span> [<span class="id" type="var">Q2'</span> <span class="id" type="var">H'</span>]]].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">Q1''</span> : <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">k1'</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R</span> := @<span class="id" type="var">remove_equiv_is_complete</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l'</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k2'</span> <span class="id" type="var">Q1''</span> <span class="id" type="var">Q2'</span> <span class="id" type="var">H'</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">R</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">R1</span> <span class="id" type="var">R2</span>]; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_permut_2</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) =  <span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>))).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>] <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_permut</span> <span class="id" type="var">P</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">k2</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2'</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">k2'</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H2'</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P'</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">remove_equiv_permut_2</span> <span class="id" type="var">l1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P'</span>); <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H2'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">remove_equiv_permut_2</span> <span class="id" type="var">l1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">case</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span>;<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k2'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span>;<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2'</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">k1'</span> <span class="id" type="var">k2'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_equiv_permut</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span>, <span class="id" type="var">permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>))  (<span class="id" type="var">fst</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>)) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">permut</span> (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)) (<span class="id" type="var">snd</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">remove_equiv_permut_1</span> <span class="id" type="var">P1</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">remove_equiv_permut_2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">P2</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">remove_equiv</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span>);<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">u3</span> <span class="id" type="var">u4</span> <span class="id" type="var">u5</span> <span class="id" type="var">u6</span> [<span class="id" type="var">Q1</span> <span class="id" type="var">Q2</span>] [<span class="id" type="var">Q3</span> <span class="id" type="var">Q4</span>]; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u4</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>

<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>