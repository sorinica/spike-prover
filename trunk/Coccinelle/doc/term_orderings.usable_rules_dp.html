<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>term_orderings.usable_rules_dp</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library term_orderings.usable_rules_dp</h1>

<div class="code">

<br/>

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_algebra".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "examples/cime_trace/".<br/>

<br/>
</div>

<div class="doc">
<a name="lab110"></a><h1 class="section">Termination of rewriting</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Wellfounded</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Recdef</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">weaved_relation</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equational_theory_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">dp</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">graph_dp</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">terminaison</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">interp</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">MakeUsableDP</span> (<span class="id" type="var">E</span> : <span class="id" type="var">EqTh</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Module</span> <span class="id" type="var">GDp</span> := <span class="id" type="var">graph_dp.MakeGDP</span> (<span class="id" type="var">E</span>).<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">GDp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">Dp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">E</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">filter_top</span> <span class="id" type="var">R</span> <span class="id" type="var">G</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span> := <br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ <span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span> | <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">G</span> <span class="id" type="var">f</span> <span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">symb_sup_gen</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> : <span class="id" type="var">relation</span> <span class="id" type="var">symbol</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">r</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">filter_top</span> <span class="id" type="var">R1</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">f'</span> =&gt; <span class="id" type="var">f</span> = <span class="id" type="var">f'</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">symb_in_term</span> <span class="id" type="var">g</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">g</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">symb_sup_gen_list</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">Rlist1</span> <span class="id" type="var">R2</span> <span class="id" type="var">Rlist2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist1</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist2</span>) -&gt; <br/>
&nbsp;&nbsp;{<span class="id" type="var">Slist</span> | <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>, <span class="id" type="var">symb_sup_gen</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">f</span>,g) <span class="id" type="var">Slist</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">Rlist1</span>; <span class="id" type="var">revert</span> <span class="id" type="var">R1</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Rlist1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">l</span> <span class="id" type="var">r</span>] <span class="id" type="var">Rlist1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">Rlist2</span> <span class="id" type="var">Rlist_ok1</span> <span class="id" type="var">Rlist_ok2</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">r</span> [<span class="id" type="var">l</span> [[<span class="id" type="var">H</span> <span class="id" type="var">_</span>] <span class="id" type="var">_</span>]]]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">R'</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">R1</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> /\ <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) <span class="id" type="var">Rlist1</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Rlist_ok'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">R'</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) <span class="id" type="var">Rlist1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok1</span>; <span class="id" type="var">right</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHRlist1</span> <span class="id" type="var">R'</span> <span class="id" type="var">R2</span> <span class="id" type="var">Rlist2</span> <span class="id" type="var">Rlist_ok'</span> <span class="id" type="var">Rlist_ok2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Slist</span> <span class="id" type="var">Slist_ok</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">Slist</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">u</span> [<span class="id" type="var">v</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H1</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">contradiction</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Slist_ok</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">H4</span>]; <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Slist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">v</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>] [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rlist_ok'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> <span class="id" type="var">H4</span>]; <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> =&gt; (<span class="id" type="var">f</span>,g)) (<span class="id" type="var">filter</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">defined_dec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok2</span> <span class="id" type="var">g</span> <span class="id" type="keyword">then</span> <span class="id" type="var">true</span> <span class="id" type="keyword">else</span> <span class="id" type="var">false</span>) (<span class="id" type="var">symb_list</span> <span class="id" type="var">r</span>))) ++ <span class="id" type="var">Slist</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">g'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">v</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> <span class="id" type="var">H1</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> <span class="id" type="var">g'</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | ].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">filter_In</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_list_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">defined_dec</span> <span class="id" type="var">R2</span> <span class="id" type="var">Rlist2</span> <span class="id" type="var">Rlist_ok2</span> <span class="id" type="var">g'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Dg'</span> | <span class="id" type="var">NDg'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">NDg'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Slist_ok</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g''</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">filter_In</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'_in_r</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">defined_dec</span> <span class="id" type="var">R2</span> <span class="id" type="var">Rlist2</span> <span class="id" type="var">Rlist_ok2</span> <span class="id" type="var">g'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Dg'</span> | <span class="id" type="var">NDg'</span>]; [ <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span> | <span class="id" type="tactic">discriminate</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">r</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">symb_list_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Slist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">v</span> [[<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]  [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rlist_ok'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">symb_sup</span> <span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">symbol</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">r</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">filter_top</span> <span class="id" type="var">R</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">f'</span> =&gt; <span class="id" type="var">f</span> = <span class="id" type="var">f'</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">symb_in_term</span> <span class="id" type="var">g</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">g</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Usable</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">filter_top</span> <span class="id" type="var">R</span> <br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">f</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> /\ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">symb_sup</span> <span class="id" type="var">R</span>) <span class="id" type="var">f</span> <span class="id" type="var">g</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">UsableRules</span> (<span class="id" type="var">R</span> <span class="id" type="var">C</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) : <span class="id" type="var">relation</span> <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">r</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l</span>, <span class="id" type="var">C</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">Usable</span> <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">symb_sup_list</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist</span>) -&gt; <br/>
&nbsp;&nbsp;{<span class="id" type="var">Slist</span> | <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>, <span class="id" type="var">symb_sup</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">f</span>,g) <span class="id" type="var">Slist</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span> <span class="id" type="var">Rlist_ok</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">symb_sup_gen_list</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">Rlist_ok</span>).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">usable_dec</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, {<span class="id" type="var">URlist</span> | <span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>,  <span class="id" type="var">Usable</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">URlist</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">symb_sup_list</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Slist</span> <span class="id" type="var">Slist_ok</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">SR_dec</span> := <span class="id" type="var">refl_trans_clos_dec</span> <span class="id" type="var">_</span> <span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Slist_ok</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">Usable</span>; <span class="id" type="tactic">set</span> (<span class="id" type="var">SR</span> := <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">symb_sup</span> <span class="id" type="var">R</span>)) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">SR</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Slist</span> <span class="id" type="var">Slist_ok</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Rlist</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">l</span> <span class="id" type="var">r</span>] <span class="id" type="var">Rlist</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist_ok</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">R'</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> /\ <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) <span class="id" type="var">Rlist</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Rlist_ok'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">R'</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) <span class="id" type="var">Rlist</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="var">right</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHRlist</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">URlist</span> <span class="id" type="var">URlist_ok</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">URlist</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H1</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok'</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">split</span>; [ <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rlist_ok'</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">split_case</span> : {<span class="id" type="var">f0</span> : <span class="id" type="var">symbol</span> | <span class="id" type="var">symb_in_term</span> <span class="id" type="var">f0</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> /\ <span class="id" type="var">SR</span> <span class="id" type="var">f0</span> <span class="id" type="var">f</span>}+{forall <span class="id" type="var">f0</span>, ~(symb_in_term <span class="id" type="var">f0</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> /\ <span class="id" type="var">SR</span> <span class="id" type="var">f0</span> <span class="id" type="var">f</span>)}).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">filter</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">g</span> =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">SR_dec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span> <span class="id" type="keyword">then</span> <span class="id" type="var">true</span> <span class="id" type="keyword">else</span> <span class="id" type="var">false</span>) (<span class="id" type="var">symb_list</span> <span class="id" type="var">t</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> [<span class="id" type="var">g_in_t</span> <span class="id" type="var">Sgf</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">g_in_nil</span> : <span class="id" type="var">In</span> <span class="id" type="var">g</span> <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">filter_In</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_list_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">SR_dec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">SR</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">contradiction</span> <span class="id" type="var">g_in_nil</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">g</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">g_in_gk</span> : <span class="id" type="var">In</span> <span class="id" type="var">g</span> (<span class="id" type="var">g</span> :: <span class="id" type="var">k</span>)).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">g_in_gk</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">filter_In</span> <span class="id" type="keyword">in</span> <span class="id" type="var">g_in_gk</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">g_in_gk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g_in_t</span> <span class="id" type="var">Sgf</span>]; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">symb_list_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">SR_dec</span> <span class="id" type="var">g</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">split_case</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">g</span> [<span class="id" type="var">g_in_t</span> <span class="id" type="var">Sgf</span>]] | <span class="id" type="var">Ko</span>].<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>,r) :: <span class="id" type="var">URlist</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H1</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok'</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">g</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">split</span>; [ <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rlist_ok'</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">URlist</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H1</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Ko</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok'</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">split</span>; [ <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rlist_ok'</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">usablerules_dec</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">P</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,v) <span class="id" type="var">Plist</span>) -&gt;<br/>
&nbsp;&nbsp;{<span class="id" type="var">URlist</span> | <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>,  <span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">URlist</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist</span>; <span class="id" type="var">revert</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Plist</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">u</span> <span class="id" type="var">v</span>] <span class="id" type="var">Plist</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist_ok</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">v</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">P'</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> /\ <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) <span class="id" type="var">Plist</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Plist_ok'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>, <span class="id" type="var">P'</span> <span class="id" type="var">b</span> <span class="id" type="var">a</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">a</span>,b) <span class="id" type="var">Plist</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Plist_ok</span>; <span class="id" type="var">right</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHPlist</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">URlist</span> <span class="id" type="var">URlist_ok</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">usable_dec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">v</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Uv</span> <span class="id" type="var">Uv_ok</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Uv</span> ++ <span class="id" type="var">URlist</span>); <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s</span> [<span class="id" type="var">t</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H1</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Uv_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span>; <span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; [ <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Plist_ok'</span> | ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> | <span class="id" type="var">H1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Uv_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">v</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Plist_ok</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">URlist_ok</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s</span> [<span class="id" type="var">t</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">s</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>; [ <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Plist_ok</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Plist_ok'</span> |  ]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_term_dec2</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">s12</span> <span class="id" type="var">t12</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span>), {<span class="id" type="var">s12</span> = <span class="id" type="var">t12</span>}+{s12 &lt;&gt; <span class="id" type="var">t12</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s1</span> <span class="id" type="var">s2</span>] [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> <span class="id" type="var">s1</span> <span class="id" type="var">t1</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_t1</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_diff_t1</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> <span class="id" type="var">s2</span> <span class="id" type="var">t2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">s2_eq_t2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">s2_diff_t2</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_equal2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s12_eq_t12</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s2_diff_t2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">s12_eq_t12</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s2_eq_t2</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s12_eq_t12</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s1_diff_t1</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">s12_eq_t12</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">s1_eq_t1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">split_rules</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">P</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,v) <span class="id" type="var">Plist</span>) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">G</span>, <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">G</span> <span class="id" type="var">f</span> &lt;-&gt; <span class="id" type="var">defined</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ ~ <span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>) <span class="id" type="var">f</span>) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; (<span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> \/ <span class="id" type="var">filter_top</span> <span class="id" type="var">R</span> <span class="id" type="var">G</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>)) /\<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>, <span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">g</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">g</span> <span class="id" type="var">r</span> = <span class="id" type="var">true</span> -&gt; ~G <span class="id" type="var">g</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="var">R_var</span> <span class="id" type="var">G</span> <span class="id" type="var">Gdef</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Pdec</span> := <span class="id" type="var">rel_dec</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist</span> <span class="id" type="var">Plist_ok</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">usablerules_dec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">URlist</span> <span class="id" type="var">URlist_ok</span>].<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">URlist_ok</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_dec</span> <span class="id" type="var">eq_term_dec2</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">URlist</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">lr_in_U</span> | <span class="id" type="var">lr_not_in_U</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef</span>; <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">rewrite</span> <span class="id" type="var">URlist_ok</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">v</span> [<span class="id" type="var">u</span> [<span class="id" type="var">_</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]] | [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] [<span class="id" type="var">v</span> [<span class="id" type="var">u</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]] <span class="id" type="var">g</span> <span class="id" type="var">g_in_r</span> <span class="id" type="var">Gg</span>.<br/>
<span class="id" type="var">contradiction</span> <span class="id" type="var">H3</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Gg</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Gg</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">g'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">K2</span>; <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">v</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">destruct</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]; <span class="id" type="var">exists</span> <span class="id" type="var">f'</span>; <span class="id" type="tactic">split</span>].<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">r</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>].<br/>
<span class="id" type="tactic">split</span>; [ | <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Gdec</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">P</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,v) <span class="id" type="var">Plist</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">G</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">f</span> =&gt; <span class="id" type="var">defined</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ ~ <span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>) <span class="id" type="var">f</span> <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {~G <span class="id" type="var">f</span>} + {<span class="id" type="var">G</span> <span class="id" type="var">f</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Rlist</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">P</span> <span class="id" type="var">Plist</span> <span class="id" type="var">Plist_ok</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : {<span class="id" type="var">rule_list</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) |<br/>
&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> : <span class="id" type="var">term</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ ~ <span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>, <span class="id" type="var">r</span>) <span class="id" type="var">rule_list</span>)}).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">usablerules_dec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">URlist</span> <span class="id" type="var">URlist_ok</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">filter</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">In_dec</span> <span class="id" type="var">eq_term_dec2</span> <span class="id" type="var">st</span> <span class="id" type="var">URlist</span> <span class="id" type="keyword">then</span> <span class="id" type="var">false</span> <span class="id" type="keyword">else</span> <span class="id" type="var">true</span>) <span class="id" type="var">Rlist</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">filter_In</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Rlist_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_dec</span> <span class="id" type="var">eq_term_dec2</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">URlist</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">URlist_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">filter_In</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_dec</span> <span class="id" type="var">eq_term_dec2</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">URlist</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">URlist_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">rule_list</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">G</span> <span class="id" type="var">f</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">defined_dec</span>(<span class="id" type="keyword">fun</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> : <span class="id" type="var">term</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ ~ <span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>) <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Df</span> | <span class="id" type="var">nDf</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> (<span class="id" type="var">v1</span> <span class="id" type="var">v2</span> : <span class="id" type="var">variable</span>) : <span class="id" type="var">relation</span> <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Pi1</span> : <span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> :: <span class="id" type="var">nil</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">Pi2</span> : <span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v2</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> :: <span class="id" type="var">nil</span>)).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span> := <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ((<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">s</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">symb_in_term</span> <span class="id" type="var">f</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">pi</span>))).<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Interp_definition</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V0</span> : <span class="id" type="var">variable</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V1</span> : <span class="id" type="var">variable</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">V0_diff_V1</span> : <span class="id" type="var">V0</span> &lt;&gt; <span class="id" type="var">V1</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">pi</span> : <span class="id" type="var">symbol</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">bot</span> : <span class="id" type="var">symbol</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) .<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R_var</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span>, ~ <span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Rlist</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Rlist_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">Rlist</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">PPi</span> : <span class="id" type="var">is_primary_pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">R</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">G</span> : <span class="id" type="var">symbol</span> -&gt; <span class="id" type="keyword">Prop</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">P</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Plist</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>).<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Plist_ok</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">P</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">u</span>,v) <span class="id" type="var">Plist</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">Gdef'</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">G</span> <span class="id" type="var">f</span> &lt;-&gt; <span class="id" type="var">defined</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> /\ ~ <span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>) <span class="id" type="var">f</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Gdef</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, <span class="id" type="var">G</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">Gf</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Gf</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Gf</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">R_red</span> := <span class="id" type="var">compute_red</span> <span class="id" type="var">Rlist</span>.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">FB</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">R_red</span> <span class="id" type="var">t</span>) &lt;-&gt; <span class="id" type="var">one_step</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">compute_red_is_correct</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_reg</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Rlist_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">Comb</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">bot</span> <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">t</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">t</span> :: (<span class="id" type="var">Comb</span> <span class="id" type="var">l</span>) :: <span class="id" type="var">nil</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">interp_call</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Subt</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">interp_call</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Defd</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>, <span class="id" type="var">G</span> <span class="id" type="var">f2</span> -&gt; <span class="id" type="var">one_step</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">interp_call</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">G</span> <span class="id" type="var">f</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_subterm</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">s</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> <span class="id" type="var">Is</span> <span class="id" type="var">Sub</span> <span class="id" type="var">q</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">Sub'</span> <span class="id" type="var">Dg</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Is</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">p</span> ++ <span class="id" type="var">q</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">subterm_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_one_step_interp_dom</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_with_subterm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t'</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_t'</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_t'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">p</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">K</span> <span class="id" type="var">f_not_in_H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_with_subterm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_well_defined</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> <span class="id" type="var">interp_call</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> <span class="id" type="var">K''</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">K</span> <span class="id" type="var">nil</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>) <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">s</span> := <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Acc_s</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_with_subterm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_s</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s</span> <span class="id" type="var">Acc_s'</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_s</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">direct_subterm</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_s'</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_s'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">Interp</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">Vcase</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">Interp</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">notGcase</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">ll</span> , ~G <span class="id" type="var">f</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">l'</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Gcase</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">ll</span> <span class="id" type="var">k'</span> <span class="id" type="var">kk</span>, <span class="id" type="var">G</span> <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">l'</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>)) <span class="id" type="var">ll</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">R_red</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>)) <span class="id" type="var">kk</span> -&gt; <span class="id" type="var">k'</span> = (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>)) <span class="id" type="var">kk</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s') <span class="id" type="var">kk</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) (<span class="id" type="var">Comb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> :: <span class="id" type="var">k'</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_unicity</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> <span class="id" type="var">interp_call</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">s1</span> = <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>];<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Cf1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hl1'</span> <span class="id" type="var">Hll1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">ll1</span> <span class="id" type="var">k1</span> <span class="id" type="var">kk1</span> <span class="id" type="var">Df1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hl1'</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">Hk1</span> <span class="id" type="var">Hk1'</span> <span class="id" type="var">Hkk1</span>];<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Cf2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">Hl2'</span> <span class="id" type="var">Hll2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'</span> <span class="id" type="var">ll2</span> <span class="id" type="var">k2</span> <span class="id" type="var">kk2</span> <span class="id" type="var">Df2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">Hl2'</span> <span class="id" type="var">Hll2</span> <span class="id" type="var">Hk2</span> <span class="id" type="var">Hk2'</span> <span class="id" type="var">Hkk2</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s1) <span class="id" type="var">ll1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s2) <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">s1</span> = <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">ss1_in_ll1</span> <span class="id" type="var">ss2_in_ll2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_in_l</span> : <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span>,s1); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">kk1</span> [<span class="id" type="var">kk2</span> <span class="id" type="var">K</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> -Hl2 <span class="id" type="var">K</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s</span> <span class="id" type="var">s1</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s2</span>] <span class="id" type="var">ll2</span>] <span class="id" type="var">Hl2</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hl2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">s_eq_s'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">K</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">try</span> (<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHll1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">tt1_in_ll1</span> <span class="id" type="var">tt2_in_ll2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">K</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_equal2</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s1) <span class="id" type="var">ll1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s2) <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">s1</span> = <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">ss1_in_ll1</span> <span class="id" type="var">ss2_in_ll2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_in_l</span> : <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span>,s1); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">lll1</span> [<span class="id" type="var">lll2</span> <span class="id" type="var">K</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> -Hl2 <span class="id" type="var">K</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">ll2</span> <span class="id" type="var">Hl2</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s</span> <span class="id" type="var">s1</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s2</span>] <span class="id" type="var">ll2</span>] <span class="id" type="var">Hl2</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hl2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">s_eq_s'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">K</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">try</span> (<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHll1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">tt1_in_ll1</span> <span class="id" type="var">tt2_in_ll2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">K</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="tactic">f_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s1) <span class="id" type="var">kk1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">s</span>,s2) <span class="id" type="var">kk2</span> -&gt; <span class="id" type="var">s1</span> = <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">ss1_in_kk1</span> <span class="id" type="var">ss2_in_kk2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_in_l</span> : <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">s</span>,s1); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">FB</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hk1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">kkk1</span> [<span class="id" type="var">kkk2</span> <span class="id" type="var">K</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hkk2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hk1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hk2</span>.<br/>
<span class="id" type="tactic">clear</span> -Hk2 <span class="id" type="var">K</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">kk2</span> <span class="id" type="var">Hk2</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">kk1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s</span> <span class="id" type="var">s1</span>] <span class="id" type="var">kk1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">s'</span> <span class="id" type="var">s2</span>] <span class="id" type="var">kk2</span>] <span class="id" type="var">Hk2</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hk2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Hk2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hk2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">s_eq_s'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">K</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>); <span class="id" type="tactic">try</span> (<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHkk1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">kk2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">tt1_in_ll1</span> <span class="id" type="var">tt2_in_ll2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">K</span> <span class="id" type="var">t</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_defined</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> <span class="id" type="var">interp_call</span> <span class="id" type="var">t</span> -&gt; {<span class="id" type="var">t'</span> | <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t'</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> : <span class="id" type="var">Acc</span> <span class="id" type="var">interp_call</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_t'</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_t'</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">Vcase</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Il</span> : {<span class="id" type="var">ll</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) | <span class="id" type="var">l</span> = <span class="id" type="var">map</span> (@<span class="id" type="var">fst</span> <span class="id" type="var">term</span> <span class="id" type="var">term</span>) <span class="id" type="var">ll</span> /\ <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">ll</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>}).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; {<span class="id" type="var">t'</span> : <span class="id" type="var">term</span> | <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> (<span class="id" type="var">tail_set</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">H3</span>].<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">t</span>,t') :: <span class="id" type="var">ll</span>); <span class="id" type="tactic">split</span>; <br/>
[ <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> <br/>
| <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> [<span class="id" type="var">uu'_eq_tt'</span> | <span class="id" type="var">uu'_in_ll</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">uu'_eq_tt'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">assumption</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Il</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ll</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">Gdec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">f_not_in_G</span> | <span class="id" type="var">f_in_G</span>].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (@<span class="id" type="var">snd</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">notGcase</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Ik</span> : {<span class="id" type="var">kk</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) |  <span class="id" type="var">R_red</span>  (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) = <span class="id" type="var">map</span> (@<span class="id" type="var">fst</span> <span class="id" type="var">term</span> <span class="id" type="var">term</span>) <span class="id" type="var">kk</span> /\ <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">kk</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>}).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHk</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> (<span class="id" type="var">R_red</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) -&gt; {<span class="id" type="var">t'</span> : <span class="id" type="var">term</span> | <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>}).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_red</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_in_red</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">IHk</span>; <span class="id" type="tactic">generalize</span> ((<span class="id" type="var">R_red</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>))); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">k</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">Hk</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHk</span> (<span class="id" type="var">tail_set</span> <span class="id" type="var">_</span> <span class="id" type="var">Hk</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">kk</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">Hk</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">H3</span>].<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">t</span>,t') :: <span class="id" type="var">kk</span>); <span class="id" type="tactic">split</span>; <br/>
[ <span class="id" type="tactic">subst</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> <br/>
| <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span> [<span class="id" type="var">uu'_eq_tt'</span> | <span class="id" type="var">uu'_in_ll</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">uu'_eq_tt'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">assumption</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Ik</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">kk</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Comb</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (@<span class="id" type="var">snd</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">ll</span>) :: (<span class="id" type="var">map</span> (@<span class="id" type="var">snd</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">kk</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Gcase</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ll</span> <span class="id" type="var">kk</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">project_comb</span> :  <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t</span> (<span class="id" type="var">Comb</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">set</span> (<span class="id" type="var">sigma</span> := (<span class="id" type="var">V0</span>,a) :: (<span class="id" type="var">V1</span>, <span class="id" type="var">Comb</span> <span class="id" type="var">l</span>) :: <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> : <span class="id" type="var">a</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_var_bool_refl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H2</span> : <span class="id" type="var">Comb</span> <span class="id" type="var">l</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V1</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_var_bool_refl</span>; <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_var_bool</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">V1_eq_V0</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">V0_diff_V1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_var_bool_ok</span> <span class="id" type="var">V1</span> <span class="id" type="var">V0</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">V1_eq_V0</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H3</span> : <span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">Comb</span> <span class="id" type="var">l</span> :: <span class="id" type="var">nil</span>) = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">V0</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">V1</span> :: <span class="id" type="var">nil</span>))).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>, <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">t_eq_a</span> | <span class="id" type="var">t_in_l</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span>, <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Comb</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span>, <span class="id" type="var">H2</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_in_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">g</span>, <span class="id" type="var">symb_in_term</span> <span class="id" type="var">g</span> <span class="id" type="var">t</span> = <span class="id" type="var">true</span> -&gt; ~G <span class="id" type="var">g</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) -&gt; <span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">_</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Isigma</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Isigma</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">fl_in_H</span> <span class="id" type="var">sigma</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Isigma</span>.<br/>

<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">constructor</span> 2 <span class="id" type="keyword">with</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">t</span> =&gt; (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>, <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">t</span>)) <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">fl_in_H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_map</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_map</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">K</span> <span class="id" type="var">t_in_l</span>]]; <span class="id" type="tactic">injection</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">g_in_t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">fl_in_H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">symb_in_direct_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Isigma</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> <span class="id" type="var">K'</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">var_in_subterm</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_interp_subst</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">tsigma'</span> <span class="id" type="var">sigma'</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) <span class="id" type="var">tsigma'</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) -&gt; <span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">t</span>) <span class="id" type="var">tsigma'</span> /\<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt; ~G <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">tsigma'</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span> =&gt; <span class="id" type="var">f</span> = <span class="id" type="var">g</span> /\ <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span>) <span class="id" type="var">l</span>) <span class="id" type="var">k</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">tsigma'</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">I1</span> <span class="id" type="var">I2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t'</span> :=  <span class="id" type="var">interp_well_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_t</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span>  <span class="id" type="var">Acc_t'</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">I1</span> (<span class="id" type="var">I2</span> <span class="id" type="var">v</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)))); <span class="id" type="tactic">split</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">exact</span> <span class="id" type="var">I</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IHl</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">tsigma'</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">I1</span> <span class="id" type="var">I2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">IHl'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> : <span class="id" type="var">term</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">tsigma'</span> : <span class="id" type="var">term</span>) (<span class="id" type="var">sigma'</span> : <span class="id" type="var">substitution</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) <span class="id" type="var">tsigma'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">variable</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">t</span>) <span class="id" type="var">tsigma'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">ssigma''</span> <span class="id" type="var">sigma''</span> <span class="id" type="var">Issigma</span> <span class="id" type="var">Isigma''</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_ssigma</span> : <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> <span class="id" type="var">H3</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)) (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">map_length</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l1</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">Acc_ssigma</span> <span class="id" type="var">ssigma''</span> <span class="id" type="var">sigma''</span> <span class="id" type="var">Issigma</span> <span class="id" type="var">Isigma''</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">I1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Cf1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hl1'</span> <span class="id" type="var">Hll1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l1'</span> <span class="id" type="var">ll1</span> <span class="id" type="var">k1</span> <span class="id" type="var">kk1</span> <span class="id" type="var">Df1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hl1'</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">Hk1</span> <span class="id" type="var">Hk1'</span> <span class="id" type="var">Hkk1</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">I1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H0</span> : <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)))<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span>) <span class="id" type="var">l</span>) (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHl</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="var">revert</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">IHl'</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll1</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">discriminate</span> <span class="id" type="var">Hl1</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a'</span> <span class="id" type="var">a1</span>] <span class="id" type="var">ll1</span>]; [<span class="id" type="tactic">discriminate</span> <span class="id" type="var">Hl1</span> | <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">I2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">I2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k</span> | <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">K</span>].<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_not_in_G</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span>) <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>)).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHl</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="var">revert</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">IHl'</span>; <span class="id" type="tactic">clear</span> -I2.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">ll1</span> <span class="id" type="var">Hl1</span> <span class="id" type="var">Hll1</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll1</span>; [<span class="id" type="var">left</span> | <span class="id" type="tactic">discriminate</span> <span class="id" type="var">Hl1</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a'</span> <span class="id" type="var">a1</span>] <span class="id" type="var">ll1</span>]; [<span class="id" type="tactic">discriminate</span> <span class="id" type="var">Hl1</span> | <span class="id" type="tactic">injection</span> <span class="id" type="var">Hl1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Hl1</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">I2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">I2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hll1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">k</span> | <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H0</span>].<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">project_comb</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_subst</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;{<span class="id" type="var">sigma'</span> |  <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)) }.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Acc_ls</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_sigma</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_l</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">x_mem_l</span> : <span class="id" type="var">mem</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>) <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">var_in_subterm2</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="var">x_mem_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> <span class="id" type="var">Sub</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) <span class="id" type="var">p</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">l</span> <span class="id" type="var">p</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">p</span> =&gt; <span class="id" type="var">p</span>).<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">varl</span> := <span class="id" type="var">var_list</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">in</span> *; <span class="id" type="var">clearbody</span> <span class="id" type="var">varl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_garbage_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">tau</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H4</span> : { <span class="id" type="var">tau'</span> : <span class="id" type="var">list</span> (<span class="id" type="var">variable</span> * (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)) | <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tau</span> = <span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xtt'</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">xtt'</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">x</span>,(t,t')) =&gt; (<span class="id" type="var">x</span>,t) <span class="id" type="keyword">end</span>) <span class="id" type="var">tau'</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">varl</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">x</span>,(t,t')) <span class="id" type="var">tau'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span>) }).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_tau</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> : <span class="id" type="var">variable</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> <span class="id" type="var">varl</span> -&gt; <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">tau</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_sigma</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">Acc_tau</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">tau</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">v</span> <span class="id" type="var">vval</span>] <span class="id" type="var">tau</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">Acc_tau</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHtau</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">tau'</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">xval</span> <span class="id" type="var">xval_in_tau</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">xval_in_tau</span>)); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_var_bool_ok</span> <span class="id" type="var">x</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_var_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">x_eq_v</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">xval_in_tau</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">tau'</span> [<span class="id" type="var">tau''</span> <span class="id" type="var">H4</span>]].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H3</span> <span class="id" type="var">v</span> <span class="id" type="var">x</span> <span class="id" type="var">vval</span> <span class="id" type="var">xval</span> <span class="id" type="var">nil</span> <span class="id" type="var">tau'</span> <span class="id" type="var">tau''</span>); <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">xval</span> <span class="id" type="var">yval</span> <span class="id" type="var">tau1</span> <span class="id" type="var">tau2</span> <span class="id" type="var">tau3</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H3</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">xval</span> <span class="id" type="var">yval</span> ((<span class="id" type="var">v</span>,vval) :: <span class="id" type="var">tau1</span>) <span class="id" type="var">tau2</span> <span class="id" type="var">tau3</span>); <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_l</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">Acc_tau</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_l</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_x</span> : <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)).<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>] <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_var_bool_ok</span> <span class="id" type="var">x</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_var_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">x_eq_v</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">x</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">find_mem</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_var_bool_ok</span> <span class="id" type="var">v</span> <span class="id" type="var">tau</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">find</span> <span class="id" type="var">eq_var_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">tau</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">K</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">v'</span> [<span class="id" type="var">tau1</span> [<span class="id" type="var">tau2</span> [<span class="id" type="var">K'</span> <span class="id" type="var">K''</span>]]]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H3</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span> <span class="id" type="var">vval</span> <span class="id" type="var">t</span> <span class="id" type="var">nil</span> <span class="id" type="var">tau1</span> <span class="id" type="var">tau2</span>); <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_var_bool_ok</span> <span class="id" type="var">v</span> <span class="id" type="var">varl</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_var_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">varl</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">v_mem_varl</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">v_in_varl</span> : <span class="id" type="var">In</span> <span class="id" type="var">v</span> <span class="id" type="var">varl</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_impl_in</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_vval</span> :  <span class="id" type="var">Interp_dom</span> <span class="id" type="var">vval</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">Acc_tau</span> <span class="id" type="var">_</span> <span class="id" type="var">v_in_varl</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_var_bool_refl</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">p</span> =&gt; <span class="id" type="var">p</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> (<span class="id" type="var">interp_well_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_vval</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">vval'</span> <span class="id" type="var">K</span>].<br/>
<span class="id" type="var">exists</span> ((<span class="id" type="var">v</span>,(vval,vval')) :: <span class="id" type="var">tau'</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">x_in_varl</span> [<span class="id" type="var">x_eq_v</span> | <span class="id" type="var">xtt'_in_tau'</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">x_eq_v</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">apply</span> (<span class="id" type="var">K2</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">v_not_in_varl</span>; <span class="id" type="var">exists</span> ((<span class="id" type="var">v</span>,(vval,vval)) :: <span class="id" type="var">tau'</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">x_in_varl</span> [<span class="id" type="var">x_eq_v</span> | <span class="id" type="var">xtt'_in_tau'</span>]; <br/>
[ <span class="id" type="tactic">injection</span> <span class="id" type="var">x_eq_v</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">v_not_in_varl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span><br/>
| <span class="id" type="tactic">apply</span> (<span class="id" type="var">K2</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">tau'</span> [<span class="id" type="var">H4</span> <span class="id" type="var">H5</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xtt'</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">xtt'</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">x</span>,(t,t')) =&gt; (<span class="id" type="var">x</span>,t') <span class="id" type="keyword">end</span>) <span class="id" type="var">tau'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_varl</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H1</span> <span class="id" type="var">x</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H4</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">find_map</span> <span class="id" type="var">eq_var_bool</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">y</span> : (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">y</span>) <span class="id" type="var">x</span> <span class="id" type="var">tau'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">find_map</span> <span class="id" type="var">eq_var_bool</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">y</span> : (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">y</span>) <span class="id" type="var">x</span> <span class="id" type="var">tau'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">find_mem</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>  <span class="id" type="var">eq_var_bool_ok</span> <span class="id" type="var">x</span> <span class="id" type="var">tau'</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">map_eq</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xval0</span> : <span class="id" type="var">variable</span> * (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) =&gt; (<span class="id" type="var">fst</span> <span class="id" type="var">xval0</span>, <span class="id" type="var">fst</span> (<span class="id" type="var">snd</span> <span class="id" type="var">xval0</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">xtt'</span> : <span class="id" type="var">variable</span> * (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) =&gt; <span class="id" type="keyword">let</span> (<span class="id" type="var">x0</span>, <span class="id" type="var">y</span>) := <span class="id" type="var">xtt'</span> <span class="id" type="keyword">in</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">t</span>, <span class="id" type="var">_</span>) := <span class="id" type="var">y</span> <span class="id" type="keyword">in</span> (<span class="id" type="var">x0</span>, <span class="id" type="var">t</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tau'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">xtt'</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">xtt'</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">x</span>,(t,t')) =&gt; <span class="id" type="var">refl_equal</span> (<span class="id" type="var">x</span>,t) <span class="id" type="keyword">end</span>)).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">map_eq</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">xval0</span> : <span class="id" type="var">variable</span> * (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) =&gt; (<span class="id" type="var">fst</span> <span class="id" type="var">xval0</span>, <span class="id" type="var">snd</span> (<span class="id" type="var">snd</span> <span class="id" type="var">xval0</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">xtt'</span> : <span class="id" type="var">variable</span> * (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>) =&gt; <span class="id" type="keyword">let</span> (<span class="id" type="var">x0</span>, <span class="id" type="var">y</span>) := <span class="id" type="var">xtt'</span> <span class="id" type="keyword">in</span> <span class="id" type="keyword">let</span> (<span class="id" type="var">_</span>, <span class="id" type="var">t'0</span>) := <span class="id" type="var">y</span> <span class="id" type="keyword">in</span> (<span class="id" type="var">x0</span>, <span class="id" type="var">t'0</span>)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">tau'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">xtt'</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">xtt'</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">x</span>,(t,t')) =&gt; <span class="id" type="var">refl_equal</span> (<span class="id" type="var">x</span>,t') <span class="id" type="keyword">end</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">find</span> <span class="id" type="var">eq_var_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">tau'</span>).<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">xval</span> <span class="id" type="var">xval'</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K1</span>, <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">K3</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">x'</span> [<span class="id" type="var">tau1</span> [<span class="id" type="var">tau2</span> [<span class="id" type="var">K4</span> <span class="id" type="var">K5</span>]]]].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">x'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H5</span> <span class="id" type="var">x</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">tau'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K1</span>, <span class="id" type="var">K2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Vcase</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Hclosed</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>, ~G <span class="id" type="var">f</span> -&gt; <span class="id" type="var">symb_sup</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> -&gt; ~G <span class="id" type="var">g</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span> <span class="id" type="var">Hf</span> <span class="id" type="var">H</span> <span class="id" type="var">Gg</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hf</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Gg</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Gg</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g'</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Gg</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> [<span class="id" type="var">u</span> [[<span class="id" type="var">J1</span> <span class="id" type="var">J2</span>] [<span class="id" type="var">J3</span> <span class="id" type="var">J4</span>]]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f'</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">k</span> <span class="id" type="var">v</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">x</span> [<span class="id" type="var">y</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> [<span class="id" type="var">f'</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]]]]]]; <span class="id" type="tactic">apply</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">x</span>; <span class="id" type="var">exists</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">split</span>].<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">f'</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">v</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_at_top_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> -&gt; (<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span> | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; ~G <span class="id" type="var">g</span> <span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>,  <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) -&gt; <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>,l') ((<span class="id" type="var">r</span>,l) :: <span class="id" type="var">nil</span>))  (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">K</span> <span class="id" type="var">K'</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Acc_rs</span> <span class="id" type="var">Acc_ls</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">Il</span> <span class="id" type="var">Ir</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_subst</span> <span class="id" type="var">l</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Acc_ls</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> <span class="id" type="var">Isigma</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">K''</span> : <span class="id" type="var">t'</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">r</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_unicity</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_in_H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g</span> <span class="id" type="var">g_in_r</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">Gdec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="var">g</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">not_Gg</span> | <span class="id" type="var">Gg</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Hclosed</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">r</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">apply</span> <span class="id" type="var">Gdef</span>].<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_r</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Isigma</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">R_reg</span> <span class="id" type="keyword">with</span> <span class="id" type="var">r</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">K''</span> := <span class="id" type="var">proj1</span> (<span class="id" type="var">rwr_interp_subst</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_ls</span> <span class="id" type="var">_</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">Il</span> <span class="id" type="var">Isigma</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="var">constructor</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">left</span>; <span class="id" type="var">constructor</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">one_step_incl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">intros</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_at_top_not_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> -&gt; (<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span> | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">G</span> <span class="id" type="var">g</span> <span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l</span>) <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">K</span> <span class="id" type="var">K'</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Acc_ls</span> <span class="id" type="var">Acc_rs</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">Il</span> <span class="id" type="var">Ir</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Il</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Il</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Il</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">project_comb</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>, <span class="id" type="var">t'</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">rs_in_kk</span> : <span class="id" type="var">In</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H5</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">FB</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">instance</span> <span class="id" type="var">R</span> <span class="id" type="var">r</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) <span class="id" type="var">sigma</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">rs_in_kk</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">rs_in_kk</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">rs</span> <span class="id" type="var">t''</span>] [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_rs'</span> : <span class="id" type="var">Acc</span> <span class="id" type="var">interp_call</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">r</span>) <span class="id" type="var">Acc_rs'</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H8</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_not_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">s</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span> | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">G</span> <span class="id" type="var">g</span> <span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>,l') ((<span class="id" type="var">r</span>,l) :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">K</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">IH</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">K'</span> <span class="id" type="var">K''</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">H2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_at_top_not_H</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K</span>).<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Is</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Is</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f0</span> <span class="id" type="var">l0</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">fl1_in_kk</span> : <span class="id" type="var">In</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H6</span>, <span class="id" type="var">FB</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> : <span class="id" type="var">term</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>, <span class="id" type="var">l'</span>) ((<span class="id" type="var">r</span>, <span class="id" type="var">l</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">t1t2_eq_rl</span> | <span class="id" type="var">t1t2_in_nil</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_rl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">project_comb</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">k'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">fl1_in_kk</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">fl1_in_kk</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">fl1</span> <span class="id" type="var">t''</span>] [<span class="id" type="var">fl1_eq_fl1</span> <span class="id" type="var">fl1_in_kk</span>]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">fl1_eq_fl1</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">fl1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>, <span class="id" type="var">t''</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_unicity</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H9</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_rule_not_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> -&gt; (<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span> | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">G</span> <span class="id" type="var">g</span> <span class="id" type="keyword">end</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>,l') ((<span class="id" type="var">r</span>,l) :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">K</span> <span class="id" type="var">K'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H5</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H5</span> | <span class="id" type="var">H5</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">H5</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H5</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x3</span> | ]; [<span class="id" type="var">contradiction</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">IH</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">K''</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">H2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_at_top_not_H</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Is</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Is</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">It</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">one_step_in_list</span> <span class="id" type="var">H1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K1</span> [<span class="id" type="var">K2</span> <span class="id" type="var">K3</span>]]]]]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_map_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll1</span> [[ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll2</span>] [<span class="id" type="var">K4</span> [<span class="id" type="var">K5</span> <span class="id" type="var">K6</span>]]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_map_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K3</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll3</span> [[ | [<span class="id" type="var">u3</span> <span class="id" type="var">u4</span>] <span class="id" type="var">ll4</span>] [<span class="id" type="var">K7</span> [<span class="id" type="var">K8</span> <span class="id" type="var">K9</span>]]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K3</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K6</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K6</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K6</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K10</span> <span class="id" type="var">K11</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K9</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K9</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K9</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K10</span> <span class="id" type="var">K11</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ll1_eq_ll3</span> : <span class="id" type="var">ll1</span> = <span class="id" type="var">ll3</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Aux</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">ll1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t'') <span class="id" type="var">ll3</span> -&gt; <span class="id" type="var">t'</span> = <span class="id" type="var">t''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">tt'_in_ll1</span> <span class="id" type="var">tt''_in_ll3</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">tt'_in_ll1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">lll1</span> [<span class="id" type="var">lll2</span> <span class="id" type="var">H15</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>, <span class="id" type="var">u2</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> <span class="id" type="var">lll1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">lll1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H13</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">K8</span> <span class="id" type="var">Aux</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">ll3</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">b1</span> <span class="id" type="var">b2</span>] <span class="id" type="var">ll3</span>] <span class="id" type="var">K8</span> <span class="id" type="var">Aux</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K8</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K8</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K8</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHll1</span> <span class="id" type="var">ll3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">t</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ll2_eq_ll4</span> : <span class="id" type="var">ll2</span> = <span class="id" type="var">ll4</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Aux</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t'') <span class="id" type="var">ll4</span> -&gt; <span class="id" type="var">t'</span> = <span class="id" type="var">t''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">tt'_in_ll2</span> <span class="id" type="var">tt''_in_ll4</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">tt'_in_ll2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">lll1</span> [<span class="id" type="var">lll2</span> <span class="id" type="var">H15</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>, <span class="id" type="var">u2</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>,u2) :: <span class="id" type="var">lll1</span>) :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">ll2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>,u2) :: <span class="id" type="var">lll1</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H13</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">K10</span> <span class="id" type="var">Aux</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">ll4</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll2</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span>] <span class="id" type="var">ll2</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">b1</span> <span class="id" type="var">b2</span>] <span class="id" type="var">ll4</span>] <span class="id" type="var">K10</span> <span class="id" type="var">Aux</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K10</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K10</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K10</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHll2</span> <span class="id" type="var">ll4</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">t</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">ll3</span> <span class="id" type="var">ll4</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">rwr_list</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">rwr_list_expand_strong</span>; <br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>;<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>);<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll2</span>);<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>, <span class="id" type="var">u2</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> <span class="id" type="var">ll1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u'</span>, <span class="id" type="var">u4</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> <span class="id" type="var">ll1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H13</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f0</span> <span class="id" type="var">l0</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">fl1_in_kk</span> : <span class="id" type="var">In</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">kk</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H6</span>, <span class="id" type="var">FB</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> : <span class="id" type="var">term</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>, <span class="id" type="var">l'</span>) ((<span class="id" type="var">r</span>, <span class="id" type="var">l</span>) :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">t1t2_eq_rl</span> | <span class="id" type="var">t1t2_in_nil</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_rl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">project_comb</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">k'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">fl1_in_kk</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">fl1_in_kk</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">fl1</span> <span class="id" type="var">t''</span>] [<span class="id" type="var">fl1_eq_fl1</span> <span class="id" type="var">fl1_in_kk</span>]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">fl1_eq_fl1</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">fl1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>, <span class="id" type="var">t''</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_unicity</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H9</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_rule_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> -&gt; (<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span> | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; ~G <span class="id" type="var">g</span> <span class="id" type="keyword">end</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>,l') ((<span class="id" type="var">r</span>,l) :: <span class="id" type="var">nil</span>)) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>,l') ((<span class="id" type="var">r</span>,l) :: <span class="id" type="var">nil</span>)) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> <span class="id" type="var">K</span> <span class="id" type="var">K'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H5</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H5</span> | <span class="id" type="var">H5</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">H5</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H5</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x3</span> | ]; [<span class="id" type="var">contradiction</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">IH</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">K''</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2</span> | <span class="id" type="var">H2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_at_top_H</span> <span class="id" type="keyword">with</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Is</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">It</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">general_context</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">one_step_in_list</span> <span class="id" type="var">H1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">K1</span> [<span class="id" type="var">K2</span> <span class="id" type="var">K3</span>]]]]]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_map_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll1</span> [[ | [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span>] <span class="id" type="var">ll2</span>] [<span class="id" type="var">K4</span> [<span class="id" type="var">K5</span> <span class="id" type="var">K6</span>]]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_map_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K3</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ll3</span> [[ | [<span class="id" type="var">u3</span> <span class="id" type="var">u4</span>] <span class="id" type="var">ll4</span>] [<span class="id" type="var">K7</span> [<span class="id" type="var">K8</span> <span class="id" type="var">K9</span>]]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K3</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K6</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K6</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K6</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K10</span> <span class="id" type="var">K11</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K9</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K9</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K9</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">K10</span> <span class="id" type="var">K11</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ll1_eq_ll3</span> : <span class="id" type="var">ll1</span> = <span class="id" type="var">ll3</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Aux</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">ll1</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t'') <span class="id" type="var">ll3</span> -&gt; <span class="id" type="var">t'</span> = <span class="id" type="var">t''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">tt'_in_ll1</span> <span class="id" type="var">tt''_in_ll3</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">tt'_in_ll1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">lll1</span> [<span class="id" type="var">lll2</span> <span class="id" type="var">H15</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>, <span class="id" type="var">u2</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> <span class="id" type="var">lll1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">ll1</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">lll1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H13</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">K8</span> <span class="id" type="var">Aux</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">ll3</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll1</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span>] <span class="id" type="var">ll1</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">b1</span> <span class="id" type="var">b2</span>] <span class="id" type="var">ll3</span>] <span class="id" type="var">K8</span> <span class="id" type="var">Aux</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K8</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K8</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K8</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHll1</span> <span class="id" type="var">ll3</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">t</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">ll2_eq_ll4</span> : <span class="id" type="var">ll2</span> = <span class="id" type="var">ll4</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Aux</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t') <span class="id" type="var">ll2</span> -&gt; <span class="id" type="var">In</span> (<span class="id" type="var">t</span>,t'') <span class="id" type="var">ll4</span> -&gt; <span class="id" type="var">t'</span> = <span class="id" type="var">t''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">tt'_in_ll2</span> <span class="id" type="var">tt''_in_ll4</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">tt'_in_ll2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">lll1</span> [<span class="id" type="var">lll2</span> <span class="id" type="var">H15</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>, <span class="id" type="var">u2</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>,u2) :: <span class="id" type="var">lll1</span>) :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">ll2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">ass_app</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>,u2) :: <span class="id" type="var">lll1</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H13</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">K10</span> <span class="id" type="var">Aux</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">ll4</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">ll2</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">a1</span> <span class="id" type="var">a2</span>] <span class="id" type="var">ll2</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">b1</span> <span class="id" type="var">b2</span>] <span class="id" type="var">ll4</span>] <span class="id" type="var">K10</span> <span class="id" type="var">Aux</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K10</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K10</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K10</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> <span class="id" type="var">b2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHll2</span> <span class="id" type="var">ll4</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> <span class="id" type="var">t''</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">Aux</span> <span class="id" type="var">t</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">ll3</span> <span class="id" type="var">ll4</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">rwr_list</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">rwr_list_expand_strong</span>; <br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u4</span>;<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>);<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll2</span>);<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">snd</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll2</span>).<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">u</span> <span class="id" type="var">u'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u</span>, <span class="id" type="var">u2</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> <span class="id" type="var">ll1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_dom_subterm</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Term</span> <span class="id" type="var">f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) (<span class="id" type="var">ll1</span> ++ (<span class="id" type="var">u'</span>, <span class="id" type="var">u4</span>) :: <span class="id" type="var">ll2</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">length</span> <span class="id" type="var">ll1</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">map_app</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> : <span class="id" type="var">term</span> * <span class="id" type="var">term</span> =&gt; <span class="id" type="var">fst</span> <span class="id" type="var">st</span>) <span class="id" type="var">ll1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H6</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H13</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f0</span> <span class="id" type="var">l0</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span>  (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)).<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">rwr_not_H</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_rule_H_not_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">one_step</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">K</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">split_rules</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="var">R_var</span> <span class="id" type="var">G</span> <span class="id" type="var">Gdef'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">U1</span> <span class="id" type="var">U2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Erule</span> := <span class="id" type="var">one_step_one_rule</span> <span class="id" type="var">R</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Erule</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">r</span> [<span class="id" type="var">l</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K1</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">Gdec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">f_in_H</span> | <span class="id" type="var">f_not_in_H</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;(<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">term</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">r'</span> <span class="id" type="var">l'</span> : <span class="id" type="var">term</span> =&gt; <span class="id" type="var">In</span> (<span class="id" type="var">r'</span>, <span class="id" type="var">l'</span>) ((<span class="id" type="var">r</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) :: <span class="id" type="var">nil</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> [[<span class="id" type="var">K3</span> | <span class="id" type="var">Abs</span>] | <span class="id" type="var">K3</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">U1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">K1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> | <span class="id" type="var">K1</span>].<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">K1</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_in_H</span>;<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Gdef'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">f_in_H</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">rwr_rule_H</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K1</span> <span class="id" type="var">f_in_H</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">K2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">K3</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">f_not_in_H</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">rwr_rule_not_H</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K1</span> <span class="id" type="var">f_not_in_H</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">K2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Is</span> <span class="id" type="var">It</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">trans_rwr_rule_H_not_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Interp</span> <span class="id" type="var">t</span> <span class="id" type="var">t'</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">rwr</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>)) <span class="id" type="var">t'</span> <span class="id" type="var">s'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_s'</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">K</span> | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_rule_H_not_H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_interp_dom</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_interp_dom</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t3'</span> <span class="id" type="var">t1'</span> <span class="id" type="var">I3</span> <span class="id" type="var">I1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t2</span> : <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_interp_dom</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>)).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_trans</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> (<span class="id" type="var">interp_well_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_t2</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">t2'</span> <span class="id" type="var">I2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_rule_H_not_H</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_interp_dom</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>)).<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t3</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_trans</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHK2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_interp_dom_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, ~G <span class="id" type="var">f</span> -&gt; <span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) -&gt; <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">f_in_H</span> <span class="id" type="var">Acc_l1</span> <span class="id" type="var">K1</span>.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>] <span class="id" type="var">g</span> <span class="id" type="var">l</span> <span class="id" type="var">Sub</span> <span class="id" type="var">g_not_in_H</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_in_H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">l2</span>); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l2</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ai</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">K</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">L</span> <span class="id" type="var">K'</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">q</span> <span class="id" type="var">ai</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_sub_acc_sub_acc_sub</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">head_P_in_H</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">mark</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span>, <span class="id" type="var">P</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span> -&gt; <span class="id" type="var">mrel</span> <span class="id" type="var">mark</span> (<span class="id" type="var">dp</span> <span class="id" type="var">R</span>) <span class="id" type="var">v</span> <span class="id" type="var">u</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">P</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span> = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> -&gt; ~G <span class="id" type="var">f</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">mark</span> <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">K3</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> [<span class="id" type="var">K4</span> <span class="id" type="var">K5</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">K5</span>.<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l'</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">_D</span> := <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K1</span>); <span class="id" type="tactic">inversion</span> <span class="id" type="var">_D</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">D</span> <span class="id" type="var">J1</span> <span class="id" type="var">J2</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">D</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">interp_dom_interp_dom_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">mark</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>, <span class="id" type="var">P</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> -&gt; <span class="id" type="var">mrel</span> <span class="id" type="var">mark</span> (<span class="id" type="var">dp</span> <span class="id" type="var">R</span>) <span class="id" type="var">u</span> <span class="id" type="var">v</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> -&gt;  <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">P</span>) <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Interp_dom</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">mark</span> <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_sub_s</span> <span class="id" type="var">Acc_sub_t</span> <span class="id" type="var">K</span> <span class="id" type="var">Is</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_f</span> <span class="id" type="var">ls</span> <span class="id" type="var">l</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_t</span> <span class="id" type="var">_fl</span> <span class="id" type="var">sigma</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> <span class="id" type="var">K3</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">_K</span> := <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K1</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">fk</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">_K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">fk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> <span class="id" type="var">v</span> <span class="id" type="var">p</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">f2_in_H</span> : ~G (<span class="id" type="var">mark</span> <span class="id" type="var">f2</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">head_P_in_H</span> <span class="id" type="var">mark</span> <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">nil</span> (<span class="id" type="var">mark</span> <span class="id" type="var">f2</span>) <span class="id" type="var">l2</span> <span class="id" type="var">K1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">empty_subst_is_id</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>] <span class="id" type="var">g</span> <span class="id" type="var">k'</span> <span class="id" type="var">Sub'</span> <span class="id" type="var">g_not_in_H</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f2_in_H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub'</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l2</span>)); <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l2</span>) <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ai</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">K'</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">K'</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">L</span> <span class="id" type="var">K''</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">q</span> <span class="id" type="var">ai</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_sub_t</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">pi_in_H</span> : ~G <span class="id" type="var">pi</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Dpi</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Dpi</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">PPi</span> <span class="id" type="var">t</span> (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> <span class="id" type="var">l</span>) <span class="id" type="var">H1</span> <span class="id" type="var">pi</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_symb_bool_refl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Q8_weak</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">mark</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ~defined <span class="id" type="var">R</span> (<span class="id" type="var">mark</span> <span class="id" type="var">f</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>, <span class="id" type="var">P</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> -&gt; <span class="id" type="var">mrel</span> <span class="id" type="var">mark</span> (<span class="id" type="var">dp</span> <span class="id" type="var">R</span>) <span class="id" type="var">u</span> <span class="id" type="var">v</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">Interp_dom</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s'</span>, <span class="id" type="var">Interp</span> <span class="id" type="var">s</span> <span class="id" type="var">s'</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">P</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span>  (<span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">s'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">P</span>) <span class="id" type="var">R</span>)) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">mark</span> <span class="id" type="var">mark_ok</span> <span class="id" type="var">P_in_dpR</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">acc_rdp_var</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">P</span>) <span class="id" type="var">R</span>)) (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">subst</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">s'</span> <span class="id" type="var">Is</span> <span class="id" type="var">Acc_s'</span>; <span class="id" type="var">revert</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Is</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_s'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">s'</span> <span class="id" type="var">Acc_s''</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_s'</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">P</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span>  (<span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) <span class="id" type="var">s'</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">Acc_s''</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_s''</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_s</span> <span class="id" type="var">Is</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">ls</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_rdp_var</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">Gdec</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Rlist_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Plist_ok</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">f_in_H</span> | <span class="id" type="var">f_not_in_H</span>]; <br/>
[ <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">f_in_H</span><br/>
| <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">f_not_in_H</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> [<span class="id" type="var">K</span> [<span class="id" type="var">Acc_sub_t</span>  <span class="id" type="var">Acc_sub_s</span>]].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> := <span class="id" type="var">interp_dom_interp_dom_2</span> <span class="id" type="var">mark</span> <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_sub_s</span> <span class="id" type="var">Acc_sub_t</span> <span class="id" type="var">K</span> <span class="id" type="var">Acc_s</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> (<span class="id" type="var">interp_well_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_t</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">It</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_f</span> <span class="id" type="var">_ls</span> <span class="id" type="var">l</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_v</span> <span class="id" type="var">_fl</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H1</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">_K</span> := <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> <span class="id" type="var">fl</span> <span class="id" type="var">K</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">fl'</span> <span class="id" type="var">r</span> <span class="id" type="var">p</span> <span class="id" type="var">g</span> <span class="id" type="var">lv</span> <span class="id" type="var">H0</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Dg</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Is</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f'</span> <span class="id" type="var">_ls</span> <span class="id" type="var">ls'</span> <span class="id" type="var">lls</span> <span class="id" type="var">_</span> <span class="id" type="var">H8</span> <span class="id" type="var">H9</span> <span class="id" type="var">Ills</span> | ]; <br/>
[<span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span> <span class="id" type="var">_ls</span> <span class="id" type="var">s'</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">g_in_H</span> := <span class="id" type="var">head_P_in_H</span> <span class="id" type="var">mark</span> <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">sigma</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">It</span> <span class="id" type="keyword">as</span> [ |  <span class="id" type="var">g'</span> <span class="id" type="var">lt</span> <span class="id" type="var">lt'</span> <span class="id" type="var">llt</span> <span class="id" type="var">_</span> <span class="id" type="var">H4</span> <span class="id" type="var">H5</span> <span class="id" type="var">Illt</span> | ]; [ <span class="id" type="tactic">subst</span> <span class="id" type="var">g'</span> <span class="id" type="var">t'</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g</span>)); <span class="id" type="tactic">assumption</span>].<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_fl</span> := <span class="id" type="var">interp_dom_interp_dom_1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">f_in_H</span> <span class="id" type="var">Acc_sub_s</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H5'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_fl</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_subst</span> <span class="id" type="var">_</span> <span class="id" type="var">sigma</span> <span class="id" type="var">Acc_fl</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">sigma'</span> <span class="id" type="var">Isigma</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> <span class="id" type="var">_</span> (<span class="id" type="var">interp_well_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_fl</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">fl'</span> <span class="id" type="var">Ifl</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H5'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ifl</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Ifl</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">f'</span> <span class="id" type="var">_l</span> <span class="id" type="var">l'</span> <span class="id" type="var">ll</span> <span class="id" type="var">_</span> <span class="id" type="var">H10</span> <span class="id" type="var">H11</span> <span class="id" type="var">Ill</span> | ]; [<span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span> <span class="id" type="var">_l</span> <span class="id" type="var">fl'</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">G</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_subterm_rdp_rdp</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">revert</span> <span class="id" type="var">Ills</span> <span class="id" type="var">Ill</span> <span class="id" type="var">Acc_sub_s</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="var">revert</span> <span class="id" type="var">ll</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">lls</span> <span class="id" type="keyword">as</span> [ | [<span class="id" type="var">s</span> <span class="id" type="var">s'</span>] <span class="id" type="var">lls</span>]; <span class="id" type="tactic">intros</span> [ | [<span class="id" type="var">u</span> <span class="id" type="var">u'</span>] <span class="id" type="var">ll</span>] <span class="id" type="var">Ills</span> <span class="id" type="var">Ill</span> <span class="id" type="var">Acc_sub_s</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">refl_trans_clos_one_step_list_length_eq</span> <span class="id" type="var">K</span>); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">refl_trans_clos_one_step_list_length_eq</span> <span class="id" type="var">K</span>); <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span> <span class="id" type="keyword">in</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">K</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">refl_trans_clos_one_step_list_head_tail</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_s</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_sub_s</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_s'</span> : <span class="id" type="var">Acc</span> <span class="id" type="var">interp_call</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">acc_one_step_interp_dom</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_s'</span> <span class="id" type="var">s'</span> <span class="id" type="var">u'</span>).<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ills</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ill</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_rwr_rule_H_not_H</span> <span class="id" type="keyword">with</span> <span class="id" type="var">s</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ills</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ill</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHlls</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ills</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Ill</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_sub_s</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_sub</span> : <span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">acc_sub</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">rwr_sub_acc_sub_acc_sub</span> <span class="id" type="var">R</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span> <span class="id" type="var">Acc_sub_s</span>).<br/>

<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H5'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ifl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">rwr_interp_subst</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_fl</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span>) <span class="id" type="var">sigma'</span> <span class="id" type="var">Ifl</span> <span class="id" type="var">Isigma</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">fl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">_f</span> <span class="id" type="var">_l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H0</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H5'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H5'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">rwr_subterm_rdp_rdp</span> <span class="id" type="keyword">with</span>  (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span>) <span class="id" type="var">_l</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H5</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H10</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H10</span> <span class="id" type="var">f_in_H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H10</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">H10</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_incl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_incl</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>.<br/>
<span class="id" type="tactic">do</span> 3 <span class="id" type="tactic">intro</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t'_eq_glvs'</span> : <span class="id" type="var">Term</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g</span>) <span class="id" type="var">lt'</span> = <span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span> (<span class="id" type="var">Term</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g</span>) <span class="id" type="var">lv</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">interp_unicity</span> <span class="id" type="var">_</span> (<span class="id" type="var">interp_well_defined</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_t</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_in_H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">g'</span> <span class="id" type="var">g'_glv</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_unfold</span> <span class="id" type="keyword">in</span> <span class="id" type="var">g'_glv</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_symb_bool_ok</span> <span class="id" type="var">g'</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g</span>)); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_symb_bool</span> <span class="id" type="var">g'</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g</span>)).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">g'_glv</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Dg'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Dg'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g''</span> <span class="id" type="var">k</span> <span class="id" type="var">t</span> [<span class="id" type="var">K</span> <span class="id" type="var">K'</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">g''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">K'</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mark_term</span> <span class="id" type="var">mark</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">lv</span>));<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mark_term</span> <span class="id" type="var">mark</span> (<span class="id" type="var">Term</span> <span class="id" type="var">_f</span> <span class="id" type="var">_l</span>)); <span class="id" type="tactic">split</span>; [ | <span class="id" type="tactic">split</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">g'</span>; <span class="id" type="tactic">split</span>; [ | <span class="id" type="var">left</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">symb_in_term_unfold</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">g'_glv</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_symb_bool</span> <span class="id" type="var">g'</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">x_in_lv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Isigma</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">R_reg</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H0</span> <span class="id" type="var">x</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">var_in_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">lv</span>) <span class="id" type="var">p</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">t'_eq_glvs'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Rdp_step</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma'</span>) <span class="id" type="var">_l</span>).<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">instance</span> <span class="id" type="var">P</span> (<span class="id" type="var">Term</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g</span>) <span class="id" type="var">lv</span>) (<span class="id" type="var">Term</span> (<span class="id" type="var">mark</span> <span class="id" type="var">_f</span>) <span class="id" type="var">_l</span>) <span class="id" type="var">sigma'</span>); <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H4</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_t1</span> <span class="id" type="var">_t2</span> <span class="id" type="var">sigma</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H4</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">_K1</span> := <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H1</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_K1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">K1</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x2</span> | <span class="id" type="var">g2</span> <span class="id" type="var">k2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H0</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">f_not_in_H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">mark_ok</span> <span class="id" type="var">g2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">f_not_in_H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">g2'</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]].<br/>
<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Q8_strong</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">mark</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, ~defined <span class="id" type="var">R</span> (<span class="id" type="var">mark</span> <span class="id" type="var">f</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">v</span> <span class="id" type="var">u</span>, <span class="id" type="var">P</span> <span class="id" type="var">u</span> <span class="id" type="var">v</span> -&gt; <span class="id" type="var">mrel</span> <span class="id" type="var">mark</span> (<span class="id" type="var">dp</span> <span class="id" type="var">R</span>) <span class="id" type="var">u</span> <span class="id" type="var">v</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">P</span>) (<span class="id" type="var">union</span> <span class="id" type="var">_</span>  (<span class="id" type="var">UsableRules</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">V0</span> <span class="id" type="var">V1</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span>  (<span class="id" type="var">rest</span> (<span class="id" type="var">acc_sub</span> <span class="id" type="var">R</span>) (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> <span class="id" type="var">P</span>) <span class="id" type="var">R</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">mark</span> <span class="id" type="var">mark_ok</span> <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">Wf</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> [<span class="id" type="var">_</span> <span class="id" type="var">Ht</span>]].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">s'</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_t1</span> <span class="id" type="var">_t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">_H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">_K2</span> := <span class="id" type="var">P_in_dpR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_H2</span>).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">_K2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">_K2</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">K2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u1</span> <span class="id" type="var">u2</span> <span class="id" type="var">p</span> <span class="id" type="var">f2</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span> <span class="id" type="var">Sub</span> <span class="id" type="var">Df2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x2</span> | <span class="id" type="var">g2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">R_var</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> : <span class="id" type="var">Interp_dom</span> (<span class="id" type="var">Term</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g2</span>) <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>] <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">Sub'</span> <span class="id" type="var">Gf</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Sub'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Gdef'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Gf</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Gf</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f</span> <span class="id" type="var">l'</span> <span class="id" type="var">t</span> [<span class="id" type="var">K</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">mark_ok</span> <span class="id" type="var">g2</span>); <span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l'</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sub'</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l1</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">ai</span> | ]; [ | <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">K</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">kk1</span> [<span class="id" type="var">kk2</span> [<span class="id" type="var">L</span> <span class="id" type="var">K1</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">acc_subterms_3</span> <span class="id" type="keyword">with</span> <span class="id" type="var">q</span> <span class="id" type="var">ai</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Ht</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">interp_defined</span> (<span class="id" type="var">Term</span> (<span class="id" type="var">mark</span> <span class="id" type="var">g2</span>) <span class="id" type="var">l1</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">It</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">interp_well_defined</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Q8_weak</span> <span class="id" type="keyword">with</span> <span class="id" type="var">mark</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Interp_definition</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">MakeUsableDP</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>