<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>ac_matching.matching_complete</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library ac_matching.matching_complete</h1>

<div class="code">

<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_algebra".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_orderings".<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">list_sort</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">ac</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">cf_eq_ac</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">matching_sound</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">S</span>.<br/>

<br/>
<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">SMatching</span> : <span class="id" type="var">matching_sound.S</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">WFMMatching</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">WFMatching</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Matching</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Cf_eq_ac</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Ac</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">EqTh</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">solve_is_complete</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pb</span>, <span class="id" type="var">well_formed_pb</span> <span class="id" type="var">pb</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">is_well_formed_sol</span> <span class="id" type="var">pb</span> <span class="id" type="var">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">pb</span>.(<span class="id" type="var">unsolved_part</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">pb'</span>, <span class="id" type="var">In</span> <span class="id" type="var">pb'</span> (<span class="id" type="var">solve</span> <span class="id" type="var">pb</span>) /\ <span class="id" type="var">is_well_formed_sol</span> <span class="id" type="var">pb'</span> <span class="id" type="var">sigma</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">S</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">SMatching1</span> : <span class="id" type="var">matching_sound.S</span>) :<br/>
&nbsp;<span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">SMatching</span> := <span class="id" type="var">SMatching1</span>.<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">SMatching</span> := <span class="id" type="var">SMatching1</span>.<br/>

<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">SMatching1</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">WFMMatching</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">WFMatching</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Matching</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Cf_eq_ac</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Ac</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">EqTh</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">X</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="keyword">Sort</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">LPermut</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_a_subterm</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">l1</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="var">well_formed_cf_subst</span> <span class="id" type="var">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)  -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) = <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>)) = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">f</span>=g<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">rmv</span> =&gt;  <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">build</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) = <span class="id" type="var">build</span> <span class="id" type="var">f</span> <span class="id" type="var">rmv</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">l1</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">Ar</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'''</span> | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">cp1</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [ <span class="id" type="var">H''</span> [<span class="id" type="var">l2_eq</span> <span class="id" type="var">l2'''_eq</span>]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">cp1</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'''</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_cons</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">flatten_apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l1</span> <span class="id" type="var">Ar</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">flatten_build</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>) <span class="id" type="var">Ar</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_cons_inside</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)) <span class="id" type="tactic">by</span> <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">setoid_rewrite</span> &lt;- <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f_eq_g</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">f</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_alien</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Wt2</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">ll</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_cons_inside</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">ll</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">ll</span>)) <span class="id" type="tactic">by</span> <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">setoid_rewrite</span> &lt;- <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l2'_l2''</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l2'_l2''</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s_in_l2'</span> | <span class="id" type="var">s_in_l2''</span>];<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_alien</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Wt2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t_not_in_l2</span>; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">ll</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_not_in_l2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)  (<span class="id" type="var">quick_permut</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span> :: <span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l1</span>)))); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f_eq_g</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f_diff_g</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t_not_in_l2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">ll</span>) (<span class="id" type="var">quick_permut</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">ll</span> :: <span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l1</span>)))).<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_several_subterms</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">l1</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="var">well_formed_cf_subst</span> <span class="id" type="var">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) = <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>)) = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">l0</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove_list</span> <span class="id" type="var">l0</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l3</span> =&gt;  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> <span class="id" type="var">le_gt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l3</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">build</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) = <span class="id" type="var">build</span> <span class="id" type="var">f</span> <span class="id" type="var">l3</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">l1</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">Ar</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">ll</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">W_v</span> : <span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)). <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">W_v_sigma</span> := <span class="id" type="var">well_formed_cf_apply_subst</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">_</span> <span class="id" type="var">W_v</span>);<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">W_v_sigma</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove_list</span> (<span class="id" type="var">well_formed_cf_sorted</span> <span class="id" type="var">Ar</span> <span class="id" type="var">W_v_sigma</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">well_formed_cf_sorted</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Wt2</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_list</span> <span class="id" type="var">ll</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'</span> | ].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">elim</span> (<span class="id" type="var">le_gt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2'</span>)); <span class="id" type="tactic">intro</span> <span class="id" type="var">L</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Al_l2'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l2'</span> -&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span> <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span> | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">f</span> &lt;&gt; <span class="id" type="var">g</span> <span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">In_t</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_alien</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Wt2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">list_permut.in_permut_in</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_cons</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_cf_length</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Wt1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">In_t</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_subterms</span> <span class="id" type="var">Wt2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">list_permut.in_permut_in</span> <span class="id" type="var">P</span>);<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">flatten_apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l1</span> <span class="id" type="var">Ar</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">flatten_build</span> <span class="id" type="var">l2'</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Al_l2'</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_app1</span> <span class="id" type="var">ll</span>).<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">plus_lt_compat_l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">length</span> <span class="id" type="var">ll</span>) <span class="id" type="var">L</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">length_app</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="var">list_permut.permut_length</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">setoid_rewrite</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">L'</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_quicksort</span>; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">L''</span> := <span class="id" type="var">plus_lt_reg_l</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">length</span> <span class="id" type="var">ll</span>) <span class="id" type="var">L'</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">L</span> <span class="id" type="var">L'</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> &lt; <span class="id" type="var">length</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">le_lt_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">L''</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">length_flatten_bis</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_in_map_l1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t'_in_map_l1</span>;<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t'_in_map_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">Wt</span> <span class="id" type="var">t_sigma</span>]].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_subterms</span> <span class="id" type="var">Wt1</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">P</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l1</span>)));<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_several_subterms_bis</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span> <span class="id" type="var">l1</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="var">well_formed_cf_subst</span> <span class="id" type="var">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>)) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">quicksort</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>)) = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span>  | <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span>  | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">f</span>&lt;&gt;g <span class="id" type="keyword">end</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l3</span> =&gt; <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>  (<span class="id" type="var">build</span> <span class="id" type="var">f</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span> :: <span class="id" type="var">l1</span>)) = <span class="id" type="var">build</span> <span class="id" type="var">f</span> <span class="id" type="var">l3</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span> <span class="id" type="var">l1</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">Ar</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'''</span> | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">cp1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [ <span class="id" type="var">H''</span> [<span class="id" type="var">l2_eq</span> <span class="id" type="var">l2'''_eq</span>]]]]] <span class="id" type="var">Al_t</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l2'''_eq</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">s_eq_v'</span> | <span class="id" type="var">s_in_l1</span>]; [<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span> | <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_subterms</span> <span class="id" type="var">Wt1</span>); <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">s_eq_v'</span> | <span class="id" type="var">s_in_l1</span>]; [<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span> | <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_alien</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Wt1</span>); <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">flatten_apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span> :: <span class="id" type="var">l1</span>) <span class="id" type="var">Ar</span>);<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">flatten_build</span> <span class="id" type="var">l2'''</span> <span class="id" type="var">Ar</span>); <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'''</span> <span class="id" type="var">cp1'</span>.<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_cons_inside</span> <span class="id" type="var">t</span> <span class="id" type="var">t</span>) <span class="id" type="tactic">by</span> <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">pattern</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">pattern</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_cf_subst</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_sigma</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Inj</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l''</span> -&gt; <span class="id" type="var">l'</span> = <span class="id" type="var">l''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">setoid_rewrite</span> &lt;- (<span class="id" type="var">Inj</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_sigma</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">Inj</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>.<br/>
<span class="id" type="tactic">transitivity</span><br/>
&nbsp;&nbsp;(<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>)  :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>) ++<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span> :: <span class="id" type="var">l1</span>))) <span class="id" type="keyword">with</span><br/>
((<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">nil</span>)) ++ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l1</span>));<br/>
[ <span class="id" type="tactic">rewrite</span> <span class="id" type="var">app_comm_cons</span> | <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_app2</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="keyword">with</span><br/>
((<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)));<br/>
[<span class="id" type="var">idtac</span> | <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">app_nil_end</span>; <span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">ll</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">g</span>); <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l2'_l2''</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l2'_l2''</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">s_in_l2'</span> | <span class="id" type="var">s_in_l2''</span>];<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_alien</span> <span class="id" type="var">Ar</span> <span class="id" type="var">Wt2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Not_in</span> <span class="id" type="var">Al_t</span>;<br/>
<span class="id" type="tactic">pattern</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Ar</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">pattern</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_cf_subst</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_sigma</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Inj</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l''</span> -&gt; <span class="id" type="var">l'</span> = <span class="id" type="var">l''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">Inj</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_sigma</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">Not_in</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Inj</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Not_in</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">in_quick_in</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">in_quick_in</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="keyword">with</span><br/>
(<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>)  :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">ll</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">g</span>); <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_several_subterms_bis_nil</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>, <span class="id" type="var">arity</span> <span class="id" type="var">f</span> = <span class="id" type="var">AC</span> -&gt; <span class="id" type="var">well_formed_cf_subst</span> <span class="id" type="var">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">quicksort</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>))) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span>  | <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span>  | <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">f</span>&lt;&gt;g <span class="id" type="keyword">end</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">l3</span> =&gt; <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) = <span class="id" type="var">build</span> <span class="id" type="var">f</span> <span class="id" type="var">l3</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">sigma</span> <span class="id" type="var">f</span> <span class="id" type="var">v</span> <span class="id" type="var">v'</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span> <span class="id" type="var">Ar</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">t1_sigma</span> <span class="id" type="var">Al_t</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">t</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'''</span> | ].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">cp1</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [ <span class="id" type="var">H'</span> [<span class="id" type="var">l2_eq</span> <span class="id" type="var">l2'''_eq</span>]]]]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l2'''_eq</span>;<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>).<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_cons</span> <span class="id" type="var">t</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2''</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>:= <span class="id" type="var">trans_eq</span> (<span class="id" type="var">sym_eq</span> <span class="id" type="var">v_sigma</span>) <span class="id" type="var">t1_sigma</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Inj</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l''</span> -&gt; <span class="id" type="var">l'</span> = <span class="id" type="var">l''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">cp1</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">Inj</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">Inj</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> <br/>
(<span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">flatten</span> <span class="id" type="var">f</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">ll</span> ]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">g</span>); <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_build_inside</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">cp1</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Not_in</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Not_in</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">trans_eq</span> (<span class="id" type="var">sym_eq</span> <span class="id" type="var">v_sigma</span>) <span class="id" type="var">t1_sigma</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Inj</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span>, <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l'</span> = <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l''</span> -&gt; <span class="id" type="var">l'</span> = <span class="id" type="var">l''</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l'</span> <span class="id" type="var">l''</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">Inj</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">Inj</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">in_quick_in</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span>:= <span class="id" type="var">flatten_app</span> <span class="id" type="var">f</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) :: <span class="id" type="var">nil</span>) (<span class="id" type="var">t</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span>  <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">ll</span> ]; <span class="id" type="tactic">simpl</span>; [<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">g</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f_eq_g</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f</span> = <span class="id" type="var">g</span>); <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">solve_is_complete</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">pb</span>, <span class="id" type="var">well_formed_pb</span> <span class="id" type="var">pb</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">is_well_formed_sol</span> <span class="id" type="var">pb</span> <span class="id" type="var">sigma</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">pb</span>.(<span class="id" type="var">unsolved_part</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span> :: <span class="id" type="var">_</span> =&gt; <span class="id" type="var">exists</span> <span class="id" type="var">pb'</span>, <span class="id" type="var">In</span> <span class="id" type="var">pb'</span> (<span class="id" type="var">solve</span> <span class="id" type="var">pb</span>) /\ <span class="id" type="var">is_well_formed_sol</span> <span class="id" type="var">pb'</span> <span class="id" type="var">sigma</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">pb</span> <span class="id" type="var">W</span> <span class="id" type="var">sigma'</span> [<span class="id" type="var">sigma</span> [<span class="id" type="var">S</span> [<span class="id" type="var">S'</span> <span class="id" type="var">W_sigma</span>]]].<br/>
<span class="id" type="var">case_eq</span> <span class="id" type="var">pb</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">ex</span> [ | [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span>] <span class="id" type="var">unsolved_p</span>] <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span> <span class="id" type="var">Pb</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>:term, <span class="id" type="var">is_rough_sol</span> <span class="id" type="var">pb</span> (((<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>), <span class="id" type="var">t</span>) :: <span class="id" type="var">sigma</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">add_new_var_to_rough_sol</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Fresh_var</span> := <span class="id" type="var">fresh_var_spec</span> <span class="id" type="var">pb</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">S'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">W</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">W</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">W1_pb</span> [<span class="id" type="var">W2_pb</span> [<span class="id" type="var">W3_pb</span> [<span class="id" type="var">W4_pb</span> [<span class="id" type="var">W5_pb</span> <span class="id" type="var">W6_pb</span>]]]]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">S</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">S</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">S1</span> [<span class="id" type="var">S2</span> <span class="id" type="var">S3</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">W1_pb</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))) <span class="id" type="keyword">as</span> [<span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1_sigma</span> := <span class="id" type="var">S1</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">unsolved_part</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">simpl</span> <span class="id" type="var">solved_part</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">simpl</span> <span class="id" type="var">partly_solved_part</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">simpl</span> <span class="id" type="var">existential_vars</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">solve</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">find</span> <span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">solved_p</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">x_val</span> <span class="id" type="var">F</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">F</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">x_val</span> <span class="id" type="var">t2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">T.eq_bool</span> <span class="id" type="var">x_val</span> <span class="id" type="var">t2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">x_val_eq_t2</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">x_val_diff_t2</span>].<br/>

<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">x_val</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> <span class="id" type="var">unsolved_p</span> <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">ab_in_unsolved_p</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">x_val</span> = <span class="id" type="var">t2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">S3</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">find</span> <span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">partly_solved_p</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">pst</span> <span class="id" type="var">F'</span>| <span class="id" type="tactic">intros</span> <span class="id" type="var">F'</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">E</span> := <span class="id" type="var">S2</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">partly_solved_part</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">E</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>) (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>));<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>) (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">h_diff_h</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">h_diff_h</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">W3_pb</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">simpl</span> <span class="id" type="var">partly_solved_part</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F'</span>.<br/>
<span class="id" type="var">destruct_arity</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>) <span class="id" type="var">n</span> <span class="id" type="var">Af2</span>; [<span class="id" type="tactic">intros</span> [<span class="id" type="var">Wct</span> <span class="id" type="var">Act</span>] | <span class="id" type="var">contradiction</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">E</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Wt2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">t1_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">E</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">remove_several_subterms_bis_nil</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">v</span> (<span class="id" type="var">new_var</span> <span class="id" type="var">pst</span>) (<span class="id" type="var">closed_term</span> <span class="id" type="var">pst</span>) <span class="id" type="var">_</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Af2</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">E</span> <span class="id" type="var">E</span> <span class="id" type="var">Act</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">closed_term</span> <span class="id" type="var">pst</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">quicksort</span> (<span class="id" type="var">flatten</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> (<span class="id" type="var">new_var</span> <span class="id" type="var">pst</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id" type="var">closed_term</span> <span class="id" type="var">pst</span> :: <span class="id" type="var">nil</span>)))) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'</span> | ].<br/>

<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> ((<span class="id" type="var">Var</span> (<span class="id" type="var">new_var</span> <span class="id" type="var">pst</span>), <span class="id" type="var">build</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>) <span class="id" type="var">l2'</span>) :: <span class="id" type="var">unsolved_p</span>) <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>);<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t3</span> [<span class="id" type="var">In_t1t3</span> | <span class="id" type="var">In_t1t3</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t3</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t3</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>

<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> <span class="id" type="var">unsolved_p</span> ((<span class="id" type="var">v</span>, <span class="id" type="var">t2</span>) :: <span class="id" type="var">solved_p</span>) <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t3</span> <span class="id" type="var">In_t1t3</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v0_eq_v</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v0_diff_v</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">S3</span> <span class="id" type="var">v0</span>).<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v'</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>]; [<span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_sigma</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_eq_f2</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f1</span> =f2); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span>; <span class="id" type="var">destruct_arity</span> <span class="id" type="var">f1</span> <span class="id" type="var">n1</span> <span class="id" type="var">Af1</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_gt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ll2</span> | <span class="id" type="var">Ll2</span>].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac_elementary_solve</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="var">absurd</span> (2&lt;=0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_length</span> <span class="id" type="var">Af1</span> <span class="id" type="var">Wt1</span>).<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">find</span> <span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">solved_p</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">pst</span> <span class="id" type="var">F</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">F</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v_sigma</span> := <span class="id" type="var">S3</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">solved_part</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">solved_part</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_sigma</span> := <span class="id" type="var">remove_a_subterm</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Af1</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">t1_sigma</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac_elementary_solve_term_var_with_val_term</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">pst</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_sigma</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> ((<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>, <span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2'</span>) :: <span class="id" type="var">unsolved_p</span>) <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">pst</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v'</span> | <span class="id" type="var">f</span> <span class="id" type="var">k</span>]; [<span class="id" type="var">contradiction</span> | <span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_sigma</span> := <span class="id" type="var">remove_several_subterms</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Af1</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">t1_sigma</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_sigma</span>; <span class="id" type="var">revert</span> <span class="id" type="var">t_sigma</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f1</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f1_diff_f1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f1_diff_f1</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove_list</span> <span class="id" type="var">k</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">k2'</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">TO.A</span> <span class="id" type="keyword">in</span> *;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_gt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">length</span> <span class="id" type="var">k2'</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Lk2'</span> | <span class="id" type="var">Lk2'</span>]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>

<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> ((<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>, <span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k2'</span>) :: <span class="id" type="var">unsolved_p</span>) <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v_sigma</span> := <span class="id" type="var">S2</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="var">cbv</span> <span class="id" type="var">zeta</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">W3_v</span> := <span class="id" type="var">W3_pb</span> <span class="id" type="var">v</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">find</span> <span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">partly_solved_p</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">pst</span> <span class="id" type="var">F'</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">F'</span>]; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">F'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">F'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">W3_v</span>.<br/>
<span class="id" type="var">destruct_arity</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>) <span class="id" type="var">n</span> <span class="id" type="var">Ahsp</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac_elementary_solve_term_var_with_part_val_term</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">W3_v</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Wct</span> <span class="id" type="var">Act</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>));<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_eq_hd_pst</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f1_diff_hd_pst</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">f1_eq_hd_pst</span> <span class="id" type="keyword">in</span> *.<br/>

<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_sigma</span> := <span class="id" type="var">remove_several_subterms_bis</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Af1</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">t1_sigma</span> <span class="id" type="var">Act</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">closed_term</span> <span class="id" type="var">pst</span>) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">l2'</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>

<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> ((<span class="id" type="var">build</span> <span class="id" type="var">f1</span> (<span class="id" type="var">Var</span> (<span class="id" type="var">new_var</span> <span class="id" type="var">pst</span>) :: <span class="id" type="var">l1</span>), <span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2'</span>) :: <span class="id" type="var">unsolved_p</span>) <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">exists_map_without_repetition</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v_sigma_in_l2</span> : <span class="id" type="var">In</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_cf_subst</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_cf_subst</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>));<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f1_eq_hd_pst</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_sigma</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">f1</span> = <span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_sigma</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">in_quick_in</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Wv</span> : <span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">W</span> := <span class="id" type="var">well_formed_cf_apply_subst</span> <span class="id" type="var">W_sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) <span class="id" type="var">Wv</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Wv</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">W</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>) (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>));<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>) (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">h_diff_h</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">h_diff_h</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v'_sigma</span> := <span class="id" type="var">remove_several_subterms_bis_nil</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Ahsp</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">W</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">v_sigma</span> <span class="id" type="var">Act</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_sigma</span> := <span class="id" type="var">remove_a_subterm</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Af1</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>) <span class="id" type="var">t1_sigma</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">closed_term</span> <span class="id" type="var">pst</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">quicksort</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">flatten</span> (<span class="id" type="var">head_symb</span> <span class="id" type="var">pst</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> (<span class="id" type="var">new_var</span> <span class="id" type="var">pst</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:: <span class="id" type="var">closed_term</span> <span class="id" type="var">pst</span> :: <span class="id" type="var">nil</span>)))) <span class="id" type="keyword">as</span> [<span class="id" type="var">k2</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'</span> | ].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]]; <br/>
[<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_sigma</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f1_diff_hd_pst</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">W3_v</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac_elementary_solve_term_var_without_val_term</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">exists_map12_without_repetition</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t_sigma</span> := <span class="id" type="var">remove_a_subterm</span> <span class="id" type="var">sigma</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Af1</span> <span class="id" type="var">W_sigma</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>) <span class="id" type="var">t1_sigma</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); [<span class="id" type="tactic">intros</span> <span class="id" type="var">v'</span> <span class="id" type="var">v_sigma</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span> <span class="id" type="var">v_sigma</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_sigma</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">in_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v'</span>) <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span>]; <br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t_sigma</span>; [<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">split</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">v_sigma_eq_t</span> [<span class="id" type="var">l2_eq</span> <span class="id" type="var">H</span>]]]]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">TO.A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_gt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> + 1)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ll2'</span> | <span class="id" type="var">Ll2'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v0_eq_v</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v0_diff_v</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S3</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v0_eq_v</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v0_diff_v</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S3</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">in_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>) <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H'</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">v_sigma_eq_t</span> [<span class="id" type="var">l2_eq</span> <span class="id" type="var">H</span>]]]]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">TO.A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_gt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> + 1)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ll2'</span> | <span class="id" type="var">Ll2'</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v0_eq_v</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v0_diff_v</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S3</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v0</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v0_eq_v</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v0_diff_v</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v0</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S3</span>.<br/>

<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">f</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">W_fk</span> : <span class="id" type="var">well_formed_cf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">W_sigma</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">find</span> <span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> <span class="id" type="var">sigma</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a</span> <span class="id" type="var">k</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">W_fk</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">W_fk</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">W_fk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">W_fk</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">W_fk</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a_in_l2</span> : <span class="id" type="var">In</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f1</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_sigma</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f1_diff_f1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f1_diff_f1</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">in_quick_in</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">W_sigma'</span> : <span class="id" type="var">well_formed_cf_subst</span> (((<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>), (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>)) :: <span class="id" type="var">sigma</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">well_formed_cf_subst</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">v0</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v0</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v0</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v0_eq_fv</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v0_diff_fv</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_cons</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">W_sigma</span> <span class="id" type="var">v0</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">v_sigma'</span> : <span class="id" type="var">apply_cf_subst</span> (((<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>), (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>)) :: <span class="id" type="var">sigma</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) =<br/>
&nbsp;<span class="id" type="var">Term</span> <span class="id" type="var">f1</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">quicksort</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">flatten</span> <span class="id" type="var">f1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_cf_subst</span> (((<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>), (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>)) :: <span class="id" type="var">sigma</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">Var</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)) :: <span class="id" type="var">a</span> :: <span class="id" type="var">nil</span>)))).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">apply_cf_subst</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>) (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>) (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); <br/>
[<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">fv_diff_fv</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">fv_diff_fv</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v_eq_fv</span> | <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">v</span> = <span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Fresh_var</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">v_eq_fv</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">pb</span>; <br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">occurs_in_pb</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">do</span> 3 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="tactic">f_equal</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">sort_is_unique</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">W_fk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">_</span> [<span class="id" type="var">W_fk</span> <span class="id" type="var">_</span>]]]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_sorted</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_sym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut_bis</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f1</span> (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span> :: <span class="id" type="var">a</span> :: <span class="id" type="var">nil</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">flatten</span> <span class="id" type="var">f1</span> (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span> :: <span class="id" type="var">nil</span>) ++ <span class="id" type="var">flatten</span> <span class="id" type="var">f1</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">nil</span>));<br/>
[<span class="id" type="var">idtac</span> | <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">flatten_app</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">app</span>; <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">permut_trans</span> (<span class="id" type="var">list_permut_app_app</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>) <span class="id" type="var">_</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">flatten</span> <span class="id" type="var">f1</span> (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span> :: <span class="id" type="var">nil</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">g</span> <span class="id" type="var">ll</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">g</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">g</span>);  [<span class="id" type="tactic">intro</span> <span class="id" type="var">f1_eq_g</span> | <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">f1</span>=g); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">W_fk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">_</span> [<span class="id" type="var">_</span> <span class="id" type="var">W_fk</span>]]]; <span class="id" type="tactic">apply</span> (<span class="id" type="var">W_fk</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">ll</span>)); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_build_cons</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">t1_sigma'</span> : <span class="id" type="var">apply_cf_subst</span> (((<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>), (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>)) :: <span class="id" type="var">sigma</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f1</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>)) = <span class="id" type="var">Term</span> <span class="id" type="var">f1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">add_new_var_to_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">fv_in_t1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Fresh_var</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pb</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">occurs_in_pb</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">unsolved_part</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Pb</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Aa</span> : <span class="id" type="keyword">match</span> <span class="id" type="var">a</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">f1</span> &lt;&gt; <span class="id" type="var">g</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">W_fk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">_</span> [<span class="id" type="var">_</span> <span class="id" type="var">W_fk</span>]]]; <span class="id" type="tactic">apply</span> <span class="id" type="var">W_fk</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H1</span> := <span class="id" type="var">remove_several_subterms_bis</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(((<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>), (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>)) :: <span class="id" type="var">sigma</span>) <span class="id" type="var">f1</span> <span class="id" type="var">v</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>) <span class="id" type="var">l1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">a</span> <span class="id" type="var">l2</span> <span class="id" type="var">Af1</span> <span class="id" type="var">W_sigma'</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">Wt2</span> <span class="id" type="var">v_sigma'</span> <span class="id" type="var">t1_sigma'</span> <span class="id" type="var">Aa</span>).<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l2'</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">TO.A</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">le_gt_dec</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span>) (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> + 1)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ll2'</span> | <span class="id" type="var">Ll2'</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">length</span> <span class="id" type="var">l2</span> &lt; <span class="id" type="var">length</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ll2'</span>;  <span class="id" type="tactic">apply</span> <span class="id" type="var">le_lt_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">pattern</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span> :: <span class="id" type="var">l1</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">v_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t1_sigma</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f1</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">t1_sigma</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f1_diff_f1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f1_diff_f1</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_quicksort</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">S</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>)) <span class="id" type="keyword">with</span> (1 + <span class="id" type="var">length</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_le_compat</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">W_fk</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> [<span class="id" type="var">W_fk</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">length_map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">length_flatten_bis</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t'</span> <span class="id" type="var">t'_in_map_l1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">in_map_iff</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t'_in_map_l1</span>; <br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t'_in_map_l1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> [<span class="id" type="var">Wt</span> <span class="id" type="var">t_sigma</span>]].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_subterms</span> <span class="id" type="var">Wt1</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">exists</span> (((<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>), (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>)) :: <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">R''</span> := (<span class="id" type="var">R'</span> (<span class="id" type="var">build</span> <span class="id" type="var">f1</span> <span class="id" type="var">k</span>))).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Pb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R''</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">R''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">R1</span> [<span class="id" type="var">R2</span> <span class="id" type="var">R3</span>]]; <br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R1</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Pb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R1</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R2</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Pb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R2</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R3</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Pb</span> <span class="id" type="keyword">in</span> <span class="id" type="var">R3</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">Pb</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]; [<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">R1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">partly_solved_part</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">find</span>;<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">v'</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">R2_v'</span> := <span class="id" type="var">R2</span> <span class="id" type="var">v'</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v'</span> <span class="id" type="var">v</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v'</span> <span class="id" type="var">v</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v'_eq_v</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v'_diff_v</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">v'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">v_sigma'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">v'</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">S'_v'</span> := <span class="id" type="var">S'</span> <span class="id" type="var">v'</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">X.eq_bool_ok</span> <span class="id" type="var">v'</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">X.eq_bool</span> <span class="id" type="var">v'</span> (<span class="id" type="var">fresh_var</span> <span class="id" type="var">pb</span>)); [<span class="id" type="tactic">intro</span> <span class="id" type="var">v'_eq_fv</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">v'_diff_fv</span>];<br/>
[<span class="id" type="tactic">do</span> 2 <span class="id" type="var">left</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">v'</span> | <span class="id" type="tactic">destruct</span> <span class="id" type="var">S'_v'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">S'_v'</span> | <span class="id" type="var">S'_v'</span>]; [<span class="id" type="var">left</span>; <span class="id" type="var">right</span> | <span class="id" type="var">right</span>]]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">ac_elementary_solve_term_term_term</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">exists_map_without_repetition</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>).<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">f_diff_s</span> := <span class="id" type="var">well_formed_cf_alien</span> <span class="id" type="var">Af1</span> <span class="id" type="var">Wt1</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">f_diff_s</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">s_l0_in_l2</span> : <span class="id" type="var">In</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)) <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">S1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f1_eq_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f1</span> = <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f1</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">in_quick_in</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="tactic">trivial</span> | <span class="id" type="var">idtac</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">in_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">T.eq_bool_ok</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)) <span class="id" type="var">l2</span>);<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">remove</span> <span class="id" type="var">T.eq_bool</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)) <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> <br/>
&nbsp;&nbsp;&nbsp;[<span class="id" type="var">l2'''</span> | ]; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intro</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">In</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)) <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">a'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">H</span> [<span class="id" type="var">l2_eq</span> <span class="id" type="var">l2'''_eq</span>]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">a'</span>;<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2'''_eq</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span> <span class="id" type="var">l2'''</span>;<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">f_diff_f</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">unsolved_part</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">In_t1t2</span> | [<span class="id" type="var">In_t1t2</span> | <span class="id" type="var">In_t1t2</span>]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_subterms</span> <span class="id" type="var">Wt1</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_apply_subst</span> <span class="id" type="var">W_sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_subterms</span> <span class="id" type="var">Wt1</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">permut_refl</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">In_t1t2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">flatten_cf</span> <span class="id" type="keyword">with</span> <span class="id" type="var">f1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_apply_subst</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_cons</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">well_formed_cf_build_inside</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">flatten_apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">l1</span> <span class="id" type="var">Af1</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">flatten_build</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>) <span class="id" type="var">Af1</span>).<br/>
<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">permut_cons_inside</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>))); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_sigma</span>;<br/>
<br/>
<span class="id" type="tactic">setoid_rewrite</span> &lt;- <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">f1</span> <span class="id" type="var">f</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">f1</span> <span class="id" type="var">f</span>); [<span class="id" type="tactic">intros</span> <span class="id" type="var">f1_eq_f</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">f1</span> = <span class="id" type="var">f</span>); <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">intro</span> <span class="id" type="var">f_diff_f1</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">quick_permut</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l2'_l2''</span>; <br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t_in_l2'_l2''</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">t_in_l2'</span> | <span class="id" type="var">t_in_l2''</span>];<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_alien</span> <span class="id" type="var">Af1</span> <span class="id" type="var">Wt2</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span> &gt; <span class="id" type="var">length</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">gt</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_not_lt</span>;<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">t1_sigma</span>;<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_quicksort</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">length_flatten_ter</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">well_formed_cf_subterms</span> <span class="id" type="var">Wt1</span>); <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_cf_unfold</span> <span class="id" type="var">_</span> <span class="id" type="var">Wt1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl1</span> [<span class="id" type="var">Ll1</span> <span class="id" type="var">Sl1</span>]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">well_formed_cf_unfold</span> <span class="id" type="var">_</span> <span class="id" type="var">Wt2</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">Wl2</span> [<span class="id" type="var">Ll2</span> <span class="id" type="var">Sl2</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> [ | <span class="id" type="var">b1</span> [ | <span class="id" type="var">c1</span> <span class="id" type="var">l1</span>]]]; [<span class="id" type="var">absurd</span> (0 = 2) | <span class="id" type="var">absurd</span> (1 = 2) | <span class="id" type="var">idtac</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">length</span> <span class="id" type="var">l1</span>))) = 2); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ll1</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a2</span> [ | <span class="id" type="var">b2</span> [ | <span class="id" type="var">c2</span> <span class="id" type="var">l2</span>]]]; [<span class="id" type="var">absurd</span> (0 = 2) | <span class="id" type="var">absurd</span> (1 = 2) | <span class="id" type="var">idtac</span> | <span class="id" type="var">absurd</span> (<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">S</span>(<span class="id" type="var">length</span> <span class="id" type="var">l2</span>))) = 2); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Ll2</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">discriminate</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">P</span> := <span class="id" type="var">quick_permut</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">a1</span> :: <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">b1</span> :: <span class="id" type="var">nil</span>));<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">t1_sigma</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">list_permut.permut_length_2</span> <span class="id" type="var">P</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">P</span>.<br/>
<span class="id" type="tactic">intros</span> [[<span class="id" type="var">a1_sigma</span> <span class="id" type="var">b1_sigma</span>] | [<span class="id" type="var">a1_sigma</span> <span class="id" type="var">b1_sigma</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> ((<span class="id" type="var">a1</span>, <span class="id" type="var">a2</span>) :: (<span class="id" type="var">b1</span>, <span class="id" type="var">b2</span>) :: <span class="id" type="var">unsolved_p</span>) <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">t1t2_eq_a1a2</span> | [<span class="id" type="var">t1t2_eq_b1b2</span> | <span class="id" type="var">t1t2_in_l</span>]]; <br/>
[ <span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_a1a2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <br/>
| <span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_b1b2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <br/>
| <span class="id" type="tactic">apply</span>  <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> ((<span class="id" type="var">a1</span>, <span class="id" type="var">b2</span>) :: (<span class="id" type="var">b1</span>, <span class="id" type="var">a2</span>) :: <span class="id" type="var">unsolved_p</span>) <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">t1t2_eq_a1b2</span> | [<span class="id" type="var">t1t2_eq_b1a2</span> | <span class="id" type="var">t1t2_in_l</span>]]; <br/>
[ <span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_a1b2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <br/>
| <span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_b1a2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <br/>
| <span class="id" type="tactic">apply</span>  <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Af1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t1_sigma</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">t1_sigma</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">T1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">unsolved_p</span> -&gt; <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span> = <span class="id" type="var">t2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_unsolved_p</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">S1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">U1</span> : <span class="id" type="keyword">match</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">fold_left2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">current_list_of_eqs</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)) (<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) :: <span class="id" type="var">current_list_of_eqs</span>) <span class="id" type="var">unsolved_p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">new_list_of_equations</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">In</span> (<span class="id" type="var">t1</span>,t2) <span class="id" type="var">new_list_of_equations</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span> = <span class="id" type="var">t2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>).<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">T1</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span> <span class="id" type="var">unsolved_p</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">unsol</span> <span class="id" type="var">T1</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1t2_in_unsol</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">T1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">unsol</span> <span class="id" type="var">T1</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHl</span> ((<span class="id" type="var">t</span>, <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) :: <span class="id" type="var">unsol</span>)).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">fold_left2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">current_list_of_eqs</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)) (<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) :: <span class="id" type="var">current_list_of_eqs</span>) ((<span class="id" type="var">t</span>, <span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) :: <span class="id" type="var">unsol</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">l</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_cf_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> | ].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">t1t2_eq_ttsigma</span> | <span class="id" type="var">t1t2_in_unsol</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_ttsigma</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">T1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> [<span class="id" type="var">t1t2_eq_ttsigma</span> | <span class="id" type="var">t1t2_in_unsol</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">t1t2_eq_ttsigma</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">T1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">fold_left2</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> (<span class="id" type="var">current_list_of_eqs</span> : <span class="id" type="var">list</span> (<span class="id" type="var">term</span> * <span class="id" type="var">term</span>)) (<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> : <span class="id" type="var">term</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">t1</span>, <span class="id" type="var">t2</span>) :: <span class="id" type="var">current_list_of_eqs</span>) <span class="id" type="var">unsolved_p</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> | ].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">mk_pb</span> <span class="id" type="var">ex</span> <span class="id" type="var">l</span> <span class="id" type="var">solved_p</span> <span class="id" type="var">partly_solved_p</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>