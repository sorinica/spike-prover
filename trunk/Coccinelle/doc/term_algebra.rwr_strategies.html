<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>term_algebra.rwr_strategies</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library term_algebra.rwr_strategies</h1>

<div class="code">
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "list_extensions".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_algebra".<br/>
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "term_orderings".<br/>

<br/>
</div>

<div class="doc">
<a name="lab54"></a><h1 class="section">strategies for rewriting in a term algebra</h1>

</div>
<div class="code">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Wellfounded</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">decidable_set</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">weaved_relation</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">term_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equational_theory_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">dp</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">rpo</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">E</span> : <span class="id" type="var">EqTh</span>).<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">E</span>.<br/>
&nbsp;&nbsp;<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">P_step</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) (<span class="id" type="var">P</span> : <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">P_at_top</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">P</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">axiom</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">P_in_context</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span>, <span class="id" type="var">one_step_list</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">ls</span> <span class="id" type="var">lt</span> -&gt; <span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">lt</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_step_one_step</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">one_step</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Hl</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">s'</span> <span class="id" type="var">Hnf</span> <span class="id" type="var">H'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span> <span class="id" type="var">H'</span>]; <br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">at_top</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_context</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">ls</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">ls</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">ls</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l'</span> <span class="id" type="var">H''</span> | <span class="id" type="var">t'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H''</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">head_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">tail_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Hl</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_context_cons</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">trans_clos</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t1</span> :: <span class="id" type="var">l</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">Trans1</span> <span class="id" type="var">Trans2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_in_context</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">P_in_context</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_step_context_in</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">t1</span> :: <span class="id" type="var">l'</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l'</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_in_context</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span> ]; <span class="id" type="tactic">simpl</span>; [ <span class="id" type="var">left</span> | <span class="id" type="var">right</span> ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_context_in</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">t1</span> :: <span class="id" type="var">l'</span>)) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l'</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">Step</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">t3</span> <span class="id" type="var">Trans1</span> <span class="id" type="var">Trans2</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_step_context_in</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l</span> ++ <span class="id" type="var">t2</span> :: <span class="id" type="var">l'</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">t_step</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_step_context_in</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_general_context</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">trans_clos</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> | <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">l3</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">H3</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nf_P_step_subterm</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span>, <span class="id" type="var">nf</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">nf</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">_</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">Hnf</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s_in_l</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> <span class="id" type="var">H'</span>]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hnf</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">u</span> :: <span class="id" type="var">l''</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">P_in_context</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">IH</span> <span class="id" type="var">Hnf</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s'</span> <span class="id" type="var">l'</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl'</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_acc_subterms</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t</span>) -&gt; <span class="id" type="var">constructor</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">HR</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Cf'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Cf'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">Cf</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Cf'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_one_step_list</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">refine</span> (@<span class="id" type="var">Acc_ind</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>)) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t'</span> <span class="id" type="var">s</span> <span class="id" type="var">Hnf</span> <span class="id" type="var">H'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H''</span> <span class="id" type="var">H3</span> <span class="id" type="var">H'''</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x2</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">HR</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Cf</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l2</span> <span class="id" type="var">l</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">k</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">k</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">k</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">k'</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_acc_subterms_1</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>;<br/>
<span class="id" type="tactic">refine</span> (@<span class="id" type="var">Acc_ind</span> <span class="id" type="var">_</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> <span class="id" type="var">H''</span>]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">u</span> :: <span class="id" type="var">l2</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">P_step_context_in</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_acc_subterms_3</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> <span class="id" type="var">s</span> -&gt;  <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">p</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> := <span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">s'</span> | ].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H'</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)); <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s'_in_l</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHp</span> <span class="id" type="var">s'</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">P_acc_subterms_1</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s'_in_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">_</span> <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">var_P_acc</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span> <span class="id" type="var">x</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list_list</span> <span class="id" type="var">l</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">list_rec3</span> <span class="id" type="var">size</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>;<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>] <span class="id" type="var">Sl</span> <span class="id" type="var">x</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Sl</span>; <span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sl'</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">plus_le_compat_r</span> 1 (<span class="id" type="var">size</span> <span class="id" type="var">t</span>) (<span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">y</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">y_eq_x</span> | <span class="id" type="var">x_in_l</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">map</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">map</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sk</span> : <span class="id" type="var">list_size</span> <span class="id" type="var">size</span> <span class="id" type="var">k</span> &lt;= <span class="id" type="var">n</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sl</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">list_size_fold</span> <span class="id" type="var">size</span> <span class="id" type="var">k</span>);<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_plus_l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_k</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_acc_subterms_1</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="var">map</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">var_list_list</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span> :: <span class="id" type="var">l</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">var_list</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">k</span>)  ++ <span class="id" type="var">var_list_list</span> <span class="id" type="var">l</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">var_list_unfold</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">_</span> <span class="id" type="var">Sk</span> <span class="id" type="var">x</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">x_in_k</span> | <span class="id" type="var">x_in_l</span>].<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">x_in_k</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_k</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">IHn</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_acc_with_subterm_subterms</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">direct_subterm</span>) <span class="id" type="var">t</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">direct_subterm</span>) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_acc_with_subterm</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">t</span> &lt;-&gt;  <span class="id" type="var">Acc</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">direct_subterm</span>) <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">size_t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H</span> | <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">u</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">P_acc_subterms_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_t</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">v_R_u</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">In_split</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> <span class="id" type="var">H''</span>]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">P_acc_with_subterm_subterms</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l'</span> ++ <span class="id" type="var">v</span> :: <span class="id" type="var">l''</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">P_step_context_in</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_incl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">P_step_in_list</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>, <span class="id" type="var">one_step_list</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span>) <span class="id" type="var">l'</span> <span class="id" type="var">l</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">exists</span> <span class="id" type="var">t</span>, <span class="id" type="var">exists</span> <span class="id" type="var">t'</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l1</span>, <span class="id" type="var">exists</span> <span class="id" type="var">l2</span>, <span class="id" type="var">P_step</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">t'</span> <span class="id" type="var">t</span> /\  <span class="id" type="var">l</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">t</span> :: <span class="id" type="var">l2</span> /\ <span class="id" type="var">l'</span> = <span class="id" type="var">l1</span> ++ <span class="id" type="var">t'</span> :: <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">P</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">t2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="var">exists</span> (@<span class="id" type="var">nil</span> <span class="id" type="var">term</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHH'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> [<span class="id" type="var">u'</span> [<span class="id" type="var">l3</span> [<span class="id" type="var">l4</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]]]]]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">u</span>; <span class="id" type="var">exists</span> <span class="id" type="var">u'</span>; <span class="id" type="var">exists</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">l3</span>); <span class="id" type="var">exists</span> <span class="id" type="var">l4</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">inner</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) (<span class="id" type="var">t</span> : <span class="id" type="var">term</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">nf</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_nf_inner_step_nf</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>), (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">v</span>, <span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">nf</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> &lt;-&gt; <span class="id" type="var">nf</span> (<span class="id" type="var">P_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">inner</span> <span class="id" type="var">R</span>)) <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">Rvar</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">s</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">apply</span> (<span class="id" type="var">P_step_one_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">inner</span> <span class="id" type="var">R</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">_</span> <span class="id" type="var">s</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H''</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H''</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Rvar</span> <span class="id" type="var">t1</span> <span class="id" type="var">v2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span> <span class="id" type="var">s</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">P_at_top</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">nf_P_step_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H''</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H''</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">nf</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">nf_P_step_subterm</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> <span class="id" type="var">False</span>.<br/>
<span class="id" type="tactic">generalize</span> <span class="id" type="var">l1</span> <span class="id" type="var">H''</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">IH</span> <span class="id" type="var">H</span> <span class="id" type="var">l1</span> <span class="id" type="var">H''</span> <span class="id" type="var">H'</span>; <br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">H''</span> <span class="id" type="var">H'</span>;<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2'</span> <span class="id" type="var">l'</span> <span class="id" type="var">H3</span> | <span class="id" type="var">t'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">H3</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H''</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H'</span> <span class="id" type="var">t</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">t1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">l1'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">nf_dec_inner_dec</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, {<span class="id" type="var">nf</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>}+{~ <span class="id" type="var">nf</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>}) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, {<span class="id" type="var">inner</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span>}+{~inner <span class="id" type="var">R</span> <span class="id" type="var">t</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">nf_dec</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">inner</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nf_dec</span> <span class="id" type="var">t</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">nf_t</span> | <span class="id" type="var">red_t</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">nf_l</span> | <span class="id" type="var">red_l</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">s_eq_t</span> | <span class="id" type="var">s_in_l</span>]; [<span class="id" type="tactic">subst</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">nf_l</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">nf_tl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">red_l</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">nf_tl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">nf_tl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">red_t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">nf_tl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">Context_sensitive</span>.<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">mu</span> : <span class="id" type="var">F.Symb.A</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">nat</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">C_step</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">C_at_top</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">axiom</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">C_step</span> <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">C_in_context</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">n</span> <span class="id" type="var">lt</span> <span class="id" type="var">ls</span>, <span class="id" type="var">C_list</span> <span class="id" type="var">R</span> <span class="id" type="var">n</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span> -&gt; <span class="id" type="var">In</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>) -&gt; <span class="id" type="var">C_step</span> <span class="id" type="var">R</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">lt</span>)<br/>
<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">with</span> <span class="id" type="var">C_list</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) : <span class="id" type="var">nat</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="var">list</span> <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C_head_step</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">l</span>, <span class="id" type="var">C_step</span> <span class="id" type="var">R</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> -&gt; <span class="id" type="var">C_list</span> <span class="id" type="var">R</span> 0 (<span class="id" type="var">t1</span> :: <span class="id" type="var">l</span>) (<span class="id" type="var">t2</span> :: <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">C_tail_step</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">i</span>, <span class="id" type="var">C_list</span> <span class="id" type="var">R</span> <span class="id" type="var">i</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">C_list</span> <span class="id" type="var">R</span> (<span class="id" type="var">S</span> <span class="id" type="var">i</span>) (<span class="id" type="var">t</span> :: <span class="id" type="var">l1</span>) (<span class="id" type="var">t</span> :: <span class="id" type="var">l2</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">shifted_active_in_list</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> (<span class="id" type="var">s</span> : <span class="id" type="var">term</span>) := <br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>, <span class="id" type="var">In</span> (<span class="id" type="var">shift</span> + <span class="id" type="var">i</span>) (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>) /\ <span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span> = <span class="id" type="var">Some</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">active_in_list</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> (<span class="id" type="var">s</span> : <span class="id" type="var">term</span>) := <span class="id" type="var">shifted_active_in_list</span> 0 <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">active_direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">False</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt; <span class="id" type="var">active_in_list</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> := <span class="id" type="var">refl_trans_clos</span> <span class="id" type="var">active_direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">active_position</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> {<span class="id" type="keyword">struct</span> <span class="id" type="var">p</span>} : <span class="id" type="var">bool</span> :=<br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">p</span> <span class="id" type="keyword">with</span><br/>
| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span><br/>
| <span class="id" type="var">i</span> :: <span class="id" type="var">q</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">t</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Var</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">andb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">match</span> <span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">None</span> =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Some</span> <span class="id" type="var">ti</span> =&gt; <span class="id" type="var">active_position</span> <span class="id" type="var">ti</span> <span class="id" type="var">q</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">active_is_active</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> &lt;-&gt; (<span class="id" type="var">exists</span> <span class="id" type="var">p</span>, <span class="id" type="var">active_position</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span> /\ <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="var">exists</span> <span class="id" type="var">nil</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">s'</span> <span class="id" type="var">t'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">H</span> | <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">y</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">i</span> :: <span class="id" type="var">nil</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">i_not_in_mu_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">i_not_in_mu_f</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">in_impl_mem</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>) (<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">refl_equal</span> <span class="id" type="var">a</span>) <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>) <span class="id" type="var">K1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">z</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> [<span class="id" type="var">K3</span> <span class="id" type="var">K4</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">i</span> :: <span class="id" type="var">p</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">i_not_in_mu_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">i_not_in_mu_f</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">in_impl_mem</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>) (<span class="id" type="keyword">fun</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">refl_equal</span> <span class="id" type="var">a</span>) <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>) <span class="id" type="var">K1</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">p</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H'</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">i_in_mu_f</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ti</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHp</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_impl_in</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_acc_subterms_1</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">active_direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">generalize</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">refine</span> (@<span class="id" type="var">Acc_ind</span> <span class="id" type="var">_</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>.<br/>
&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [ <span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H''</span>]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">u</span> :: <span class="id" type="var">l2</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C_in_context</span> <span class="id" type="keyword">with</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">i</span>; <span class="id" type="var">revert</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">length</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">nth_error_at_pos</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_acc_subterms_2</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> -&gt; <span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> <span class="id" type="var">y</span> | <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_acc_subterms_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHH'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_acc_subterms_1</span> <span class="id" type="keyword">with</span> <span class="id" type="var">z</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">instanciated_active_subterm</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">active_subterm</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">s</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">s'</span> <span class="id" type="var">t'</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> <span class="id" type="var">y</span> | <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">z</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">y</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>) <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">y</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">z</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>) <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">active_position_in_instanciated_term</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">p</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">sigma</span>, <span class="id" type="var">active_position</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t</span>) <span class="id" type="var">p</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> <span class="id" type="var">s</span> -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">active_position</span> <span class="id" type="var">t</span> <span class="id" type="var">p</span> = <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">p</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">p</span>].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">s</span> <span class="id" type="var">sigma</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span> <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">l</span>) <span class="id" type="var">i</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">i</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="var">contradiction</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> <span class="id" type="var">s'</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">H</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">K</span>]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHp</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">cdp</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>:= <br/>
&nbsp;&nbsp;| <span class="id" type="var">Cdp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>, <span class="id" type="var">R</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">active_subterm</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">f2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">cdp</span> <span class="id" type="var">R</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>) <span class="id" type="var">t1</span>.<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">vdp</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span>:= <br/>
&nbsp;&nbsp;| <span class="id" type="var">Vdp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">x</span>, <span class="id" type="var">R</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">active_subterm</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>) <span class="id" type="var">t2</span> -&gt; (<span class="id" type="var">not</span> (<span class="id" type="var">active_subterm</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>) <span class="id" type="var">t1</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">vdp</span> <span class="id" type="var">R</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>) <span class="id" type="var">t1</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span> := <span class="id" type="var">exists</span> <span class="id" type="var">n</span>, <span class="id" type="var">C_list</span> <span class="id" type="var">R</span> <span class="id" type="var">n</span> <span class="id" type="var">ls</span> <span class="id" type="var">lt</span> /\ <span class="id" type="var">In</span> (<span class="id" type="var">shift</span> + <span class="id" type="var">n</span>) (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">cdp_step</span> (<span class="id" type="var">R</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>) : <span class="id" type="var">term</span> -&gt; <span class="id" type="var">term</span> -&gt; <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;&nbsp;| <span class="id" type="var">Cdp_step</span> : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> 0 <span class="id" type="var">f</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">axiom</span> (<span class="id" type="var">cdp</span> <span class="id" type="var">R</span>) <span class="id" type="var">t3</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">cdp_step</span> <span class="id" type="var">R</span> <span class="id" type="var">t3</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">Vdp_step</span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">t3</span> <span class="id" type="var">w</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> 0 <span class="id" type="var">f</span>) <span class="id" type="var">l2</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">axiom</span> (<span class="id" type="var">vdp</span> <span class="id" type="var">R</span>) <span class="id" type="var">t3</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">active_subterm</span> <span class="id" type="var">w</span> <span class="id" type="var">t3</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">cdp_step</span> <span class="id" type="var">R</span> <span class="id" type="var">w</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Context_Acc_var</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">HR</span> <span class="id" type="var">x</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">HR</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>).<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">actives</span> <span class="id" type="var">f</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">term</span> :=<br/>
<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
| <span class="id" type="var">t</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>) <span class="id" type="keyword">then</span> <span class="id" type="var">t</span> :: (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">l</span>) <span class="id" type="keyword">else</span> (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>) <span class="id" type="var">l</span>) <br/>
<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">actives_ok</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>, <span class="id" type="var">In</span> <span class="id" type="var">s</span> (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span>) &lt;-&gt; <span class="id" type="var">shifted_active_in_list</span> <span class="id" type="var">n</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span>; <span class="id" type="var">revert</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">_</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n_in_mu_f</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">s_eq_t</span> | <span class="id" type="var">s_in_actives</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">s</span>; <span class="id" type="var">exists</span> 0; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_impl_in</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">s_in_actives</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_actives</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">S</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n_not_in_mu_f</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">S</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n_in_mu_f</span>.<br/>
<span class="id" type="tactic">intros</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n_not_in_mu_f</span>.<br/>
<span class="id" type="tactic">intros</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">n_not_in_mu_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">shifting_context</span> : <br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l'</span>, <br/>
<span class="id" type="var">Acc</span> (<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span>) <span class="id" type="var">l'</span> -&gt; <br/>
<span class="id" type="var">Acc</span> (<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> (<span class="id" type="var">S</span> <span class="id" type="var">shift</span>) <span class="id" type="var">f</span>) (<span class="id" type="keyword">match</span> <span class="id" type="var">l'</span> <span class="id" type="keyword">with</span> <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span> | <span class="id" type="var">_</span> :: <span class="id" type="var">l</span> =&gt; <span class="id" type="var">l</span> <span class="id" type="keyword">end</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> [<span class="id" type="var">n</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">t</span> :: <span class="id" type="var">k</span>)).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">c_in_context</span> <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>); <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">C_tail_step</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">shifting_head</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span>) <span class="id" type="var">l</span> -&gt;<br/>
<span class="id" type="var">mem</span> <span class="id" type="var">eq</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>) -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, (<span class="id" type="var">exists</span> <span class="id" type="var">k</span>, <span class="id" type="var">l</span> = <span class="id" type="var">t</span>::k) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">t</span> [<span class="id" type="var">l</span> <span class="id" type="var">H</span>]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">shift_in_mu_f</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> [<span class="id" type="var">l'</span> <span class="id" type="var">H</span>].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s</span> <span class="id" type="var">l'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">IH</span> (<span class="id" type="var">s</span> :: <span class="id" type="var">l</span>)).<br/>
<span class="id" type="var">exists</span> 0; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">mem_impl_in</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filtering</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">l1</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step_list</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l1</span>) (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="var">revert</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">n</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">n</span> [<span class="id" type="var">K</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">K</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">shift_in_mu_f</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">shift_not_in_mu</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">shift_not_in_mu</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">acc_filtering</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, <span class="id" type="var">Acc</span> (<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span>) <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>)) (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">shift</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>; <span class="id" type="var">revert</span> <span class="id" type="var">f</span> <span class="id" type="var">shift</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Acc_nil</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Acc_nil</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">y</span> [<span class="id" type="var">n</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">shift_in_mu_f</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_one_step_list</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t1</span> | <span class="id" type="var">u_in_actives</span>].<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">shifting_head</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_actives</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_one_step_list</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">shifting_context</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_one_step_list</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> [<span class="id" type="var">u_eq_t1</span> | <span class="id" type="var">u_in_actives</span>].<br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">u</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">shifting_head</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">u</span> <span class="id" type="var">u_in_actives</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_one_step_list</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> (<span class="id" type="var">S</span> <span class="id" type="var">shift</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">shifting_context</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">shift_not_in_mu_f</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_inv</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> (<span class="id" type="var">S</span> <span class="id" type="var">shift</span>) <span class="id" type="var">l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">shifting_context</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_l</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">shift</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">shift_in_mu_f</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_one_step_list</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Acc_tl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l</span> := <span class="id" type="var">tail_prop</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_tl</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_one_step_list</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_t</span> := <span class="id" type="var">Acc_tl</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>))).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_tl</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHl</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IHl</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IHt</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHt</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">shift_not_in_mu_f</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">k</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">shift_not_in_mu_f</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Acc_C_step_acc_c_in_context</span> :<br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">active_in_list</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">c_in_context</span> <span class="id" type="var">R</span> 0 <span class="id" type="var">f</span>) <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_filtering</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_one_step_list</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_actives</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">active_in_list</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_actives</span>; <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">actives_ok</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">context_acc_subterms</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">active_in_list</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>) -&gt; <span class="id" type="var">constructor</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">HR</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">Cf'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Cf'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">Cf</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Cf'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l'</span> := <span class="id" type="var">Acc_C_step_acc_c_in_context</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_l</span>); <span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">n</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H''</span> <span class="id" type="var">H3</span> <span class="id" type="var">H'''</span>]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x2</span> | <span class="id" type="var">f2</span> <span class="id" type="var">l2</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x2</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">HR</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>;<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Cf</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">active_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, {<span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>}+{~ <span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>; <span class="id" type="var">revert</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">v</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">s</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">s</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s_eq_v</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s_diff_v</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">A</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s_diff_v</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">A</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span> <span class="id" type="var">IH</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">s</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">s</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s_eq_fl</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">s</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s_diff_fl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : {<span class="id" type="var">ti</span> | <span class="id" type="var">In</span> <span class="id" type="var">ti</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">ti</span> /\ <span class="id" type="var">active_direct_subterm</span> <span class="id" type="var">ti</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>)}+<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" type="keyword">forall</span> <span class="id" type="var">ti</span>, <span class="id" type="var">In</span> <span class="id" type="var">ti</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">active_direct_subterm</span> <span class="id" type="var">ti</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">active_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">ti</span> -&gt; <span class="id" type="var">False</span>}).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">s_diff_fl</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">active_in_list</span>; <span class="id" type="tactic">generalize</span> 0.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t1</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">n</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">beq_nat_ok</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">n</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n_in_mu_f</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_introl</span> <span class="id" type="var">_</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">_</span>)) <span class="id" type="var">s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">A1</span> | <span class="id" type="var">not_A1</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> 0; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_impl_in</span> <span class="id" type="keyword">with</span> (@<span class="id" type="var">eq</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> (<span class="id" type="var">tail_set</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>) <span class="id" type="var">s</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ai</span> | <span class="id" type="var">not_Al</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Ai</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> [<span class="id" type="var">ti_in_l</span> [<span class="id" type="var">Ai</span> <span class="id" type="var">Al</span>]]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">ti</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Al</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">S</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> [<span class="id" type="var">t1_eq_ti</span> | <span class="id" type="var">ti_in_l</span>] <span class="id" type="var">Al</span> <span class="id" type="var">Ai</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">not_A1</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">ti</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Al</span> <span class="id" type="keyword">as</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intro</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">ti</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">not_A1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">not_Al</span> <span class="id" type="var">ti</span> <span class="id" type="var">ti_in_l</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">not_mem_n_mu_f</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> (<span class="id" type="var">tail_set</span> <span class="id" type="var">_</span> <span class="id" type="var">IH</span>) <span class="id" type="var">s</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Ai</span> | <span class="id" type="var">not_Al</span>].<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Ai</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">ti</span> [<span class="id" type="var">ti_in_l</span> [<span class="id" type="var">Ai</span> <span class="id" type="var">Al</span>]]].<br/>
<span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">ti</span>; <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">split</span>].<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Al</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">S</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> [<span class="id" type="var">t1_eq_ti</span> | <span class="id" type="var">ti_in_l</span>] <span class="id" type="var">Al</span> <span class="id" type="var">Ai</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Al</span> <span class="id" type="keyword">as</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_mem_n_mu_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">not_Al</span> <span class="id" type="var">ti</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H</span>]]]; <br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">not_Al</span> <span class="id" type="var">ti</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Al</span> <span class="id" type="keyword">as</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">not_mem_n_mu_f</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_impl_mem</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [[<span class="id" type="var">ti</span> [<span class="id" type="var">ti_in_l</span> [<span class="id" type="var">Ai</span> <span class="id" type="var">Al</span>]]] | <span class="id" type="var">H</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">ti</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">A</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">A</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">u</span> | <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="var">A'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">A</span>.<br/>
<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s_diff_fl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">A'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">A'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x'</span> <span class="id" type="var">y'</span> <span class="id" type="var">A''</span> | <span class="id" type="var">x'</span> <span class="id" type="var">y'</span> <span class="id" type="var">z'</span> <span class="id" type="var">A1</span> <span class="id" type="var">A2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">A'</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">s</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">A''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H3</span>]]]; <br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">y'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">A2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">l1</span> [<span class="id" type="var">l2</span> [<span class="id" type="var">L</span> <span class="id" type="var">H3</span>]]]; <br/>
<span class="id" type="tactic">subst</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">A1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cdp_criterion_local</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">constructor</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>} + {<span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>}) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>,   <span class="id" type="var">Acc</span> (<span class="id" type="var">cdp_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">active_direct_subterm</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">s</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">HR</span> <span class="id" type="var">RR</span> <span class="id" type="var">CD</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t</span> <span class="id" type="var">Acc_t</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">t</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Context_Acc_var</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="var">active_direct_subterm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l'</span> := <span class="id" type="var">Acc_C_step_acc_c_in_context</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Acc_l</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">acc_filtering</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_l'</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">rename</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">into</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">actives_l</span> := <span class="id" type="var">actives</span> <span class="id" type="var">f</span> 0 <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">refl_equal</span> <span class="id" type="var">actives_l</span>).<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">actives_l</span> <span class="id" type="tactic">at</span> 2.<br/>
<span class="id" type="var">clearbody</span> <span class="id" type="var">actives_l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">IH</span> <span class="id" type="var">Acc_t</span>.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">Acc_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">actives_l</span> <span class="id" type="var">Acc_l</span> <span class="id" type="var">IHl</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">AH</span> <span class="id" type="var">IH</span> <span class="id" type="var">Acc_t</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_l'</span> : <span class="id" type="var">Acc</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>)) <span class="id" type="var">actives_l</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">Acc_l</span>; <span class="id" type="tactic">rename</span> <span class="id" type="var">Acc_l'</span> <span class="id" type="var">into</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">acc_one_step_list</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_intro</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">s</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x1</span> | <span class="id" type="var">f1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Context_Acc_var</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H'</span> | <span class="id" type="var">f'</span> <span class="id" type="var">n</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">H'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1_R_t2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">k</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">R</span> <span class="id" type="var">t1</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>)); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">HR</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">g</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H''</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">n</span> <span class="id" type="var">t</span>, <span class="id" type="var">size</span> <span class="id" type="var">t</span> &lt;= <span class="id" type="var">n</span> -&gt; <span class="id" type="var">active_subterm</span> <span class="id" type="var">t</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">n</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">n</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">St</span>; <span class="id" type="var">absurd</span> (1 &lt;= 0); <span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> <span class="id" type="var">arith</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">size</span> <span class="id" type="var">t</span>); <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">size_ge_one</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">x</span> | <span class="id" type="var">g</span> <span class="id" type="var">h</span>] <span class="id" type="var">St</span> <span class="id" type="var">A</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Context_Acc_var</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Acc_h</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">t</span>, <span class="id" type="var">In</span> <span class="id" type="var">t</span> <span class="id" type="var">h</span> -&gt; <span class="id" type="var">active_subterm</span> <span class="id" type="var">t</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) -&gt; <span class="id" type="var">Acc</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>) <span class="id" type="var">t</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_h</span> <span class="id" type="var">At</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHn</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_S_n</span>; <span class="id" type="tactic">refine</span> (<span class="id" type="var">le_trans</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">St</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">size_direct_subterm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">CD</span> <span class="id" type="var">g</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Cg</span> | <span class="id" type="var">Dg</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">context_acc_subterms</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">t_in_h</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_h</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">t_in_h</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">active_in_list</span>, <span class="id" type="var">shifted_active_in_list</span>; <span class="id" type="tactic">generalize</span> 0.<br/>
<span class="id" type="tactic">induction</span> <span class="id" type="var">h</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">s</span> <span class="id" type="var">h</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">_</span> <span class="id" type="var">H</span>]]; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> [[ | <span class="id" type="var">i</span>] [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]]; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHh</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">S</span> <span class="id" type="var">n</span>).<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">H1</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span> <span class="id" type="keyword">in</span> <span class="id" type="var">A</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">A</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> [<span class="id" type="var">Ap</span> <span class="id" type="var">Sub</span>]].<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_in_instantiated_term</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Sub</span>).<br/>
<span class="id" type="var">case_eq</span> (<span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t1</span> <span class="id" type="var">p</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">u</span> <span class="id" type="var">Sub'</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">u</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">xu</span> | <span class="id" type="var">g'</span> <span class="id" type="var">lu</span>].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">active_dec</span> (<span class="id" type="var">Var</span> <span class="id" type="var">xu</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Axu_in_k</span> | <span class="id" type="var">not_Axu_in_k</span>].<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Axu_in_k</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">xu'</span> | <span class="id" type="var">xu'</span> <span class="id" type="var">fk'</span> <span class="id" type="var">Axu_in_k'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Axu_in_k</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Axu_in_k'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Axu_in_k'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">xu'</span> <span class="id" type="var">fk'</span> <span class="id" type="var">Axu_in_k</span> | <span class="id" type="var">xu'</span> <span class="id" type="var">y</span> <span class="id" type="var">fk'</span> <span class="id" type="var">A1</span> <span class="id" type="var">A2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Axu_in_k</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">actives_ok</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>) <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_acc_subterms_2</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">y</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">A2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">actives_ok</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>) <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">instanciated_active_subterm</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">A1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Vdp_step</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>).<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Vdp</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>; <span class="id" type="var">exists</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">active_position_in_instanciated_term</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Var</span> <span class="id" type="var">xu</span>) <span class="id" type="var">sigma</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_h</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_h</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_h</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">h1</span> [<span class="id" type="var">h2</span> [<span class="id" type="var">L</span> <span class="id" type="var">K3</span>]]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> : <span class="id" type="var">active_subterm</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cdp_step</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>).<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cdp</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>; <span class="id" type="var">exists</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">active_position_in_instanciated_term</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g'</span> <span class="id" type="var">lu</span>) <span class="id" type="var">sigma</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">As</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_h</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">As</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">As</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">h1</span> [<span class="id" type="var">h2</span> [<span class="id" type="var">L</span> <span class="id" type="var">K3</span>]]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> : <span class="id" type="var">active_subterm</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>; <span class="id" type="var">exists</span> <span class="id" type="var">p</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">active_subterm</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Dummy</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">Sub'</span> [<span class="id" type="var">v</span> [<span class="id" type="var">q</span> [<span class="id" type="var">q'</span> [<span class="id" type="var">J1</span> [<span class="id" type="var">v_in_t1</span> [<span class="id" type="var">Sub''</span> <span class="id" type="var">J2</span>]]]]]]; <span class="id" type="tactic">subst</span> <span class="id" type="var">p</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">active_dec</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)) <span class="id" type="keyword">as</span> [<span class="id" type="var">Av_in_k</span> | <span class="id" type="var">not_Av_in_k</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_acc_subterms_2</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">Av_in_k</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v'</span> | <span class="id" type="var">v'</span> <span class="id" type="var">fk'</span> <span class="id" type="var">Av_in_k'</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">Av_in_k</span>; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Av_in_k'</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Av_in_k'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">v'</span> <span class="id" type="var">fk'</span> <span class="id" type="var">Av_in_k</span> | <span class="id" type="var">v'</span> <span class="id" type="var">y</span> <span class="id" type="var">fk'</span> <span class="id" type="var">A1</span> <span class="id" type="var">A2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">Av_in_k</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">actives_ok</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>) <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">context_acc_subterms_2</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">y</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_l</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">A2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">actives_ok</span>; <span class="id" type="var">exists</span> <span class="id" type="var">i</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">nth_error_map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span> <span class="id" type="var">i</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">K2</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>) <span class="id" type="var">i</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">ti</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hi</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> : <span class="id" type="var">active_subterm</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>))).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>; <span class="id" type="var">exists</span> <span class="id" type="var">q'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">t1</span> <span class="id" type="var">q</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Ap</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">q'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">q</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">q'</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">A</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">q'</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHq</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> : <span class="id" type="var">active_subterm</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">y</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instanciated_active_subterm</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">trans_clos_trans_clos_alt</span> <span class="id" type="keyword">in</span> <span class="id" type="var">A1</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>; <span class="id" type="var">exists</span> <span class="id" type="var">q'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sub'''</span> : <span class="id" type="var">subterm_at_pos</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) <span class="id" type="var">q</span>  = <span class="id" type="var">Some</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>))).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">t1</span> <span class="id" type="var">q</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Ap</span> <span class="id" type="var">Sub'''</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">q'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">q</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">q'</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">A</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">q'</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHq</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Vdp_step</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)).<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">replace</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> (<span class="id" type="var">map</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span>) <span class="id" type="var">k</span>)) <span class="id" type="keyword">with</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Term</span> <span class="id" type="var">f</span> <span class="id" type="var">k</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">instance</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Vdp</span> <span class="id" type="keyword">with</span> <span class="id" type="var">t1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>; <span class="id" type="var">exists</span> <span class="id" type="var">q</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">active_position_in_instanciated_term</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>) <span class="id" type="var">sigma</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Ap</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">q'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">q</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>]; <span class="id" type="tactic">intro</span> <span class="id" type="var">q'</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>].<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHq</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>; <span class="id" type="var">exists</span> <span class="id" type="var">q'</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Sub'''</span> : <span class="id" type="var">subterm_at_pos</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) <span class="id" type="var">q</span>  = <span class="id" type="var">Some</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>))).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">subterm_at_pos_apply_subst_apply_subst_subterm_at_pos</span> <span class="id" type="var">t1</span> <span class="id" type="var">q</span> <span class="id" type="var">sigma</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Sub''</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Ap</span> <span class="id" type="var">Sub'''</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v</span>)); <span class="id" type="tactic">clear</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">q'</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">q</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">i</span> <span class="id" type="var">q</span>]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">q'</span> <span class="id" type="var">t</span> <span class="id" type="var">s</span> <span class="id" type="var">A</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">q'</span> [<span class="id" type="var">v</span> | <span class="id" type="var">f</span> <span class="id" type="var">l</span>] <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">beq_nat</span> <span class="id" type="var">i</span> (<span class="id" type="var">mu</span> <span class="id" type="var">f</span>)); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l</span> <span class="id" type="var">i</span>); [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>].<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHq</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">s_in_h</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_h</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">s_in_h</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">i</span> [<span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">nth_error_ok_in</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">K2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">h1</span> [<span class="id" type="var">h2</span> [<span class="id" type="var">L</span> <span class="id" type="var">K3</span>]]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">Dummy</span> : <span class="id" type="var">active_subterm</span> (<span class="id" type="var">Term</span> <span class="id" type="var">g</span> <span class="id" type="var">h</span>) (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>)).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">active_is_active</span>.<br/>
<span class="id" type="var">exists</span> (<span class="id" type="var">q</span> ++ <span class="id" type="var">q'</span>); <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">H''</span> (<span class="id" type="var">size</span> (<span class="id" type="var">apply_subst</span> <span class="id" type="var">sigma</span> <span class="id" type="var">t1</span>))).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_n</span>.<br/>
<span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">actives</span> <span class="id" type="var">f</span> 0 <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">filtering</span>.<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">H''</span> <span class="id" type="var">H'''</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H''</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">s'</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">s'</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Vdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span> <span class="id" type="var">s'</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Acc_t</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">s'</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span> | <span class="id" type="var">f'</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l2</span> <span class="id" type="var">s'</span> <span class="id" type="var">K1</span> <span class="id" type="var">K2</span>]; <span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Cdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Vdp_step</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span> <span class="id" type="var">s'</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">trivial</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_clos_is_trans</span> <span class="id" type="keyword">with</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="var">exists</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cdp_criterion</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">t</span>, ~ (<span class="id" type="var">R</span> <span class="id" type="var">t</span> (<span class="id" type="var">Var</span> <span class="id" type="var">x</span>))) -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>, <span class="id" type="var">R</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> -&gt; <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span>, <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">var_list</span> <span class="id" type="var">t</span>)) -&gt;<br/>
&nbsp;&nbsp;(<span class="id" type="keyword">forall</span> <span class="id" type="var">f</span>, {<span class="id" type="var">constructor</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>} + {<span class="id" type="var">defined</span> <span class="id" type="var">R</span> <span class="id" type="var">f</span>}) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">well_founded</span> (<span class="id" type="var">cdp_step</span> <span class="id" type="var">R</span>) -&gt; <span class="id" type="var">well_founded</span> (<span class="id" type="var">C_step</span> <span class="id" type="var">R</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">HR</span> <span class="id" type="var">RR</span> <span class="id" type="var">CD</span> <span class="id" type="var">Wf</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">pattern</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">term_rec3</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Context_Acc_var</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cdp_criterion_local</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">As</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">As</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n</span> [<span class="id" type="var">_</span> <span class="id" type="var">As</span>]].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">n</span> <span class="id" type="var">As</span>; <span class="id" type="tactic">clear</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">t</span> <span class="id" type="var">l</span>]; <span class="id" type="tactic">intros</span> [ | <span class="id" type="var">n</span>] <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span> <span class="id" type="keyword">with</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Context_sensitive</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>