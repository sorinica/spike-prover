<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>examples.cime_trace.dp_extension</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library examples.cime_trace.dp_extension</h1>

<div class="code">
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">weaved_relation</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">closure</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">equational_theory_spec</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">dp</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">modular_dp</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">terminaison</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span>(<span class="id" type="var">E</span>:EqTh) .<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">MDP</span> := <span class="id" type="var">modular_dp.MakeModDP</span>(<span class="id" type="var">E</span>).<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">E</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">T</span>.<br/>
<span class="id" type="keyword">Import</span> <span class="id" type="var">Dp</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Empty_R_neutral_union_r</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>;[<span class="id" type="var">idtac</span>|intro <span class="id" type="var">H</span>;<span class="id" type="var">right</span>;<span class="id" type="tactic">assumption</span>].<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion_clear</span> 1;<span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">case</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Empty_R_neutral_union_l</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">Empty_R</span>  <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">union_sym</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">Empty_R_neutral_union_r</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">S</span>.<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span> <span class="id" type="var">R4</span>: <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">R1_equiv_R2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Hypothesis</span> <span class="id" type="var">R3_equiv_R4</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">defined_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">f</span> , <span class="id" type="var">defined</span> <span class="id" type="var">R1</span> <span class="id" type="var">f</span> &lt;-&gt; <span class="id" type="var">defined</span> <span class="id" type="var">R2</span> <span class="id" type="var">f</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">R1_equiv_R2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="var">econstructor</span> <span class="id" type="var">eassumption</span>.<br/>
<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">R1_equiv_R2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="var">econstructor</span> <span class="id" type="var">eassumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">dp</span> <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">dp</span> <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">inversion</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">R1_equiv_R2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="var">econstructor</span> <span class="id" type="tactic">try</span> <span class="id" type="var">eassumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">defined_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">exact</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="tactic">inversion</span> 1.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">R1_equiv_R2</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="var">econstructor</span> <span class="id" type="tactic">try</span> <span class="id" type="var">eassumption</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">defined_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">exact</span> <span class="id" type="var">H2</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">axiom_ddp_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R1</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R2</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">split</span>.<br/>
<span class="id" type="tactic">inversion</span> 1.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H0</span> <span class="id" type="var">Sub</span>].<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">dp_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="var">constructor</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">inversion</span> 1.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H0</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H0</span> <span class="id" type="var">Sub</span>].<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">dp_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="var">constructor</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>, <span class="id" type="var">one_step</span> <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">one_step</span> <span class="id" type="var">R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_incl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">R3_equiv_R4</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">R3_equiv_R4</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>, <span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R3</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R4</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_incl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">one_step_equiv</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">one_step_equiv</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>, <span class="id" type="var">rwr</span> <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">rwr</span> <span class="id" type="var">R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">trans_incl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">one_step_equiv</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">one_step_equiv</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rwr_list_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span>  (<span class="id" type="var">one_step</span> <span class="id" type="var">R3</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <span class="id" type="var">refl_trans_clos</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> <span class="id" type="var">R4</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_trans_incl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">one_step_list_equiv</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">one_step_list_equiv</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp_step_equiv_aux_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> , <br/>
&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R1</span>)) <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt;   <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">axiom_ddp_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">axiom_ddp_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp_step_equiv_aux_2</span> : <span class="id" type="keyword">forall</span>  <span class="id" type="var">r</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt;   <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">rwr_list_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">rwr_list_equiv</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rdp_step_equiv</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>, <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R1</span>)) <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt;  <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">transitivity</span>  (<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">dp_step_equiv_aux_1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">dp_step_equiv_aux_2</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Empty_R_equiv_list</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span> : <span class="id" type="var">term</span>, <span class="id" type="var">Empty_R</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">nil</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">S</span>.<br/>
<span class="id" type="keyword">Section</span> <span class="id" type="var">S'</span>.<br/>

<br/>
<span class="id" type="keyword">Variable</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span> : <span class="id" type="var">relation</span> <span class="id" type="var">term</span>.<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rdp_step_equiv_strong</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span> <span class="id" type="var">R4</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R1_dp_equiv_R2</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">dp</span> <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">dp</span> <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">R3_equiv_R4</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">r</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R1</span>)) <span class="id" type="var">R3</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt;   <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R0</span> <span class="id" type="var">R4</span> <span class="id" type="var">R5</span> <span class="id" type="var">R6</span> <span class="id" type="var">R1_dp_equiv_R2</span> <span class="id" type="var">R3_equiv_R4</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>;<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">case</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>;  <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">v</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H2'</span>]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2''</span> <span class="id" type="var">Sub</span>].<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- (@<span class="id" type="var">rwr_list_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R3_equiv_R4</span>); <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H3</span>; <span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">R1_dp_equiv_R2</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">f</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">v</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">sigma</span> <span class="id" type="var">H2'</span>]; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H2'</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H2''</span> <span class="id" type="var">Sub</span>].<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (@<span class="id" type="var">rwr_list_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">R3_equiv_R4</span>); <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H3</span>; <span class="id" type="var">constructor</span> 1; <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">R1_dp_equiv_R2</span>; <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">module_Empty_R</span> : <span class="id" type="var">module</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">constructor</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">f2</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">def_f2</span> <span class="id" type="var">s_t</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">def_f2</span>;<span class="id" type="tactic">subst</span>.<br/>
<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_union_sym</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">one_step</span>  (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span>  <span class="id" type="var">R2</span> <span class="id" type="var">R1</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">union_sym</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_union_sym</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">one_step_list</span>  (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span>  <span class="id" type="var">R2</span> <span class="id" type="var">R1</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">union_sym</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_union_rotate</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">R3</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> <span class="id" type="var">R1</span>) <span class="id" type="var">R2</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">union_sym</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">union_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_union_rotate</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">R3</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R3</span> <span class="id" type="var">R1</span>) <span class="id" type="var">R2</span>)) <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">union_sym</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">union_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_union_assoc</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">R3</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span>  <span class="id" type="var">R1</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> <span class="id" type="var">R3</span>)) <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">union_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">S'</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_union_insert</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>) <span class="id" type="var">R2</span>) <span class="id" type="var">r</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_equiv</span>;<span class="id" type="tactic">clear</span>;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">union_sym</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">union_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Empty_R_neutral_union_l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">union_sym</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">one_step_list_union_insert</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>)) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>) <span class="id" type="var">R2</span>)) <span class="id" type="var">r</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_equiv</span>;<span class="id" type="tactic">clear</span>;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">union_sym</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">union_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Empty_R_neutral_union_l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">union_sym</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">star_equiv</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span>:Set) (<span class="id" type="var">R1</span> <span class="id" type="var">R2</span>: <span class="id" type="var">A</span> -&gt; <span class="id" type="var">A</span> -&gt; <span class="id" type="keyword">Prop</span>), (<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">star</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">star</span> <span class="id" type="var">_</span> <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">H</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>;<span class="id" type="tactic">induction</span> 1;<span class="id" type="tactic">try</span> <span class="id" type="var">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 2 <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>;<span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H1</span>;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 2 <span class="id" type="keyword">with</span> <span class="id" type="var">y</span>;<span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">star_list_equiv_empty</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">star</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>) <span class="id" type="var">R2</span>))) <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">star</span> <span class="id" type="var">_</span> (<span class="id" type="var">one_step_list</span> (<span class="id" type="var">one_step</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>))) <span class="id" type="var">r</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">star_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span>;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">one_step_list_equiv</span>;<span class="id" type="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">union_sym</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">Empty_R</span>)).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">union_assoc</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Empty_R_neutral_union_l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">union_sym</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">is_primary_pi_not_subrule</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span>:relation <span class="id" type="var">term</span>) <span class="id" type="var">pi</span> (<span class="id" type="var">Hpi</span>:is_primary_pi <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">R</span> <span class="id" type="var">t2</span> <span class="id" type="var">t1</span> -&gt; <span class="id" type="var">subterm_at_pos</span> <span class="id" type="var">t2</span> <span class="id" type="var">p</span> = <span class="id" type="var">Some</span> (<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">pi</span> <span class="id" type="var">Hpi</span> <span class="id" type="var">t1</span> <span class="id" type="var">t2</span> <span class="id" type="var">p</span> <span class="id" type="var">l</span> <span class="id" type="var">H</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">is_primary_pi</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hpi</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">Hpi</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">pi</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">F</span> <span class="id" type="var">_</span>].<br/>
&nbsp;&nbsp;<span class="id" type="tactic">elim</span> <span class="id" type="var">F</span>;<span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span> - <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">revert</span> <span class="id" type="var">t2</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">p</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t2</span> <span class="id" type="var">H2</span>. <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">injection</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">clear</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">subst</span> <span class="id" type="var">t2</span>. <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>); <span class="id" type="tactic">case</span> ( <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">pi</span>);<span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">abs</span>;<span class="id" type="tactic">elim</span> <span class="id" type="var">abs</span>;<span class="id" type="tactic">trivial</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">t2</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">t2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">discriminate</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">case_eq</span> (<span class="id" type="var">nth_error</span> <span class="id" type="var">l0</span> <span class="id" type="var">a</span>);<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">generalize</span> (<span class="id" type="var">F.Symb.eq_bool_ok</span> <span class="id" type="var">pi</span> <span class="id" type="var">a0</span>); <span class="id" type="tactic">case</span> ( <span class="id" type="var">F.Symb.eq_bool</span> <span class="id" type="var">pi</span> <span class="id" type="var">a0</span>);<span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">revert</span> <span class="id" type="var">a</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">destruct</span> <span class="id" type="var">a</span>;  <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">destruct</span> <span class="id" type="var">a'</span>. <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">injection</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHp</span>. <span class="id" type="tactic">trivial</span>. <span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">IHl0</span> <span class="id" type="var">a'</span>);<span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">discriminate</span>.<br/>

<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">pi_no_dp</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span>:relation <span class="id" type="var">term</span>) <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> (<span class="id" type="var">Hpi</span>:is_primary_pi <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">dp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>))  <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">dp</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">Hpi</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>;<span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span> <span class="id" type="var">p</span>;<span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H3</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">False_ind</span>. <span class="id" type="tactic">eapply</span> <span class="id" type="var">is_primary_pi_not_subrule</span>; <span class="id" type="tactic">try</span> <span class="id" type="var">eassumption</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">False_ind</span>. <span class="id" type="tactic">eapply</span> <span class="id" type="var">is_primary_pi_not_subrule</span>; <span class="id" type="tactic">try</span> <span class="id" type="var">eassumption</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">p</span>;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">p</span>;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>;<span class="id" type="tactic">discriminate</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">t2</span> <span class="id" type="var">p</span>;<span class="id" type="tactic">trivial</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">left</span>;<span class="id" type="tactic">exact</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H2</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">f2</span>; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">constructor</span> 1 <span class="id" type="keyword">with</span> <span class="id" type="var">l</span> <span class="id" type="var">t</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">left</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">dp_equiv_empty_pi</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span>:relation <span class="id" type="var">term</span>) <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> (<span class="id" type="var">Hpi</span>:is_primary_pi <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">dp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">Empty_R</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>))  <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">dp</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">Hpi</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">pi_no_dp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">dp_equiv</span>; <span class="id" type="tactic">clear</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">Empty_R_neutral_union_l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> <span class="id" type="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">Hpi</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rdp_equiv_empty_l</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span> <span class="id" type="var">R'</span>:relation <span class="id" type="var">term</span>) <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">Empty_R</span>))) <span class="id" type="var">R'</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R</span>)) <span class="id" type="var">R'</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">R'</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">rdp_step_equiv_strong</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span>;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">apply</span> <span class="id" type="var">dp_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span>;  <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>;<span class="id" type="tactic">apply</span> <span class="id" type="var">Empty_R_neutral_union_l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rdp_equiv_empty_pi</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">R</span> <span class="id" type="var">R'</span>:relation <span class="id" type="var">term</span>) <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> (<span class="id" type="var">Hpi</span>:is_primary_pi <span class="id" type="var">pi</span> <span class="id" type="var">R</span>) <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">rdp_step</span>  (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R</span> <span class="id" type="var">Empty_R</span>) (<span class="id" type="var">Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>)))) <span class="id" type="var">R'</span>  <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">R</span>)) <span class="id" type="var">R'</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R</span> <span class="id" type="var">R'</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">Hpi</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">rdp_step_equiv_strong</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">pi_no_dp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">dp_equiv</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">clear</span>;  <span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>;<span class="id" type="tactic">apply</span> <span class="id" type="var">Empty_R_neutral_union_l</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> <span class="id" type="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion_clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">Hpi</span>;<span class="id" type="tactic">exact</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Empty_R_no_dp</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">dp</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Empty_R_no_rdp_step</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">rdp_step</span> (<span class="id" type="var">axiom</span> (<span class="id" type="var">ddp</span> <span class="id" type="var">Empty_R</span>)) <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> -&gt; <span class="id" type="var">False</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H6</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">Empty_R_no_dp</span> <span class="id" type="keyword">with</span> (1:=H6).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="var">Inclusion</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">well_founded_equiv</span> : <span class="id" type="keyword">forall</span> (<span class="id" type="var">A</span>:Set) <span class="id" type="var">R</span> <span class="id" type="var">R'</span> (<span class="id" type="var">H</span>:forall <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">R'</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>), <br/>
&nbsp;&nbsp;@<span class="id" type="var">well_founded</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> &lt;-&gt; <span class="id" type="var">well_founded</span> <span class="id" type="var">R'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">R</span> <span class="id" type="var">R'</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>;<span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>;<span class="id" type="tactic">apply</span> <span class="id" type="var">Inclusion.wf_incl</span> <span class="id" type="keyword">with</span> (2:=H').<br/>
&nbsp;&nbsp;<span class="id" type="tactic">red</span>;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">auto</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">red</span>;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>;<span class="id" type="tactic">auto</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>

<br/>
<span class="id" type="keyword">Ltac</span> <span class="id" type="var">prove_equiv_union</span> := <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- ?R  &lt;-&gt; ?R  =&gt; <span class="id" type="tactic">reflexivity</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> &lt;-&gt; <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Empty_R_neutral_union_r</span>;<span class="id" type="var">prove_equiv_union</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">_</span> &lt;-&gt; <span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Empty_R</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Empty_R_neutral_union_r</span>;<span class="id" type="var">prove_equiv_union</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Empty_R</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span> &lt;-&gt; <span class="id" type="var">_</span> =&gt; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Empty_R_neutral_union_l</span>;<span class="id" type="var">prove_equiv_union</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">_</span> &lt;-&gt; <span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Empty_R</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span>  =&gt; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Empty_R_neutral_union_l</span>;<span class="id" type="var">prove_equiv_union</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">union</span> <span class="id" type="var">_</span> ?R1 ?R2 <span class="id" type="var">_</span> <span class="id" type="var">_</span> &lt;-&gt; <span class="id" type="var">_</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">tac</span> <span class="id" type="var">b</span> <span class="id" type="var">R</span> <span class="id" type="var">Rs</span> := <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">R</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">context</span> <span class="id" type="var">CR</span> [<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">Empty_R</span> ?R'] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">H</span> := <span class="id" type="tactic">fresh</span> "H" <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">H'</span> := <span class="id" type="tactic">fresh</span> "H" <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">e</span> := <span class="id" type="var">context</span> <span class="id" type="var">CR</span> [<span class="id" type="var">R'</span>] <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>:forall <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">e</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" type="tactic">intros</span>;<span class="id" type="var">prove_equiv_union</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span>:forall <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">Rs</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">Rs</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>) <span class="id" type="tactic">by</span> <span class="id" type="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">b</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">true</span> =&gt; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">union_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">false</span> =&gt; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">union_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">context</span> <span class="id" type="var">CR</span> [<span class="id" type="var">union</span> <span class="id" type="var">_</span> ?R' <span class="id" type="var">Empty_R</span>] =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">H</span> := <span class="id" type="tactic">fresh</span> "H" <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">H'</span> := <span class="id" type="tactic">fresh</span> "H" <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">e</span> := <span class="id" type="var">context</span> <span class="id" type="var">CR</span> [<span class="id" type="var">R'</span>] <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span>:forall <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">R</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">e</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span class="id" type="tactic">intros</span>;<span class="id" type="var">prove_equiv_union</span>|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assert</span> (<span class="id" type="var">H'</span>:forall <span class="id" type="var">x</span> <span class="id" type="var">y</span>, <span class="id" type="var">Rs</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> &lt;-&gt; <span class="id" type="var">Rs</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>) <span class="id" type="tactic">by</span> <span class="id" type="tactic">reflexivity</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">b</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">true</span> =&gt; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">union_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">false</span> =&gt; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">union_equiv</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H'</span> <span class="id" type="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="tactic">progress</span>  (<span class="id" type="var">tac</span> <span class="id" type="var">true</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span>))||(tac <span class="id" type="var">false</span> <span class="id" type="var">R2</span> <span class="id" type="var">R1</span>));<span class="id" type="var">prove_equiv_union</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">union</span> <span class="id" type="var">_</span> ?R1 ?R2 <span class="id" type="var">_</span> <span class="id" type="var">_</span> &lt;-&gt; <span class="id" type="var">_</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">R2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">context</span> [<span class="id" type="var">R1</span>] =&gt; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">union_idem_strong</span>;[<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *|intros;<span class="id" type="tactic">try</span> <span class="id" type="var">prove_equiv_union</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| |- <span class="id" type="var">union</span> <span class="id" type="var">_</span> ?R1 <span class="id" type="var">_</span> &lt;-&gt; ?R2 =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">R2</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">context</span> <span class="id" type="var">C</span> [<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> ?R2'] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">e</span> := <span class="id" type="var">context</span> <span class="id" type="var">C</span>[<span class="id" type="var">R2'</span>] <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">setoid_replace</span> <span class="id" type="var">R2</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">e</span>);[<span class="id" type="var">idtac</span>|idtac]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|context <span class="id" type="var">C</span> [<span class="id" type="var">union</span> <span class="id" type="var">_</span> ?R2' <span class="id" type="var">R1</span>] =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">let</span> <span class="id" type="var">e</span> := <span class="id" type="var">context</span> <span class="id" type="var">C</span>[<span class="id" type="var">R2'</span>] <span class="id" type="keyword">in</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">setoid_replace</span> <span class="id" type="var">R2</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">union</span> <span class="id" type="var">_</span> <span class="id" type="var">R1</span> <span class="id" type="var">e</span>);[<span class="id" type="var">idtac</span>|idtac]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_equiv_list</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">R1</span> <span class="id" type="var">R1_list</span> <span class="id" type="var">R2</span> <span class="id" type="var">R2_list</span> (<span class="id" type="var">H1</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R1</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">R1_list</span>) (<span class="id" type="var">H2</span>: <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) <span class="id" type="var">R2_list</span>),<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">union</span> <span class="id" type="var">term</span> <span class="id" type="var">R1</span> <span class="id" type="var">R2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">In</span> (<span class="id" type="var">l</span>, <span class="id" type="var">r</span>) (<span class="id" type="var">R1_list</span> ++ <span class="id" type="var">R2_list</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">R1</span> <span class="id" type="var">R1_list</span> <span class="id" type="var">R2</span> <span class="id" type="var">R2_list</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> [<span class="id" type="var">H</span>|H];<span class="id" type="tactic">apply</span> <span class="id" type="var">in_or_app</span>;[<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H1</span>|rewrite &lt;- <span class="id" type="var">H2</span>];<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">destruct</span>  (@<span class="id" type="var">in_app_or</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; [<span class="id" type="var">left</span>;<span class="id" type="tactic">rewrite</span>  <span class="id" type="var">H1</span>|right;<span class="id" type="tactic">rewrite</span>  <span class="id" type="var">H2</span>];<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *.<br/>

<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">pi_reg</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">v0</span> <span class="id" type="var">v1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> (<span class="id" type="var">H</span> : <span class="id" type="var">MDP.Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v0</span> <span class="id" type="var">v1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span>) <span class="id" type="var">x</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">E.T.var_list</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">In</span> <span class="id" type="var">x</span> (<span class="id" type="var">E.T.var_list</span> <span class="id" type="var">t</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">pi</span> <span class="id" type="var">v0</span> <span class="id" type="var">v1</span> <span class="id" type="var">s</span> <span class="id" type="var">t</span> <span class="id" type="var">H</span> <span class="id" type="var">x</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>;<span class="id" type="tactic">subst</span>;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>|-*.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H0</span>;<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H0</span>;<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *.<br/>

<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Pi_as_list</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> := <br/>
&nbsp;&nbsp;((<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> :: <span class="id" type="var">nil</span>)),Var <span class="id" type="var">v1</span>)::<br/>
&nbsp;&nbsp;((<span class="id" type="var">Term</span> <span class="id" type="var">pi</span> (<span class="id" type="var">Var</span> <span class="id" type="var">v1</span> :: <span class="id" type="var">Var</span> <span class="id" type="var">v2</span> :: <span class="id" type="var">nil</span>)),Var <span class="id" type="var">v2</span>)::nil.<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">Pi_equiv_list</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>, <span class="id" type="var">MDP.Pi</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">r</span> <span class="id" type="var">l</span> &lt;-&gt; <span class="id" type="var">In</span> (<span class="id" type="var">l</span>,r) (<span class="id" type="var">Pi_as_list</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">pi</span> <span class="id" type="var">v1</span> <span class="id" type="var">v2</span> <span class="id" type="var">l</span> <span class="id" type="var">r</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>;<span class="id" type="tactic">simpl</span>;<span class="id" type="tactic">auto</span> <span class="id" type="keyword">with</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> 1;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">injection</span> <span class="id" type="var">H0</span>;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">subst</span>;<span class="id" type="var">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">injection</span> <span class="id" type="var">H1</span>;<span class="id" type="tactic">intros</span>;<span class="id" type="tactic">subst</span>;<span class="id" type="var">constructor</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">case</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>