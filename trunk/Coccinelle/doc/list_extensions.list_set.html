<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>list_extensions.list_set</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library list_extensions.list_set</h1>

<div class="code">

<br/>
</div>

<div class="doc">
<a name="lab11"></a><h1 class="section">Sets built with lists</h1>

</div>
<div class="code">
<span class="id" type="keyword">Add</span> <span class="id" type="var">LoadPath</span> "basis".<br/>

<br/>
<span class="id" type="keyword">Set</span> <span class="id" type="keyword">Implicit</span> <span class="id" type="var">Arguments</span>.<br/>

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Relations</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">List</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Setoid</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">decidable_set</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">more_list</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">list_permut</span>.<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">Arith</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Type</span> <span class="id" type="var">S</span>.<br/>

<br/>
<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">EDS</span> : <span class="id" type="var">decidable_set.ES</span>.<br/>
<span class="id" type="keyword">Declare Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">LP</span> : <span class="id" type="var">list_permut.S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">EDS</span> := <span class="id" type="var">EDS</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">without_red_bool</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">e</span> :: <span class="id" type="var">le</span> =&gt; <span class="id" type="keyword">if</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">le</span>) <span class="id" type="keyword">then</span> <span class="id" type="var">false</span> <span class="id" type="keyword">else</span> <span class="id" type="var">without_red_bool</span> <span class="id" type="var">le</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">without_red</span> <span class="id" type="var">l</span> := <span class="id" type="var">without_red_bool</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span>.<br/>

<br/>
<span class="id" type="keyword">Record</span> <span class="id" type="var">t</span> : <span class="id" type="keyword">Set</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">mk_set</span> <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">support</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">is_a_set</span> : <span class="id" type="var">without_red</span> <span class="id" type="var">support</span><br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> := <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">cardinal</span> <span class="id" type="var">s</span> := <span class="id" type="var">List.length</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> := <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">eq_set_refl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">eq_set_list_permut_support</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>,  <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">s1</span>.(<span class="id" type="var">support</span>) <span class="id" type="var">s2</span>.(<span class="id" type="var">support</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">Parameter</span> <span class="id" type="var">cardinal_subset</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">cardinal</span> <span class="id" type="var">s1</span> &lt;= <span class="id" type="var">cardinal</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">S</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab12"></a><h2 class="section">Definition of sets using lists.</h2>

</div>
<div class="code">
<span class="id" type="keyword">Module</span> <span class="id" type="var">Make</span> (<span class="id" type="var">EDS1</span> : <span class="id" type="var">decidable_set.ES</span>) &lt;: <span class="id" type="var">S</span> <span class="id" type="keyword">with</span> <span class="id" type="keyword">Module</span> <span class="id" type="var">EDS</span>:= <span class="id" type="var">EDS1</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">EDS</span> := <span class="id" type="var">EDS1</span>.<br/>

<br/>
<span class="id" type="keyword">Module</span> <span class="id" type="keyword">Import</span> <span class="id" type="var">LP</span> := <span class="id" type="var">list_permut.Make</span> (<span class="id" type="var">EDS</span>).<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">without_red_bool</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">e</span> :: <span class="id" type="var">le</span> =&gt; <span class="id" type="keyword">if</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">le</span>) <span class="id" type="keyword">then</span> <span class="id" type="var">false</span> <span class="id" type="keyword">else</span> <span class="id" type="var">without_red_bool</span> <span class="id" type="var">le</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">without_red</span> <span class="id" type="var">l</span> := <span class="id" type="var">without_red_bool</span> <span class="id" type="var">l</span> = <span class="id" type="var">true</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_remove</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">without_red</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>) -&gt; <span class="id" type="var">without_red</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>); [<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">discriminate</span> | <span class="id" type="tactic">trivial</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">l1</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e1_not_mem_l</span> <span class="id" type="var">Wl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e1_mem_l'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">e1_not_mem_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_remove</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_not_in</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">without_red</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>) -&gt; ~mem <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>)); <br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e1_not_in_l1_e_l2</span> <span class="id" type="var">wr</span> [<span class="id" type="var">e_eq_e1</span> | <span class="id" type="var">e_mem_l1l2</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">e1_not_in_l1_e_l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_not_in</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr</span> <span class="id" type="var">e_mem_l1l2</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_prf</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">without_red</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) -&gt; ~mem <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">without_red</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">wr12</span> <span class="id" type="var">e_not_in_l1_l2</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_l2</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">wr12</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr12</span> <span class="id" type="var">e_not_in_l1_l2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">e</span> :: <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e1_in_l1_l2</span>; <br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_not_in</span> <span class="id" type="var">e1</span> <span class="id" type="var">nil</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">diff_mem_remove</span> <span class="id" type="keyword">with</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">trivial</span>;<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">e_not_in_l1_l2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">add_prf</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_remove</span> <span class="id" type="var">e1</span> <span class="id" type="var">nil</span> (<span class="id" type="var">l1</span> ++ <span class="id" type="var">l2</span>)); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">e_not_in_l1_l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_permut</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">without_red</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">LP.permut</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">without_red</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">_</span> <span class="id" type="var">P</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">permut_nil</span> (<span class="id" type="var">permut_sym</span> <span class="id" type="var">P</span>)); <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_not_in_l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">P</span>;<span class="id" type="tactic">assert</span> (<span class="id" type="var">a1_in_l2</span> := <span class="id" type="var">cons_permut_mem</span> (<span class="id" type="var">Relation_Definitions.equiv_refl</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a1</span>) <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_in_l2</span>);<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2''</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_eq_a1'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span> <span class="id" type="keyword">in</span> <span class="id" type="var">P</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">exact</span> <span class="id" type="var">a1_eq_a1'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">add_prf</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_permut</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_permut_mem</span> <span class="id" type="var">a1'</span> <span class="id" type="var">P</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_in_l1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_not_in_l1</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a1'</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a1_eq_a1'</span>) <span class="id" type="var">a1_in_l1</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">remove_red</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">e</span> :: <span class="id" type="var">le</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">le</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">remove_red</span> <span class="id" type="var">le</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">e</span> :: (<span class="id" type="var">remove_red</span> <span class="id" type="var">le</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">included_remove_red</span> : <br/>
<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove_red</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x_in_rl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">included_remove_red</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="var">x_in_rl</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x_in_arl</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">x_in_arl</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">x_in_arl</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">x_in_arl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x_eq_a</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">x_eq_a</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x_in_rl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">included_remove_red</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="var">x_in_rl</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">remove_red_included</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove_red</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_in_l</span> <span class="id" type="var">x_in_al</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">x_in_al</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">x_in_al</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x_eq_a</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">remove_red_included</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">x_eq_a</span>) <span class="id" type="var">a_in_l</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x_in_l</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">remove_red_included</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="var">x_in_l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">x_in_al</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">x_in_al</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">x_in_al</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x_eq_a</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">x_eq_a</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">x_in_l</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">remove_red_included</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="var">x_in_l</span>).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_remove_red</span> :  <span class="id" type="keyword">forall</span> <span class="id" type="var">l</span>, <span class="id" type="var">without_red</span> (<span class="id" type="var">remove_red</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">without_red_remove_red</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_not_in_l</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> (<span class="id" type="var">remove_red</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> (<span class="id" type="var">remove_red</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_rl</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">included_remove_red</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_not_in_rl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">without_red_remove_red</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Record</span> <span class="id" type="var">t</span> : <span class="id" type="keyword">Set</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">mk_set</span> <br/>
&nbsp;&nbsp;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">support</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">is_a_set</span> : <span class="id" type="var">without_red</span> <span class="id" type="var">support</span><br/>
&nbsp;&nbsp;}.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> := <span class="id" type="var">mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_mem_mem</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> <span class="id" type="var">e_eq_e'</span> <span class="id" type="var">e_mem_s</span>;<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e_mem_s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a</span> [<span class="id" type="var">l'</span> [<span class="id" type="var">l''</span> [<span class="id" type="var">e_eq_a</span> [<span class="id" type="var">H</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">transitivity</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">add</span> (<span class="id" type="var">e</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">s</span> : <span class="id" type="var">t</span>) : <span class="id" type="var">t</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_not_in_s</span>.<br/>
<span class="id" type="tactic">exact</span> (<span class="id" type="var">mk_set</span> (<span class="id" type="var">add_prf</span> <span class="id" type="var">e</span> <span class="id" type="var">nil</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>) <span class="id" type="var">s</span>.(<span class="id" type="var">is_a_set</span>) <span class="id" type="var">e_not_in_s</span>)).<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">already_mem_add</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> = <span class="id" type="var">s</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> [<span class="id" type="var">l</span> <span class="id" type="var">prf</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>, <span class="id" type="var">add</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">EDS1.eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_not_in_l</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_not_in_l</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">not_already_mem_add</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>, ~ <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">e</span> :: <span class="id" type="var">support</span> <span class="id" type="var">s</span> = <span class="id" type="var">support</span> (<span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> [<span class="id" type="var">l</span> <span class="id" type="var">prf</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>, <span class="id" type="var">add</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">EDS1.eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_in_l</span> <span class="id" type="var">a_not_in_l</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_not_in_l</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>, <span class="id" type="var">add</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>, <span class="id" type="var">add</span>; <span class="id" type="tactic">simpl</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_12</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">add</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>) -&gt; <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> \/ <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>, <span class="id" type="var">add</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e'</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">filter_aux</span> (<span class="id" type="var">P_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>)  (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">nil</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">e</span> :: <span class="id" type="var">le</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">P_bool</span> <span class="id" type="var">e</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">e</span> :: (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">le</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">le</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">included_filter_aux</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">P_e</span> <span class="id" type="var">IH</span> | <span class="id" type="var">H1</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">not_P_e</span> <span class="id" type="var">IH</span> ].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">x_eq_e</span> | <span class="id" type="var">x_in_fl</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span>  <span class="id" type="var">x_in_fl</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_filter_aux</span> :  <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>, <span class="id" type="var">without_red</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">without_red</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_not_in_l</span> <span class="id" type="var">Wl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">P_bool</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">without_red_filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span> <span class="id" type="var">Wl</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>));<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_in_l</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">included_filter_aux</span> <span class="id" type="keyword">with</span> <span class="id" type="var">P_bool</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">filter</span> (<span class="id" type="var">P_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">s</span> <br/>
&nbsp;&nbsp;(<span class="id" type="var">P_compat</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> -&gt; (<span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> = <span class="id" type="var">P_bool</span> <span class="id" type="var">e'</span>)) := <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">mk_set</span> (<span class="id" type="var">without_red_filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">s</span>.(<span class="id" type="var">is_a_set</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filter_1_list</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">P_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">l</span> <span class="id" type="var">e</span> <br/>
&nbsp;&nbsp;(<span class="id" type="var">P_compat</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> -&gt; (<span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> = <span class="id" type="var">P_bool</span> <span class="id" type="var">e'</span>)),<br/>
&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> -&gt; <span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span> <span class="id" type="var">P_compat</span> <span class="id" type="var">e_in_l</span> <span class="id" type="var">P_e</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">P_e'</span> <span class="id" type="var">IH</span> | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">not_P_e</span> <span class="id" type="var">IH</span> ].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">e_in_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_e'</span> | <span class="id" type="var">e_in_l</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e_in_l</span>; <span class="id" type="tactic">destruct</span> <span class="id" type="var">e_in_l</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_e'</span> | <span class="id" type="var">e_in_l</span>].<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">P_compat</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>) <span class="id" type="keyword">in</span> <span class="id" type="var">P_e</span>; <span class="id" type="tactic">trivial</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">P_e</span> <span class="id" type="keyword">in</span> <span class="id" type="var">not_P_e</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filter_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">P_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">s</span> <span class="id" type="var">P_compat</span> <span class="id" type="var">e</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">filter</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">s</span> <span class="id" type="var">P_compat</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>, <span class="id" type="var">support</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P_bool</span> [<span class="id" type="var">l</span> <span class="id" type="var">wr</span>] <span class="id" type="var">P_compat</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_s</span> <span class="id" type="var">P_e</span>; <span class="id" type="tactic">simpl</span>;  <span class="id" type="tactic">apply</span> <span class="id" type="var">filter_1_list</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filter_2_list</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">P_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">l</span> <span class="id" type="var">e</span>  <br/>
&nbsp;&nbsp;(<span class="id" type="var">P_compat</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> -&gt; (<span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> = <span class="id" type="var">P_bool</span> <span class="id" type="var">e'</span>)),<br/>
&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>) -&gt; <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l</span> /\ <span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> = <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span> <span class="id" type="var">e</span> <span class="id" type="var">P_compat</span> <span class="id" type="var">H</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">filter_aux</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">l</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">P_e'</span> <span class="id" type="var">IH</span> | <span class="id" type="var">H1</span> <span class="id" type="var">e'</span> <span class="id" type="var">l</span> <span class="id" type="var">H2</span> <span class="id" type="var">not_P_e</span> <span class="id" type="var">IH</span> ].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_e'</span> | <span class="id" type="var">e_in_fl</span>]; <span class="id" type="tactic">split</span>.<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">P_compat</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">IH</span> <span class="id" type="var">e_in_fl</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">IH</span> <span class="id" type="var">e_in_fl</span>)).<br/>
<span class="id" type="tactic">split</span>; [<span class="id" type="var">right</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filter_2</span> :<br/>
&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">P_bool</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">s</span> <span class="id" type="var">P_compat</span> <span class="id" type="var">e</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">filter</span> <span class="id" type="var">P_bool</span> <span class="id" type="var">s</span> <span class="id" type="var">P_compat</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s</span> /\ <span class="id" type="var">P_bool</span> <span class="id" type="var">e</span> = <span class="id" type="var">true</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>, <span class="id" type="var">support</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P_bool</span> [<span class="id" type="var">l</span> <span class="id" type="var">wr</span>] <span class="id" type="var">e</span> <span class="id" type="var">E</span> <span class="id" type="var">e_in_l_and_P_e</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">filter_2_list</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_nil</span> : <span class="id" type="var">without_red</span> <span class="id" type="var">nil</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">empty</span> : <span class="id" type="var">t</span> := <span class="id" type="var">mk_set</span> <span class="id" type="var">without_red_nil</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_singleton</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> : <span class="id" type="var">A</span>, <span class="id" type="var">without_red</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">nil</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">singleton</span> (<span class="id" type="var">e</span> : <span class="id" type="var">A</span>) : <span class="id" type="var">t</span> := <span class="id" type="var">mk_set</span> (<span class="id" type="var">without_red_singleton</span> <span class="id" type="var">e</span>).<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">make_set</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) : <span class="id" type="var">t</span> := <span class="id" type="var">mk_set</span> (<span class="id" type="var">without_red_remove_red</span> <span class="id" type="var">l</span>).<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">add_without_red</span> (<span class="id" type="var">acc</span> <span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l</span>} : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">acc</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">e</span> :: <span class="id" type="var">le</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">acc</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">add_without_red</span> <span class="id" type="var">acc</span> <span class="id" type="var">le</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">add_without_red</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">acc</span>) <span class="id" type="var">le</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_add_without_red</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">without_red</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">without_red</span> (<span class="id" type="var">add_without_red</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">Wl1</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">add_without_red</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e_in_l1</span> <span class="id" type="var">IH</span> | <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e_not_in_l1</span> <span class="id" type="var">IH</span> ].<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">e_not_in_l1</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> := <span class="id" type="var">mk_set</span> (<span class="id" type="var">without_red_add_without_red</span> <span class="id" type="var">s2</span>.(<span class="id" type="var">support</span>) <span class="id" type="var">s1</span>.(<span class="id" type="var">is_a_set</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_1_aux</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">e</span> : <span class="id" type="var">A</span>), <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">add_without_red</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">union_1_aux</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_l1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">union_1_aux</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span> <span class="id" type="var">_</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_l1</span>)).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] <span class="id" type="var">e</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">union_1_aux</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_2_aux</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">e</span> : <span class="id" type="var">A</span>), <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">add_without_red</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_a2l2</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e_in_a2l2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">case</span> <span class="id" type="var">e_in_a2l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e_in_a2l2</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_a2</span>.<br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a2</span> <span class="id" type="var">e</span> <span class="id" type="var">_</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e_eq_a2</span>) <span class="id" type="var">_</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a2_in_l1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">union_1_aux</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">union_1_aux</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">l1</span>) <span class="id" type="var">l2</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_l2</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">union_2_aux</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] <span class="id" type="var">e</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">union_2_aux</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_12_aux</span> :<br/>
<span class="id" type="keyword">forall</span> (<span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) (<span class="id" type="var">e</span> : <span class="id" type="var">A</span>), <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">add_without_red</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> \/ <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1_l2</span>; <br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">add_without_red</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ | <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_in_l1</span> <span class="id" type="var">IH</span> | <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_not_in_l1</span> <span class="id" type="var">IH</span> ].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">e_in_l1_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">e_in_l1</span> | <span class="id" type="var">e_in_l2</span>]; [<span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">e_in_l1_l2</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">e_eq_e2</span> | <span class="id" type="var">e_in_l1</span>] | <span class="id" type="var">e_in_l2</span>];<br/>
[ <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">left</span> | <span class="id" type="tactic">do</span> 2 <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_12</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> \/ <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] <span class="id" type="var">e</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">union_12_aux</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="var">Function</span> <span class="id" type="var">remove_not_common</span> (<span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>) {<span class="id" type="keyword">struct</span> <span class="id" type="var">l2</span>} : <span class="id" type="var">list</span> <span class="id" type="var">A</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l2</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span> =&gt; <span class="id" type="var">acc</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">e</span> :: <span class="id" type="var">l</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">if</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">then</span> <span class="id" type="var">remove_not_common</span> (<span class="id" type="var">e</span> :: <span class="id" type="var">acc</span>) <span class="id" type="var">l1</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">else</span> <span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">length_remove_not_common</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">acc</span>, <span class="id" type="var">length</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) = <span class="id" type="var">length</span> <span class="id" type="var">acc</span> + <span class="id" type="var">length</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="var">fix</span> 2.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">acc</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">plus_n_O</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">length_remove_not_common</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">acc</span>)); <br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">length_remove_not_common</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">nil</span>)); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">plus_n_Sm</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">length_remove_not_common</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_remove_not_common_aux</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, (<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">acc</span> /\ <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span> -&gt; <span class="id" type="var">False</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">without_red</span> <span class="id" type="var">acc</span> -&gt; <span class="id" type="var">without_red</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">without_red</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">without_red</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">H</span> <span class="id" type="var">Wa</span> <span class="id" type="var">Wl1</span> <span class="id" type="var">Wl2</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e_in_l1</span> <span class="id" type="var">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e_not_in_l1</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_e</span>; <span class="id" type="var">revert</span> <span class="id" type="var">Wl2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">Abs</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_not_in_l2</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">e_not_in_l2</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_in_acc</span> <span class="id" type="var">a_in_l2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">acc</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">acc</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_acc</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">split</span>; [<span class="id" type="tactic">assumption</span> | <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>].<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Wa</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Wl2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_in_acc</span> <span class="id" type="var">a_in_l2</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">H</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="var">right</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">Wl2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">without_red_remove_not_common</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>, <span class="id" type="var">without_red</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">without_red</span> <span class="id" type="var">l2</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">without_red</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr1</span> <span class="id" type="var">wr2</span>; <br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">without_red_remove_not_common_aux</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> [ <span class="id" type="var">H</span> <span class="id" type="var">_</span> ]; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">mk_set</span> (<span class="id" type="var">without_red_remove_not_common</span> <span class="id" type="var">s1</span>.(<span class="id" type="var">is_a_set</span>) <span class="id" type="var">s2</span>.(<span class="id" type="var">is_a_set</span>)).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_1_aux</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">acc</span> \/ <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_acc_l1</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_in_l1</span> <span class="id" type="var">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_not_in_l1</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">e_in_acc_l1</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">e_eq_e2</span> | <span class="id" type="var">e_in_acc</span>] | <span class="id" type="var">e_in_l1</span>];<br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span> | <span class="id" type="var">left</span> | <span class="id" type="var">right</span> ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e2</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">e2_in_l1</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_1</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] <span class="id" type="var">e</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">inter_1_aux</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_2_aux</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">acc</span> \/ <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_acc_l2</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_in_l1</span> <span class="id" type="var">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_not_in_l1</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">e_in_acc_l2</span>) <span class="id" type="keyword">as</span> [[<span class="id" type="var">e_eq_e2</span> | <span class="id" type="var">e_in_acc</span>] | <span class="id" type="var">e_in_l1</span>];<br/>
[ <span class="id" type="tactic">subst</span>; <span class="id" type="var">right</span>; <span class="id" type="var">left</span> | <span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span> ]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">IH</span> <span class="id" type="var">e_in_acc_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">e_in_acc</span> | <span class="id" type="var">e_in_l2</span>]; [<span class="id" type="var">left</span> | <span class="id" type="var">right</span>; <span class="id" type="var">right</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_2</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] <span class="id" type="var">e</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">inter_2_aux</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">H</span>).<br/>
<span class="id" type="tactic">intros</span> [ <span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>]; <span class="id" type="tactic">trivial</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_12_aux</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>,  <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l1</span> -&gt; <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">l2</span> -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span>, <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">acc</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_acc</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_in_l1</span> <span class="id" type="var">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_not_in_l1</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>

<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1</span> <span class="id" type="var">e_in_l2</span>;<br/>
<span class="id" type="var">functional</span> <span class="id" type="tactic">induction</span> (<span class="id" type="var">remove_not_common</span> <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">as</span> [ <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_in_l1</span> <span class="id" type="var">IH</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">acc</span> <span class="id" type="var">l1</span> <span class="id" type="var">H1</span> <span class="id" type="var">e2</span> <span class="id" type="var">l2</span> <span class="id" type="var">H2</span> <span class="id" type="var">e2_not_in_l1</span> <span class="id" type="var">IH</span>].<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">e_in_l2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_e2</span> | <span class="id" type="var">e_in_l2</span>]; [<span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="var">left</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> <span class="id" type="var">e_in_l2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_e2</span> | <span class="id" type="var">e_in_l2</span>].<br/>
<span class="id" type="var">absurd</span> (<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e2</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">rewrite</span> <span class="id" type="var">e2_not_in_l1</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">exact</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IH</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">inter_12</span> : <br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1</span> <span class="id" type="var">e_in_l2</span>; <br/>
<span class="id" type="tactic">refine</span> (<span class="id" type="var">inter_12_aux</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span> <span class="id" type="var">e</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, {<span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>} + {~ <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">subset</span>, <span class="id" type="var">mem</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">_</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>; <span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">intros</span>; <span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_in_l2</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">subset_dec</span> <span class="id" type="var">l1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1_in_l2</span>; <span class="id" type="var">left</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_a1l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">e_in_a1l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e_in_a1l1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_a1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_in_l1</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">l1_in_l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1_not_in_l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">l1_not_in_l2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1</span>; <span class="id" type="tactic">exact</span> (<span class="id" type="var">l1_in_l2</span> <span class="id" type="var">e</span> (<span class="id" type="var">or_intror</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_l1</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_not_in_l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">l1_in_l2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_not_in_l2</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">l1_in_l2</span> <span class="id" type="var">a1</span>); <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_union_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">union_1</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_union_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s2</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">union_2</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_inter_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">subset</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">s1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">inter_1</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_inter_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">subset</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">inter_2</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> &lt;-&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_set_dec</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, {<span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>} + {~eq_set <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">subset_dec</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">s1_incl_s2</span> | <span class="id" type="var">s1_not_incl_s2</span> ].<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">subset_dec</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">s2_incl_s1</span> | <span class="id" type="var">s2_not_incl_s1</span> ].<br/>
<span class="id" type="var">left</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s2_not_incl_s1</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_s2</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="var">right</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">s1_eq_s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">s1_not_incl_s2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_s1</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_set_refl</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s</span> <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_set_sym</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">eq_set</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">H</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_set_trans</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">eq_set</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span> -&gt; <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s3</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">s2_eq_s3</span> <span class="id" type="var">e</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">e</span>) (<span class="id" type="var">s2_eq_s3</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_compat_eq_set</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">eq_set</span> (<span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span>) (<span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="keyword">forall</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span>) -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">a</span> (<span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">a_mem_e_s1</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">add_12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_mem_e_s1</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">a_eq_e</span> | <span class="id" type="var">a_mem_s1</span>].<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e_eq_a</span> : <span class="id" type="var">EDS1.eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">eq_mem_mem</span> (<span class="id" type="var">add</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>) <span class="id" type="var">e_eq_a</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">add_1</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">add_2</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">eq_set_sym</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">add_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">s</span>, <span class="id" type="var">eq_set</span> (<span class="id" type="var">add</span> <span class="id" type="var">e1</span> (<span class="id" type="var">add</span> <span class="id" type="var">e2</span> <span class="id" type="var">s</span>)) (<span class="id" type="var">add</span> <span class="id" type="var">e2</span> (<span class="id" type="var">add</span> <span class="id" type="var">e1</span> <span class="id" type="var">s</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">s</span>, <span class="id" type="var">subset</span> (<span class="id" type="var">add</span> <span class="id" type="var">e1</span> (<span class="id" type="var">add</span> <span class="id" type="var">e2</span> <span class="id" type="var">s</span>)) (<span class="id" type="var">add</span> <span class="id" type="var">e2</span> (<span class="id" type="var">add</span> <span class="id" type="var">e1</span> <span class="id" type="var">s</span>))).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">add_12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_e1</span> | <span class="id" type="var">e_in_e2_s</span>].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e1</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">add_2</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">add_1</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">add_12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_e2_s</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">e_eq_e2</span> | <span class="id" type="var">e_in_s</span>].<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e2</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">add_1</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">apply</span> <span class="id" type="var">add_2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">s</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_empty_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s</span> (<span class="id" type="var">union</span> <span class="id" type="var">empty</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12_aux</span> <span class="id" type="var">nil</span> (<span class="id" type="var">support</span> <span class="id" type="var">s</span>) <span class="id" type="var">e</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_empty_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s</span> (<span class="id" type="var">union</span> <span class="id" type="var">s</span> <span class="id" type="var">empty</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_comm</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">eq_set</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>) (<span class="id" type="var">union_1</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>) (<span class="id" type="var">union_2</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>)<br/>
(<span class="id" type="var">union_12</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1</span> <span class="id" type="var">e</span>)  (<span class="id" type="var">union_1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1</span> <span class="id" type="var">e</span>) (<span class="id" type="var">union_2</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_assoc</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span>, <span class="id" type="var">eq_set</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> (<span class="id" type="var">union</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span>)) (<span class="id" type="var">union</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">s3</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span> <span class="id" type="var">e</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12</span> <span class="id" type="var">s1</span> (<span class="id" type="var">union</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span>) <span class="id" type="var">e</span>) (<span class="id" type="var">union_1</span> <span class="id" type="var">s1</span> (<span class="id" type="var">union</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span>) <span class="id" type="var">e</span>) <br/>
&nbsp;(<span class="id" type="var">union_2</span> <span class="id" type="var">s1</span> (<span class="id" type="var">union</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span>) <span class="id" type="var">e</span>)<br/>
(<span class="id" type="var">union_12</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span> <span class="id" type="var">e</span>) (<span class="id" type="var">union_1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span> <span class="id" type="var">e</span>) (<span class="id" type="var">union_2</span> <span class="id" type="var">s2</span> <span class="id" type="var">s3</span> <span class="id" type="var">e</span>)<br/>
(<span class="id" type="var">union_12</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">s3</span> <span class="id" type="var">e</span>) (<span class="id" type="var">union_1</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">s3</span> <span class="id" type="var">e</span>) <br/>
&nbsp;&nbsp;(<span class="id" type="var">union_2</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">s3</span> <span class="id" type="var">e</span>)<br/>
(<span class="id" type="var">union_12</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>)  (<span class="id" type="var">union_1</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>) (<span class="id" type="var">union_2</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_filter</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> (<span class="id" type="var">P1</span> <span class="id" type="var">P2</span> : <span class="id" type="var">A</span> -&gt; <span class="id" type="var">bool</span>) <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">P1_compat</span> <span class="id" type="var">P2_compat</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; (<span class="id" type="keyword">forall</span> <span class="id" type="var">e</span>, <span class="id" type="var">P1</span> <span class="id" type="var">e</span> = <span class="id" type="var">true</span> -&gt; <span class="id" type="var">P2</span> <span class="id" type="var">e</span> = <span class="id" type="var">true</span>) -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">subset</span> (<span class="id" type="var">filter</span> <span class="id" type="var">P1</span> <span class="id" type="var">s1</span> <span class="id" type="var">P1_compat</span>) (<span class="id" type="var">filter</span> <span class="id" type="var">P2</span> <span class="id" type="var">s2</span> <span class="id" type="var">P2_compat</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P1</span> <span class="id" type="var">P2</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">P1_compat</span> <span class="id" type="var">P2_compat</span> <span class="id" type="var">Hs</span> <span class="id" type="var">HP</span> <span class="id" type="var">e</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">filter_1</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hs</span> <span class="id" type="var">e</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj1</span> (<span class="id" type="var">filter_2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P1_compat</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">HP</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">proj2</span> (<span class="id" type="var">filter_2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P1_compat</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>)).<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">filter_union</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">P</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">P_compat</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">eq_set</span> (<span class="id" type="var">filter</span> <span class="id" type="var">P</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">P_compat</span>)  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">union</span> (<span class="id" type="var">filter</span> <span class="id" type="var">P</span> <span class="id" type="var">s1</span> <span class="id" type="var">P_compat</span>) (<span class="id" type="var">filter</span> <span class="id" type="var">P</span> <span class="id" type="var">s2</span> <span class="id" type="var">P_compat</span>)).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] <span class="id" type="var">P_compat</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">filter_2_list</span> <span class="id" type="var">_</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P_compat</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H'</span> <span class="id" type="var">Pe</span>];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">union_12_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H'</span>);<br/>
[ <span class="id" type="tactic">apply</span> <span class="id" type="var">union_1_aux</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">union_2_aux</span>] ; <span class="id" type="tactic">apply</span> <span class="id" type="var">filter_1_list</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">destruct</span> (<span class="id" type="var">union_12_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>) <span class="id" type="keyword">as</span> [ <span class="id" type="var">H'</span> | <span class="id" type="var">H'</span>];<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">filter_2_list</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">P_compat</span> <span class="id" type="var">H'</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">H''</span> <span class="id" type="var">Pe</span>];<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">filter_1_list</span>; <span class="id" type="tactic">trivial</span>; [ <span class="id" type="tactic">apply</span> <span class="id" type="var">union_1_aux</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">union_2_aux</span>] ; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_compat_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> -&gt; <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">subset</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1_eq_s1'</span> <span class="id" type="var">H</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_s1'</span>;<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s1'</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_compat_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> -&gt; <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> <span class="id" type="var">s2_eq_s2'</span> <span class="id" type="var">H</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_s1</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">s2_eq_s2'</span> <span class="id" type="var">e</span>) (<span class="id" type="var">H</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_s1</span>);<br/>
<span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_compat</span> :<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> -&gt; <span class="id" type="var">eq_set</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">subset</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> <span class="id" type="var">s1_eq_s1'</span> <span class="id" type="var">s2_eq_s2'</span> <span class="id" type="var">H</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_s1'</span>;<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s1'</span> <span class="id" type="var">e</span>) (<span class="id" type="var">s2_eq_s2'</span> <span class="id" type="var">e</span>) (<span class="id" type="var">H</span> <span class="id" type="var">e</span>);<br/>
<span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_compat_subset_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">subset</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s</span>)  (<span class="id" type="var">union</span> <span class="id" type="var">s2</span> <span class="id" type="var">s</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] [<span class="id" type="var">l</span> <span class="id" type="var">wr</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">subset</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_ll1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_ll1</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">e_in_l</span> | <span class="id" type="var">e_in_l1</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_2</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_compat_subset_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">subset</span> (<span class="id" type="var">union</span> <span class="id" type="var">s</span> <span class="id" type="var">s1</span>)  (<span class="id" type="var">union</span> <span class="id" type="var">s</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] [<span class="id" type="var">l</span> <span class="id" type="var">wr</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">subset</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_ll1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_ll1</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">e_in_l</span> | <span class="id" type="var">e_in_l1</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_compat_subset</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2'</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">subset</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2'</span> -&gt; <span class="id" type="var">subset</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span>)  (<span class="id" type="var">union</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>] [<span class="id" type="var">l1'</span> <span class="id" type="var">wr1'</span>] [<span class="id" type="var">l2'</span> <span class="id" type="var">wr2'</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">subset</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H</span> <span class="id" type="var">H'</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_ll1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12_aux</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e_in_ll1</span>); <span class="id" type="tactic">intros</span> [ <span class="id" type="var">e_in_l1</span> | <span class="id" type="var">e_in_l1'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">union_compat_eq_set</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> -&gt; <span class="id" type="var">eq_set</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">eq_set</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) (<span class="id" type="var">union</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2'</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> <span class="id" type="var">s1_eq_s1'</span> <span class="id" type="var">s2_eq_s2'</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">e_in_s1</span> | <span class="id" type="var">e_in_s2</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_1</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s1'</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">s2_eq_s2'</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">union_12</span> <span class="id" type="var">s1'</span> <span class="id" type="var">s2'</span> <span class="id" type="var">e</span> <span class="id" type="var">H</span>); <span class="id" type="tactic">intros</span> [<span class="id" type="var">e_in_s1'</span> | <span class="id" type="var">e_in_s2'</span>].<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_1</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s1'</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">union_2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">s2_eq_s2'</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span>  <span class="id" type="var">subset_subset_union</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">subset</span> <span class="id" type="var">s2</span> <span class="id" type="var">s</span> -&gt; <span class="id" type="var">subset</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) <span class="id" type="var">s</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">e</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">union_12</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>); [ <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span> | <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>]; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">cardinal</span> <span class="id" type="var">s</span> := <span class="id" type="var">List.length</span> <span class="id" type="var">s</span>.(<span class="id" type="var">support</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cardinal_subset</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">cardinal</span> <span class="id" type="var">s1</span> &lt;= <span class="id" type="var">cardinal</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">subset</span>, <span class="id" type="var">cardinal</span>, <span class="id" type="var">mem</span>, <span class="id" type="var">without_red</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">l2</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_O_n</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a1</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_not_in_l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span> <span class="id" type="var">l1_in_l2</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e1_in_l2</span> : <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l1_in_l2</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e1_in_l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2''</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_eq_a1'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">H'</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_add</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cardinal_subset</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_remove</span> <span class="id" type="var">a1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">diff_mem_remove</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a1'</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_a1'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_not_in_l1</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a1'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">l1_in_l2</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cardinal_union_1</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">cardinal</span> <span class="id" type="var">s1</span> &lt;= <span class="id" type="var">cardinal</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cardinal_subset</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">subset_union_1</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cardinal_union_2</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">cardinal</span> <span class="id" type="var">s2</span> &lt;= <span class="id" type="var">cardinal</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cardinal_subset</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">subset_union_2</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cardinal_union_inter_12</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">cardinal</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) + <span class="id" type="var">cardinal</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) = <span class="id" type="var">cardinal</span> <span class="id" type="var">s1</span> + <span class="id" type="var">cardinal</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>, <span class="id" type="var">cardinal</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">fix</span> 3.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>); <span class="id" type="var">case_eq</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Abs</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2_not_in_l2_bool</span> <span class="id" type="var">a2_not_in_l2</span> <span class="id" type="var">wr2</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a2_in_l1</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_remove_not_common</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">plus_n_Sm</span>; <span class="id" type="tactic">rewrite</span> (<span class="id" type="var">cardinal_union_inter_12</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>); <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a2_not_in_l1</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">plus_n_Sm</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">cardinal_union_inter_12</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l1''</span>, <span class="id" type="var">length</span> (<span class="id" type="var">add_without_red</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">a2</span> :: <span class="id" type="var">l1''</span>) <span class="id" type="var">l2</span>) = <span class="id" type="var">S</span> (<span class="id" type="var">length</span> (<span class="id" type="var">add_without_red</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">l1''</span>) <span class="id" type="var">l2</span>))).<br/>
<span class="id" type="tactic">clear</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">a2_not_in_l1</span> <span class="id" type="var">a2_not_in_l2</span> <span class="id" type="var">wr2</span>; <span class="id" type="var">revert</span> <span class="id" type="var">l2</span> <span class="id" type="var">a2</span> <span class="id" type="var">a2_not_in_l2_bool</span>.<br/>
<span class="id" type="var">fix</span> <span class="id" type="var">L</span> 1.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">l2</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">_</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l1''</span>; <span class="id" type="tactic">do</span> 2 <span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_n_Sm</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2</span> <span class="id" type="var">l2</span> <span class="id" type="var">a</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">eq_bool_sym</span> : <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a</span> = <span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a2</span> <span class="id" type="var">a</span>) (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">a</span>); <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2_eq_a</span> <span class="id" type="var">a_diff_a2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a_diff_a2</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a2_diff_a</span> <span class="id" type="var">a_eq_a2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a2_diff_a</span>; <span class="id" type="tactic">symmetry</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_not_in_l2_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l1''</span>; <span class="id" type="var">revert</span> <span class="id" type="var">a_not_in_l2_bool</span>;<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">mem_bool_app</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1'</span> (<span class="id" type="var">a</span> :: <span class="id" type="var">l1''</span>)).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_bool_sym</span>; <span class="id" type="tactic">case</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">a</span> <span class="id" type="var">a2</span>); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intro</span>; <span class="id" type="tactic">discriminate</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a_not_in_l2_bool</span>; <span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">mem_bool_app</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l1''</span>);<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">a2</span> (<span class="id" type="var">l1'</span> ++ <span class="id" type="var">l1''</span>)).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">L</span> <span class="id" type="var">l2</span> <span class="id" type="var">a</span> <span class="id" type="var">a_not_in_l2_bool</span> <span class="id" type="var">l1'</span> <span class="id" type="var">l1''</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">L</span> <span class="id" type="var">l2</span> <span class="id" type="var">a</span> <span class="id" type="var">a_not_in_l2_bool</span> (<span class="id" type="var">a2</span> :: <span class="id" type="var">l1'</span>) <span class="id" type="var">l1''</span>).<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">L'</span> := <span class="id" type="var">L</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span>); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">L'</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cardinal_union</span>:<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">cardinal</span> (<span class="id" type="var">union</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>) = <span class="id" type="var">cardinal</span> <span class="id" type="var">s1</span> + <span class="id" type="var">cardinal</span> <span class="id" type="var">s2</span> - <span class="id" type="var">cardinal</span> (<span class="id" type="var">inter</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">cardinal_union_inter_12</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">plus_minus</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">sym_eq</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">plus_comm</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">cardinal_eq_set</span> : <span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>, <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">cardinal</span> <span class="id" type="var">s1</span> = <span class="id" type="var">cardinal</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s1_eq_s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_antisym</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">cardinal_subset</span>;<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_si</span>; <span class="id" type="tactic">generalize</span> (<span class="id" type="var">s1_eq_s2</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">intuition</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_cardinal_not_eq_not_eq_set</span>  :<br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; ~mem <span class="id" type="var">e</span> <span class="id" type="var">s1</span> -&gt; <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>  -&gt; <br/>
&nbsp;&nbsp;<span class="id" type="var">cardinal</span> <span class="id" type="var">s1</span> &lt; <span class="id" type="var">cardinal</span> <span class="id" type="var">s2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s1</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">s2</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>.<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">without_red</span>, <span class="id" type="var">cardinal</span>, <span class="id" type="var">subset</span>, <span class="id" type="var">mem</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">fix</span> 1.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span> <span class="id" type="var">a</span> <span class="id" type="var">l1_in_l2</span> <span class="id" type="var">a_not_in_l1</span> <span class="id" type="var">a_in_l2</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">a_in_l2</span>); <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2''</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a_eq_a'</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">M</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">M</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">M</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">length_app</span>; <span class="id" type="tactic">simpl</span> (<span class="id" type="var">length</span> (<span class="id" type="var">a'</span> :: <span class="id" type="var">l2''</span>)); <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">plus_n_Sm</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">length_app</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">wr2'</span> : <span class="id" type="var">without_red</span> (<span class="id" type="var">l2'</span> ++ <span class="id" type="var">l2''</span>)).<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">without_red_remove</span> <span class="id" type="keyword">with</span> <span class="id" type="var">a'</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">apply</span> (@<span class="id" type="var">cardinal_subset</span> (<span class="id" type="var">mk_set</span> <span class="id" type="var">wr1</span>) (<span class="id" type="var">mk_set</span> <span class="id" type="var">wr2'</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_l1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e_in_l2</span> := <span class="id" type="var">l1_in_l2</span> <span class="id" type="var">e</span> <span class="id" type="var">e_in_l1</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e_in_l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">e_in_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e_in_l2</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_l2'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_l2</span>; <span class="id" type="tactic">case</span> <span class="id" type="var">e_in_l2</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">e_in_l2</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_a'</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">a</span> <span class="id" type="var">l1</span>).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">a'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_in_l2''</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">mem_or_app</span>; <span class="id" type="var">right</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_set_list_permut_support</span> :<br/>
&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>,  <span class="id" type="var">eq_set</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> -&gt; <span class="id" type="var">permut</span> <span class="id" type="var">s1</span>.(<span class="id" type="var">support</span>) <span class="id" type="var">s2</span>.(<span class="id" type="var">support</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>] [<span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>]; <span class="id" type="tactic">unfold</span> <span class="id" type="var">eq_set</span>, <span class="id" type="var">mem</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">l1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">e1</span> <span class="id" type="var">l1</span>].<br/>
<span class="id" type="tactic">intros</span> [ | <span class="id" type="var">e2</span> <span class="id" type="var">l2</span>] <span class="id" type="var">_</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">Pnil</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">H</span> <span class="id" type="var">e2</span>); <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">intros</span> [<span class="id" type="var">_</span> <span class="id" type="var">Abs</span>]; <span class="id" type="tactic">apply</span> <span class="id" type="var">Abs</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">l2</span> <span class="id" type="var">wr2</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">e1_in_l2</span> : <span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e1</span> <span class="id" type="var">l2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">H</span>; <span class="id" type="var">left</span>; <span class="id" type="tactic">reflexivity</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">destruct</span> (<span class="id" type="var">mem_split_set</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">e1_in_l2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">e1'</span> [<span class="id" type="var">l2'</span> [<span class="id" type="var">l2''</span> [<span class="id" type="var">e1_eq_e1'</span> [<span class="id" type="var">H'</span> <span class="id" type="var">_</span>]]]]].<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">e1_eq_e1'</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H'</span>; <span class="id" type="tactic">subst</span> <span class="id" type="var">l2</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">permut_cons_inside</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">IHl1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_remove</span> <span class="id" type="var">e1</span> <span class="id" type="var">nil</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_remove</span> <span class="id" type="var">e1'</span>); <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">H'</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">diff_mem_remove</span> <span class="id" type="keyword">with</span> <span class="id" type="var">e1'</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_e1'</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_not_in</span> <span class="id" type="var">e1</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span> <span class="id" type="var">wr1</span>).<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">rewrite</span> <span class="id" type="var">e1_eq_e1'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">e_eq_e1'</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">H</span> <span class="id" type="var">e</span>); <span class="id" type="var">right</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">apply</span> (@<span class="id" type="var">diff_mem_remove</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">nil</span> <span class="id" type="var">l1</span> <span class="id" type="var">e1</span>).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_eq_e1</span>; <span class="id" type="tactic">apply</span> (<span class="id" type="var">without_red_not_in</span> <span class="id" type="var">e1'</span> <span class="id" type="var">l2'</span> <span class="id" type="var">l2''</span> <span class="id" type="var">wr2</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">e1_eq_e1'</span>; <span class="id" type="tactic">rewrite</span> &lt;- <span class="id" type="var">e_eq_e1</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">H</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">apply</span> <span class="id" type="var">mem_insert</span>; <span class="id" type="tactic">trivial</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">not_mem_compat</span> : <br/>
&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span>, <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">e0</span> : <span class="id" type="var">EDS1.A</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e0</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>))) <span class="id" type="var">e</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">fun</span> <span class="id" type="var">e0</span> : <span class="id" type="var">EDS1.A</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e0</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>))) <span class="id" type="var">e'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s2</span> <span class="id" type="var">e</span> <span class="id" type="var">e'</span> <span class="id" type="var">e_eq_e'</span>; <br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)) (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e'</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e'</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_in_s2</span> <span class="id" type="var">e'_not_in_s2</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e'</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_not_in_s2</span> <span class="id" type="var">e'_in_s2</span>; <span class="id" type="var">absurd</span> (<span class="id" type="var">more_list.mem</span> <span class="id" type="var">eq_A</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">eq_proof</span> <span class="id" type="var">e'</span>).<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">equiv_sym</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_proof</span>); <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">set_diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> := <span class="id" type="var">filter</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">e</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>.(<span class="id" type="var">support</span>))) <span class="id" type="var">s1</span> (<span class="id" type="var">not_mem_compat</span> <span class="id" type="var">s2</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">subset_set_diff</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> -&gt; <span class="id" type="var">cardinal</span> (<span class="id" type="var">set_diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2'</span>) &lt;= <span class="id" type="var">cardinal</span> (<span class="id" type="var">set_diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">set_diff</span>, <span class="id" type="var">filter</span>, <span class="id" type="var">cardinal</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s1</span> <span class="id" type="var">prf</span>]; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">induction</span> <span class="id" type="var">s1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">s1</span>]; <span class="id" type="tactic">intros</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> <span class="id" type="var">s2_in_s2'</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">le_n</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">prf1</span> := <span class="id" type="var">without_red_remove</span> <span class="id" type="var">a1</span> <span class="id" type="var">nil</span> <span class="id" type="var">s1</span> <span class="id" type="var">prf</span>); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">prf1</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">IHs1</span> <span class="id" type="var">prf1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s2_in_s2'</span>).<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">l</span> := <span class="id" type="var">filter_aux</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">e</span> : <span class="id" type="var">EDS1.A</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>))) <span class="id" type="var">s1</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">l'</span> := <span class="id" type="var">filter_aux</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">e</span> : <span class="id" type="var">EDS1.A</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>))) <span class="id" type="var">s1</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">s2_in_s2'</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)); <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_not_in_s2'</span> <span class="id" type="var">a1_in_s2</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">a1_not_in_s2'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_in_s2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">strict_subset_set_diff</span> : <br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">forall</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span>, <span class="id" type="var">subset</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> -&gt; <br/>
&nbsp;&nbsp;(<span class="id" type="var">exists</span> <span class="id" type="var">e</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s1</span> /\ <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2'</span> /\ ~mem <span class="id" type="var">e</span> <span class="id" type="var">s2</span>) -&gt;<br/>
&nbsp;&nbsp;<span class="id" type="var">cardinal</span> (<span class="id" type="var">set_diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2'</span>) &lt; <span class="id" type="var">cardinal</span> (<span class="id" type="var">set_diff</span> <span class="id" type="var">s1</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
<span class="id" type="tactic">unfold</span> <span class="id" type="var">set_diff</span>, <span class="id" type="var">filter</span>, <span class="id" type="var">cardinal</span>; <span class="id" type="tactic">simpl</span>;<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">s1</span> <span class="id" type="var">prf</span>]; <span class="id" type="tactic">induction</span> <span class="id" type="var">s1</span> <span class="id" type="keyword">as</span> [ | <span class="id" type="var">a1</span> <span class="id" type="var">s1</span>]; <br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">s2</span> <span class="id" type="var">s2'</span> <span class="id" type="var">s2_in_s2'</span> [<span class="id" type="var">e</span> [<span class="id" type="var">e_mem_s1</span> [<span class="id" type="var">e_mem_s2'</span> <span class="id" type="var">e_not_mem_s2</span>]]]; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="var">contradiction</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">prf1</span> := <span class="id" type="var">without_red_remove</span> <span class="id" type="var">a1</span> <span class="id" type="var">nil</span> <span class="id" type="var">s1</span> <span class="id" type="var">prf</span>); <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">prf1</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> <span class="id" type="var">a1</span>); <span class="id" type="var">case_eq</span> (<span class="id" type="var">eq_bool</span> <span class="id" type="var">e</span> <span class="id" type="var">a1</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_eq_a1</span> <span class="id" type="var">e_eq_a1'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a1_mem_s2'</span> : <span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>) = <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">a1_not_mem_s2'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_not_mem_s2'</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">mem_eq_mem</span> <span class="id" type="var">EDS1.eq_proof</span> <span class="id" type="var">e</span> <span class="id" type="var">_</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>) <span class="id" type="var">e_eq_a1'</span> <span class="id" type="var">e_mem_s2'</span>).<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">a1_mem_s2'</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">a1_not_mem_s2</span> : <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)) = <span class="id" type="var">true</span>).<br/>
<span class="id" type="tactic">rewrite</span> &lt;- (<span class="id" type="var">not_mem_compat</span> <span class="id" type="var">s2</span> <span class="id" type="var">e_eq_a1'</span>).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">intro</span> <span class="id" type="var">e_mem_s2</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">e_not_mem_s2</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">refl_equal</span>.<br/>
<span class="id" type="tactic">rewrite</span> <span class="id" type="var">a1_not_mem_s2</span>.<br/>
<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>.<br/>
<span class="id" type="tactic">apply</span> (<span class="id" type="var">subset_set_diff</span> (<span class="id" type="var">mk_set</span> <span class="id" type="var">prf1</span>) <span class="id" type="var">s2_in_s2'</span>).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">e_diff_a1</span> <span class="id" type="var">e_diff_a1'</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">He</span> : <span class="id" type="var">exists</span> <span class="id" type="var">e</span> : <span class="id" type="var">EDS1.A</span>, <span class="id" type="var">mem</span> <span class="id" type="var">e</span> (<span class="id" type="var">mk_set</span> <span class="id" type="var">prf1</span>) /\ <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2'</span> /\ ~ <span class="id" type="var">mem</span> <span class="id" type="var">e</span> <span class="id" type="var">s2</span>).<br/>
<span class="id" type="var">exists</span> <span class="id" type="var">e</span>; <span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>; [<span class="id" type="var">idtac</span> | <span class="id" type="tactic">assumption</span> | <span class="id" type="tactic">assumption</span>].<br/>
<span class="id" type="var">revert</span> <span class="id" type="var">e_mem_s1</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>; <span class="id" type="tactic">simpl</span>.<br/>
<span class="id" type="tactic">intros</span> [<span class="id" type="var">e_eq_a1</span> | <span class="id" type="var">e_mem_s1</span>]; [<span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">e_diff_a1'</span> | <span class="id" type="var">idtac</span>]; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">assert</span> (<span class="id" type="var">H</span> := <span class="id" type="var">IHs1</span> <span class="id" type="var">prf1</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">s2_in_s2'</span> <span class="id" type="var">He</span>).<br/>
<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H</span>.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">l</span> := <span class="id" type="var">filter_aux</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">e</span> : <span class="id" type="var">EDS1.A</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>))) <span class="id" type="var">s1</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">set</span> (<span class="id" type="var">l'</span> := <span class="id" type="var">filter_aux</span> (<span class="id" type="keyword">fun</span> <span class="id" type="var">e</span> : <span class="id" type="var">EDS1.A</span> =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">e</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>))) <span class="id" type="var">s1</span>) <span class="id" type="keyword">in</span> *.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">s2_in_s2'</span> <span class="id" type="var">a1</span>); <span class="id" type="tactic">unfold</span> <span class="id" type="var">mem</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2'</span>)).<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_S</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="tactic">generalize</span> (<span class="id" type="var">mem_bool_ok</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">eq_bool_ok</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)); <span class="id" type="tactic">case</span> (<span class="id" type="var">mem_bool</span> <span class="id" type="var">EDS1.eq_bool</span> <span class="id" type="var">a1</span> (<span class="id" type="var">support</span> <span class="id" type="var">s2</span>)).<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">a1_in_s2</span> <span class="id" type="var">a1_not_in_s2'</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">False_rec</span>.<br/>
<span class="id" type="tactic">apply</span> <span class="id" type="var">a1_not_in_s2'</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">Sub</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">a1_in_s2</span>.<br/>
<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span>; <span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">le_n_S</span>; <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">End</span> <span class="id" type="var">Make</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>