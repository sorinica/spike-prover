\documentclass[12pt]{report}
\usepackage[]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{fullpage}
\usepackage{coqdoc}
\usepackage{amsmath,amssymb}
\usepackage{url}
\begin{document}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% This file has been automatically generated with the command
%% coqdoc --latex term.v 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\coqlibrary{term}{Library }{term}

\begin{coqdoccode}
\coqdocemptyline
\end{coqdoccode}
\section{Term algebra defined as functor from a Module Signature and a Module Variable.}

\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Add} \coqdocvar{LoadPath} "basis".\coqdoceol
\coqdocnoindent
\coqdockw{Add} \coqdocvar{LoadPath} "list\_extensions".\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{Recdef}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{List}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{closure}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{more\_list}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{list\_permut}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{list\_set}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{Arith}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{decidable\_set}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{Setoid}.\coqdoceol
\coqdocnoindent
\coqdockw{Require} \coqdockw{Import} \coqdocvar{term\_spec}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Set Implicit Arguments}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\section{A functor building a Term Module from a Signature and a set of Variables.}

\begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Module} \coqdocvar{Make'} (\coqdocvar{F1} : \coqdocvar{Signature}) (\coqdocvar{X1} : \coqdocvar{decidable\_set.S}) <: \coqdoceol
\coqdocindent{2.50em}
\coqdocvar{Term} \coqdockw{with} \coqdockw{Module} \coqdocvar{F} := \coqdocvar{F1} \coqdockw{with} \coqdockw{Module} \coqdocvar{X} := \coqdocvar{X1}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Module} \coqdocvar{F} := \coqdocvar{F1}.\coqdoceol
\coqdocnoindent
\coqdockw{Import} \coqdocvar{F1}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Module} \coqdocvar{X} := \coqdocvar{X1}.\coqdoceol
\coqdocnoindent
\coqdockw{Import} \coqdocvar{X1}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Notation} \coqdocvar{symbol} := \coqdocvar{Symb.A}.\coqdoceol
\coqdocnoindent
\coqdockw{Notation} \coqdocvar{eq\_symb\_bool} := \coqdocvar{Symb.eq\_bool}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Notation} \coqdocvar{variable} := \coqdocvar{X.A}.\coqdoceol
\coqdocnoindent
\coqdockw{Notation} \coqdocvar{eq\_var\_bool} := \coqdocvar{X.eq\_bool}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Module} \coqdocvar{EX} := \coqdocvar{decidable\_set.Convert} (\coqdocvar{X}).\coqdoceol
\coqdocnoindent
\coqdockw{Module} \coqdocvar{VSet} : \coqdoceol
\coqdocindent{1.50em}
\coqdocvar{list\_set.S} \coqdockw{with} \coqdockw{Definition} \coqdocvar{EDS.A} := \coqdocvar{X.A}\coqdoceol
\coqdocindent{8.50em}
\coqdockw{with} \coqdockw{Definition} \coqdocvar{EDS.eq\_A} := @\coqdocvar{eq} \coqdocvar{X.A} := \coqdocvar{list\_set.Make} (\coqdocvar{EX}).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{eq\_symb\_bool\_refl} : \coqdockw{\ensuremath{\forall}} \coqdocvar{f}, \coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{f} = \coqdocvar{true}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{f}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{Symb.eq\_bool\_ok} \coqdocvar{f} \coqdocvar{f}); \coqdoctac{case} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{f}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{f\_diff\_f}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{f\_diff\_f}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{eq\_var\_bool\_refl} : \coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{v} = \coqdocvar{true}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{v}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{v}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{v}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{v\_diff\_v}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{v\_diff\_v}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
Definition of terms. 
Arity is not taken into account, and terms may be hill-formed. \begin{coqdoccode}
\coqdocemptyline
\coqdocnoindent
\coqdockw{Inductive} \coqdocvar{term} : \coqdockw{Set} :=\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} : \coqdocvar{variable} \ensuremath{\rightarrow} \coqdocvar{term}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} : \coqdocvar{symbol} \ensuremath{\rightarrow} \coqdocvar{list} \coqdocvar{term} \ensuremath{\rightarrow} \coqdocvar{term}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
Definition and a few properties of the size of a term.\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{size} (\coqdocvar{t}:\coqdocvar{term}) : \coqdocvar{nat} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{v} \ensuremath{\Rightarrow} 1\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{l} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{3.50em}
\coqdockw{let} \coqdocvar{size\_list} :=\coqdoceol
\coqdocindent{4.50em}
(\coqdockw{fix} \coqdocvar{size\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\} : \coqdocvar{nat} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} 0\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{size} \coqdocvar{t} + \coqdocvar{size\_list} \coqdocvar{lt}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}) \coqdoctac{in}\coqdoceol
\coqdocindent{4.00em}
1 + \coqdocvar{size\_list} \coqdocvar{l}\coqdoceol
\coqdocindent{1.50em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{size\_unfold} :\coqdoceol
\coqdocindent{0.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t},\coqdoceol
\coqdocindent{0.50em}
\coqdocvar{size} \coqdocvar{t} = \coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} 1\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow} 1 + \coqdocvar{list\_size} \coqdocvar{size} \coqdocvar{l}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{v}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l}; \coqdoctac{simpl}; \coqdoctac{apply} \coqdoctac{f\_equal}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{l}; \coqdockw{fix} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{l}; \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{size\_unfold}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{size\_ge\_one} : \coqdockw{\ensuremath{\forall}} \coqdocvar{t}, 1 \ensuremath{\le} \coqdocvar{size} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{v}; \coqdoctac{apply} \coqdocvar{le\_n}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l}; \coqdoctac{rewrite} \coqdocvar{size\_unfold}; \coqdoctac{apply} \coqdocvar{le\_n\_S}; \coqdoctac{apply} \coqdocvar{le\_O\_n}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Function} \coqdocvar{var\_in\_term\_list} (\coqdocvar{x} : \coqdocvar{variable}) (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \coqdoceol
\coqdocnoindent
\{ \coqdockw{measure} (\coqdocvar{list\_size} \coqdocvar{size}) \coqdocvar{l} \} : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} (\coqdocvar{Var} \coqdocvar{y}) :: \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{orb} (\coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{y}) (\coqdocvar{var\_in\_term\_list} \coqdocvar{x} \coqdocvar{l}) \coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} (\coqdocvar{Term} \coqdocvar{\_} \coqdocvar{ll}) :: \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{orb} (\coqdocvar{var\_in\_term\_list} \coqdocvar{x} \coqdocvar{ll}) (\coqdocvar{var\_in\_term\_list} \coqdocvar{x} \coqdocvar{l})\coqdoceol
\coqdocnoindent
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{l} \coqdocvar{t} \coqdocvar{l'} \coqdocvar{y} \coqdocvar{H1} \coqdocvar{H2};  \coqdoctac{simpl}; \coqdoctac{auto} \coqdockw{with} \coqdocvar{arith}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{l} \coqdocvar{t} \coqdocvar{l'} \coqdocvar{f} \coqdocvar{ll} \coqdocvar{H1} \coqdocvar{H2}; \coqdoctac{simpl}; \coqdoctac{auto} \coqdockw{with} \coqdocvar{arith}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{l} \coqdocvar{t} \coqdocvar{l'} \coqdocvar{f} \coqdocvar{ll} \coqdocvar{H1} \coqdocvar{H2}; \coqdoctac{simpl}; \coqdoctac{apply} \coqdocvar{lt\_le\_trans} \coqdockw{with} (\coqdocvar{size} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{ll})).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{size\_unfold}; \coqdoctac{simpl}; \coqdoctac{auto} \coqdockw{with} \coqdocvar{arith}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{auto} \coqdockw{with} \coqdocvar{arith}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{var\_in\_term} (\coqdocvar{v} : \coqdocvar{variable}) (\coqdocvar{t} : \coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{4.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{4.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{x} \ensuremath{\Rightarrow}  (\coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{v}) \coqdoceol
\coqdocindent{4.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{var\_in\_term\_list} \coqdocvar{v} \coqdocvar{l}\coqdoceol
\coqdocindent{4.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{var\_list} (\coqdocvar{t} : \coqdocvar{term}) : \coqdocvar{list} \coqdocvar{variable} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{x} \ensuremath{\Rightarrow} (\coqdocvar{x} :: \coqdocvar{nil})\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{l} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{3.50em}
\coqdockw{let} \coqdocvar{var\_list\_list} :=\coqdoceol
\coqdocindent{4.50em}
(\coqdockw{fix} \coqdocvar{var\_list\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\} : \coqdocvar{list} \coqdocvar{variable} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{var\_list} \coqdocvar{t} ++ \coqdocvar{var\_list\_list} \coqdocvar{lt}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}) \coqdoctac{in}\coqdoceol
\coqdocindent{4.00em}
\coqdocvar{var\_list\_list} \coqdocvar{l}\coqdoceol
\coqdocindent{1.50em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Function} \coqdocvar{var\_list\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\} : \coqdocvar{list} \coqdocvar{variable} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{var\_list} \coqdocvar{t} ++ \coqdocvar{var\_list\_list} \coqdocvar{lt}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{var\_list\_list\_app} : \coqdockw{\ensuremath{\forall}} \coqdocvar{l1} \coqdocvar{l2}, \coqdocvar{var\_list\_list} (\coqdocvar{l1} ++ \coqdocvar{l2}) = (\coqdocvar{var\_list\_list} \coqdocvar{l1}) ++ \coqdocvar{var\_list\_list} \coqdocvar{l2}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1; \coqdoctac{intros} \coqdocvar{l1} \coqdocvar{l2}; \coqdoctac{case} \coqdocvar{l1}; \coqdoctac{clear} \coqdocvar{l1}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t1} \coqdocvar{l1}; \coqdoctac{simpl}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{ass\_app}; \coqdoctac{rewrite} \coqdocvar{var\_list\_list\_app}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{in\_var\_list\_list} : \coqdockw{\ensuremath{\forall}} \coqdocvar{l} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list\_list} \coqdocvar{l}) \ensuremath{\rightarrow} \coqdoctac{\ensuremath{\exists}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\land} \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1; \coqdoctac{intro} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_nil}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{l} \coqdocvar{v} \coqdocvar{v\_in\_tl}; \coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_in\_tl}) \coqdockw{as} [\coqdocvar{v\_in\_t} \ensuremath{|} \coqdocvar{v\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{t}; \coqdoctac{split}; [\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal} \ensuremath{|} \coqdoctac{assumption}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_var\_list\_list} \coqdocvar{l} \coqdocvar{v} \coqdocvar{v\_in\_l}) \coqdockw{as} [\coqdocvar{u} [\coqdocvar{u\_in\_l} \coqdocvar{v\_in\_u}]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{u}; \coqdoctac{split}; [\coqdoctac{right} \ensuremath{|} \coqdoctac{idtac}]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{mem\_var\_list\_list} : \coqdockw{\ensuremath{\forall}} \coqdocvar{l} \coqdocvar{v}, \coqdocvar{mem} (@\coqdocvar{eq} \coqdocvar{\_}) \coqdocvar{v} (\coqdocvar{var\_list\_list} \coqdocvar{l}) \ensuremath{\rightarrow} \coqdoctac{\ensuremath{\exists}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\land} \coqdocvar{mem} (@\coqdocvar{eq} \coqdocvar{\_}) \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1; \coqdoctac{intro} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_nil}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{l} \coqdocvar{v} \coqdocvar{v\_in\_tl}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{mem\_or\_app} \coqdoctac{in} \coqdocvar{v\_in\_tl}; \coqdoctac{destruct} \coqdocvar{v\_in\_tl} \coqdockw{as} [\coqdocvar{v\_in\_t} \ensuremath{|} \coqdocvar{v\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{t}; \coqdoctac{split}; [\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal} \ensuremath{|} \coqdoctac{assumption}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{mem\_var\_list\_list} \coqdocvar{l} \coqdocvar{v} \coqdocvar{v\_in\_l}) \coqdockw{as} [\coqdocvar{u} [\coqdocvar{u\_in\_l} \coqdocvar{v\_in\_u}]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{u}; \coqdoctac{split}; [\coqdoctac{right} \ensuremath{|} \coqdoctac{idtac}]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{var\_in\_term\_list\_is\_sound} : \coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{l}, \coqdocvar{var\_in\_term\_list} \coqdocvar{x} \coqdocvar{l} = \coqdocvar{true} \ensuremath{\leftrightarrow} \coqdocvar{In} \coqdocvar{x} (\coqdocvar{var\_list\_list} \coqdocvar{l}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x} \coqdocvar{l}; \coqdocvar{functional} \coqdoctac{induction} (\coqdocvar{var\_in\_term\_list} \coqdocvar{x} \coqdocvar{l}) \coqdockw{as} [ \ensuremath{|} \coqdocvar{x'} \coqdocvar{y} \coqdocvar{l} \coqdocvar{H1} \coqdocvar{IH} \ensuremath{|} \coqdocvar{x'} \coqdocvar{f} \coqdocvar{ll} \coqdocvar{l} \coqdocvar{H1} \coqdocvar{IHll} \coqdocvar{IHl}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intuition}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IH}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{x} \coqdocvar{y}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{y}); \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{x\_eq\_y}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{left}; \coqdoctac{apply} \coqdocvar{sym\_eq}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{x\_diff\_y}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{x\_in\_l}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{y\_eq\_x} \ensuremath{|} \coqdocvar{x\_in\_l}]; [\coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{x\_diff\_y}; \coqdoctac{apply} \coqdocvar{sym\_eq} \ensuremath{|} \coqdoctac{idtac}]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}; \coqdoctac{intro} \coqdocvar{x\_in\_ll\_l}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{Bool.orb\_prop} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{x\_in\_ll\_l}) \coqdockw{as} [\coqdocvar{x\_in\_ll} \ensuremath{|} \coqdocvar{x\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IHll}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IHl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{x\_in\_ll\_l}); [\coqdoctac{intro} \coqdocvar{x\_in\_ll} \ensuremath{|} \coqdoctac{intro} \coqdocvar{x\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IHll} \coqdoctac{in} \coqdocvar{x\_in\_ll}; \coqdoctac{rewrite} \coqdocvar{x\_in\_ll}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IHl} \coqdoctac{in} \coqdocvar{x\_in\_l}; \coqdoctac{rewrite} \coqdocvar{x\_in\_l}; \coqdoctac{case} (\coqdocvar{var\_in\_term\_list} \coqdocvar{x} \coqdocvar{ll}); \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{var\_in\_term\_is\_sound} : \coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{t}, \coqdocvar{var\_in\_term} \coqdocvar{x} \coqdocvar{t} = \coqdocvar{true} \ensuremath{\leftrightarrow} \coqdocvar{In} \coqdocvar{x} (\coqdocvar{var\_list} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x} \coqdocvar{t}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{y}; \coqdoctac{simpl}; \coqdoctac{split}; \coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{y} \coqdocvar{x}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{y} \coqdocvar{x}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{y\_eq\_x} \coqdocvar{\_}; \coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{Abs}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{\_}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{y\_diff\_x} \coqdocvar{y\_in\_x}; \coqdoctac{case} \coqdocvar{y\_in\_x}; \coqdoctac{clear} \coqdocvar{y\_in\_x}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{y\_eq\_x}; \coqdocvar{absurd} (\coqdocvar{y} = \coqdocvar{x}); \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{var\_in\_term\_list\_is\_sound}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{var\_list\_unfold} :\coqdoceol
\coqdocindent{0.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t},\coqdoceol
\coqdocindent{0.50em}
\coqdocvar{var\_list} \coqdocvar{t} = \coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{x} \ensuremath{\Rightarrow} (\coqdocvar{x} :: \coqdocvar{nil})\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{var\_list\_list} \coqdocvar{l}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}; \coqdoctac{intros}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{direct\_subterm} \coqdocvar{t1} \coqdocvar{t2} : \coqdockw{Prop} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t2} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{False}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{In} \coqdocvar{t1} \coqdocvar{l}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{size\_direct\_subterm} :\coqdoceol
\coqdocindent{0.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t1} \coqdocvar{t2}, \coqdocvar{direct\_subterm} \coqdocvar{t1} \coqdocvar{t2} \ensuremath{\rightarrow} \coqdocvar{size} \coqdocvar{t1} < \coqdocvar{size} \coqdocvar{t2}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t1} \coqdocvar{t2}; \coqdoctac{unfold} \coqdocvar{direct\_subterm}; \coqdoctac{case} \coqdocvar{t2}; \coqdoctac{clear} \coqdocvar{t2}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{a} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l}; \coqdoctac{rewrite} (\coqdocvar{size\_unfold} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})).\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{t1} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{f}; \coqdockw{fix} 2.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t1} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{l} \coqdocvar{t1\_in\_tl}; \coqdoctac{case} \coqdocvar{t1\_in\_tl}; \coqdoctac{clear} \coqdocvar{t1\_in\_tl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_eq\_t1}; \coqdoctac{subst} \coqdocvar{t1}; \coqdoctac{apply} \coqdocvar{le\_n\_S}; \coqdoctac{apply} \coqdocvar{le\_plus\_l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_in\_l}; \coqdoctac{apply} \coqdocvar{lt\_le\_trans} \coqdockw{with} (1 + \coqdocvar{list\_size} \coqdocvar{size} \coqdocvar{l}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{size\_direct\_subterm}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{le\_n\_S}; \coqdoctac{apply} \coqdocvar{le\_plus\_r}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{symb\_in\_term} (\coqdocvar{f} : \coqdocvar{symbol}) (\coqdocvar{t}:\coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{g} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{3.50em}
\coqdockw{let} \coqdocvar{symb\_in\_term\_list} :=\coqdoceol
\coqdocindent{4.50em}
(\coqdockw{fix} \coqdocvar{symb\_in\_term\_list} \coqdocvar{f} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\} : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{orb} (\coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t}) (\coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{lt})\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}) \coqdoctac{in}\coqdoceol
\coqdocindent{8.50em}
\coqdocvar{orb} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}) (\coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{l})\coqdoceol
\coqdocindent{1.50em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{symb\_in\_term\_list} \coqdocvar{f} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\} : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{orb} (\coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t}) (\coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{lt})\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{symb\_list} (\coqdocvar{t} : \coqdocvar{term}) : \coqdocvar{list} \coqdocvar{symbol} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{x} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{3.50em}
\coqdockw{let} \coqdocvar{symb\_list\_list} :=\coqdoceol
\coqdocindent{4.50em}
(\coqdockw{fix} \coqdocvar{symb\_list\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\} : \coqdocvar{list} \coqdocvar{symbol} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{symb\_list} \coqdocvar{t} ++ \coqdocvar{symb\_list\_list} \coqdocvar{lt}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}) \coqdoctac{in}\coqdoceol
\coqdocindent{4.00em}
\coqdocvar{f} :: (\coqdocvar{symb\_list\_list} \coqdocvar{l})\coqdoceol
\coqdocindent{1.50em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Function} \coqdocvar{symb\_list\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\} : \coqdocvar{list} \coqdocvar{symbol} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{symb\_list} \coqdocvar{t} ++ \coqdocvar{symb\_list\_list} \coqdocvar{lt}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{symb\_list\_list\_app} : \coqdockw{\ensuremath{\forall}} \coqdocvar{l1} \coqdocvar{l2}, \coqdocvar{symb\_list\_list} (\coqdocvar{l1} ++ \coqdocvar{l2}) = (\coqdocvar{symb\_list\_list} \coqdocvar{l1}) ++ \coqdocvar{symb\_list\_list} \coqdocvar{l2}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1; \coqdoctac{intros} \coqdocvar{l1} \coqdocvar{l2}; \coqdoctac{case} \coqdocvar{l1}; \coqdoctac{clear} \coqdocvar{l1}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t1} \coqdocvar{l1}; \coqdoctac{simpl}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{ass\_app}; \coqdoctac{rewrite} \coqdocvar{symb\_list\_list\_app}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{in\_symb\_list\_list} : \coqdockw{\ensuremath{\forall}} \coqdocvar{l} \coqdocvar{f}, \coqdocvar{In} \coqdocvar{f} (\coqdocvar{symb\_list\_list} \coqdocvar{l}) \ensuremath{\rightarrow} \coqdoctac{\ensuremath{\exists}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\land} \coqdocvar{In} \coqdocvar{f} (\coqdocvar{symb\_list} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1; \coqdoctac{intro} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_nil}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{l} \coqdocvar{v} \coqdocvar{v\_in\_tl}; \coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_in\_tl}) \coqdockw{as} [\coqdocvar{v\_in\_t} \ensuremath{|} \coqdocvar{v\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{t}; \coqdoctac{split}; [\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal} \ensuremath{|} \coqdoctac{assumption}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_symb\_list\_list} \coqdocvar{l} \coqdocvar{v} \coqdocvar{v\_in\_l}) \coqdockw{as} [\coqdocvar{u} [\coqdocvar{u\_in\_l} \coqdocvar{v\_in\_u}]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{u}; \coqdoctac{split}; [\coqdoctac{right} \ensuremath{|} \coqdoctac{idtac}]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{symb\_in\_term\_unfold} :\coqdoceol
\coqdocindent{0.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{t},  \coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t} = \coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{14.50em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{14.50em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{g} \coqdocvar{l} \ensuremath{\Rightarrow}  \coqdocvar{orb} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}) (\coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{l})\coqdoceol
\coqdocindent{13.50em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{g} \coqdocvar{t}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{intros}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{symb\_in\_term\_list\_app} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{l1} \coqdocvar{l2}, \coqdocvar{symb\_in\_term\_list} \coqdocvar{f} (\coqdocvar{l1} ++ \coqdocvar{l2}) = \coqdoceol
\coqdocindent{10.50em}
\coqdocvar{orb} (\coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{l1}) (\coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{l2}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 2.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l1} \coqdocvar{l2}; \coqdoctac{case} \coqdocvar{l1}; \coqdoctac{clear} \coqdocvar{l1}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{l1}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{Bool.orb\_assoc}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{b} \ensuremath{\Rightarrow} \coqdocvar{orb} (\coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t}) \coqdocvar{b})).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{symb\_in\_term\_list\_app}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{symb\_in\_direct\_subterm} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{l} \coqdocvar{t} \coqdocvar{g}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\rightarrow} \coqdocvar{symb\_in\_term} \coqdocvar{g} \coqdocvar{t} = \coqdocvar{true} \ensuremath{\rightarrow} \coqdocvar{symb\_in\_term} \coqdocvar{g} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) = \coqdocvar{true}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{s} \coqdocvar{g} \coqdocvar{s\_in\_l} \coqdocvar{g\_in\_s}; \coqdoctac{rewrite} \coqdocvar{symb\_in\_term\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_symb\_bool} \coqdocvar{g} \coqdocvar{f}).\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdocvar{revert} \coqdocvar{l} \coqdocvar{s\_in\_l}; \coqdockw{fix} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdocvar{In}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{l} \coqdocvar{s\_in\_tl}; \coqdoctac{case} \coqdocvar{s\_in\_tl}; \coqdoctac{clear} \coqdocvar{s\_in\_tl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t\_eq\_s}; \coqdoctac{subst} \coqdocvar{t}; \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{g\_in\_s}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s\_in\_l}; \coqdoctac{simpl}; \coqdoctac{case} (\coqdocvar{symb\_in\_term} \coqdocvar{g} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{symb\_in\_direct\_subterm} \coqdocvar{\_} \coqdocvar{s\_in\_l}); \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{eq\_bool} (\coqdocvar{t1} \coqdocvar{t2} :\coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t1}, \coqdocvar{t2} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{v1}, \coqdocvar{Var} \coqdocvar{v2} \ensuremath{\Rightarrow} \coqdocvar{eq\_var\_bool} \coqdocvar{v1} \coqdocvar{v2}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_}, \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{\_}, \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}  \coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f1} \coqdocvar{l1}, \coqdocvar{Term} \coqdocvar{f2} \coqdocvar{l2} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{3.50em}
\coqdockw{if} \coqdocvar{eq\_symb\_bool} \coqdocvar{f1} \coqdocvar{f2} \coqdoceol
\coqdocindent{3.50em}
\coqdockw{then}\coqdoceol
\coqdocindent{3.50em}
\coqdockw{let} \coqdocvar{eq\_bool\_list} :=\coqdoceol
\coqdocindent{4.50em}
(\coqdockw{fix} \coqdocvar{eq\_bool\_list} (\coqdocvar{l1} \coqdocvar{l2}: \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l1}\} : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l1}, \coqdocvar{l2} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil}, \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil}, (\coqdocvar{\_} :: \coqdocvar{\_}) \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} (\coqdocvar{\_}::\coqdocvar{\_}), \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{t1} :: \coqdocvar{k1}, \coqdocvar{t2} :: \coqdocvar{k2} \ensuremath{\Rightarrow} \coqdockw{if} \coqdocvar{eq\_bool} \coqdocvar{t1} \coqdocvar{t2} \coqdockw{then} \coqdocvar{eq\_bool\_list} \coqdocvar{k1} \coqdocvar{k2} \coqdockw{else} \coqdocvar{false}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}) \coqdoctac{in}\coqdoceol
\coqdocindent{4.00em}
\coqdocvar{eq\_bool\_list} \coqdocvar{l1} \coqdocvar{l2}\coqdoceol
\coqdocindent{4.00em}
\coqdockw{else} \coqdocvar{false}\coqdoceol
\coqdocindent{1.50em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{eq\_bool\_ok} : \coqdockw{\ensuremath{\forall}} \coqdocvar{t1} \coqdocvar{t2}, \coqdockw{match} \coqdocvar{eq\_bool} \coqdocvar{t1} \coqdocvar{t2} \coqdockw{with} \coqdocvar{true} \ensuremath{\Rightarrow} \coqdocvar{t1} = \coqdocvar{t2} \ensuremath{|} \coqdocvar{false} \ensuremath{\Rightarrow} \coqdocvar{t1}\ensuremath{\not=} \coqdocvar{t2} \coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t1}; \coqdoctac{case} \coqdocvar{t1}; [\coqdoctac{intro} \coqdocvar{v1} \ensuremath{|} \coqdoctac{intros} \coqdocvar{f1} \coqdocvar{l1}]; (\coqdoctac{intro} \coqdocvar{t2}; \coqdoctac{case} \coqdocvar{t2}; [\coqdoctac{intro} \coqdocvar{v2} \ensuremath{|} \coqdoctac{intros} \coqdocvar{f2} \coqdocvar{l2}]); \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v1} \coqdocvar{v2}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{v1} \coqdocvar{v2}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v1\_eq\_v2}; \coqdoctac{rewrite} \coqdocvar{v1\_eq\_v2}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v1\_diff\_v2} \coqdocvar{v1\_eq\_v2}; \coqdoctac{apply} \coqdocvar{v1\_diff\_v2}; \coqdoctac{injection} \coqdocvar{v1\_eq\_v2}; \coqdoctac{intro}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{F.Symb.eq\_bool\_ok} \coqdocvar{f1} \coqdocvar{f2}); \coqdoctac{case} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f1} \coqdocvar{f2}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f1\_eq\_f2}; \coqdoctac{rewrite} \coqdocvar{f1\_eq\_f2}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{eq\_bool\_list\_ok} : \coqdockw{match} (\coqdockw{fix} \coqdocvar{eq\_bool\_list} (\coqdocvar{l0} \coqdocvar{l3} : \coqdocvar{list} \coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{3.00em}
\coqdockw{match} \coqdocvar{l0} \coqdockw{with}\coqdoceol
\coqdocindent{3.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdockw{match} \coqdocvar{l3} \coqdockw{with}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{\_} :: \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{7.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{3.00em}
\ensuremath{|} \coqdocvar{t3} :: \coqdocvar{k1} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{match} \coqdocvar{l3} \coqdockw{with}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{t4} :: \coqdocvar{k2} \ensuremath{\Rightarrow} \coqdockw{if} \coqdocvar{eq\_bool} \coqdocvar{t3} \coqdocvar{t4} \coqdockw{then} \coqdocvar{eq\_bool\_list} \coqdocvar{k1} \coqdocvar{k2} \coqdockw{else} \coqdocvar{false}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{3.00em}
\coqdockw{end}) \coqdocvar{l1} \coqdocvar{l2} \coqdockw{with} \coqdocvar{true} \ensuremath{\Rightarrow} \coqdocvar{l1} = \coqdocvar{l2} \ensuremath{|} \coqdocvar{false} \ensuremath{\Rightarrow} \coqdocvar{l1} \ensuremath{\not=} \coqdocvar{l2} \coqdockw{end}).\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{l1} \coqdocvar{l2}; \coqdoctac{clear} - \coqdocvar{eq\_bool\_ok0}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} \coqdocvar{eq\_bool\_list\_ok} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l1}; \coqdoctac{case} \coqdocvar{l1}; [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{intros} \coqdocvar{t1} \coqdocvar{k1}]; (\coqdoctac{intro} \coqdocvar{l2}; \coqdoctac{case} \coqdocvar{l2}; [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{intros} \coqdocvar{t2} \coqdocvar{k2}]).\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok0} \coqdocvar{t1} \coqdocvar{t2}); \coqdoctac{case} (\coqdocvar{eq\_bool} \coqdocvar{t1} \coqdocvar{t2}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t1\_eq\_t2}; \coqdoctac{rewrite} \coqdocvar{t1\_eq\_t2}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_list\_ok} \coqdocvar{k1} \coqdocvar{k2}); \coqdoceol
\coqdocnoindent
\coqdoctac{case} ((\coqdockw{fix} \coqdocvar{eq\_bool\_list} (\coqdocvar{l0} \coqdocvar{l3} : \coqdocvar{list} \coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{3.00em}
\coqdockw{match} \coqdocvar{l0} \coqdockw{with}\coqdoceol
\coqdocindent{3.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdockw{match} \coqdocvar{l3} \coqdockw{with}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{\_} :: \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{7.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{3.00em}
\ensuremath{|} \coqdocvar{t3} :: \coqdocvar{k3} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{match} \coqdocvar{l3} \coqdockw{with}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{t4} :: \coqdocvar{k4} \ensuremath{\Rightarrow} \coqdockw{if} \coqdocvar{eq\_bool} \coqdocvar{t3} \coqdocvar{t4} \coqdockw{then} \coqdocvar{eq\_bool\_list} \coqdocvar{k3} \coqdocvar{k4} \coqdockw{else} \coqdocvar{false}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{3.00em}
\coqdockw{end}) \coqdocvar{k1} \coqdocvar{k2}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{k1\_eq\_k2}; \coqdoctac{rewrite} \coqdocvar{k1\_eq\_k2}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{k1\_diff\_k2} \coqdocvar{tk1\_eq\_tk2}; \coqdoctac{apply} \coqdocvar{k1\_diff\_k2}; \coqdoctac{injection} \coqdocvar{tk1\_eq\_tk2}; \coqdoctac{intro}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t1\_diff\_t2} \coqdocvar{tk1\_eq\_tk2}; \coqdoctac{apply} \coqdocvar{t1\_diff\_t2}; \coqdoctac{injection} \coqdocvar{tk1\_eq\_tk2}; \coqdoctac{intros}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{eq\_bool\_list\_ok};\coqdoceol
\coqdocnoindent
\coqdoctac{case} ((\coqdockw{fix} \coqdocvar{eq\_bool\_list} (\coqdocvar{l0} \coqdocvar{l3} : \coqdocvar{list} \coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{12.00em}
\coqdockw{match} \coqdocvar{l0} \coqdockw{with}\coqdoceol
\coqdocindent{12.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{14.00em}
\coqdockw{match} \coqdocvar{l3} \coqdockw{with}\coqdoceol
\coqdocindent{14.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{14.00em}
\ensuremath{|} \coqdocvar{\_} :: \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{14.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{12.00em}
\ensuremath{|} \coqdocvar{t3} :: \coqdocvar{k1} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{14.00em}
\coqdockw{match} \coqdocvar{l3} \coqdockw{with}\coqdoceol
\coqdocindent{14.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{14.00em}
\ensuremath{|} \coqdocvar{t4} :: \coqdocvar{k2} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{16.00em}
\coqdockw{if} \coqdocvar{eq\_bool} \coqdocvar{t3} \coqdocvar{t4}\coqdoceol
\coqdocindent{16.00em}
\coqdockw{then} \coqdocvar{eq\_bool\_list} \coqdocvar{k1} \coqdocvar{k2}\coqdoceol
\coqdocindent{16.00em}
\coqdockw{else} \coqdocvar{false}\coqdoceol
\coqdocindent{14.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{12.00em}
\coqdockw{end}) \coqdocvar{l1} \coqdocvar{l2}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l1\_eq\_l2}; \coqdoctac{rewrite} \coqdocvar{l1\_eq\_l2}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{l1\_diff\_l2} \coqdocvar{fl1\_eq\_fl2}; \coqdoctac{apply} \coqdocvar{l1\_diff\_l2}; \coqdoctac{injection} \coqdocvar{fl1\_eq\_fl2}; \coqdoctac{intros}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f1\_diff\_f2} \coqdocvar{fl1\_eq\_fl2}; \coqdoctac{apply} \coqdocvar{f1\_diff\_f2}; \coqdoctac{injection} \coqdocvar{fl1\_eq\_fl2}; \coqdoctac{intros}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{eq\_term\_dec} : \coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{t'}:\coqdocvar{term}, \{\coqdocvar{t}=\coqdocvar{t'}\}+\{\coqdocvar{t}\ensuremath{\not=}\coqdocvar{t'}\}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{t'}; \coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{t} \coqdocvar{t'}).\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_bool} \coqdocvar{t} \coqdocvar{t'}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_eq\_t'}; \coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_diff\_t'}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{term\_term\_dec} : \coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y}:\coqdocvar{term}\ensuremath{\times}\coqdocvar{term}, \{\coqdocvar{x}=\coqdocvar{y}\}+\{\~{}\coqdocvar{x}=\coqdocvar{y}\}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{a} \coqdocvar{b}] [\coqdocvar{a'} \coqdocvar{b'}].\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_term\_dec} \coqdocvar{a} \coqdocvar{a'}).\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_term\_dec} \coqdocvar{b} \coqdocvar{b'}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{Heq1} \coqdocvar{Heq2};\coqdoctac{left};\coqdoctac{f\_equal};\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{abs} \coqdocvar{\_};\coqdoctac{right};\coqdoctac{intro} \coqdocvar{Heq};\coqdoctac{elim} \coqdocvar{abs};\coqdoctac{injection} \coqdocvar{Heq};\coqdoctac{intros};\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{abs};\coqdoctac{right};\coqdoctac{intro} \coqdocvar{Heq};\coqdoctac{elim} \coqdocvar{abs};\coqdoctac{injection} \coqdocvar{Heq};\coqdoctac{intros};\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{rel\_dec} : \coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} (\coqdocvar{P} : \coqdocvar{relation} \coqdocvar{term}) \coqdocvar{Plist}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{u} \coqdocvar{v}, \coqdocvar{P} \coqdocvar{v} \coqdocvar{u} \ensuremath{\leftrightarrow} \coqdocvar{In} (\coqdocvar{u},\coqdocvar{v}) \coqdocvar{Plist}) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{r} \coqdocvar{l}, \{\coqdocvar{P} \coqdocvar{r} \coqdocvar{l}\}+\{\~{}\coqdocvar{P} \coqdocvar{r} \coqdocvar{l}\}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{P} \coqdocvar{Plist} \coqdocvar{Plist\_ok} \coqdocvar{r} \coqdocvar{l}; \coqdocvar{revert} \coqdocvar{P} \coqdocvar{Plist\_ok}.\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{Plist} \coqdockw{as} [ \ensuremath{|} [\coqdocvar{u} \coqdocvar{v}] \coqdocvar{Plist}]; \coqdoctac{intros} \coqdocvar{P} \coqdocvar{Plist\_ok}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{Plist\_ok} \coqdoctac{in} \coqdocvar{H}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{r} \coqdocvar{v}); \coqdoctac{destruct} (\coqdocvar{eq\_bool} \coqdocvar{r} \coqdocvar{v}).\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{l} \coqdocvar{u}); \coqdoctac{destruct} (\coqdocvar{eq\_bool} \coqdocvar{l} \coqdocvar{u}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{l} \coqdocvar{r}; \coqdoctac{left}; \coqdoctac{rewrite} \coqdocvar{Plist\_ok}; \coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{l\_diff\_u} \coqdocvar{\_}; \coqdoctac{destruct} (\coqdocvar{IHPlist} (\coqdockw{fun} \coqdocvar{v'} \coqdocvar{u'} \ensuremath{\Rightarrow} \coqdocvar{P} \coqdocvar{v'} \coqdocvar{u'} \ensuremath{\land} \coqdocvar{In} (\coqdocvar{u'},\coqdocvar{v'}) \coqdocvar{Plist})) \coqdockw{as} [[\coqdocvar{Ok} \coqdocvar{\_}] \ensuremath{|} \coqdocvar{Ko}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{t}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{\_} \coqdocvar{H}]; \coqdoctac{exact} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H}; \coqdoctac{split}; [\coqdoctac{rewrite} \coqdocvar{Plist\_ok}; \coqdoctac{right} \ensuremath{|} ]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{Plist\_ok} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{destruct} \coqdocvar{H} \coqdockw{as} [\coqdocvar{H} \ensuremath{|} \coqdocvar{H}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{l\_diff\_u}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{sym\_eq}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Ko}; \coqdoctac{split}; [\coqdoctac{rewrite} \coqdocvar{Plist\_ok}; \coqdoctac{right} \ensuremath{|} ]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{r\_diff\_v}; \coqdoctac{destruct} (\coqdocvar{IHPlist} (\coqdockw{fun} \coqdocvar{v'} \coqdocvar{u'} \ensuremath{\Rightarrow} \coqdocvar{P} \coqdocvar{v'} \coqdocvar{u'} \ensuremath{\land} \coqdocvar{In} (\coqdocvar{u'},\coqdocvar{v'}) \coqdocvar{Plist})) \coqdockw{as} [[\coqdocvar{Ok} \coqdocvar{\_}] \ensuremath{|} \coqdocvar{Ko}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{t}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{\_} \coqdocvar{H}]; \coqdoctac{exact} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H}; \coqdoctac{split}; [\coqdoctac{rewrite} \coqdocvar{Plist\_ok}; \coqdoctac{right} \ensuremath{|} ]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{Plist\_ok} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{destruct} \coqdocvar{H} \coqdockw{as} [\coqdocvar{H} \ensuremath{|} \coqdocvar{H}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{r\_diff\_v}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{sym\_eq}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Ko}; \coqdoctac{split}; [\coqdoctac{rewrite} \coqdocvar{Plist\_ok}; \coqdoctac{right} \ensuremath{|} ]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Module} \coqdocvar{Term\_eq\_dec} : \coqdocvar{decidable\_set.S} \coqdockw{with} \coqdockw{Definition} \coqdocvar{A}:= \coqdocvar{term} \coqdoceol
\coqdocindent{30.50em}
\coqdockw{with} \coqdockw{Definition} \coqdocvar{eq\_bool} := \coqdocvar{eq\_bool}\coqdoceol
\coqdocindent{30.50em}
\coqdockw{with} \coqdockw{Definition} \coqdocvar{eq\_bool\_ok} := \coqdocvar{eq\_bool\_ok}.\coqdoceol
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{A} := \coqdocvar{term}.\coqdoceol
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{eq\_bool} := \coqdocvar{eq\_bool}.\coqdoceol
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{eq\_bool\_ok} := \coqdocvar{eq\_bool\_ok}.\coqdoceol
\coqdocnoindent
\coqdockw{End} \coqdocvar{Term\_eq\_dec}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsection{Recursion on terms.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Section} \coqdocvar{Recursion}.\coqdoceol
\coqdocnoindent
\coqdockw{Variable} \coqdocvar{P} : \coqdocvar{term} \ensuremath{\rightarrow} \coqdockw{Type}.\coqdoceol
\coqdocnoindent
\coqdockw{Variable} \coqdocvar{Pl} : \coqdocvar{list} \coqdocvar{term} \ensuremath{\rightarrow} \coqdockw{Type}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{term\_rec2} : (\coqdockw{\ensuremath{\forall}} \coqdocvar{n} \coqdocvar{t}, \coqdocvar{size} \coqdocvar{t} \ensuremath{\le} \coqdocvar{n} \ensuremath{\rightarrow} \coqdocvar{P} \coqdocvar{t}) \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{P} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H} \coqdocvar{t}; \coqdoctac{apply} (\coqdocvar{H} (\coqdocvar{size} \coqdocvar{t}) \coqdocvar{t}); \coqdoctac{apply} \coqdocvar{le\_n}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{term\_rec3} :\coqdoceol
\coqdocindent{1.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{P} (\coqdocvar{Var} \coqdocvar{v})) \ensuremath{\rightarrow} (\coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{l}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\rightarrow} \coqdocvar{P} \coqdocvar{t}) \ensuremath{\rightarrow} \coqdocvar{P} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})) \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{P} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{Hv} \coqdocvar{Halg}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t};\coqdoctac{case} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{Hv}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{a}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l}. \coqdoctac{apply} \coqdocvar{Halg}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} \coqdocvar{term\_list\_rec\_3} 1  .\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l};\coqdoctac{case} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl};\coqdoctac{intros} \coqdocvar{t0} \coqdocvar{abs};\coqdoctac{elim} \coqdocvar{abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t0} \coqdocvar{l0} \coqdocvar{t1} .\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_term\_dec} \coqdocvar{t0} \coqdocvar{t1}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t\_eq\_t1}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{t\_eq\_t1}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{term\_rec3}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_eq\_t1}. \coqdoctac{assert} (\coqdocvar{In} \coqdocvar{t1} \coqdocvar{l0}).\coqdoceol
\coqdocnoindent
\coqdoctac{case} \coqdocvar{H}. \coqdoctac{intro} \coqdocvar{abs};\coqdoctac{elim} \coqdocvar{t\_eq\_t1};\coqdoctac{exact} \coqdocvar{abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{h};\coqdoctac{exact} \coqdocvar{h}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{term\_list\_rec\_3} \coqdockw{with} \coqdocvar{l0}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{H0}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{term\_rec4} :\coqdoceol
\coqdocindent{1.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{P} (\coqdocvar{Var} \coqdocvar{v})) \ensuremath{\rightarrow} (\coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{l}, \coqdocvar{Pl} \coqdocvar{l} \ensuremath{\rightarrow} \coqdocvar{P} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{1.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{l}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\rightarrow} \coqdocvar{P} \coqdocvar{t}) \ensuremath{\rightarrow} \coqdocvar{Pl} \coqdocvar{l}) \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{P} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{Hvar} \coqdocvar{Hterm} \coqdocvar{Hlist}; \coqdoctac{apply} \coqdocvar{term\_rec2}; \coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{n}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{Size\_t}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (1<=0); \coqdoctac{auto} \coqdockw{with} \coqdocvar{arith};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{le\_trans} \coqdockw{with} (\coqdocvar{size} \coqdocvar{t}); \coqdoctac{trivial}; \coqdoctac{apply} \coqdocvar{size\_ge\_one}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l} ]; \coqdoctac{trivial};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Hterm}; \coqdoctac{apply} \coqdocvar{Hlist}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{In\_t}; \coqdoctac{apply} \coqdocvar{IHn};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{lt\_n\_Sm\_le};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{lt\_le\_trans} \coqdockw{with} (\coqdocvar{size} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})); \coqdoctac{trivial};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{size\_direct\_subterm}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocnoindent
\coqdockw{End} \coqdocvar{Recursion}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsection{Double recursion on terms.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Section} \coqdocvar{DoubleRecursion}.\coqdoceol
\coqdocnoindent
\coqdockw{Variable} \coqdocvar{P2} : \coqdocvar{term} \ensuremath{\rightarrow} \coqdocvar{term} \ensuremath{\rightarrow} \coqdockw{Type}.\coqdoceol
\coqdocnoindent
\coqdockw{Variable} \coqdocvar{Pl2} : \coqdocvar{list} \coqdocvar{term} \ensuremath{\rightarrow} \coqdocvar{list} \coqdocvar{term} \ensuremath{\rightarrow} \coqdockw{Type}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{term\_rec7} :\coqdoceol
\coqdocindent{1.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{v1} \coqdocvar{t2}, \coqdocvar{P2} (\coqdocvar{Var} \coqdocvar{v1}) \coqdocvar{t2}) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{t1} \coqdocvar{v2}, \coqdocvar{P2} \coqdocvar{t1} (\coqdocvar{Var} \coqdocvar{v2})) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{f1} \coqdocvar{f2} \coqdocvar{l1} \coqdocvar{l2}, \coqdocvar{Pl2} \coqdocvar{l1} \coqdocvar{l2} \ensuremath{\rightarrow} \coqdocvar{P2} (\coqdocvar{Term} \coqdocvar{f1} \coqdocvar{l1}) (\coqdocvar{Term} \coqdocvar{f2} \coqdocvar{l2})) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{l1} \coqdocvar{l2}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{t1} \coqdocvar{t2}, \coqdocvar{In} \coqdocvar{t1} \coqdocvar{l1} \ensuremath{\rightarrow} \coqdocvar{In} \coqdocvar{t2} \coqdocvar{l2} \ensuremath{\rightarrow} \coqdocvar{P2} \coqdocvar{t1} \coqdocvar{t2}) \ensuremath{\rightarrow} \coqdocvar{Pl2} \coqdocvar{l1} \coqdocvar{l2}) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t1} \coqdocvar{t2}, \coqdocvar{P2} \coqdocvar{t1} \coqdocvar{t2}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{Hvt} \coqdocvar{Htv} \coqdocvar{Hterm} \coqdocvar{Hlist}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t1}; \coqdoctac{pattern} \coqdocvar{t1}; \coqdoctac{apply} \coqdocvar{term\_rec2}; \coqdoctac{induction} \coqdocvar{n}; \coqdoctac{clear} \coqdocvar{t1};\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t1} \coqdocvar{Size\_t1}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (1<=0); \coqdoctac{auto} \coqdockw{with} \coqdocvar{arith};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{le\_trans} \coqdockw{with} (\coqdocvar{size} \coqdocvar{t1}); \coqdoctac{trivial}; \coqdoctac{apply} \coqdocvar{size\_ge\_one}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t1} \coqdockw{as} [ \coqdocvar{x1} \ensuremath{|} \coqdocvar{f1} \coqdocvar{l1} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t2} \coqdockw{as} [ \coqdocvar{x2} \ensuremath{|} \coqdocvar{f2} \coqdocvar{l2} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Hterm}; \coqdoctac{apply} \coqdocvar{Hlist}; \coqdoctac{intros} \coqdocvar{t1} \coqdocvar{t2} \coqdocvar{In\_t1} \coqdocvar{In\_t2}; \coqdoctac{apply} \coqdocvar{IHn};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{lt\_n\_Sm\_le};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{lt\_le\_trans} \coqdockw{with} (\coqdocvar{size} (\coqdocvar{Term} \coqdocvar{f1} \coqdocvar{l1})); \coqdoctac{trivial};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{size\_direct\_subterm}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{term\_rec8} :\coqdoceol
\coqdocindent{1.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{v1} \coqdocvar{t2}, \coqdocvar{P2} (\coqdocvar{Var} \coqdocvar{v1}) \coqdocvar{t2}) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{t1} \coqdocvar{v2}, \coqdocvar{P2} \coqdocvar{t1} (\coqdocvar{Var} \coqdocvar{v2})) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{f1} \coqdocvar{f2} \coqdocvar{l1} \coqdocvar{l2}, \coqdocvar{Pl2} \coqdocvar{l1} \coqdocvar{l2} \ensuremath{\rightarrow} \coqdocvar{P2} (\coqdocvar{Term} \coqdocvar{f1} \coqdocvar{l1}) (\coqdocvar{Term} \coqdocvar{f2} \coqdocvar{l2})) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{l1} \coqdocvar{l2}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{t1} \coqdocvar{t2}, \coqdocvar{In} \coqdocvar{t1} \coqdocvar{l1} \ensuremath{\rightarrow} \coqdocvar{In} \coqdocvar{t2} \coqdocvar{l2} \ensuremath{\rightarrow} \coqdocvar{P2} \coqdocvar{t1} \coqdocvar{t2}) \ensuremath{\rightarrow} \coqdocvar{Pl2} \coqdocvar{l1} \coqdocvar{l2}) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{7.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{l1} \coqdocvar{l2}, \coqdocvar{Pl2} \coqdocvar{l1} \coqdocvar{l2}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{Hvt} \coqdocvar{Htv} \coqdocvar{Hterm} \coqdocvar{Hlist} \coqdocvar{l1} \coqdocvar{l2};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Hlist};\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{term\_rec7}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocnoindent
\coqdockw{End} \coqdocvar{DoubleRecursion}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsection{Well-formedness of terms, according to the arity.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{well\_formed\_bool} (\coqdocvar{t}:\coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{2.50em}
\coqdockw{let} \coqdocvar{well\_formed\_list} :=\coqdoceol
\coqdocindent{3.50em}
(\coqdockw{fix} \coqdocvar{well\_formed\_list} (\coqdocvar{l}:\coqdocvar{list} \coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{3.50em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{3.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{3.50em}
\ensuremath{|} \coqdocvar{h} :: \coqdocvar{tl} \ensuremath{\Rightarrow} \coqdocvar{andb} (\coqdocvar{well\_formed\_bool} \coqdocvar{h})  (\coqdocvar{well\_formed\_list} \coqdocvar{tl})\coqdoceol
\coqdocindent{3.50em}
\coqdockw{end}) \coqdoctac{in}\coqdoceol
\coqdocindent{3.50em}
\coqdocvar{andb} (\coqdocvar{well\_formed\_list} \coqdocvar{l})\coqdoceol
\coqdocindent{2.50em}
(\coqdockw{match} \coqdocvar{arity} \coqdocvar{f} \coqdockw{with}\coqdoceol
\coqdocindent{2.50em}
\ensuremath{|} \coqdocvar{Free} \coqdocvar{n} \ensuremath{\Rightarrow} \coqdocvar{beq\_nat} (\coqdocvar{length} \coqdocvar{l}) \coqdocvar{n} \coqdoceol
\coqdocindent{2.50em}
\ensuremath{|} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{beq\_nat} (\coqdocvar{length} \coqdocvar{l}) 2\coqdoceol
\coqdocindent{2.50em}
\coqdockw{end})\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{well\_formed} \coqdocvar{t} := \coqdocvar{well\_formed\_bool} \coqdocvar{t} = \coqdocvar{true}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{well\_formed\_unfold} :\coqdoceol
\coqdocindent{0.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{well\_formed} \coqdocvar{t} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{0.50em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with} \coqdoceol
\coqdocindent{0.50em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{True}\coqdoceol
\coqdocindent{0.50em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{2.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{u}, \coqdocvar{In} \coqdocvar{u} \coqdocvar{l} \ensuremath{\rightarrow} \coqdocvar{well\_formed} \coqdocvar{u}) \ensuremath{\land}\coqdoceol
\coqdocindent{2.00em}
(\coqdockw{match} \coqdocvar{arity} \coqdocvar{f} \coqdockw{with}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{Free} \coqdocvar{n} \ensuremath{\Rightarrow} \coqdocvar{length} \coqdocvar{l} = \coqdocvar{n}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{length} \coqdocvar{l} = 2\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end})\coqdoceol
\coqdocindent{0.50em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{well\_formed}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t}; \coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{Wl} \coqdocvar{Ar}]; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{Ar}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{u} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff} \coqdoctac{in} \coqdocvar{Wl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{Wl} \coqdockw{as} [\coqdocvar{Wa} \coqdocvar{Wl}]; \coqdoctac{intros} \coqdocvar{u} [\coqdocvar{Eq\_u\_a} \ensuremath{|} \coqdocvar{In\_u}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{u}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{Ar}; \coqdoctac{case} (\coqdocvar{arity} \coqdocvar{f}); \coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{beq\_nat\_eq}; \coqdoctac{symmetry}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{well\_formed\_fold} :\coqdoceol
\coqdocindent{0.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t},\coqdoceol
\coqdocindent{0.50em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with} \coqdoceol
\coqdocindent{0.50em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{True}\coqdoceol
\coqdocindent{0.50em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{2.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{u}, \coqdocvar{In} \coqdocvar{u} \coqdocvar{l} \ensuremath{\rightarrow} \coqdocvar{well\_formed} \coqdocvar{u}) \ensuremath{\land}\coqdoceol
\coqdocindent{2.00em}
(\coqdockw{match} \coqdocvar{arity} \coqdocvar{f} \coqdockw{with}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{Free} \coqdocvar{n} \ensuremath{\Rightarrow} \coqdocvar{length} \coqdocvar{l} = \coqdocvar{n}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{length} \coqdocvar{l} = 2\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end})\coqdoceol
\coqdocindent{0.50em}
\coqdockw{end} \ensuremath{\rightarrow} \coqdocvar{well\_formed} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{well\_formed}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t}; \coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l} ]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{Wl} \coqdocvar{Ar}]; \coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{Ar}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{Ar}; \coqdoctac{case} (\coqdocvar{arity} \coqdocvar{f}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Ar}; \coqdoctac{rewrite} \coqdocvar{Ar}; \coqdoctac{symmetry}; \coqdoctac{apply} \coqdocvar{beq\_nat\_refl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Ar}; \coqdoctac{rewrite} \coqdocvar{Ar}; \coqdoctac{symmetry}; \coqdoctac{apply} \coqdocvar{beq\_nat\_refl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{n} \coqdocvar{Ar}; \coqdoctac{rewrite} \coqdocvar{Ar}; \coqdoctac{symmetry}; \coqdoctac{apply} \coqdocvar{beq\_nat\_refl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsection{Substitutions.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{substitution} := \coqdocvar{list} (\coqdocvar{variable} \ensuremath{\times} \coqdocvar{term}).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{apply\_subst} (\coqdocvar{sigma} : \coqdocvar{substitution}) (\coqdocvar{t} : \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{t}\} : \coqdocvar{term} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{v} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{2.00em}
\coqdockw{match} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} \coqdockw{with}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{t}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{v\_sigma} \ensuremath{\Rightarrow} \coqdocvar{v\_sigma}\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{f} (\coqdocvar{map} (\coqdocvar{apply\_subst} \coqdocvar{sigma}) \coqdocvar{l})\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{empty\_subst\_is\_id} : \coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{apply\_subst} \coqdocvar{nil} \coqdocvar{t} = \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IH}; \coqdoctac{simpl}; \coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}));\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{trivial}; \coqdoctac{simpl}; \coqdoctac{rewrite} (\coqdocvar{IH} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IH}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{empty\_subst\_is\_id\_list} : \coqdockw{\ensuremath{\forall}} \coqdocvar{l}, \coqdocvar{map} (\coqdocvar{apply\_subst} \coqdocvar{nil}) \coqdocvar{l} = \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{simpl}; \coqdoceol
\coqdocnoindent
[\coqdoctac{idtac} \ensuremath{|} \coqdoctac{rewrite} \coqdocvar{empty\_subst\_is\_id}; \coqdoctac{rewrite} \coqdocvar{IHl}];\coqdoceol
\coqdocnoindent
\coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
Composition of substitutions. \begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{map\_subst} (\coqdocvar{f} : \coqdocvar{variable} \ensuremath{\rightarrow} \coqdocvar{term} \ensuremath{\rightarrow} \coqdocvar{term}) \coqdocvar{sigma} :=\coqdoceol
\coqdocindent{1.00em}
\coqdocvar{map} (\coqdockw{fun} \coqdocvar{x} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} (\coqdocvar{x} : \coqdocvar{variable} \ensuremath{\times} \coqdocvar{term}) \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} (\coqdocvar{v}, \coqdocvar{v\_sigma}) \ensuremath{\Rightarrow} (\coqdocvar{v}, \coqdocvar{f} \coqdocvar{v} \coqdocvar{v\_sigma})\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end})\coqdoceol
\coqdocindent{6.00em}
\coqdocvar{sigma}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{subst\_comp} \coqdocvar{sigma1} \coqdocvar{sigma2} :=\coqdoceol
\coqdocindent{1.00em}
(\coqdocvar{map\_subst} (\coqdockw{fun} \coqdocvar{\_} \coqdocvar{t} \ensuremath{\Rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma1} \coqdocvar{t}) \coqdocvar{sigma2})\coqdoceol
\coqdocindent{1.00em}
++ \coqdoceol
\coqdocindent{1.00em}
(\coqdocvar{map\_subst} (\coqdockw{fun} \coqdocvar{v} \coqdocvar{t} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{12.00em}
\coqdockw{match} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma2} \coqdockw{with}\coqdoceol
\coqdocindent{12.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{t}\coqdoceol
\coqdocindent{12.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{v\_sigma2} \ensuremath{\Rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma1} \coqdocvar{v\_sigma2}\coqdoceol
\coqdocindent{12.00em}
\coqdockw{end})\coqdoceol
\coqdocindent{11.00em}
\coqdocvar{sigma1}).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_comp\_is\_subst\_comp\_aux1} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{sigma} \coqdocvar{f},\coqdoceol
\coqdocindent{1.00em}
\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} (\coqdocvar{map\_subst} \coqdocvar{f} \coqdocvar{sigma}) =\coqdoceol
\coqdocindent{1.50em}
\coqdockw{match} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} \coqdockw{with}\coqdoceol
\coqdocindent{1.50em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{1.50em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{t} \ensuremath{\Rightarrow} \coqdocvar{Some} (\coqdocvar{f} \coqdocvar{v} \coqdocvar{t})\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{sigma} \coqdocvar{f}; \coqdoctac{induction} \coqdocvar{sigma} \coqdockw{as} [ \ensuremath{|} [\coqdocvar{v1} \coqdocvar{a1}] \coqdocvar{sigma}]; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{v1}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{v1}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{v\_eq\_v1}; \coqdoctac{subst} \coqdocvar{v1}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{IHsigma}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_comp\_is\_subst\_comp\_aux2} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{sigma1} \coqdocvar{sigma2},\coqdoceol
\coqdocindent{1.00em}
\coqdocvar{find} (\coqdocvar{B}:= \coqdocvar{term}) \coqdocvar{eq\_var\_bool} \coqdocvar{v} (\coqdocvar{sigma1} ++ \coqdocvar{sigma2})  =\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma1} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma1}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma2}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 2.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{sigma1} \coqdocvar{sigma2}; \coqdoctac{case} \coqdocvar{sigma1}; \coqdoctac{clear} \coqdocvar{sigma1}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}; \coqdoctac{intros} \coqdocvar{v1} \coqdocvar{a1}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{v1}).\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{subst\_comp\_is\_subst\_comp\_aux2}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Theorem} \coqdocvar{subst\_comp\_is\_subst\_comp} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{sigma1} \coqdocvar{sigma2} \coqdocvar{t},\coqdoceol
\coqdocindent{1.50em}
\coqdocvar{apply\_subst} (\coqdocvar{subst\_comp} \coqdocvar{sigma1} \coqdocvar{sigma2}) \coqdocvar{t} =\coqdoceol
\coqdocindent{1.50em}
\coqdocvar{apply\_subst} \coqdocvar{sigma1} (\coqdocvar{apply\_subst} \coqdocvar{sigma2} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{sigma1} \coqdocvar{sigma2} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{v}; \coqdoctac{unfold} \coqdocvar{subst\_comp};\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{subst\_comp\_is\_subst\_comp\_aux2};\coqdoceol
\coqdocnoindent
\coqdoctac{do} 2 \coqdoctac{rewrite} \coqdocvar{subst\_comp\_is\_subst\_comp\_aux1};\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma2}); \coqdoctac{trivial}; \coqdoctac{simpl};\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma1}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IH}; \coqdoctac{simpl}; \coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}));\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{a} \coqdocvar{l}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} (\coqdocvar{IH} \coqdocvar{a}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IH}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{instantiated\_subterm} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{u} \coqdocvar{u'} \coqdocvar{sigma}, \coqdocvar{trans\_clos} \coqdocvar{direct\_subterm} \coqdocvar{u} \coqdocvar{u'} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{3.00em}
\coqdocvar{trans\_clos} \coqdocvar{direct\_subterm} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{u}) (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{u'}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{u} \coqdocvar{u'} \coqdocvar{sigma}; \coqdoctac{apply} \coqdocvar{trans\_incl2}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} [ \ensuremath{|} \coqdocvar{f} \coqdocvar{l}] \coqdocvar{s\_in\_l}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{in\_map\_iff}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{s}; \coqdoctac{split}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
Well-formed substitutions. \begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{well\_formed\_subst} \coqdocvar{sigma} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdockw{match} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{True}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{t} \ensuremath{\Rightarrow} \coqdocvar{well\_formed} \coqdocvar{t} \coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Theorem} \coqdocvar{well\_formed\_apply\_subst} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{sigma}, \coqdocvar{well\_formed\_subst} \coqdocvar{sigma} \ensuremath{\rightarrow} \coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{well\_formed} \coqdocvar{t} \ensuremath{\rightarrow} \coqdocvar{well\_formed} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{well\_formed}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{sigma} \coqdocvar{W\_sigma} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{term\_rec3}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{\_}; \coqdoctac{simpl}; \coqdoctac{generalize} (\coqdocvar{W\_sigma} \coqdocvar{v}); \coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{Hrec}; \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff}; \coqdoctac{intros} [\coqdocvar{Wl} \coqdocvar{Ar}].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{Ar}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{a} \coqdocvar{l}]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff} \coqdoctac{in} \coqdocvar{Wl}; \coqdoctac{destruct} \coqdocvar{Wl} \coqdockw{as} [\coqdocvar{Wa} \coqdocvar{Wl'}].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{Bool.andb\_true\_iff}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Hrec}; \coqdoctac{trivial}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}; \coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{Hrec}; \coqdoctac{trivial}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{length\_map}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{well\_formed\_apply\_subst\_strong} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{sigma} \coqdocvar{t}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{x}, \coqdocvar{var\_in\_term} \coqdocvar{x} \coqdocvar{t} = \coqdocvar{true} \ensuremath{\rightarrow} \coqdocvar{well\_formed} (\coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{Var} \coqdocvar{x}))) \ensuremath{\rightarrow} \coqdoceol
\coqdocindent{1.00em}
\coqdocvar{well\_formed} \coqdocvar{t} \ensuremath{\rightarrow} \coqdocvar{well\_formed} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{sigma} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{W\_sigma} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{W\_sigma}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{eq\_var\_bool\_refl}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{W\_sigma} \coqdocvar{Wfl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{well\_formed\_unfold} \coqdocvar{Wfl}) \coqdockw{as} [\coqdocvar{Wl} \coqdocvar{Af}]; \coqdoctac{clear} \coqdocvar{Wfl}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{well\_formed\_fold}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{u} \coqdocvar{u\_in\_mapl}; \coqdoctac{rewrite} \coqdocvar{in\_map\_iff} \coqdoctac{in} \coqdocvar{u\_in\_mapl}; \coqdoctac{destruct} \coqdocvar{u\_in\_mapl} \coqdockw{as} [\coqdocvar{t} [\coqdocvar{H} \coqdocvar{t\_in\_l}]].\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{u}; \coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_t}; \coqdoctac{apply} \coqdocvar{W\_sigma}; \coqdoctac{rewrite} \coqdocvar{var\_in\_term\_is\_sound}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_split\_set} \coqdocvar{\_} \coqdocvar{eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{t\_in\_l}) \coqdockw{as} [\coqdocvar{l'} [\coqdocvar{l'{}'} \coqdocvar{H}]]; \coqdoctac{subst} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{var\_list\_unfold}; \coqdoctac{rewrite} \coqdocvar{var\_list\_list\_app}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{var\_in\_term\_is\_sound}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{map\_length}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{well\_formed\_remove\_subst} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{sigma} \coqdocvar{t}, \coqdocvar{well\_formed} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}) \ensuremath{\rightarrow} \coqdocvar{well\_formed} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{sigma} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{Hrec} \coqdocvar{Wfl}; \coqdoctac{destruct} (\coqdocvar{well\_formed\_unfold} \coqdocvar{Wfl}) \coqdockw{as} [\coqdocvar{Wl} \coqdocvar{Af}]; \coqdoctac{clear} \coqdocvar{Wfl}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{length\_map} \coqdoctac{in} \coqdocvar{Af}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{well\_formed\_fold}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{u} \coqdocvar{u\_in\_l}; \coqdoctac{apply} (\coqdocvar{Hrec} \coqdocvar{u} \coqdocvar{u\_in\_l}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{rewrite} \coqdocvar{in\_map\_iff}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{u}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{well\_formed\_remove\_term} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{sigma} \coqdocvar{t}, \coqdocvar{well\_formed} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{x}, \coqdocvar{var\_in\_term} \coqdocvar{x} \coqdocvar{t} = \coqdocvar{true} \ensuremath{\rightarrow} \coqdocvar{well\_formed} (\coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{Var} \coqdocvar{x})).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{sigma} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{W} \coqdocvar{x}; \coqdoctac{simpl}; \coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{x}); \coqdoctac{case} (\coqdocvar{X.eq\_bool} \coqdocvar{v} \coqdocvar{x}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_eq\_x} \coqdocvar{\_}; \coqdoctac{subst} \coqdocvar{v}; \coqdoctac{exact} \coqdocvar{W}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{Hrec} \coqdocvar{Wfl}; \coqdoctac{simpl} \coqdocvar{apply\_subst} \coqdoctac{in} \coqdocvar{Wfl}; \coqdoctac{destruct} (\coqdocvar{well\_formed\_unfold} \coqdocvar{Wfl}) \coqdockw{as} [\coqdocvar{Wl} \coqdocvar{\_}]; \coqdoctac{clear} \coqdocvar{Wfl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v}; \coqdoctac{rewrite} \coqdocvar{var\_in\_term\_is\_sound}; \coqdoctac{rewrite} \coqdocvar{var\_list\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_in\_tl}; \coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_in\_tl}) \coqdockw{as} [\coqdocvar{v\_in\_t} \ensuremath{|} \coqdocvar{v\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{Hrec} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{rewrite} \coqdocvar{in\_map\_iff}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{t}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{var\_in\_term\_is\_sound}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{tail\_prop} \coqdocvar{\_} \coqdocvar{Hrec}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{tail\_prop} \coqdocvar{\_} \coqdocvar{Wl}).\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsection{Positions in a term.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{is\_a\_pos} (\coqdocvar{t} : \coqdocvar{term}) (\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat}) \{\coqdockw{struct} \coqdocvar{p}\}: \coqdocvar{bool} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{p} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{i} :: \coqdocvar{q} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{2.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{4.50em}
\coqdockw{match} \coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i} \coqdockw{with}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{ti} \ensuremath{\Rightarrow} \coqdocvar{is\_a\_pos} \coqdocvar{ti} \coqdocvar{q}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{2.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Function} \coqdocvar{subterm\_at\_pos} (\coqdocvar{t} : \coqdocvar{term}) (\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat}) \{\coqdockw{struct} \coqdocvar{p}\}: \coqdocvar{option} \coqdocvar{term} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{p} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{Some} \coqdocvar{t}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{i} :: \coqdocvar{q} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{2.00em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{2.00em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{\_} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{4.50em}
\coqdockw{match} \coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i} \coqdockw{with}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{ti} \ensuremath{\Rightarrow} \coqdocvar{subterm\_at\_pos} \coqdocvar{ti} \coqdocvar{q}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{is\_subterm} (\coqdocvar{s} \coqdocvar{t} : \coqdocvar{term}) : \coqdocvar{bool}  :=\coqdoceol
\coqdocindent{0.50em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with} \coqdoceol
\coqdocindent{0.50em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{x} \ensuremath{\Rightarrow} \coqdockw{match} \coqdocvar{s} \coqdockw{with} \coqdocvar{Var} \coqdocvar{y} \ensuremath{\Rightarrow} \coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{y} \ensuremath{|} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false} \coqdockw{end}\coqdoceol
\coqdocindent{0.50em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{3.00em}
\coqdockw{let} \coqdockw{fix} \coqdocvar{is\_subterm\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{4.50em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{4.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{4.50em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{orb} (\coqdocvar{is\_subterm} \coqdocvar{s} \coqdocvar{t}) (\coqdocvar{is\_subterm\_list} \coqdocvar{l})\coqdoceol
\coqdocindent{4.50em}
\coqdockw{end} \coqdoctac{in}\coqdoceol
\coqdocindent{4.50em}
\coqdocvar{orb} (\coqdocvar{eq\_bool} \coqdocvar{t} \coqdocvar{s}) (\coqdocvar{is\_subterm\_list} \coqdocvar{l})\coqdoceol
\coqdocindent{0.50em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{is\_subterm\_ok\_true} : \coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{s} \coqdocvar{t}, \coqdocvar{is\_subterm} \coqdocvar{s} \coqdocvar{t} = \coqdocvar{true} \ensuremath{\rightarrow} \{\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat} \ensuremath{|} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}\}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{s} \coqdockw{as} [\coqdocvar{y} \ensuremath{|} ]; \coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{x} \coqdocvar{H}; [ \ensuremath{|} \coqdoctac{discriminate}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{nil}; \coqdoctac{simpl}; \coqdoctac{do} 2 \coqdoctac{apply} \coqdoctac{f\_equal}; \coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{x} \coqdocvar{y}); \coqdoctac{rewrite} \coqdocvar{H}; \coqdoctac{exact} (\coqdockw{fun} \coqdocvar{H} \ensuremath{\Rightarrow} \coqdocvar{H}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{s} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{g} \coqdocvar{k}]; \coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{is\_subterm} (\coqdocvar{Var} \coqdocvar{x}) \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Sub}; \coqdoctac{destruct} (\coqdocvar{IHl} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdocvar{Sub}) \coqdockw{as} [\coqdocvar{p} \coqdocvar{Sub'}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (0 :: \coqdocvar{p}); \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{nSub}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{nSub} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{destruct} \coqdocvar{IHl0} \coqdockw{as} [\coqdocvar{p} \coqdocvar{Sub}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl}; [\coqdoctac{right} \ensuremath{|} ]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{S} \coqdocvar{i} :: \coqdocvar{p}); \coqdoctac{simpl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{eq\_bool} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k})).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{s\_eq\_t}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{nil}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k})); \coqdoctac{rewrite} \coqdocvar{s\_eq\_t}; \coqdoctac{intro} \coqdocvar{s\_eq\_t'}; \coqdoctac{simpl}; \coqdoctac{apply} \coqdoctac{f\_equal}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{s\_diff\_t}; \coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k})); \coqdoctac{rewrite} \coqdocvar{s\_diff\_t}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{s\_diff\_t}; \coqdoctac{rewrite} \coqdocvar{s\_diff\_t} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{s\_diff\_t}; \coqdoctac{intros} \coqdocvar{\_}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} : \{\coqdocvar{i} : \coqdocvar{nat} \& \{\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat} \ensuremath{|} \coqdocvar{subterm\_at\_pos} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) (\coqdocvar{i} :: \coqdocvar{p}) = \coqdocvar{Some} (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k})\}\}).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{is\_subterm} (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k}) \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Sub}; \coqdoctac{destruct} (\coqdocvar{IHl} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdocvar{Sub}) \coqdockw{as} [\coqdocvar{p} \coqdocvar{Sub'}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} 0; \coqdoctac{\ensuremath{\exists}} \coqdocvar{p}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{nSub}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{nSub} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{IHl0} \coqdockw{as} [\coqdocvar{i} [\coqdocvar{p} \coqdocvar{Sub}]].\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl}; [\coqdoctac{right} \ensuremath{|} ]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{S} \coqdocvar{i}); \coqdoctac{\ensuremath{\exists}} \coqdocvar{p}; \coqdoctac{simpl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{H'} \coqdockw{as} [\coqdocvar{i} [\coqdocvar{p} \coqdocvar{Sub}]]; \coqdoctac{\ensuremath{\exists}} (\coqdocvar{i} :: \coqdocvar{p}); \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{is\_subterm\_ok\_false} : \coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{s} \coqdocvar{t}, \coqdocvar{is\_subterm} \coqdocvar{s} \coqdocvar{t} = \coqdocvar{false} \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{p}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} \ensuremath{\not=} \coqdocvar{Some} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{s} \coqdockw{as} [\coqdocvar{y} \ensuremath{|} ]; \coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{x} \coqdocvar{H} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Sub}; \coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{x} \coqdocvar{y}); \coqdoctac{rewrite} \coqdocvar{H}; \coqdoctac{intro} \coqdocvar{x\_diff\_y}; \coqdoctac{apply} \coqdocvar{x\_diff\_y}; \coqdoctac{injection} \coqdocvar{Sub}; \coqdoctac{exact} (\coqdockw{fun} \coqdocvar{H} \ensuremath{\Rightarrow} \coqdocvar{H}).\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{s} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{g} \coqdocvar{k}]; \coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}] \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}, \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{i} \coqdocvar{Sub}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} \coqdocvar{i}] \coqdocvar{Sub} ; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{i} \coqdocvar{Sub}; \coqdocvar{case\_eq} (\coqdocvar{is\_subterm} (\coqdocvar{Var} \coqdocvar{x}) \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Sub'}; \coqdoctac{rewrite} \coqdocvar{Sub'} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{nSub}; \coqdoctac{rewrite} \coqdocvar{nSub} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i}]; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{IHl} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdocvar{nSub} \coqdocvar{p} \coqdocvar{Sub}).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl0} \coqdockw{with} \coqdocvar{i}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl}; [\coqdoctac{right} \ensuremath{|} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intro} \coqdocvar{t\_eq\_s'}; \coqdoctac{assert} (\coqdocvar{t\_eq\_s} : \coqdocvar{Term} \coqdocvar{g} \coqdocvar{k} = \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}).\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{t\_eq\_s'}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{t\_eq\_s'}; \coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k})); \coqdocvar{case\_eq} (\coqdocvar{eq\_bool} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k}));\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H1} \coqdocvar{H2}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H1}; \coqdoctac{rewrite} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H2}; \coqdoctac{rewrite} \coqdocvar{t\_eq\_s}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdockw{if} \coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}\coqdoceol
\coqdocindent{3.00em}
\coqdockw{then}\coqdoceol
\coqdocindent{3.50em}
(\coqdockw{fix} \coqdocvar{eq\_bool\_list} (\coqdocvar{l1} \coqdocvar{l2} : \coqdocvar{list} \coqdocvar{term}) : \coqdocvar{bool} :=\coqdoceol
\coqdocindent{5.00em}
\coqdockw{match} \coqdocvar{l1} \coqdockw{with}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdockw{match} \coqdocvar{l2} \coqdockw{with}\coqdoceol
\coqdocindent{9.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{true}\coqdoceol
\coqdocindent{9.50em}
\ensuremath{|} \coqdocvar{\_} :: \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{9.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{5.00em}
\ensuremath{|} \coqdocvar{t1} :: \coqdocvar{k1} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{7.00em}
\coqdockw{match} \coqdocvar{l2} \coqdockw{with}\coqdoceol
\coqdocindent{7.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{false}\coqdoceol
\coqdocindent{7.00em}
\ensuremath{|} \coqdocvar{t2} :: \coqdocvar{k2} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{9.00em}
\coqdockw{if} \coqdocvar{eq\_bool} \coqdocvar{t1} \coqdocvar{t2} \coqdockw{then} \coqdocvar{eq\_bool\_list} \coqdocvar{k1} \coqdocvar{k2} \coqdockw{else} \coqdocvar{false}\coqdoceol
\coqdocindent{7.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{5.00em}
\coqdockw{end}) \coqdocvar{l} \coqdocvar{k}\coqdoceol
\coqdocindent{3.00em}
\coqdockw{else} \coqdocvar{false}).\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{i}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} \coqdocvar{i}]; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} \coqdocvar{i}]; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{is\_subterm} (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k}) \coqdocvar{t}); [\coqdoctac{discriminate} \ensuremath{|} \coqdoctac{apply} \coqdocvar{refl\_equal}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl0}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl}; [\coqdoctac{right} \ensuremath{|} ]; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{is\_subterm} (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{k}) \coqdocvar{t}); [\coqdoctac{discriminate} \ensuremath{|} \coqdoctac{assumption}].\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_at\_pos\_dec} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{s}, \{\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat} \ensuremath{|} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}\}+\{\coqdockw{\ensuremath{\forall}} \coqdocvar{p}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} \ensuremath{\not=} \coqdocvar{Some} \coqdocvar{s}\}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x} \coqdocvar{s}; \coqdoctac{case} \coqdocvar{s}; \coqdoctac{clear} \coqdocvar{s}; [\coqdoctac{intro} \coqdocvar{x'}\ensuremath{|} \coqdoctac{intros} \coqdocvar{f'} \coqdocvar{l'}].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{x} \coqdocvar{x'}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{x'}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{x\_eq\_x'}; \coqdoctac{left}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{nil}; \coqdoctac{rewrite} \coqdocvar{x\_eq\_x'}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{x\_diff\_x'}; \coqdoctac{right}; \coqdoctac{intros} \coqdocvar{p}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{H}; \coqdoctac{apply} \coqdocvar{x\_diff\_x'}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{exact} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{n} \coqdocvar{p} \coqdocvar{H}; \coqdoctac{discriminate}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{intros} \coqdocvar{p}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{H}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{n} \coqdocvar{p} \coqdocvar{H}; \coqdoctac{discriminate}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{s}; \coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) \coqdocvar{s}); \coqdoctac{case} (\coqdocvar{eq\_bool} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_eq\_s}; \coqdoctac{left}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{nil}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{t\_eq\_s}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t\_diff\_s};\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{IH} : \coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{s},  \{\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat} \ensuremath{|} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}\} +\coqdoceol
\coqdocindent{11.50em}
\{(\coqdockw{\ensuremath{\forall}} \coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} \ensuremath{\not=} \coqdocvar{Some} \coqdocvar{s})\}).\coqdoceol
\coqdocnoindent
\coqdoctac{clear} - \coqdocvar{subterm\_at\_pos\_dec}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{l}; \coqdockw{fix} \coqdocvar{subterm\_at\_pos\_dec\_list} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t1} \coqdocvar{l} \coqdocvar{t} \coqdocvar{t\_in\_t1l}; \coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{t} \coqdocvar{t1}); \coqdoctac{case} (\coqdocvar{eq\_bool} \coqdocvar{t} \coqdocvar{t1}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t\_eq\_t1} \coqdocvar{s}; \coqdoctac{rewrite} \coqdocvar{t\_eq\_t1}; \coqdoctac{apply} \coqdocvar{subterm\_at\_pos\_dec}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t\_diff\_t1} \coqdocvar{s}; \coqdoctac{apply} (\coqdocvar{subterm\_at\_pos\_dec\_list} \coqdocvar{l} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{t\_in\_t1l}; \coqdoctac{case} \coqdocvar{t\_in\_t1l}; \coqdoctac{clear} \coqdocvar{t\_in\_t1l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t1\_eq\_t}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{t\_diff\_t1}; \coqdoctac{rewrite} \coqdocvar{t1\_eq\_t}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_in\_l}; \coqdoctac{exact} \coqdocvar{t\_in\_l}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{IH'} : \coqdockw{\ensuremath{\forall}} \coqdocvar{s}, \{\coqdocvar{n} :\coqdocvar{nat} \& \{\coqdocvar{t} : \coqdocvar{term} \& \{\coqdocvar{p} \ensuremath{|} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{n}) = \coqdocvar{Some} \coqdocvar{t} \ensuremath{\land} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}\}\}\} + \coqdoceol
\coqdocindent{12.00em}
\{(\coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{p}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} \ensuremath{\not=} \coqdocvar{Some} \coqdocvar{s})\}).\coqdoceol
\coqdocnoindent
\coqdoctac{clear} -\coqdocvar{IH}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{l} \coqdocvar{IH}; \coqdockw{fix} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{l}; \coqdoctac{case} \coqdocvar{l}; \coqdoctac{clear} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{s}; \coqdoctac{right}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{l} \coqdocvar{IH} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{IH} \coqdocvar{t} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{s\_in\_t}; \coqdoctac{case} \coqdocvar{s\_in\_t}; \coqdoctac{intros} \coqdocvar{p} \coqdocvar{Sub}; \coqdoctac{left}; \coqdoctac{\ensuremath{\exists}} 0; \coqdoctac{\ensuremath{\exists}} \coqdocvar{t}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{p}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{s\_not\_in\_t}; \coqdoctac{case} (\coqdocvar{subterm\_at\_pos\_dec} \coqdocvar{l} (\coqdocvar{tail\_set} \coqdocvar{\_} \coqdocvar{IH}) \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{s\_in\_l}; \coqdoctac{case} \coqdocvar{s\_in\_l}; \coqdoctac{intros} \coqdocvar{n} \coqdocvar{H}; \coqdoctac{case} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{tn} \coqdocvar{H}; \coqdoctac{case} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{p} \coqdocvar{H}; \coqdoctac{case} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{E} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{\ensuremath{\exists}} (\coqdocvar{S} \coqdocvar{n}); \coqdoctac{\ensuremath{\exists}} \coqdocvar{tn}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{p}; \coqdoctac{split}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{s\_not\_in\_l}; \coqdoctac{right}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t'} \coqdocvar{t'\_in\_tl}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{t'\_in\_tl}; \coqdoctac{case} \coqdocvar{t'\_in\_tl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t\_eq\_t'}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{t\_eq\_t'}; \coqdoctac{exact} \coqdocvar{s\_not\_in\_t}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} (\coqdocvar{s\_not\_in\_l} \coqdocvar{t'}).\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{IH'} \coqdocvar{s}); \coqdoctac{intro} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{n} \coqdocvar{H}; \coqdoctac{case} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{H}; \coqdoctac{case} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{p} \coqdocvar{H}; \coqdoctac{case} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{E} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{\ensuremath{\exists}} (\coqdocvar{n} :: \coqdocvar{p}); \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{E}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{intro} \coqdocvar{p}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intro} \coqdocvar{t\_eq\_s}; \coqdoctac{apply} \coqdocvar{t\_diff\_s}; \coqdoctac{injection} \coqdocvar{t\_eq\_s}; \coqdoctac{intro} \coqdocvar{t\_eq\_s'}; \coqdoctac{exact} \coqdocvar{t\_eq\_s'}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{n} \coqdocvar{p}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{nth\_error\_ok\_in} \coqdocvar{n} \coqdocvar{l}); \coqdoctac{case} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{n}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{tn} \coqdocvar{H'}; \coqdoctac{case} (\coqdocvar{H'} \coqdocvar{tn} (\coqdocvar{refl\_equal} \coqdocvar{\_})); \coqdoctac{clear} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{l1} \coqdocvar{H'}; \coqdoctac{case} \coqdocvar{H'}; \coqdoctac{clear} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{l2} \coqdocvar{H'}; \coqdoctac{case} \coqdocvar{H'}; \coqdoctac{clear} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{L} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H} \coqdocvar{tn}); \coqdoctac{rewrite} \coqdocvar{H'}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{subterm\_at\_pos\_dec\_alt} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{s}, \{\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat} \ensuremath{|} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}\}+ \{\~{}\coqdoctac{\ensuremath{\exists}} \coqdocvar{p}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}\}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{s}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{case} (\coqdocvar{subterm\_at\_pos\_dec} \coqdocvar{t} \coqdocvar{s}).\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intro} \coqdocvar{H};\coqdoctac{left};\coqdoctac{exact} \coqdocvar{H}.\coqdoceol
\coqdocemptyline
\coqdocindent{1.00em}
\coqdoctac{intro} \coqdocvar{not\_Sub}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{right};\coqdoctac{intro} \coqdocvar{abs}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{case} \coqdocvar{abs}. \coqdoctac{intros} \coqdocvar{p} \coqdocvar{H}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{apply} (\coqdocvar{not\_Sub} \coqdocvar{\_} \coqdocvar{H}).\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_subterm} : \coqdoceol
\coqdocindent{4.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow} (\coqdocvar{t}=\coqdocvar{s}) \ensuremath{\lor} (\coqdocvar{trans\_clos} \coqdocvar{direct\_subterm} \coqdocvar{s} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{p}; \coqdoctac{generalize} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{s} \coqdocvar{Sub}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{Sub}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [\coqdocvar{v} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{assert} (\coqdocvar{H} := \coqdocvar{nth\_error\_ok\_in} \coqdocvar{i} \coqdocvar{l}); \coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}) \coqdockw{as} [\coqdocvar{ti} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{L} \coqdocvar{H'}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IHp} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{Sub}) \coqdockw{as} [\coqdocvar{ti\_eq\_s} \ensuremath{|} \coqdocvar{Subi}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{t\_step}; \coqdoctac{simpl}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{trans\_clos\_is\_trans} \coqdockw{with} \coqdocvar{ti}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{t\_step}; \coqdoctac{simpl}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{size\_subterm\_at\_pos} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{i} \coqdocvar{p}, \coqdockw{match} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} (\coqdocvar{i} :: \coqdocvar{p}) \coqdockw{with}\coqdoceol
\coqdocindent{9.50em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{u} \ensuremath{\Rightarrow} \coqdocvar{size} \coqdocvar{u} < \coqdocvar{size} \coqdocvar{t}\coqdoceol
\coqdocindent{9.50em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{True}\coqdoceol
\coqdocindent{9.50em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{i} \coqdocvar{p}; \coqdoctac{generalize} \coqdocvar{t} \coqdocvar{i}; \coqdoctac{clear} \coqdocvar{t} \coqdocvar{i}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{j} \coqdocvar{p}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \coqdocvar{v} \ensuremath{|} \coqdocvar{f} \coqdocvar{l} ] \coqdocvar{j}; \coqdoctac{simpl} \coqdocvar{subterm\_at\_pos}; \coqdoctac{cbv} \coqdockw{iota} \coqdockw{beta}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{nth\_error\_ok\_in} \coqdocvar{j} \coqdocvar{l}); \coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{j}) \coqdockw{as} [\coqdocvar{tj} \ensuremath{|} ]; [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{trivial}].\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{H}; \coqdoctac{apply} \coqdocvar{size\_direct\_subterm}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H} \coqdocvar{tj} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{\_} \coqdocvar{H'}]]]; \coqdoctac{subst} \coqdocvar{l}; \coqdoctac{simpl};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \coqdocvar{v} \ensuremath{|} \coqdocvar{f} \coqdocvar{l} ] \coqdocvar{i}; \coqdoctac{simpl} \coqdocvar{subterm\_at\_pos}; \coqdoctac{cbv} \coqdockw{iota} \coqdockw{beta}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{nth\_error\_ok\_in} \coqdocvar{i} \coqdocvar{l}); \coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}) \coqdockw{as} [\coqdocvar{ti} \ensuremath{|} ]; [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{trivial}].\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{ti\_in\_l}; \coqdoctac{generalize} (\coqdocvar{IHp} \coqdocvar{ti} \coqdocvar{j}); \coqdoctac{simpl} \coqdocvar{subterm\_at\_pos}; \coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{ti} \coqdockw{as} [\coqdocvar{vi} \ensuremath{|} \coqdocvar{fi} \coqdocvar{li}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{nth\_error\_ok\_in} \coqdocvar{j} \coqdocvar{li}); \coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{li} \coqdocvar{j}) \coqdockw{as} [\coqdocvar{tij} \ensuremath{|} ]; [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{trivial}].\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{tij\_in\_li}; \coqdoctac{destruct} (\coqdocvar{subterm\_at\_pos} \coqdocvar{tij} \coqdocvar{p}) \coqdockw{as} [ \coqdocvar{u} \ensuremath{|} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{H}; \coqdoctac{apply} \coqdocvar{lt\_trans} \coqdockw{with} (\coqdocvar{size} (\coqdocvar{Term} \coqdocvar{fi} \coqdocvar{li})); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{size\_direct\_subterm}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{ti\_in\_l} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{\_} \coqdocvar{H'}]]]; \coqdoctac{subst} \coqdocvar{l}; \coqdoctac{simpl};\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{size\_strict\_subterm} : \coqdockw{\ensuremath{\forall}} \coqdocvar{s} \coqdocvar{t}, \coqdocvar{trans\_clos} \coqdocvar{direct\_subterm} \coqdocvar{s} \coqdocvar{t} \ensuremath{\rightarrow} \coqdocvar{size} \coqdocvar{s} < \coqdocvar{size} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{t} \coqdocvar{Sub}; \coqdoctac{induction} \coqdocvar{Sub} \coqdockw{as} [ \coqdocvar{s} \coqdocvar{t} \coqdocvar{H} \ensuremath{|} \coqdocvar{s} \coqdocvar{u} \coqdocvar{t} \coqdocvar{H1} \coqdocvar{H2}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{size\_direct\_subterm}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{lt\_trans} \coqdockw{with} (\coqdocvar{size} \coqdocvar{u}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{size\_direct\_subterm}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_subterm\_non\_nil} : \coqdoceol
\coqdocindent{4.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow} \coqdocvar{p} \ensuremath{\not=} \coqdocvar{nil} \ensuremath{\rightarrow} (\coqdocvar{trans\_clos} \coqdocvar{direct\_subterm} \coqdocvar{s} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{p} \coqdocvar{s} \coqdocvar{H} \coqdocvar{H0}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{generalize} (\coqdocvar{subterm\_subterm} \coqdocvar{t} \coqdocvar{p} \coqdocvar{H}).\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} 1;[|\coqdoctac{assumption}].\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{subst}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{destruct} \coqdocvar{p}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{elim} \coqdocvar{H0};\coqdoctac{reflexivity}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{generalize} (\coqdocvar{size\_subterm\_at\_pos} \coqdocvar{s} \coqdocvar{n} \coqdocvar{p}).\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{rewrite} \coqdocvar{H}.\coqdoceol
\coqdocindent{1.00em}
\coqdoctac{intros} \coqdocvar{h};\coqdoctac{apply} \coqdocvar{False\_ind};\coqdoctac{apply} (\coqdocvar{lt\_irrefl} \coqdocvar{\_} \coqdocvar{h}).\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{var\_in\_subterm} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{s} \coqdocvar{t} \coqdocvar{p}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow} \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{s})  \ensuremath{\rightarrow} \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{s} \coqdocvar{t} \coqdocvar{p}; \coqdoctac{generalize} \coqdocvar{s} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{s} \coqdocvar{t}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{intros} \coqdocvar{s} \coqdocvar{t} \coqdocvar{H} \coqdocvar{v\_in\_s}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [ \ensuremath{|} \coqdocvar{g} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{nth\_error\_ok\_in} \coqdocvar{i} \coqdocvar{l}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}) \coqdockw{as} [\coqdocvar{ti} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H'} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{L} \coqdocvar{H'{}'}]]]; \coqdoctac{subst} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{var\_list\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{H'} \coqdocvar{L}; \coqdoctac{induction} \coqdocvar{l1} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t1} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{apply} (\coqdocvar{IHp} \coqdocvar{s} \coqdocvar{ti}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{apply} \coqdocvar{IHl}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{var\_in\_subterm2} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{t}, \coqdocvar{mem} (@\coqdocvar{eq} \coqdocvar{\_}) \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t}) \ensuremath{\rightarrow} \{\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat} \ensuremath{|} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} (\coqdocvar{Var} \coqdocvar{v})\}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x} \coqdocvar{v\_in\_x}; \coqdoctac{\ensuremath{\exists}} (@\coqdocvar{nil} \coqdocvar{nat}); \coqdoctac{simpl}; \coqdoctac{destruct} \coqdocvar{v\_in\_x} \coqdockw{as} [\coqdocvar{v\_eq\_x} \ensuremath{|} \coqdocvar{v\_in\_nil}]; [\coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{refl\_equal} \ensuremath{|} \coqdocvar{contradiction}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l}; \coqdoctac{rewrite} \coqdocvar{var\_list\_unfold}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{intros} \coqdocvar{IH} \coqdocvar{v\_in\_l}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{v\_in\_l}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{mem\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t})); \coqdoctac{case} (\coqdocvar{mem\_bool} \coqdocvar{X.eq\_bool} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t})); [\coqdoctac{intro} \coqdocvar{v\_in\_t} \ensuremath{|} \coqdoctac{intro} \coqdocvar{v\_not\_in\_t}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IH} \coqdocvar{t} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdocvar{v\_in\_t}) \coqdockw{as} [\coqdocvar{p} \coqdocvar{Sub}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (0 :: \coqdocvar{p}); \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{v\_in\_l'} : \coqdocvar{mem} (@\coqdocvar{eq} \coqdocvar{\_}) \coqdocvar{v} (\coqdocvar{var\_list\_list} \coqdocvar{l})).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{mem\_or\_app} \coqdoctac{in} \coqdocvar{v\_in\_l}; \coqdoctac{destruct} \coqdocvar{v\_in\_l} \coqdockw{as} [\coqdocvar{v\_in\_t} \ensuremath{|} \coqdocvar{v\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (\coqdocvar{mem} (@\coqdocvar{eq} \coqdocvar{\_}) \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t})); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IHl} (\coqdocvar{tail\_set} \coqdocvar{\_} \coqdocvar{IH}) \coqdocvar{v\_in\_l'}) \coqdockw{as} [\coqdocvar{p} \coqdocvar{Sub}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{S}(\coqdocvar{i}) :: \coqdocvar{p}); \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{symb\_in\_subterm} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{s} \coqdocvar{t} \coqdocvar{p}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow} \coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{s} = \coqdocvar{true} \ensuremath{\rightarrow} \coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t} = \coqdocvar{true}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 4.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{s} \coqdocvar{t} \coqdocvar{p}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{H}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{H}; \coqdoctac{intro} \coqdocvar{H'}; \coqdoctac{exact} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{n} \coqdocvar{p}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{Abs}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{g} \coqdocvar{l}; \coqdoctac{generalize} (\coqdocvar{nth\_error\_ok\_in} \coqdocvar{n} \coqdocvar{l}); \coqdoctac{case} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{n}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{tn} \coqdocvar{H}; \coqdoctac{case} (\coqdocvar{H} \coqdocvar{tn} (\coqdocvar{refl\_equal} \coqdocvar{\_})).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{l1} \coqdocvar{H'}; \coqdoctac{case} \coqdocvar{H'}; \coqdoctac{clear} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{l2} \coqdocvar{H'}; \coqdoctac{case} \coqdocvar{H'}; \coqdoctac{clear} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{L} \coqdocvar{H'} \coqdocvar{Sub} \coqdocvar{f\_in\_s}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{symb\_in\_term\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}).\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{H'}; \coqdoctac{rewrite} \coqdocvar{symb\_in\_term\_list\_app}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{l1}).\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{symb\_in\_subterm} \coqdocvar{f} \coqdocvar{s} \coqdocvar{tn} \coqdocvar{p} \coqdocvar{Sub} \coqdocvar{f\_in\_s}); \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{Abs}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{symb\_list\_ok} : \coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{f} (\coqdocvar{symb\_list} \coqdocvar{t}) \ensuremath{\leftrightarrow} \coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t} = \coqdocvar{true}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v}; \coqdoctac{simpl}; \coqdoctac{split}; \coqdoctac{intro} \coqdocvar{H}; [\coqdocvar{contradiction} \coqdocvar{H} \ensuremath{|} \coqdoctac{discriminate} \coqdocvar{H}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{g} \coqdocvar{l} \coqdocvar{IH}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{F.Symb.eq\_bool\_ok} \coqdocvar{f} \coqdocvar{g}); \coqdoctac{destruct} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}); [\coqdoctac{intro} \coqdocvar{f\_eq\_g} \ensuremath{|} \coqdoctac{intro} \coqdocvar{f\_diff\_g}]; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}; [\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{refl\_equal} \ensuremath{|} \coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{left}; \coqdoctac{apply} \coqdocvar{sym\_eq}; \coqdoctac{assumption}].\coqdoceol
\coqdocnoindent
\coqdoctac{split}; [\coqdoctac{intros} [\coqdocvar{H} \ensuremath{|} \coqdocvar{H}] \ensuremath{|} \coqdoctac{intro} \coqdocvar{H}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{f\_diff\_g}; \coqdoctac{apply} \coqdocvar{sym\_eq}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H}) \coqdockw{as} [\coqdocvar{f\_in\_t} \ensuremath{|} \coqdocvar{f\_in\_l}].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))) \coqdoctac{in} \coqdocvar{f\_in\_t}; \coqdoctac{rewrite} \coqdocvar{f\_in\_t}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{IHl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t}); \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IH}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}.\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t}); [\coqdoctac{intro} \coqdocvar{f\_in\_t} \ensuremath{|} \coqdoctac{intro} \coqdocvar{f\_not\_in\_t}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{rewrite} \coqdocvar{IH}; [\coqdoctac{assumption} \ensuremath{|} \coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{apply} \coqdocvar{IHl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IH}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{f\_not\_in\_t} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{symb\_list\_list\_ok} : \coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{l}, \coqdocvar{In} \coqdocvar{f} (\coqdocvar{symb\_list\_list} \coqdocvar{l}) \ensuremath{\leftrightarrow} \coqdocvar{symb\_in\_term\_list} \coqdocvar{f} \coqdocvar{l} = \coqdocvar{true}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{split}; \coqdoctac{intro} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H}) \coqdockw{as} [\coqdocvar{Ht} \ensuremath{|} \coqdocvar{Hl}].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{symb\_list\_ok} \coqdoctac{in} \coqdocvar{Ht}; \coqdoctac{rewrite} \coqdocvar{Ht}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{IHl} \coqdoctac{in} \coqdocvar{Hl}; \coqdoctac{rewrite} \coqdocvar{Hl}; \coqdoctac{case} (\coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t}); \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{symb\_in\_term} \coqdocvar{f} \coqdocvar{t}); [\coqdoctac{intro} \coqdocvar{f\_in\_t} \ensuremath{|} \coqdoctac{intro} \coqdocvar{f\_not\_in\_t}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{rewrite} \coqdocvar{symb\_list\_ok}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{rewrite} \coqdocvar{IHl}; \coqdoctac{rewrite} \coqdocvar{f\_not\_in\_t} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{is\_a\_pos\_exists\_subterm} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{p}, \coqdocvar{is\_a\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{true} \ensuremath{\leftrightarrow} \coqdoctac{\ensuremath{\exists}} \coqdocvar{u}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{u}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{p}; \coqdocvar{revert} \coqdocvar{t}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{q} ].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{t}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t}; \coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l} ]; \coqdoctac{simpl}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{u} \coqdocvar{Abs}]; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}) \coqdockw{as} [ \coqdocvar{ti} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{intro}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IHq}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{u} \coqdocvar{Sub}]; \coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{IHq}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{u}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{well\_formed\_subterm} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{well\_formed} \coqdocvar{t} \ensuremath{\rightarrow} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow} \coqdocvar{well\_formed} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 2; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{p}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{Wt} \coqdocvar{Sub}; \coqdoctac{injection} \coqdocvar{Sub}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{i} \coqdocvar{p} \coqdocvar{s}; \coqdoctac{simpl}; \coqdoctac{case} \coqdocvar{t}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{Wt} \coqdocvar{Sub}; \coqdocvar{case\_eq} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}); [\coqdoctac{intros} \coqdocvar{ti} \coqdocvar{F} \ensuremath{|} \coqdoctac{intros} \coqdocvar{F}]; \coqdoctac{rewrite} \coqdocvar{F} \coqdoctac{in} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{well\_formed\_subterm} \coqdocvar{ti} \coqdocvar{p}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{proj1} (\coqdocvar{well\_formed\_unfold} \coqdocvar{Wt})).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{nth\_error\_ok\_in} \coqdocvar{i} \coqdocvar{l} \coqdocvar{F}) \coqdockw{as} [\coqdocvar{l'} [\coqdocvar{l'{}'} [\coqdocvar{\_} \coqdocvar{H}]]]; \coqdoctac{subst} \coqdocvar{l}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{replace\_at\_pos} (\coqdocvar{t} \coqdocvar{u} : \coqdocvar{term}) (\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat}) \{\coqdockw{struct} \coqdocvar{p}\} : \coqdocvar{term} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{p} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{u}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{i} :: \coqdocvar{q} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{2.50em}
\coqdockw{match} \coqdocvar{t} \coqdockw{with}\coqdoceol
\coqdocindent{2.50em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{t}\coqdoceol
\coqdocindent{2.50em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{4.00em}
\coqdockw{let} \coqdocvar{replace\_at\_pos\_list} :=\coqdoceol
\coqdocindent{4.50em}
(\coqdockw{fix} \coqdocvar{replace\_at\_pos\_list} \coqdocvar{j} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \{\coqdockw{struct} \coqdocvar{l}\}: \coqdocvar{list} \coqdocvar{term} :=\coqdoceol
\coqdocindent{6.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocindent{6.00em}
\ensuremath{|} \coqdocvar{h} :: \coqdocvar{tl} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{8.50em}
\coqdockw{match} \coqdocvar{j} \coqdockw{with}\coqdoceol
\coqdocindent{8.50em}
\ensuremath{|} \coqdocvar{O} \ensuremath{\Rightarrow} (\coqdocvar{replace\_at\_pos} \coqdocvar{h} \coqdocvar{u} \coqdocvar{q}) :: \coqdocvar{tl}\coqdoceol
\coqdocindent{8.50em}
\ensuremath{|} \coqdocvar{S} \coqdocvar{k} \ensuremath{\Rightarrow} \coqdocvar{h} :: (\coqdocvar{replace\_at\_pos\_list} \coqdocvar{k} \coqdocvar{tl})\coqdoceol
\coqdocindent{8.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{6.00em}
\coqdockw{end}) \coqdoctac{in}\coqdoceol
\coqdocindent{2.00em}
\coqdocvar{Term} \coqdocvar{f} (\coqdocvar{replace\_at\_pos\_list} \coqdocvar{i} \coqdocvar{l})\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{replace\_at\_pos\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) (\coqdocvar{u} : \coqdocvar{term}) (\coqdocvar{i} : \coqdocvar{nat}) (\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat}) \coqdoceol
\coqdocindent{0.50em}
\{\coqdockw{struct} \coqdocvar{l}\}: \coqdocvar{list} \coqdocvar{term} :=\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{h} :: \coqdocvar{tl} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{2.50em}
\coqdockw{match} \coqdocvar{i} \coqdockw{with}\coqdoceol
\coqdocindent{2.50em}
\ensuremath{|} \coqdocvar{O} \ensuremath{\Rightarrow} (\coqdocvar{replace\_at\_pos} \coqdocvar{h} \coqdocvar{u} \coqdocvar{p}) :: \coqdocvar{tl}\coqdoceol
\coqdocindent{2.50em}
\ensuremath{|} \coqdocvar{S} \coqdocvar{j} \ensuremath{\Rightarrow} \coqdocvar{h} :: (\coqdocvar{replace\_at\_pos\_list} \coqdocvar{tl}  \coqdocvar{u} \coqdocvar{j} \coqdocvar{p})\coqdoceol
\coqdocindent{2.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{replace\_at\_pos\_unfold} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{f} \coqdocvar{l} \coqdocvar{u} \coqdocvar{i} \coqdocvar{q},\coqdoceol
\coqdocindent{1.50em}
\coqdocvar{replace\_at\_pos} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) \coqdocvar{u} (\coqdocvar{i} :: \coqdocvar{q}) = \coqdocvar{Term} \coqdocvar{f} (\coqdocvar{replace\_at\_pos\_list} \coqdocvar{l} \coqdocvar{u} \coqdocvar{i} \coqdocvar{q}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{u} \coqdocvar{i} \coqdocvar{q}; \coqdoctac{simpl}; \coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})); \coqdoceol
\coqdocnoindent
\coqdoctac{generalize} \coqdocvar{u} \coqdocvar{i} \coqdocvar{q}; \coqdoctac{clear} \coqdocvar{u} \coqdocvar{i} \coqdocvar{q}; \coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [| \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{intros} \coqdocvar{u} \coqdocvar{i} \coqdocvar{q}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{replace\_at\_pos\_is\_replace\_at\_pos1} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{u} \coqdocvar{p}, \coqdocvar{is\_a\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{true} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{1.00em}
\coqdocvar{subterm\_at\_pos} (\coqdocvar{replace\_at\_pos} \coqdocvar{t} \coqdocvar{u} \coqdocvar{p}) \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{u}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x} \coqdocvar{u} \coqdocvar{p}; \coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{q} ]; \coqdoctac{trivial};\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{u} \coqdocvar{p}; \coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{q} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{replace\_at\_pos\_unfold}; \coqdoctac{simpl}; \coqdoctac{generalize} \coqdocvar{i} \coqdocvar{q}; \coqdoctac{clear} \coqdocvar{i} \coqdocvar{q}; \coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l} ]; \coqdoctac{intros} \coqdocvar{i} \coqdocvar{q}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ]; \coqdoctac{simpl}; \coqdoctac{intros}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ]; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} (\coqdocvar{IHl} \coqdocvar{t}); \coqdoctac{trivial}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl0}; \coqdoctac{intros}; \coqdoctac{trivial}; \coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{replace\_at\_pos\_is\_replace\_at\_pos2} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{p} \coqdocvar{u}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{u} \ensuremath{\rightarrow} \coqdocvar{replace\_at\_pos} \coqdocvar{t} \coqdocvar{u} \coqdocvar{p} = \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p} \coqdocvar{u}; \coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{q} ]; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{inversion\_clear} \coqdocvar{H}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{p}; \coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{q} ].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{u} \coqdocvar{H}; \coqdoctac{inversion\_clear} \coqdocvar{H}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{u} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{replace\_at\_pos\_unfold}; \coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})); \coqdoctac{generalize} \coqdocvar{i} \coqdocvar{q} \coqdocvar{u} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{i} \coqdocvar{q} \coqdocvar{u} \coqdocvar{H};\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l} ]; \coqdoctac{intros} \coqdocvar{i} \coqdocvar{q} \coqdocvar{u} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ]; \coqdoctac{simpl}; \coqdoctac{intros}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ]; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{IHl}; \coqdoctac{trivial}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{IHl0}; \coqdoctac{trivial}; \coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_at\_pos\_apply\_subst\_apply\_subst\_subterm\_at\_pos} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{p} \coqdocvar{sigma}, \coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{u} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{4.00em}
\coqdocvar{subterm\_at\_pos} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}) \coqdocvar{p} = \coqdocvar{Some} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{u})\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{True}\coqdoceol
\coqdocnoindent
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{t}; \coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p}; \coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{q} ]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{p}; \coqdoctac{destruct} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{q} ]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H} : \coqdockw{\ensuremath{\forall}} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) \coqdocvar{i}, \coqdoceol
\coqdocindent{10.50em}
\coqdockw{match} \coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i} \coqdockw{with}\coqdoceol
\coqdocindent{16.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{li} \ensuremath{\Rightarrow} \coqdocvar{In} \coqdocvar{li} \coqdocvar{l}\coqdoceol
\coqdocindent{16.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{True} \coqdockw{end}).\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{IHl} \coqdocvar{l} \coqdocvar{i}; \coqdoctac{intro} \coqdocvar{l};\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l} ]; \coqdoctac{intro} \coqdocvar{i}; \coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{IHl} \coqdocvar{i}); \coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}); \coqdoctac{trivial}; \coqdoctac{intros}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} \coqdocvar{i}; \coqdoctac{clear} \coqdocvar{i}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{l} \coqdocvar{ll} ]; \coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{i}; \coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{sigma}; \coqdoctac{apply} \coqdocvar{IHll}; \coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{replace\_at\_pos\_list\_replace\_at\_pos\_in\_subterm} :\coqdoceol
\coqdocnoindent
\coqdockw{\ensuremath{\forall}} \coqdocvar{l1} \coqdocvar{ui} \coqdocvar{l2} \coqdocvar{u} \coqdocvar{i} \coqdocvar{p}, \coqdocvar{length} \coqdocvar{l1} = \coqdocvar{i} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{0.50em}
\coqdocvar{replace\_at\_pos\_list} (\coqdocvar{l1} ++ \coqdocvar{ui} :: \coqdocvar{l2}) \coqdocvar{u} \coqdocvar{i} \coqdocvar{p} = \coqdoceol
\coqdocindent{0.50em}
\coqdocvar{l1} ++ (\coqdocvar{replace\_at\_pos} \coqdocvar{ui} \coqdocvar{u} \coqdocvar{p}) :: \coqdocvar{l2}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{l1}; \coqdoctac{induction} \coqdocvar{l1} \coqdockw{as} [ \ensuremath{|} \coqdocvar{u1} \coqdocvar{l1} ]; \coqdoctac{intros} \coqdocvar{ui} \coqdocvar{l2} \coqdocvar{u} \coqdocvar{i} \coqdocvar{p} \coqdocvar{L}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{L}.\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{i}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} ].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{IHl1}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{inversion} \coqdocvar{L}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{well\_formed\_replace\_at\_pos} :\coqdoceol
\coqdocindent{1.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{t} \coqdocvar{u}, \coqdocvar{well\_formed} \coqdocvar{t} \ensuremath{\rightarrow} \coqdocvar{well\_formed} \coqdocvar{u} \ensuremath{\rightarrow} \coqdocvar{well\_formed} (\coqdocvar{replace\_at\_pos} \coqdocvar{t} \coqdocvar{u} \coqdocvar{p}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{p}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{u} \coqdocvar{Wt} \coqdocvar{Wu}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{replace\_at\_pos\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{well\_formed\_unfold} \coqdocvar{Wt}) \coqdockw{as} [\coqdocvar{Wl} \coqdocvar{L}]; \coqdoctac{clear} \coqdocvar{Wt}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{well\_formed\_fold}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{L}; \coqdocvar{revert} \coqdocvar{i}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{i}; \coqdoctac{case} \coqdocvar{i}; \coqdoctac{clear} \coqdocvar{i}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{v} [\coqdocvar{H} \ensuremath{|} \coqdocvar{H}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{v}; \coqdoctac{apply} \coqdocvar{IHp}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{i} \coqdocvar{v} [\coqdocvar{H} \ensuremath{|} \coqdocvar{H}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{v}; \coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl} \coqdockw{with} \coqdocvar{i}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{Wl}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{replace} (\coqdocvar{length} (\coqdocvar{replace\_at\_pos\_list} \coqdocvar{l} \coqdocvar{u} \coqdocvar{i} \coqdocvar{p})) \coqdockw{with} (\coqdocvar{length} \coqdocvar{l}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear}; \coqdocvar{revert} \coqdocvar{i}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} \coqdocvar{n}]; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_replace\_at\_pos} : \coqdoceol
\coqdocindent{4.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{u} \coqdocvar{p} \coqdocvar{sigma}, \coqdocvar{is\_a\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{true} \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{replace\_at\_pos} \coqdocvar{t} \coqdocvar{u} \coqdocvar{p}) =\coqdoceol
\coqdocindent{4.00em}
\coqdocvar{replace\_at\_pos} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}) (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{u}) \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{u} \coqdocvar{p}; \coqdocvar{revert} \coqdocvar{t} \coqdocvar{u}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{u} \coqdocvar{sigma} \coqdocvar{Hpos}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{replace\_at\_pos\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdocvar{apply\_subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{replace\_at\_pos\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdoctac{f\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Hpos}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{f}.\coqdoceol
\coqdocnoindent
\coqdocvar{revert} \coqdocvar{i} \coqdocvar{u} \coqdocvar{sigma} \coqdocvar{Hpos}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{intros} [ \ensuremath{|} \coqdocvar{n}] \coqdocvar{u} \coqdocvar{sigma} \coqdocvar{Hpos}; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{t} \ensuremath{\Rightarrow} \coqdocvar{t} :: \coqdocvar{map} (\coqdocvar{apply\_subst} \coqdocvar{sigma}) \coqdocvar{l})).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHp}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdoctac{f\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_in\_instantiated\_term} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{s} \coqdocvar{t} \coqdocvar{sigma}, \coqdocvar{subterm\_at\_pos} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}) \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{10.00em}
\coqdockw{match} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} \coqdockw{with}\coqdoceol
\coqdocindent{10.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{u'} \ensuremath{\Rightarrow} \coqdocvar{s} = \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{u'}\coqdoceol
\coqdocindent{10.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdoctac{\ensuremath{\exists}} \coqdocvar{v}, \coqdoctac{\ensuremath{\exists}} \coqdocvar{q}, \coqdoctac{\ensuremath{\exists}} \coqdocvar{q'}, \coqdocvar{p} = \coqdocvar{q} ++ \coqdocvar{q'} \ensuremath{\land}\coqdoceol
\coqdocindent{21.00em}
\coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t})  \ensuremath{\land}\coqdoceol
\coqdocindent{20.50em}
\coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{q} = \coqdocvar{Some} (\coqdocvar{Var} \coqdocvar{v}) \ensuremath{\land}\coqdoceol
\coqdocindent{20.50em}
\coqdocvar{subterm\_at\_pos} (\coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{Var} \coqdocvar{v})) \coqdocvar{q'} = \coqdocvar{Some} \coqdocvar{s}\coqdoceol
\coqdocindent{10.00em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{p}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{intros} \coqdocvar{s} \coqdocvar{t} \coqdocvar{sigma} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}; \coqdoctac{injection} \coqdocvar{Sub}; \coqdoctac{clear} \coqdocvar{Sub}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}; \coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [\coqdocvar{v} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{v}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}; \coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma}) \coqdockw{as} [\coqdocvar{v\_sigma} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (@\coqdocvar{nil} \coqdocvar{nat}); \coqdoctac{\ensuremath{\exists}} (\coqdocvar{i} :: \coqdocvar{p}); \coqdoctac{repeat} \coqdoctac{split}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H} := \coqdocvar{nth\_error\_map} (\coqdocvar{apply\_subst} \coqdocvar{sigma}) \coqdocvar{l} \coqdocvar{i}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{nth\_error} (\coqdocvar{map} (\coqdocvar{apply\_subst} \coqdocvar{sigma}) \coqdocvar{l}) \coqdocvar{i}) \coqdockw{as} [\coqdocvar{ti\_sigma} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{nth\_error\_ok\_in} \coqdocvar{i} \coqdocvar{l}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}) \coqdockw{as} [\coqdocvar{ti} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H'} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{L} \coqdocvar{H'{}'{}'}]]]; \coqdoctac{clear} \coqdocvar{H'}; \coqdoctac{subst};\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{IHp} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{Sub}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{subterm\_at\_pos} \coqdocvar{ti} \coqdocvar{p}) \coqdockw{as} [\coqdocvar{u} \ensuremath{|} ]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{v} [\coqdocvar{q} [\coqdocvar{q'} [\coqdocvar{p\_eq\_qq'} [\coqdocvar{v\_in\_ti} [\coqdocvar{Sub'} \coqdocvar{Sub'{}'}]]]]]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{v}; \coqdoctac{\ensuremath{\exists}} (\coqdocvar{length} \coqdocvar{l1} :: \coqdocvar{q}); \coqdoctac{\ensuremath{\exists}} \coqdocvar{q'}; \coqdoctac{repeat} \coqdoctac{split}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{p}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply}  \coqdocvar{var\_in\_subterm} \coqdockw{with} \coqdocvar{ti} (\coqdocvar{length} \coqdocvar{l1} :: \coqdocvar{nil}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_in\_subterm} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{q} \coqdocvar{s} \coqdocvar{t} \coqdocvar{u}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow} \coqdocvar{subterm\_at\_pos} \coqdocvar{s} \coqdocvar{q} = \coqdocvar{Some} \coqdocvar{u} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{13.00em}
\coqdocvar{subterm\_at\_pos} \coqdocvar{t} (\coqdocvar{p} ++ \coqdocvar{q}) = \coqdocvar{Some} \coqdocvar{u}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{p}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{intros} \coqdocvar{q} \coqdocvar{s} \coqdocvar{t} \coqdocvar{u} \coqdocvar{Sub1} \coqdocvar{Sub2}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub1}; \coqdoctac{injection} \coqdocvar{Sub1}; \coqdoctac{clear} \coqdocvar{Sub1}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub1}; \coqdoctac{simpl}; \coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [\coqdocvar{v} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}) \coqdockw{as} [\coqdocvar{ti} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHp} \coqdockw{with} \coqdocvar{s}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_in\_subterm2} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{q} \coqdocvar{s} \coqdocvar{t}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} (\coqdocvar{p} ++ \coqdocvar{q}) = \coqdocvar{Some} \coqdocvar{s} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{11.00em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{u}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{u} \ensuremath{\land} \coqdocvar{subterm\_at\_pos} \coqdocvar{u} \coqdocvar{q} = \coqdocvar{Some} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{p}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}]; \coqdoctac{intros} \coqdocvar{q} \coqdocvar{s} \coqdocvar{t} \coqdocvar{Sub}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{t}; \coqdoctac{split}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Sub}; \coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [\coqdocvar{v} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{nth\_error\_ok\_in} \coqdocvar{i} \coqdocvar{l}); \coqdoctac{destruct} (\coqdocvar{nth\_error} \coqdocvar{l} \coqdocvar{i}) \coqdockw{as} [\coqdocvar{ti} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{H}; \coqdoctac{destruct} (\coqdocvar{H} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{L} \coqdocvar{H'}]]]; \coqdoctac{clear} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IHp} \coqdocvar{q} \coqdocvar{s} \coqdocvar{ti} \coqdocvar{Sub}) \coqdockw{as} [\coqdocvar{u} [\coqdocvar{Sub'} \coqdocvar{H'{}'}]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{u}; \coqdoctac{subst}; \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{split}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subterm\_subterm\_alt} : \coqdoceol
\coqdocindent{0.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{s}, \coqdocvar{refl\_trans\_clos} \coqdocvar{direct\_subterm} \coqdocvar{s} \coqdocvar{t} \ensuremath{\rightarrow} \{\coqdocvar{p} : \coqdocvar{list} \coqdocvar{nat} \ensuremath{|} \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}\}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H} : \coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{s}, \coqdocvar{refl\_trans\_clos} \coqdocvar{direct\_subterm} \coqdocvar{s} \coqdocvar{t} \ensuremath{\rightarrow} \coqdoctac{\ensuremath{\exists}} \coqdocvar{p}, \coqdocvar{subterm\_at\_pos} \coqdocvar{t} \coqdocvar{p} = \coqdocvar{Some} \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{t} \coqdocvar{H}; \coqdoctac{inversion} \coqdocvar{H} \coqdockw{as} [\coqdocvar{u} \ensuremath{|} \coqdocvar{t'} \coqdocvar{s'} \coqdocvar{H'}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{nil}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{s'} \coqdocvar{t'}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{induction} \coqdocvar{H'} \coqdockw{as} [\coqdocvar{s} \coqdocvar{t} \coqdocvar{H} \ensuremath{|} \coqdocvar{s} \coqdocvar{t} \coqdocvar{u} \coqdocvar{H1} \coqdocvar{H2}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H}) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} \coqdocvar{H'}]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{length} \coqdocvar{l1} :: \coqdocvar{nil}); \coqdoctac{subst} \coqdocvar{l}; \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{t} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H1}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H1}) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} \coqdocvar{H'}]].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{IHH2} \coqdockw{as} [\coqdocvar{p} \coqdocvar{Sub}]; \coqdoctac{\ensuremath{\exists}} (\coqdocvar{p} ++ (\coqdocvar{length} \coqdocvar{l1}) :: \coqdocvar{nil}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{subterm\_in\_subterm} \coqdockw{with} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{l}; \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{s} \coqdocvar{H'}; \coqdoctac{destruct} (\coqdocvar{subterm\_at\_pos\_dec} \coqdocvar{t} \coqdocvar{s}) \coqdockw{as} [\coqdocvar{Sub} \ensuremath{|} \coqdocvar{not\_Sub}].\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{False\_rec}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'}) \coqdockw{as} [\coqdocvar{p} \coqdocvar{Sub}]; \coqdoctac{apply} (\coqdocvar{not\_Sub} \coqdocvar{p} \coqdocvar{Sub}).\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{var\_in\_replace\_at\_pos} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{s} \coqdocvar{p} \coqdocvar{u} \coqdocvar{x}, \coqdocvar{In} \coqdocvar{x} (\coqdocvar{var\_list} (\coqdocvar{replace\_at\_pos} \coqdocvar{s} \coqdocvar{u} \coqdocvar{p})) \ensuremath{\rightarrow} \coqdocvar{In} \coqdocvar{x} (\coqdocvar{var\_list} \coqdocvar{s}) \ensuremath{\lor} \coqdocvar{In} \coqdocvar{x} (\coqdocvar{var\_list} \coqdocvar{u}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{p}; \coqdocvar{revert} \coqdocvar{s}; \coqdoctac{induction} \coqdocvar{p} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i} \coqdocvar{p}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{s} \coqdocvar{u} \coqdocvar{x} \coqdocvar{x\_in\_u}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{u} \coqdocvar{x}; \coqdoctac{destruct} \coqdocvar{s} \coqdockw{as} [\coqdocvar{v} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{replace\_at\_pos\_unfold}; \coqdoctac{do} 2 \coqdoctac{rewrite} \coqdocvar{var\_list\_unfold}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{f}; \coqdocvar{revert} \coqdocvar{i} \coqdocvar{u} \coqdocvar{x}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}]; \coqdoctac{intros} \coqdocvar{i} \coqdocvar{u} \coqdocvar{x}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdocvar{replace\_at\_pos\_list}; \coqdoctac{destruct} \coqdocvar{i} \coqdockw{as} [ \ensuremath{|} \coqdocvar{i}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H}) \coqdockw{as} [\coqdocvar{H1} \ensuremath{|} \coqdocvar{H1}]; \coqdoctac{clear} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IHp} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H1}) \coqdockw{as} [\coqdocvar{H2} \ensuremath{|} \coqdocvar{H2}]; \coqdoctac{clear} \coqdocvar{H1}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intro} \coqdocvar{H}; \coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H}) \coqdockw{as} [\coqdocvar{H1} \ensuremath{|} \coqdocvar{H1}]; \coqdoctac{clear} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IHl} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H1}) \coqdockw{as} [\coqdocvar{H2} \ensuremath{|} \coqdocvar{H2}]; \coqdoctac{clear} \coqdocvar{H1}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{remove\_garbage\_subst} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{sigma} : \coqdocvar{substitution}, \coqdoceol
\coqdocindent{2.00em}
\{\coqdocvar{sigma'} : \coqdocvar{substitution} \ensuremath{|} (\coqdockw{\ensuremath{\forall}} \coqdocvar{x}, \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{sigma} = \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{sigma'}) \ensuremath{\land}\coqdoceol
\coqdocindent{20.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{val}, \coqdocvar{In} (\coqdocvar{x},\coqdocvar{val}) \coqdocvar{sigma'} \ensuremath{\rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{sigma'} = \coqdocvar{Some} \coqdocvar{val}) \ensuremath{\land}\coqdoceol
\coqdocindent{17.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{x} \coqdocvar{y} \coqdocvar{val} \coqdocvar{val'} (\coqdocvar{tau} \coqdocvar{tau'} \coqdocvar{tau'{}'} : \coqdocvar{substitution}), \coqdoceol
\coqdocindent{18.50em}
\coqdocvar{sigma'} = \coqdocvar{tau} ++ (\coqdocvar{x},\coqdocvar{val}) :: \coqdocvar{tau'} ++ (\coqdocvar{y},\coqdocvar{val'}) :: \coqdocvar{tau'{}'} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{18.50em}
\coqdocvar{x} \ensuremath{\not=} \coqdocvar{y})\}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 1.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{sigma}; \coqdoctac{clear} \coqdocvar{sigma}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{nil}; \coqdoctac{repeat} \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x} \coqdocvar{val} \coqdocvar{Abs}; \coqdoctac{elim} \coqdocvar{Abs}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x} \coqdocvar{y} \coqdocvar{val} \coqdocvar{val'} \coqdocvar{tau} \coqdocvar{tau'} \coqdocvar{tau'{}'}; \coqdoctac{case} \coqdocvar{tau}; \coqdoctac{clear} \coqdocvar{tau}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{Abs}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{tau} \coqdocvar{Abs}; \coqdoctac{discriminate}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}; \coqdoctac{intros} \coqdocvar{x} \coqdocvar{val}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{remove\_garbage\_subst} \coqdocvar{sigma}) \coqdockw{as} [\coqdocvar{sigma'} [\coqdocvar{H1} [\coqdocvar{H2} \coqdocvar{H3}]]].\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{sigma'}).\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{val'} \coqdocvar{H}; \coqdoctac{destruct} (\coqdocvar{find\_mem} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H}) \coqdockw{as} [\coqdocvar{x'} [\coqdocvar{sigma1} [\coqdocvar{sigma2} [\coqdocvar{H'} \coqdocvar{H'{}'}]]]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} ((\coqdocvar{x},\coqdocvar{val}) :: \coqdocvar{sigma1} ++ \coqdocvar{sigma2}); \coqdoctac{subst} \coqdocvar{x'}; \coqdoctac{repeat} \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{y}; \coqdoctac{simpl}; \coqdocvar{case\_eq} (\coqdocvar{eq\_var\_bool} \coqdocvar{y} \coqdocvar{x}); [\coqdoctac{intro} \coqdocvar{y\_eq\_x} \ensuremath{|} \coqdoctac{intro} \coqdocvar{x\_diff\_y}]; [\coqdoctac{trivial} \ensuremath{|} \coqdoctac{idtac}].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{H1} \coqdocvar{y}); \coqdoctac{rewrite} \coqdocvar{H'{}'}; \coqdoctac{clear} \coqdocvar{sigma'} \coqdocvar{H1} \coqdocvar{H2} \coqdocvar{H3} \coqdocvar{H} \coqdocvar{H'{}'};\coqdoceol
\coqdocnoindent
\coqdoctac{induction} \coqdocvar{sigma1} \coqdockw{as} [ \ensuremath{|} [\coqdocvar{x1} \coqdocvar{val1}] \coqdocvar{sigma1}]; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{x\_diff\_y}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{eq\_var\_bool} \coqdocvar{y} \coqdocvar{x1}); [\coqdoctac{intro} \coqdocvar{y\_eq\_x1} \ensuremath{|} \coqdoctac{intro} \coqdocvar{y\_diff\_x1}]; [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{apply} \coqdocvar{IHsigma1}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{y} \coqdocvar{val'{}'} [\coqdocvar{H4} \ensuremath{|} \coqdocvar{H4}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{H4}; \coqdoctac{clear} \coqdocvar{H4}; \coqdoctac{intros}; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{eq\_var\_bool\_refl}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{eq\_var\_bool} \coqdocvar{y} \coqdocvar{x}); [\coqdoctac{intro} \coqdocvar{y\_eq\_x} \ensuremath{|} \coqdoctac{intro} \coqdocvar{y\_diff\_x}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H4}) \coqdockw{as} [\coqdocvar{H5} \ensuremath{|} \coqdocvar{H5}];\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{In\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H5}) \coqdockw{as} [\coqdocvar{tau1} [\coqdocvar{tau2} \coqdocvar{H6}]]; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (\coqdocvar{y} = \coqdocvar{x}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H3} \coqdocvar{y} \coqdocvar{x} \coqdocvar{val'{}'} \coqdocvar{val'} \coqdocvar{tau1} \coqdocvar{tau2} \coqdocvar{sigma2}); \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{ass\_app}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{y} \coqdocvar{x}); \coqdoctac{rewrite} \coqdocvar{y\_eq\_x}; \coqdoctac{intro} \coqdocvar{y\_eq\_x'}; \coqdoctac{exact} \coqdocvar{y\_eq\_x'}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (\coqdocvar{x} = \coqdocvar{y}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H3} \coqdocvar{x} \coqdocvar{y} \coqdocvar{val'} \coqdocvar{val'{}'} \coqdocvar{sigma1} \coqdocvar{tau1} \coqdocvar{tau2}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{y} \coqdocvar{x}); \coqdoctac{rewrite} \coqdocvar{y\_eq\_x}; \coqdoctac{intro} \coqdocvar{y\_eq\_x'}; \coqdoctac{rewrite} \coqdocvar{y\_eq\_x'}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} (\coqdocvar{H2} \coqdocvar{y} \coqdocvar{val'{}'}); \coqdoctac{subst} \coqdocvar{sigma'}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{find\_diff} (@\coqdocvar{eq} \coqdocvar{variable})).\coqdoceol
\coqdocnoindent
\coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{X.eq\_bool\_ok}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{y\_diff\_x}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_insert}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{sigma} \coqdocvar{H1} \coqdocvar{H2}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x1} \coqdocvar{y} \coqdocvar{val1} \coqdocvar{valy} [ \ensuremath{|} [\coqdocvar{z} \coqdocvar{zval}] \coqdocvar{tau}] \coqdocvar{tau'} \coqdocvar{tau'{}'}; \coqdoctac{simpl}; \coqdoctac{intro} \coqdocvar{H'{}'{}'};\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H'{}'{}'}; \coqdoctac{injection} \coqdocvar{H'{}'{}'}; \coqdoctac{clear} \coqdocvar{H'{}'{}'}; \coqdoctac{intros}; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{yvaly\_in\_sigma12} : \coqdocvar{In} (\coqdocvar{y},\coqdocvar{valy}) (\coqdocvar{sigma1} ++ \coqdocvar{sigma2})).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H0}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{yvaly\_in\_sigma12}) \coqdockw{as} [\coqdocvar{yvaly\_in\_sigma1} \ensuremath{|} \coqdocvar{yvaly\_in\_sigma2}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{In\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{yvaly\_in\_sigma1}) \coqdockw{as} [\coqdocvar{tau1} [\coqdocvar{tau2} \coqdocvar{H'}]].\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{x1\_eq\_y}; \coqdoctac{apply} (\coqdocvar{H3} \coqdocvar{y} \coqdocvar{x1} \coqdocvar{valy} \coqdocvar{val'} \coqdocvar{tau1} \coqdocvar{tau2} \coqdocvar{sigma2}); \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{ass\_app}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{In\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{yvaly\_in\_sigma2}) \coqdockw{as} [\coqdocvar{tau1} [\coqdocvar{tau2} \coqdocvar{H'}]].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H3} \coqdocvar{x1} \coqdocvar{y} \coqdocvar{val'} \coqdocvar{valy} \coqdocvar{sigma1} \coqdocvar{tau1} \coqdocvar{tau2}); \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{insert\_2} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{z},\coqdocvar{val'}) \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H0}) \coqdockw{as} [\coqdocvar{tau1} [\coqdocvar{tau2} [\coqdocvar{tau3} \coqdocvar{H4}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H3} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H4}).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{H4}; \coqdoctac{\ensuremath{\exists}} ((\coqdocvar{x},\coqdocvar{val}) :: \coqdocvar{sigma'}); \coqdoctac{repeat} \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{y}; \coqdoctac{simpl}; \coqdocvar{case\_eq} (\coqdocvar{eq\_var\_bool} \coqdocvar{y} \coqdocvar{x}); [\coqdoctac{intro} \coqdocvar{y\_eq\_x} \ensuremath{|} \coqdoctac{intro} \coqdocvar{y\_diff\_x}]; [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{apply} \coqdocvar{H1}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{y} \coqdocvar{valy}  [\coqdocvar{H} \ensuremath{|} \coqdocvar{H}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros}; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{eq\_var\_bool\_refl}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{eq\_var\_bool} \coqdocvar{y} \coqdocvar{x}); [\coqdoctac{intro} \coqdocvar{y\_eq\_x} \ensuremath{|} \coqdoctac{intro} \coqdocvar{y\_diff\_x}].\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (\coqdocvar{In} (\coqdocvar{y},\coqdocvar{valy}) \coqdocvar{sigma'}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{find\_not\_found} \coqdockw{with} \coqdocvar{eq\_var\_bool} \coqdocvar{x}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{x} \coqdocvar{y}) (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{y} \coqdocvar{x}); \coqdoctac{rewrite} \coqdocvar{y\_eq\_x}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{y}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{\_}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{x\_diff\_y} \coqdocvar{y\_eq\_x'}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{x\_diff\_y}; \coqdoctac{rewrite} \coqdocvar{y\_eq\_x'}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H2}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{y} \coqdocvar{z} \coqdocvar{valy} \coqdocvar{valz} [ \ensuremath{|} [\coqdocvar{u} \coqdocvar{valu}] \coqdocvar{tau}] \coqdocvar{tau'} \coqdocvar{tau'{}'} \coqdocvar{H}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros}; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{y\_eq\_z}; \coqdoctac{subst} \coqdocvar{y}; \coqdoctac{apply} (\coqdocvar{find\_not\_found} \coqdocvar{eq\_var\_bool} \coqdocvar{\_} \coqdocvar{z} \coqdocvar{valz} \coqdocvar{\_} \coqdocvar{H4}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{eq\_var\_bool\_refl}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H3} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})).\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_eq\_vars} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{t} \coqdocvar{sigma} \coqdocvar{sigma'}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{t}) \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{Var} \coqdocvar{v}) = \coqdocvar{apply\_subst} \coqdocvar{sigma'} (\coqdocvar{Var} \coqdocvar{v})) \coqdoceol
\coqdocindent{1.50em}
\ensuremath{\leftrightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t} = \coqdocvar{apply\_subst} \coqdocvar{sigma'} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{sigma} \coqdocvar{sigma'}; \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{H}; \coqdoctac{apply} \coqdocvar{H}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{map\_eq}; \coqdoctac{intros} \coqdocvar{t} \coqdocvar{t\_in\_l}; \coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_t}; \coqdoctac{apply} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{In\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{t\_in\_l}) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} \coqdocvar{H'}]]; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{var\_in\_subterm} \coqdockw{with} \coqdocvar{t} (\coqdocvar{length} \coqdocvar{l1} :: \coqdocvar{nil}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{pattern} \coqdocvar{t}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{H}; \coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{x} [\coqdocvar{x\_eq\_v} \ensuremath{|} \coqdocvar{F}]; [\coqdoctac{subst}; \coqdoctac{trivial} \ensuremath{|} \coqdocvar{contradiction}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{H}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intro} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_l}; \coqdoctac{rewrite} \coqdocvar{var\_list\_unfold} \coqdoctac{in} \coqdocvar{v\_in\_l}; \coqdoctac{induction} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{t} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros} \coqdocvar{H} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{v\_in\_l}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_}  \coqdocvar{v\_in\_l}) \coqdockw{as} [\coqdocvar{v\_in\_t} \ensuremath{|} \coqdocvar{v\_in\_l'}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl} \coqdockw{with} \coqdocvar{t}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHl0}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{s} \coqdocvar{s\_in\_l} \coqdocvar{H'{}'} \coqdocvar{x} \coqdocvar{x\_in\_s}; \coqdoctac{apply} (\coqdocvar{IHl} \coqdocvar{s}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Fixpoint} \coqdocvar{subst\_rest} \coqdocvar{vars} \coqdocvar{sigma} : \coqdocvar{substitution} :=\coqdoceol
\coqdocnoindent
\coqdockw{match} \coqdocvar{sigma} \coqdockw{with}\coqdoceol
\coqdocnoindent
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{nil}\coqdoceol
\coqdocnoindent
\ensuremath{|} (\coqdocvar{x},\coqdocvar{u}) :: \coqdocvar{sigma} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{5.00em}
\coqdockw{if} \coqdocvar{mem\_bool} \coqdocvar{eq\_var\_bool} \coqdocvar{x} \coqdocvar{vars} \coqdoceol
\coqdocindent{5.00em}
\coqdockw{then} (\coqdocvar{x},\coqdocvar{u}) :: (\coqdocvar{subst\_rest} \coqdocvar{vars} \coqdocvar{sigma})\coqdoceol
\coqdocindent{5.00em}
\coqdockw{else} \coqdocvar{subst\_rest} \coqdocvar{vars} \coqdocvar{sigma}\coqdoceol
\coqdocnoindent
\coqdockw{end}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_rest\_ok} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{vars} \coqdocvar{sigma} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} \coqdocvar{vars} \ensuremath{\rightarrow} \coqdocvar{apply\_subst} (\coqdocvar{subst\_rest} \coqdocvar{vars} \coqdocvar{sigma}) (\coqdocvar{Var} \coqdocvar{v}) = \coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{Var} \coqdocvar{v}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 2.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{vars} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{sigma}; \coqdoctac{clear} \coqdocvar{sigma}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{z} \coqdocvar{t} \coqdocvar{v} \coqdocvar{v\_in\_vars}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{mem\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{z} \coqdocvar{vars});\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{mem\_bool} \coqdocvar{eq\_var\_bool} \coqdocvar{z} \coqdocvar{vars}); [\coqdoctac{intro} \coqdocvar{z\_in\_vars} \ensuremath{|} \coqdoctac{intro} \coqdocvar{z\_not\_in\_vars}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{z}) \coqdockw{as} [\coqdocvar{v\_eq\_z} \ensuremath{|} \coqdocvar{v\_diff\_z}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{subst\_rest\_ok}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{z}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{z}); [\coqdoctac{intro} \coqdocvar{v\_eq\_z} \ensuremath{|} \coqdoctac{intro} \coqdocvar{v\_diff\_z}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{z\_not\_in\_vars}; \coqdoctac{subst} \coqdocvar{v}; \coqdoctac{apply} \coqdocvar{in\_impl\_mem}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{subst\_rest\_ok}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_rest\_rest} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{vars} \coqdocvar{sigma} \coqdocvar{v} \coqdocvar{t}, \coqdocvar{In} (\coqdocvar{v},\coqdocvar{t}) (\coqdocvar{subst\_rest} \coqdocvar{vars} \coqdocvar{sigma}) \ensuremath{\rightarrow} \coqdocvar{In} \coqdocvar{v} \coqdocvar{vars}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 2.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{vars} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{sigma}; \coqdoctac{clear} \coqdocvar{sigma}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{t}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{z} \coqdocvar{t} \coqdocvar{v} \coqdocvar{u}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{mem\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{z} \coqdocvar{vars});\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{mem\_bool} \coqdocvar{eq\_var\_bool} \coqdocvar{z} \coqdocvar{vars}); [\coqdoctac{intro} \coqdocvar{z\_in\_vars} \ensuremath{|} \coqdoctac{intro} \coqdocvar{z\_not\_in\_vars}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{zt\_eq\_vu} \ensuremath{|} \coqdocvar{vu\_in\_rest}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{zt\_eq\_vu}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{v}; \coqdoctac{apply} \coqdocvar{mem\_impl\_in} \coqdockw{with} (@\coqdocvar{eq} \coqdocvar{\_}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{subst\_rest\_rest} \coqdocvar{vars} \coqdocvar{sigma} \coqdocvar{v} \coqdocvar{u} \coqdocvar{vu\_in\_rest}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{subst\_rest\_rest}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_rest\_subst} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{vars} \coqdocvar{sigma} \coqdocvar{v} \coqdocvar{t}, \coqdocvar{In} (\coqdocvar{v},\coqdocvar{t}) (\coqdocvar{subst\_rest} \coqdocvar{vars} \coqdocvar{sigma}) \ensuremath{\rightarrow} \coqdocvar{In} (\coqdocvar{v},\coqdocvar{t}) \coqdocvar{sigma}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 2.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{vars} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{sigma}; \coqdoctac{clear} \coqdocvar{sigma}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{t}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{z} \coqdocvar{t} \coqdocvar{v} \coqdocvar{u}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{mem\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{z} \coqdocvar{vars});\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{mem\_bool} \coqdocvar{eq\_var\_bool} \coqdocvar{z} \coqdocvar{vars}); [\coqdoctac{intro} \coqdocvar{z\_in\_vars} \ensuremath{|} \coqdoctac{intro} \coqdocvar{z\_not\_in\_vars}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{zt\_eq\_vu} \ensuremath{|} \coqdocvar{vu\_in\_rest}].\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{apply} (\coqdocvar{subst\_rest\_subst} \coqdocvar{vars}); \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{vu\_in\_rest}; \coqdoctac{right}; \coqdoctac{apply} (\coqdocvar{subst\_rest\_subst} \coqdocvar{vars}); \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_rest\_subst\_rest} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{vars} \coqdocvar{sigma} \coqdocvar{v} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{v} \coqdocvar{vars} \ensuremath{\rightarrow} \coqdocvar{In} (\coqdocvar{v},\coqdocvar{t}) \coqdocvar{sigma} \ensuremath{\rightarrow} \coqdocvar{In} (\coqdocvar{v},\coqdocvar{t}) (\coqdocvar{subst\_rest} \coqdocvar{vars} \coqdocvar{sigma}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdockw{fix} 2; \coqdoctac{intros} \coqdocvar{vars} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{sigma}; \coqdoctac{clear} \coqdocvar{sigma}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{sigma}; \coqdoctac{case} \coqdocvar{p}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{intros} \coqdocvar{x} \coqdocvar{u} \coqdocvar{v} \coqdocvar{t} \coqdocvar{x\_in\_vars}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [\coqdocvar{xu\_eq\_vt} \ensuremath{|} \coqdocvar{vt\_in\_sigma}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{xu\_eq\_vt}; \coqdoctac{clear} \coqdocvar{xu\_eq\_vt}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{v} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{mem\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{x} \coqdocvar{vars}); \coqdoctac{case} (\coqdocvar{mem\_bool} \coqdocvar{X.eq\_bool} \coqdocvar{x} \coqdocvar{vars}); [\coqdoctac{intros} \coqdocvar{\_} \ensuremath{|} \coqdoctac{intro} \coqdocvar{x\_not\_in\_vars}].\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{x\_not\_in\_vars}; \coqdoctac{apply} \coqdocvar{in\_impl\_mem}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{mem\_bool} \coqdocvar{X.eq\_bool} \coqdocvar{x} \coqdocvar{vars}).\coqdoceol
\coqdocnoindent
\coqdoctac{right}; \coqdoctac{apply} \coqdocvar{subst\_rest\_subst\_rest}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{subst\_rest\_subst\_rest}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{extend\_with\_id} \coqdocvar{vars} \coqdocvar{sigma} :=\coqdoceol
\coqdocindent{1.00em}
(\coqdocvar{map} (\coqdockw{fun} \coqdocvar{x} \ensuremath{\Rightarrow} (\coqdocvar{x},\coqdocvar{Var} \coqdocvar{x})) \coqdoceol
\coqdocindent{16.50em}
(\coqdocvar{filter} (\coqdockw{fun} \coqdocvar{x} \ensuremath{\Rightarrow}  \coqdocvar{negb} (\coqdocvar{mem\_bool} \coqdocvar{X.eq\_bool} \coqdocvar{x} (\coqdocvar{map} (@\coqdocvar{fst} \coqdocvar{\_} \coqdocvar{\_}) \coqdocvar{sigma}))) \coqdocvar{vars}))\coqdoceol
\coqdocindent{1.00em}
++ \coqdocvar{sigma}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{subst\_trivial\_ext} :\coqdoceol
\coqdocnoindent
\coqdockw{\ensuremath{\forall}} \coqdocvar{vars} \coqdocvar{sigma} \coqdocvar{t}, \coqdocvar{apply\_subst} (\coqdocvar{extend\_with\_id} \coqdocvar{vars} \coqdocvar{sigma}) \coqdocvar{t} = \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{extend\_with\_id}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{vars} \coqdocvar{sigma} \coqdocvar{t}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{subst\_eq\_vars}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{\_}; \coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{find\_app}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{mem\_bool} \coqdocvar{X.eq\_bool} \coqdocvar{v}\coqdoceol
\coqdocindent{4.00em}
(\coqdocvar{map} (\coqdockw{fun} \coqdocvar{st} : \coqdocvar{variable} \ensuremath{\times} \coqdocvar{term} \ensuremath{\Rightarrow} \coqdocvar{fst} \coqdocvar{st})\coqdoceol
\coqdocindent{5.50em}
(\coqdocvar{map} (\coqdockw{fun} \coqdocvar{x} : \coqdocvar{variable} \ensuremath{\Rightarrow} (\coqdocvar{x}, \coqdocvar{Var} \coqdocvar{x}))\coqdoceol
\coqdocindent{7.00em}
(\coqdocvar{filter}\coqdoceol
\coqdocindent{8.50em}
(\coqdockw{fun} \coqdocvar{x} : \coqdocvar{variable} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{9.00em}
\coqdocvar{negb} (\coqdocvar{mem\_bool} \coqdocvar{X.eq\_bool} \coqdocvar{x} (\coqdocvar{map} (@\coqdocvar{fst} \coqdocvar{\_} \coqdocvar{\_}) \coqdocvar{sigma}))) \coqdocvar{vars}))));\coqdoceol
\coqdocindent{1.00em}
[\coqdoctac{intro} \coqdocvar{v\_in} \ensuremath{|} \coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{refl\_equal}].\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{X.eq\_bool} \coqdocvar{v}\coqdoceol
\coqdocindent{2.00em}
(\coqdocvar{map} (\coqdockw{fun} \coqdocvar{x} : \coqdocvar{variable} \ensuremath{\Rightarrow} (\coqdocvar{x}, \coqdocvar{Var} \coqdocvar{x}))\coqdoceol
\coqdocindent{3.50em}
(\coqdocvar{filter}\coqdoceol
\coqdocindent{5.00em}
(\coqdockw{fun} \coqdocvar{x} : \coqdocvar{variable} \ensuremath{\Rightarrow} \coqdocvar{negb} (\coqdocvar{mem\_bool} \coqdocvar{X.eq\_bool} \coqdocvar{x} (\coqdocvar{map} (@\coqdocvar{fst} \coqdocvar{\_} \coqdocvar{\_}) \coqdocvar{sigma}))) \coqdocvar{vars})));\coqdoceol
\coqdocindent{5.50em}
[\coqdoctac{intros} \coqdocvar{x'} \coqdocvar{F} \ensuremath{|} \coqdoctac{intro} \coqdocvar{F}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find\_mem} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{F}) \coqdockw{as} [\coqdocvar{v'} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{v\_eq\_v'} \coqdocvar{H}]]]]; \coqdoctac{subst} \coqdocvar{v'}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{v\_in'} : \coqdocvar{In} (\coqdocvar{v},\coqdocvar{x'}) (\coqdocvar{l1} ++ (\coqdocvar{v},\coqdocvar{x'}) :: \coqdocvar{l2})).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{apply} \coqdocvar{refl\_equal}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{H} \coqdoctac{in} \coqdocvar{v\_in'}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{in\_map\_iff} \coqdoctac{in} \coqdocvar{v\_in'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{v\_in'} \coqdockw{as} [\coqdocvar{v'} [\coqdocvar{v\_eq\_v'} \coqdocvar{v\_in'}]]; \coqdoctac{injection} \coqdocvar{v\_eq\_v'}; \coqdoctac{clear} \coqdocvar{v\_eq\_v'}; \coqdoctac{do} 2 \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{v'} \coqdocvar{x'}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{filter\_In} \coqdoctac{in} \coqdocvar{v\_in'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{v\_in'} \coqdockw{as} [\coqdocvar{\_} \coqdocvar{v\_in'}].\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{X.eq\_bool} \coqdocvar{v} \coqdocvar{sigma}); [\coqdoctac{intros} \coqdocvar{v\_val} \coqdocvar{v\_sigma} \ensuremath{|} \coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{apply} \coqdocvar{refl\_equal}].\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{False\_rec}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find\_mem} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_sigma}) \coqdockw{as} [\coqdocvar{v'} [\coqdocvar{sig1} [\coqdocvar{sig2} [\coqdocvar{v\_eq\_v'} \coqdocvar{H'}]]]]; \coqdoctac{subst} \coqdocvar{v'}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H'} \coqdoctac{in} \coqdocvar{v\_in'}; \coqdoctac{clear} - \coqdocvar{v\_in'}; \coqdoctac{induction} \coqdocvar{sig1} \coqdockw{as} [ \ensuremath{|} [\coqdocvar{u} \coqdocvar{u'}] \coqdocvar{sig1}]; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{v\_in'}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{eq\_var\_bool\_refl} \coqdoctac{in} \coqdocvar{v\_in'}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{u}); [\coqdoctac{discriminate} \ensuremath{|} \coqdoctac{apply} \coqdocvar{IHsig1} ; \coqdoctac{assumption}].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{v\_mem} := \coqdocvar{mem\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{v}\coqdoceol
\coqdocnoindent
(\coqdocvar{map} (\coqdockw{fun} \coqdocvar{st} : \coqdocvar{variable} \ensuremath{\times} \coqdocvar{term} \ensuremath{\Rightarrow} \coqdocvar{fst} \coqdocvar{st})\coqdoceol
\coqdocindent{6.00em}
(\coqdocvar{map} (\coqdockw{fun} \coqdocvar{x} : \coqdocvar{variable} \ensuremath{\Rightarrow} (\coqdocvar{x}, \coqdocvar{Var} \coqdocvar{x}))\coqdoceol
\coqdocindent{7.50em}
(\coqdocvar{filter}\coqdoceol
\coqdocindent{9.00em}
(\coqdockw{fun} \coqdocvar{x} : \coqdocvar{variable} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{9.50em}
\coqdocvar{negb} (\coqdocvar{mem\_bool} \coqdocvar{eq\_var\_bool} \coqdocvar{x} (\coqdocvar{map} (@\coqdocvar{fst} \coqdocvar{\_} \coqdocvar{\_}) \coqdocvar{sigma}))) \coqdocvar{vars})))); \coqdoctac{rewrite} \coqdocvar{v\_in} \coqdoctac{in} \coqdocvar{v\_mem}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{v\_in'{}'} := \coqdocvar{mem\_impl\_in} (@\coqdocvar{eq} \coqdocvar{variable}) (\coqdockw{fun} \coqdocvar{a} \coqdocvar{b} \coqdocvar{P} \ensuremath{\Rightarrow} \coqdocvar{P}) \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_mem}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{in\_map\_iff} \coqdoctac{in} \coqdocvar{v\_in'{}'}; \coqdoctac{destruct} \coqdocvar{v\_in'{}'} \coqdockw{as} [[\coqdocvar{v'} \coqdocvar{u}] [\coqdocvar{v\_eq\_v'} \coqdocvar{v\_in3}]]; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{v\_eq\_v'}; \coqdoctac{subst} \coqdocvar{v'}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{refine} (\coqdocvar{find\_not\_found}  \coqdocvar{X.eq\_bool} \coqdocvar{v} \coqdocvar{v} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{F} (\coqdocvar{eq\_var\_bool\_refl} \coqdocvar{v}) \coqdocvar{v\_in3}).\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{o\_list\_size} \coqdocvar{pb1} \coqdocvar{pb2} := \coqdoceol
\coqdocindent{2.00em}
\coqdocvar{list\_size} (\coqdockw{fun} \coqdocvar{st} \ensuremath{\Rightarrow} \coqdocvar{size} (\coqdocvar{fst} (\coqdocvar{B}:=\coqdocvar{term}) \coqdocvar{st})) \coqdocvar{pb1} < \coqdoceol
\coqdocindent{2.00em}
\coqdocvar{list\_size} (\coqdockw{fun} \coqdocvar{st} \ensuremath{\Rightarrow} \coqdocvar{size} (\coqdocvar{fst} (\coqdocvar{B}:=\coqdocvar{term}) \coqdocvar{st})) \coqdocvar{pb2}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{wf\_size} : \coqdocvar{well\_founded} \coqdocvar{o\_list\_size}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{well\_founded}, \coqdocvar{o\_list\_size}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{pb}; \coqdoctac{apply} \coqdocvar{Acc\_intro}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{list\_size} (\coqdockw{fun} \coqdocvar{st} : \coqdocvar{term} \ensuremath{\times} \coqdocvar{term} \ensuremath{\Rightarrow} \coqdocvar{size} (\coqdocvar{fst} \coqdocvar{st})) \coqdocvar{pb}); \coqdoctac{clear} \coqdocvar{pb}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{n}; \coqdoctac{induction} \coqdocvar{n} \coqdockw{as} [ \ensuremath{|} \coqdocvar{n}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{y} \coqdocvar{Abs}; \coqdocvar{absurd} (\coqdocvar{list\_size} (\coqdockw{fun} \coqdocvar{st} : \coqdocvar{term} \ensuremath{\times} \coqdocvar{term} \ensuremath{\Rightarrow} \coqdocvar{size} (\coqdocvar{fst} \coqdocvar{st})) \coqdocvar{y} < 0); \coqdoctac{auto} \coqdockw{with} \coqdocvar{arith}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{y} \coqdocvar{Sy}; \coqdoctac{inversion} \coqdocvar{Sy}; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Acc\_intro}; \coqdoctac{intros} \coqdocvar{x} \coqdocvar{Sx}; \coqdoctac{apply} \coqdocvar{IHn}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{IHn}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_call1} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{patt} \coqdocvar{subj} \coqdocvar{pb}, \coqdocvar{o\_list\_size} \coqdocvar{pb} ((\coqdocvar{patt}, \coqdocvar{subj}) :: \coqdocvar{pb}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{patt} \coqdocvar{sibj} \coqdocvar{pb};\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{o\_list\_size}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{pattern} (\coqdocvar{list\_size} (\coqdockw{fun} \coqdocvar{st} : \coqdocvar{term} \ensuremath{\times} \coqdocvar{term} \ensuremath{\Rightarrow} \coqdocvar{size} (\coqdocvar{fst} \coqdocvar{st})) \coqdocvar{pb}); \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{plus\_O\_n}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{plus\_lt\_compat\_r}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{lt}; \coqdoctac{apply} \coqdocvar{size\_ge\_one}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_call2} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{pat} \coqdocvar{sub} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}, \coqdoceol
\coqdocindent{2.50em}
\coqdocvar{o\_list\_size} ((\coqdocvar{pat},\coqdocvar{sub}) :: \coqdocvar{nil}) ((\coqdocvar{Term} \coqdocvar{f} (\coqdocvar{pat} :: \coqdocvar{lpat}), \coqdocvar{Term} \coqdocvar{g} (\coqdocvar{sub} :: \coqdocvar{lsub})) :: \coqdocvar{pb}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{pat} \coqdocvar{sub} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}; \coqdoctac{unfold} \coqdocvar{o\_list\_size}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{auto} \coqdockw{with} \coqdocvar{arith}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_call3} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{pat} \coqdocvar{sub} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}, \coqdoceol
\coqdocindent{2.50em}
\coqdocvar{o\_list\_size} ((\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}, \coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}):: \coqdocvar{pb}) ((\coqdocvar{Term} \coqdocvar{f} (\coqdocvar{pat} :: \coqdocvar{lpat}), \coqdocvar{Term} \coqdocvar{g} (\coqdocvar{sub} :: \coqdocvar{lsub})) :: \coqdocvar{pb}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{pat} \coqdocvar{sub} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}; \coqdoctac{unfold} \coqdocvar{o\_list\_size}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{lt\_n\_S}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{plus\_assoc}.\coqdoceol
\coqdocindent{0.50em}
\coqdoctac{pattern} ((\coqdockw{fix} \coqdocvar{size\_list} (\coqdocvar{l} : \coqdocvar{list} \coqdocvar{term}) : \coqdocvar{nat} :=\coqdoceol
\coqdocindent{1.50em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{1.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} 0\coqdoceol
\coqdocindent{1.50em}
\ensuremath{|} \coqdocvar{t} :: \coqdocvar{lt} \ensuremath{\Rightarrow} \coqdocvar{size} \coqdocvar{t} + \coqdocvar{size\_list} \coqdocvar{lt}\coqdoceol
\coqdocindent{1.50em}
\coqdockw{end}) \coqdocvar{lpat} + \coqdocvar{list\_size} (\coqdockw{fun} \coqdocvar{st} : \coqdocvar{term} \ensuremath{\times} \coqdocvar{term} \ensuremath{\Rightarrow} \coqdocvar{size} (\coqdocvar{fst} \coqdocvar{st})) \coqdocvar{pb});\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{plus\_O\_n}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{plus\_lt\_compat\_r}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{lt}; \coqdoctac{apply} \coqdocvar{size\_ge\_one}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsubsection{Definition of a step of matching.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{F\_matching}:\coqdoceol
\coqdocindent{1.50em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{pb} (\coqdocvar{mrec} : \coqdockw{\ensuremath{\forall}} \coqdocvar{p}, \coqdocvar{o\_list\_size} \coqdocvar{p} \coqdocvar{pb} \ensuremath{\rightarrow} \coqdocvar{option} \coqdocvar{substitution}),\coqdoceol
\coqdocindent{1.50em}
\coqdocvar{option} \coqdocvar{substitution}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} [\coqdocvar{patt} \coqdocvar{subj}] \coqdocvar{pb}] \coqdocvar{mrec}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} (\coqdocvar{Some} \coqdocvar{nil}).\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Size} := \coqdocvar{matching\_call1} \coqdocvar{patt} \coqdocvar{subj} \coqdocvar{pb}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{patt} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{set} (\coqdocvar{o\_subst} := \coqdocvar{mrec} \coqdocvar{\_} \coqdocvar{Size}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{o\_subst} \coqdockw{as} [\coqdoctac{subst} \ensuremath{|} \coqdocvar{None}].\coqdoceol
\coqdocnoindent
\coqdoctac{exact} (\coqdocvar{merge} \coqdocvar{eq\_var\_bool} \coqdocvar{eq\_bool} ((\coqdocvar{x},\coqdocvar{subj}) :: \coqdocvar{nil}) \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{subj} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{g} \coqdocvar{m}].\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}); [\coqdoctac{intro} \coqdocvar{f\_eq\_g} \ensuremath{|} \coqdoctac{intro} \coqdocvar{f\_diff\_g}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{pat} \coqdocvar{lpat}]; \coqdoctac{destruct} \coqdocvar{m} \coqdockw{as} [ \ensuremath{|} \coqdocvar{sub} \coqdocvar{lsub}].\coqdoceol
\coqdocnoindent
\coqdoctac{set} (\coqdocvar{o\_subst} := \coqdocvar{mrec} \coqdocvar{\_} \coqdocvar{Size}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{o\_subst} \coqdockw{as} [\coqdoctac{subst} \ensuremath{|} \coqdocvar{None}].\coqdoceol
\coqdocnoindent
\coqdoctac{exact} (\coqdocvar{Some} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Size1} := \coqdocvar{matching\_call2} \coqdocvar{pat} \coqdocvar{sub} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}).\coqdoceol
\coqdocnoindent
\coqdoctac{set} (\coqdocvar{o\_subst1} := \coqdocvar{mrec} \coqdocvar{\_} \coqdocvar{Size1}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{o\_subst1} \coqdockw{as} [\coqdocvar{subst1} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Size2} :=\coqdocvar{matching\_call3} \coqdocvar{pat} \coqdocvar{sub} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}).\coqdoceol
\coqdocnoindent
\coqdoctac{set} (\coqdocvar{o\_subst2} := \coqdocvar{mrec} \coqdocvar{\_} \coqdocvar{Size2}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{o\_subst2} \coqdockw{as} [\coqdocvar{subst2} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{exact} (\coqdocvar{merge} \coqdocvar{eq\_var\_bool} \coqdocvar{eq\_bool} \coqdocvar{subst1} \coqdocvar{subst2}).\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdoctac{exact} \coqdocvar{None}.\coqdoceol
\coqdocnoindent
\coqdockw{Defined}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsubsection{Definition of matching.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Definition} \coqdocvar{matching} : \coqdocvar{list} (\coqdocvar{term} \ensuremath{\times} \coqdocvar{term}) \ensuremath{\rightarrow} \coqdocvar{option} \coqdocvar{substitution} :=\coqdoceol
\coqdocnoindent
\coqdockw{Fix} \coqdocvar{wf\_size} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{option} \coqdocvar{substitution}) \coqdocvar{F\_matching}.\coqdoceol
\coqdocemptyline
\end{coqdoccode}
\subsubsection{A more practical equivalent definition of matching.}

\begin{coqdoccode}
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_unfold} : \coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{l} : \coqdocvar{list} (\coqdocvar{term}\ensuremath{\times}\coqdocvar{term}), \coqdocvar{matching} \coqdocvar{l} = @\coqdocvar{F\_matching} \coqdocvar{l} (\coqdockw{fun} \coqdocvar{y} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{matching} \coqdocvar{y}).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{lpb}; \coqdoctac{unfold} \coqdocvar{matching}.\coqdoceol
\coqdocnoindent
\coqdoctac{refine} (\coqdocvar{Fix\_eq} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{lpb}).\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{lpb}; \coqdoctac{intros} \coqdocvar{lpb} \coqdocvar{F} \coqdocvar{G} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{unfold} \coqdocvar{F\_matching}; \coqdoctac{destruct} \coqdocvar{lpb} \coqdockw{as} [ \ensuremath{|} [\coqdocvar{patt} \coqdocvar{subj}] \coqdocvar{lpb}]; \coqdoctac{simpl}; \coqdoctac{auto}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{patt} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}]; \coqdoctac{destruct} \coqdocvar{subj} \coqdockw{as} [\coqdocvar{y} \ensuremath{|} \coqdocvar{g} \coqdocvar{m}]; \coqdoctac{simpl}; \coqdoctac{auto}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{pat} \coqdocvar{lpat}]; \coqdoctac{destruct} \coqdocvar{m} \coqdockw{as} [ \ensuremath{|} \coqdocvar{sub} \coqdocvar{lsub}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{do} 2 \coqdoctac{rewrite} \coqdocvar{H}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_unfold2} : \coqdockw{\ensuremath{\forall}} \coqdocvar{pb},\coqdoceol
\coqdocindent{1.00em}
\coqdocvar{matching} \coqdocvar{pb} =\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{pb} \coqdockw{with}\coqdoceol
\coqdocindent{1.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{Some} \coqdocvar{nil}\coqdoceol
\coqdocindent{1.50em}
\ensuremath{|} (\coqdocvar{patt}, \coqdocvar{subj}) :: \coqdocvar{pb} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{4.00em}
\coqdockw{match} \coqdocvar{patt} \coqdockw{with}\coqdoceol
\coqdocindent{4.00em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{x} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{7.50em}
\coqdockw{match} \coqdocvar{matching} \coqdocvar{pb} \coqdockw{with}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{Some} \coqdoctac{subst} \ensuremath{\Rightarrow} \coqdocvar{merge} \coqdocvar{eq\_var\_bool} \coqdocvar{eq\_bool} ((\coqdocvar{x},\coqdocvar{subj}) :: \coqdocvar{nil}) \coqdoctac{subst}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{7.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{4.50em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{6.50em}
\coqdockw{match} \coqdocvar{subj} \coqdockw{with}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{Var} \coqdocvar{\_} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{7.50em}
\ensuremath{|} \coqdocvar{Term} \coqdocvar{g} \coqdocvar{m} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{9.50em}
\coqdockw{if} \coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}\coqdoceol
\coqdocindent{9.00em}
\coqdockw{then}\coqdoceol
\coqdocindent{11.00em}
\coqdockw{match} \coqdocvar{l} \coqdockw{with}\coqdoceol
\coqdocindent{11.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow}\coqdoceol
\coqdocindent{13.00em}
\coqdockw{match} \coqdocvar{m} \coqdockw{with}\coqdoceol
\coqdocindent{13.00em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{matching} \coqdocvar{pb}\coqdoceol
\coqdocindent{13.00em}
\ensuremath{|} \coqdocvar{sub1} :: \coqdocvar{lsub} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{13.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{11.00em}
\ensuremath{|} \coqdocvar{pat1} :: \coqdocvar{lpat} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{13.50em}
\coqdockw{match} \coqdocvar{m} \coqdockw{with}\coqdoceol
\coqdocindent{13.50em}
\ensuremath{|} \coqdocvar{nil} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{13.50em}
\ensuremath{|} \coqdocvar{sub1} :: \coqdocvar{lsub} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{14.50em}
\coqdockw{match} (\coqdocvar{matching} ((\coqdocvar{pat1}, \coqdocvar{sub1}) :: \coqdocvar{nil})) \coqdockw{with}\coqdoceol
\coqdocindent{15.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{subst1} \ensuremath{\Rightarrow} \coqdoceol
\coqdocindent{17.00em}
\coqdockw{match}  (\coqdocvar{matching} ((\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}, \coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}) :: \coqdocvar{pb})) \coqdockw{with}\coqdoceol
\coqdocindent{17.00em}
\ensuremath{|} \coqdocvar{Some} \coqdoctac{subst} \ensuremath{\Rightarrow} \coqdocvar{merge} \coqdocvar{eq\_var\_bool} \coqdocvar{eq\_bool} \coqdocvar{subst1} \coqdoctac{subst}\coqdoceol
\coqdocindent{17.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{17.00em}
\coqdockw{end} \coqdoceol
\coqdocindent{15.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{None}\coqdoceol
\coqdocindent{15.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{13.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{11.00em}
\coqdockw{end}\coqdoceol
\coqdocindent{9.00em}
\coqdockw{else} \coqdocvar{None}\coqdoceol
\coqdocindent{7.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{4.50em}
\coqdockw{end}\coqdoceol
\coqdocindent{2.00em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{pb}; \coqdoctac{rewrite} \coqdocvar{matching\_unfold}; \coqdoctac{unfold} \coqdocvar{F\_matching}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{pb} \coqdockw{as} [ \ensuremath{|} [\coqdocvar{patt} \coqdocvar{subj}] \coqdocvar{pb}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{patt} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{subj} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{g} \coqdocvar{m}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{pat1} \coqdocvar{lpat}]; \coqdoctac{destruct} \coqdocvar{m} \coqdockw{as} [ \ensuremath{|} \coqdocvar{sub1} \coqdocvar{lsub}]; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{matching} \coqdocvar{pb}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_correct\_aux} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{pb} \coqdocvar{sigma}, \coqdocvar{matching} \coqdocvar{pb} = \coqdocvar{Some} \coqdocvar{sigma} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{5.50em}
((\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{t1}, \coqdocvar{In} (\coqdocvar{v},\coqdocvar{t1}) \coqdocvar{sigma} \ensuremath{\leftrightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} = \coqdocvar{Some} \coqdocvar{t1}) \ensuremath{\land}\coqdoceol
\coqdocindent{6.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p}) \ensuremath{\rightarrow} \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} \ensuremath{\not=} \coqdocvar{None}) \ensuremath{\land}\coqdoceol
\coqdocindent{6.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} \ensuremath{\not=} \coqdocvar{None} \ensuremath{\rightarrow} \coqdoceol
\coqdocindent{16.50em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{p}, \coqdoctac{\ensuremath{\exists}} \coqdocvar{s}, \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\land} \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p})) \ensuremath{\land}\coqdoceol
\coqdocindent{6.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{p} = \coqdocvar{s})).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Rt} : \coqdocvar{reflexive} \coqdocvar{\_} (@\coqdocvar{eq} \coqdocvar{term})).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{a}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{change\_hyp} : \coqdockw{\ensuremath{\forall}} \coqdocvar{sigma}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{t1}, \coqdocvar{In} (\coqdocvar{v},\coqdocvar{t1}) \coqdocvar{sigma} \ensuremath{\leftrightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} = \coqdocvar{Some} \coqdocvar{t1})  \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{1.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{a1} \coqdocvar{a1'} \coqdocvar{b1} \coqdocvar{c1}, \coqdocvar{In} (\coqdocvar{a1},\coqdocvar{b1}) \coqdocvar{sigma} \ensuremath{\rightarrow} \coqdocvar{In} (\coqdocvar{a1'},\coqdocvar{c1}) \coqdocvar{sigma} \ensuremath{\rightarrow} \coqdocvar{eq\_var\_bool} \coqdocvar{a1} \coqdocvar{a1'} = \coqdocvar{true} \ensuremath{\rightarrow} \coqdocvar{eq\_bool} \coqdocvar{b1} \coqdocvar{c1} =\coqdocvar{true})).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{sigma} \coqdocvar{H} \coqdocvar{v} \coqdocvar{v'} \coqdocvar{t1} \coqdocvar{t2} \coqdocvar{H1} \coqdocvar{H2}; \coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{v'}) (\coqdocvar{eq\_bool\_ok} \coqdocvar{t1} \coqdocvar{t2}).\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{v'}).\coqdoceol
\coqdocnoindent
\coqdoctac{case} (\coqdocvar{eq\_bool} \coqdocvar{t1} \coqdocvar{t2}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_eq\_v'} \coqdocvar{t1\_diff\_t2}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{t1\_diff\_t2}.\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{v'}; \coqdoctac{rewrite} \coqdocvar{H} \coqdoctac{in} \coqdocvar{H1}; \coqdoctac{rewrite} \coqdocvar{H} \coqdoctac{in} \coqdocvar{H2}; \coqdoctac{rewrite} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H2}; \coqdoctac{injection} \coqdocvar{H2}; \coqdoctac{intro} \coqdocvar{H3}; \coqdoctac{exact} \coqdocvar{H3}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{Abs}; \coqdoctac{discriminate}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{pb}; \coqdoctac{pattern} \coqdocvar{pb}; \coqdoctac{apply} (\coqdocvar{well\_founded\_ind} \coqdocvar{wf\_size}); \coqdoctac{clear} \coqdocvar{pb}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} [\coqdocvar{patt} \coqdocvar{subj}] \coqdocvar{pb}] \coqdocvar{IH} \coqdocvar{sigma} \coqdocvar{H}; \coqdoctac{rewrite} \coqdocvar{matching\_unfold2} \coqdoctac{in} \coqdocvar{H}.\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{H}; \coqdoctac{clear} \coqdocvar{H}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{repeat} \coqdoctac{split}; \coqdoctac{trivial};\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{try} \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{patt} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call1} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_})).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{matching} \coqdocvar{pb}) \coqdockw{as} [\coqdoctac{subst} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{H'} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})); \coqdoctac{clear} \coqdocvar{H'}; \coqdoctac{intros} [\coqdocvar{IH1} [\coqdocvar{IH2} [\coqdocvar{IH4} \coqdocvar{IH3}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{merge\_correct} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{eq\_bool\_ok} \coqdocvar{EX.eq\_proof} \coqdocvar{Rt} ((\coqdocvar{x},\coqdocvar{subj}) :: \coqdocvar{nil}) \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H} \coqdoctac{in} \coqdocvar{H'}; \coqdoctac{destruct} \coqdocvar{H'} \coqdockw{as} [\coqdocvar{H1} [\coqdocvar{H2} \coqdocvar{H3}]].\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{t1}; \coqdoctac{split}; \coqdoctac{intro} \coqdocvar{Ht1}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'{}'} := \coqdocvar{merge\_inv} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{eq\_bool\_ok} \coqdocvar{EX.eq\_proof} \coqdocvar{Rt} ((\coqdocvar{x},\coqdocvar{subj}) :: \coqdocvar{nil}) \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H} \coqdoctac{in} \coqdocvar{H'{}'}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{find\_not\_found} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{v} \coqdocvar{t1} \coqdocvar{sigma}).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t2} \coqdocvar{F} \coqdocvar{\_}; \coqdoctac{apply} \coqdoctac{f\_equal}; \coqdoctac{symmetry}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{t1\_eq\_t2} : \coqdocvar{eq\_bool} \coqdocvar{t1} \coqdocvar{t2} = \coqdocvar{true}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H'{}'} \coqdockw{with} \coqdocvar{v} \coqdocvar{v}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{w} \coqdocvar{w'} \coqdocvar{u1} \coqdocvar{u2} [\coqdocvar{wu1\_eq\_xs} \ensuremath{|} \coqdocvar{wu1\_in\_nil}] [\coqdocvar{wu2\_eq\_xs} \ensuremath{|} \coqdocvar{wu2\_in\_nil}]; \coqdoctac{try} \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{wu1\_eq\_xs}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{wu2\_eq\_xs}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{u2} \coqdocvar{u2}); \coqdoctac{case} (\coqdocvar{eq\_bool} \coqdocvar{u2} \coqdocvar{u2}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{u2\_diff\_u2}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{u2\_diff\_u2}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{change\_hyp}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find\_mem} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{F}) \coqdockw{as} [\coqdocvar{v'} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{K1} \coqdocvar{K2}]]]]; \coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{eq\_var\_bool\_refl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{t1} \coqdocvar{t2}); \coqdoctac{rewrite} \coqdocvar{t1\_eq\_t2}; \coqdoctac{intro} \coqdocvar{Eq}; \coqdoctac{exact} \coqdocvar{Eq}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{Abs}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} (\coqdocvar{Abs} (\coqdocvar{refl\_equal} \coqdocvar{\_}) (\coqdocvar{eq\_var\_bool\_refl} \coqdocvar{v}) \coqdocvar{Ht1}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find\_mem} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{Ht1}) \coqdockw{as} [\coqdocvar{v'} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{K1} \coqdocvar{K2}]]]]; \coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} [\coqdocvar{ps\_eq\_xsubj} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_xsubj}; \coqdoctac{clear} \coqdocvar{ps\_eq\_xsubj}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{v\_in\_p} \coqdockw{as} [\coqdocvar{v\_eq\_x} \ensuremath{|} \coqdocvar{v\_in\_nil}]; [\coqdoctac{subst} \coqdocvar{v} \ensuremath{|} \coqdocvar{contradiction}].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{H1} \coqdocvar{x} \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{eq\_var\_bool\_refl}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{IH2} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} \coqdocvar{ps\_in\_pb}).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H2} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'}) \coqdockw{as} [\coqdocvar{b'} [\coqdocvar{H'{}'} \coqdocvar{\_}]]; \coqdoctac{rewrite} \coqdocvar{H'{}'}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H'}; \coqdoctac{rewrite} \coqdocvar{H'} \coqdoctac{in} \coqdocvar{K2}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{H'}; \coqdoctac{assert} (\coqdocvar{H3v} := \coqdocvar{H3} \coqdocvar{v}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma}) \coqdockw{as} [\coqdocvar{v\_sigma} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H3v} \coqdocvar{v\_sigma} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{case1} \ensuremath{|} \coqdocvar{case2}].\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{case1}; \coqdocvar{revert} \coqdocvar{case1}; \coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{x}); \coqdoctac{case} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{x}); [\coqdoctac{intro} \coqdocvar{v\_eq\_x} \ensuremath{|} \coqdoctac{intro} \coqdocvar{v\_diff\_x}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{v}; \coqdoctac{\ensuremath{\exists}} (\coqdocvar{Var} \coqdocvar{x}); \coqdoctac{\ensuremath{\exists}} \coqdocvar{subj}; \coqdoctac{split}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IH4} \coqdocvar{v}) \coqdockw{as} [\coqdocvar{p} [\coqdocvar{s} [\coqdocvar{ps\_in\_pb} \coqdocvar{v\_in\_p}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{proj2} \coqdocvar{case2}); \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{p}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{s}; \coqdoctac{split}; \coqdoctac{trivial}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{s} [\coqdocvar{ps\_eq\_xsubj} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K1} := \coqdocvar{H1} \coqdocvar{x} \coqdocvar{subj}).\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_xsubj}; \coqdoctac{clear} \coqdocvar{ps\_eq\_xsubj}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{K1}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{eq\_var\_bool\_refl}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} : \coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p}) \ensuremath{\rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst} \ensuremath{\not=} \coqdocvar{None}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_p}; \coqdoctac{apply} \coqdocvar{IH2} \coqdockw{with} \coqdocvar{p} \coqdocvar{s}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{KK2} : \coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p}) \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdoctac{subst} (\coqdocvar{Var} \coqdocvar{v}) = \coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{Var} \coqdocvar{v})).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_p}; \coqdoctac{generalize} (\coqdocvar{K2} \coqdocvar{v} \coqdocvar{v\_in\_p}) (\coqdocvar{H2} \coqdocvar{v}); \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}) \coqdockw{as} [\coqdocvar{v\_subst} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{K2}; \coqdoctac{intros} \coqdocvar{\_} \coqdocvar{K2}; \coqdoctac{destruct} (\coqdocvar{K2} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{K4}]].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{K3}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{v\_subst} \coqdocvar{b}); \coqdoctac{rewrite} \coqdocvar{K4}; \coqdoctac{intro} \coqdocvar{K5}; \coqdoctac{exact} \coqdocvar{K5}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} (\coqdocvar{IH3} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{ps\_in\_pb}).\coqdoceol
\coqdocnoindent
\coqdoctac{symmetry}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} \coqdocvar{KK2}; \coqdoctac{clear} \coqdocvar{s} \coqdocvar{ps\_in\_pb} \coqdocvar{K2} \coqdocvar{KK2}; \coqdoctac{pattern} \coqdocvar{p}; \coqdoctac{apply} \coqdocvar{term\_rec3}; \coqdoctac{clear} \coqdocvar{p}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{KK2}; \coqdoctac{apply} \coqdocvar{KK2}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{f} \coqdocvar{l} \coqdocvar{IHl} \coqdocvar{KK2}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{IHl'} : \coqdockw{\ensuremath{\forall}} \coqdocvar{t}, \coqdocvar{In} \coqdocvar{t} \coqdocvar{l} \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdoctac{subst} \coqdocvar{t} = \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{t}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t} \coqdocvar{t\_in\_l}; \coqdoctac{apply} \coqdocvar{IHl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_t}; \coqdoctac{apply} \coqdocvar{KK2}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{In\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{t\_in\_l}) \coqdockw{as} [\coqdocvar{l1} [\coqdocvar{l2} \coqdocvar{H'}]]; \coqdoctac{subst} \coqdocvar{l}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (@\coqdocvar{var\_in\_subterm} \coqdocvar{v} \coqdocvar{t} (\coqdocvar{Term} \coqdocvar{f} (\coqdocvar{l1} ++ \coqdocvar{t} :: \coqdocvar{l2})) (\coqdocvar{length} \coqdocvar{l1} :: \coqdocvar{nil})); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{f} \coqdocvar{l})).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{map\_eq}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{subj} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{g} \coqdocvar{m}].\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{F.Symb.eq\_bool\_ok} \coqdocvar{f} \coqdocvar{g}); \coqdocvar{revert} \coqdocvar{H}; \coqdoctac{case} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}); [\coqdoctac{intros} \coqdocvar{H} \coqdocvar{f\_eq\_g} \ensuremath{|} \coqdoctac{intros} \coqdocvar{H} \coqdocvar{f\_diff\_g}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{pat1} \coqdocvar{lpat}]; \coqdoctac{destruct} \coqdocvar{m} \coqdockw{as} [ \ensuremath{|} \coqdocvar{sub1} \coqdocvar{lsub}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call1} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_}) \coqdocvar{sigma} \coqdocvar{H}) \coqdockw{as} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{H4} \coqdocvar{H3}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{split}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} [\coqdocvar{ps\_eq\_ff} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_ff}; \coqdoctac{intros}; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H2} \coqdockw{with} \coqdocvar{p} \coqdocvar{s}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{H'}; \coqdoctac{destruct} (\coqdocvar{H4} \coqdocvar{\_} \coqdocvar{H'}) \coqdockw{as} [\coqdocvar{p} [\coqdocvar{s} [\coqdocvar{ps\_in\_pb} \coqdocvar{v\_in\_p}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{p}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{s}; \coqdoctac{split}; \coqdoctac{trivial}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{s} [\coqdocvar{ps\_eq\_ff} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_ff}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{simpl}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H3}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call2} \coqdocvar{pat1} \coqdocvar{sub1} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{matching} ((\coqdocvar{pat1},\coqdocvar{sub1}) :: \coqdocvar{nil})) \coqdockw{as} [\coqdocvar{subst1} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{H'} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})); \coqdoctac{clear} \coqdocvar{H'}; \coqdoctac{intros} [\coqdocvar{IH1} [\coqdocvar{IH2} [\coqdocvar{IH4} \coqdocvar{IH3}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call3} \coqdocvar{pat1} \coqdocvar{sub1} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{matching} ((\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}, \coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}) :: \coqdocvar{pb})) \coqdockw{as} [\coqdoctac{subst} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{H'} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})); \coqdoctac{clear} \coqdocvar{H'}; \coqdoctac{intros} [\coqdocvar{IH1'} [\coqdocvar{IH2'} [\coqdocvar{IH4'} \coqdocvar{IH3'}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{merge\_correct} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{eq\_bool\_ok} \coqdocvar{EX.eq\_proof} \coqdocvar{Rt} \coqdocvar{subst1} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H} \coqdoctac{in} \coqdocvar{H'}; \coqdoctac{destruct} \coqdocvar{H'} \coqdockw{as} [\coqdocvar{H1} [\coqdocvar{H2} \coqdocvar{H3}]].\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{t1}; \coqdoctac{split}; \coqdoctac{intro} \coqdocvar{Ht1}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'{}'} := \coqdocvar{merge\_inv} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{eq\_bool\_ok} \coqdocvar{EX.eq\_proof} \coqdocvar{Rt} \coqdocvar{subst1} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H} \coqdoctac{in} \coqdocvar{H'{}'}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{find\_not\_found} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{v} \coqdocvar{t1} \coqdocvar{sigma}).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{t2} \coqdocvar{F} \coqdocvar{\_}; \coqdoctac{apply} \coqdoctac{f\_equal}; \coqdoctac{symmetry}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{t1\_eq\_t2} : \coqdocvar{eq\_bool} \coqdocvar{t1} \coqdocvar{t2} = \coqdocvar{true}).\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H'{}'} \coqdockw{with} \coqdocvar{v} \coqdocvar{v}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{change\_hyp}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{change\_hyp}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find\_mem} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{F}) \coqdockw{as} [\coqdocvar{v'} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{K1} \coqdocvar{K2}]]]]; \coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{eq\_var\_bool\_refl}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{t1} \coqdocvar{t2}); \coqdoctac{rewrite} \coqdocvar{t1\_eq\_t2}; \coqdoctac{intro} \coqdocvar{Eq}; \coqdoctac{exact} \coqdocvar{Eq}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{\_} \coqdocvar{Abs}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} (\coqdocvar{Abs} (\coqdocvar{refl\_equal} \coqdocvar{\_}) (\coqdocvar{eq\_var\_bool\_refl} \coqdocvar{v}) \coqdocvar{Ht1}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find\_mem} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{Ht1}) \coqdockw{as} [\coqdocvar{v'} [\coqdocvar{l1} [\coqdocvar{l2} [\coqdocvar{K1} \coqdocvar{K2}]]]]; \coqdoctac{subst}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{left}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} [\coqdocvar{ps\_eq\_patsub} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{clear} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{v\_in\_p}; \coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_in\_p}) \coqdockw{as} [\coqdocvar{v\_in\_pat1} \ensuremath{|} \coqdocvar{v\_in\_lpat}].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{IH2} \coqdocvar{v} \coqdocvar{pat1} \coqdocvar{sub1} \coqdocvar{v\_in\_pat1} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{subst1}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{H1} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'}); \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H'}; \coqdoctac{rewrite} \coqdocvar{H'} \coqdoctac{in} \coqdocvar{K2}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{IH2'} \coqdocvar{v} (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{lpat}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}) \coqdocvar{v\_in\_lpat} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H2} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'}) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{\_}]]; \coqdoctac{rewrite} \coqdocvar{K3}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H'}; \coqdoctac{rewrite} \coqdocvar{H'} \coqdoctac{in} \coqdocvar{K2}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{IH2'} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} (\coqdocvar{or\_intror} \coqdocvar{\_} \coqdocvar{ps\_in\_pb})).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H2} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'}) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{\_}]]; \coqdoctac{rewrite} \coqdocvar{K3}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H'}; \coqdoctac{rewrite} \coqdocvar{H'} \coqdoctac{in} \coqdocvar{K2}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{H'}; \coqdoctac{assert} (\coqdocvar{H3v} := \coqdocvar{H3} \coqdocvar{v}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma}) \coqdockw{as} [\coqdocvar{v\_sigma} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{H3v} \coqdocvar{v\_sigma} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{case1} \ensuremath{|} \coqdocvar{case2}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IH4} \coqdocvar{v}) \coqdockw{as} [\coqdocvar{p} [\coqdocvar{s} [\coqdocvar{ps\_in\_pb} \coqdocvar{v\_in\_p}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{case1}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{Term} \coqdocvar{f} (\coqdocvar{pat1} :: \coqdocvar{lpat})); \coqdoctac{\ensuremath{\exists}} (\coqdocvar{Term} \coqdocvar{g} (\coqdocvar{sub1} :: \coqdocvar{lsub})); \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{ps\_in\_pb} \coqdockw{as} [\coqdocvar{ps\_eq\_pat1sub1} \ensuremath{|} \coqdocvar{ps\_in\_nil}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_pat1sub1}; \coqdoctac{clear} \coqdocvar{ps\_eq\_pat1sub1}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{p} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{IH4'} \coqdocvar{v}) \coqdockw{as} [\coqdocvar{p} [\coqdocvar{s} [\coqdocvar{ps\_in\_pb} \coqdocvar{v\_in\_p}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} (\coqdocvar{proj2} \coqdocvar{case2}); \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{ps\_in\_pb} \coqdockw{as} [\coqdocvar{ps\_eq\_patsub} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} (\coqdocvar{Term} \coqdocvar{f} (\coqdocvar{pat1} :: \coqdocvar{lpat})); \coqdoctac{\ensuremath{\exists}} (\coqdocvar{Term} \coqdocvar{g} (\coqdocvar{sub1} :: \coqdocvar{lsub})); \coqdoctac{split}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{clear} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{p} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{apply} \coqdocvar{in\_or\_app}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{\ensuremath{\exists}} \coqdocvar{p}; \coqdoctac{\ensuremath{\exists}} \coqdocvar{s}; \coqdoctac{split}; \coqdoctac{trivial}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{s} [\coqdocvar{ps\_eq\_patsub} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{clear} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{replace} (\coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{pat1}) \coqdockw{with} \coqdocvar{sub1}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdoctac{f\_equal} (\coqdockw{fun} \coqdocvar{l} \ensuremath{\Rightarrow} \coqdocvar{Term} \coqdocvar{g} (\coqdocvar{sub1} :: \coqdocvar{l}))).\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{IH3'} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{injection} \coqdocvar{K}; \coqdoctac{clear} \coqdocvar{K}; \coqdoctac{intro} \coqdocvar{K}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{K}; \coqdoctac{symmetry}; \coqdoctac{apply} \coqdocvar{map\_eq}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{p\_in\_lpat}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{subst\_eq\_vars}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} : \coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p}) \ensuremath{\rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst} \ensuremath{\not=} \coqdocvar{None}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_p}; \coqdoctac{apply} \coqdocvar{IH2'} \coqdockw{with} (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{lpat}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{In\_split} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{p\_in\_lpat}) \coqdockw{as} [\coqdocvar{lpat1} [\coqdocvar{lpat2} \coqdocvar{H'}]]; \coqdoctac{subst} \coqdocvar{lpat}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (@\coqdocvar{var\_in\_subterm} \coqdocvar{v} \coqdocvar{p} (\coqdocvar{Term} \coqdocvar{g} (\coqdocvar{lpat1} ++ \coqdocvar{p} :: \coqdocvar{lpat2})) (\coqdocvar{length} \coqdocvar{lpat1} :: \coqdocvar{nil})); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{nth\_error\_at\_pos}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_p}; \coqdoctac{generalize} (\coqdocvar{K2} \coqdocvar{v} \coqdocvar{v\_in\_p}) (\coqdocvar{H2} \coqdocvar{v}); \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}) \coqdockw{as} [\coqdocvar{v\_subst} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{K2}; \coqdoctac{intros} \coqdocvar{\_} \coqdocvar{K2}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{K2} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{K4}]]; \coqdoctac{rewrite} \coqdocvar{K3};  \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{v\_subst} \coqdocvar{b}); \coqdoctac{rewrite} \coqdocvar{K4}; \coqdoctac{intro} \coqdocvar{K5}; \coqdoctac{exact} \coqdocvar{K5}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{IH3} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{K}; \coqdoctac{symmetry}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{subst\_eq\_vars}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} : \coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{pat1}) \ensuremath{\rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{subst1} \ensuremath{\not=} \coqdocvar{None}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_pat1}; \coqdoctac{apply} \coqdocvar{IH2} \coqdockw{with} \coqdocvar{pat1} \coqdocvar{sub1}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{left}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_pat1}; \coqdoctac{generalize} (\coqdocvar{K2} \coqdocvar{v} \coqdocvar{v\_in\_pat1}) (\coqdocvar{H1} \coqdocvar{v}); \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{subst1}) \coqdockw{as} [\coqdocvar{v\_subst1} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{K2}; \coqdoctac{intros} \coqdocvar{\_} \coqdocvar{K2}; \coqdoctac{rewrite} (\coqdocvar{K2} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} (\coqdocvar{IH3'} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_intror} \coqdocvar{\_} \coqdocvar{ps\_in\_pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{symmetry}; \coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{subst\_eq\_vars}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K2} : \coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p}) \ensuremath{\rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst} \ensuremath{\not=} \coqdocvar{None}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_p}; \coqdoctac{apply} \coqdocvar{IH2'} \coqdockw{with} \coqdocvar{p} \coqdocvar{s}; \coqdoctac{trivial}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{v\_in\_p}; \coqdoctac{generalize} (\coqdocvar{K2} \coqdocvar{v} \coqdocvar{v\_in\_p}) (\coqdocvar{H2} \coqdocvar{v}); \coqdoctac{simpl}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}) \coqdockw{as} [\coqdocvar{v\_subst} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{K2}; \coqdoctac{intros} \coqdocvar{\_} \coqdocvar{K2}; \coqdoctac{destruct} (\coqdocvar{K2} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_})) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{K4}]]; \coqdoctac{rewrite} \coqdocvar{K3}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{v\_subst} \coqdocvar{b}); \coqdoctac{rewrite} \coqdocvar{K4}; \coqdoctac{intro} \coqdocvar{K5}; \coqdoctac{exact} \coqdocvar{K5}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_correct} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{pb} \coqdocvar{sigma}, \coqdocvar{matching} \coqdocvar{pb} = \coqdocvar{Some} \coqdocvar{sigma} \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{6.00em}
((\coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p}) \ensuremath{\rightarrow} \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\rightarrow} \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} \ensuremath{\not=} \coqdocvar{None}) \ensuremath{\land}\coqdoceol
\coqdocindent{5.50em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{v}, \coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{sigma} \ensuremath{\not=} \coqdocvar{None} \ensuremath{\rightarrow} \coqdoceol
\coqdocindent{16.50em}
\coqdoctac{\ensuremath{\exists}} \coqdocvar{p}, \coqdoctac{\ensuremath{\exists}} \coqdocvar{s}, \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\land} \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p})) \ensuremath{\land}\coqdoceol
\coqdocindent{6.00em}
(\coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{p} = \coqdocvar{s})).\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{pb} \coqdocvar{sigma} \coqdocvar{H}; \coqdoctac{generalize} (\coqdocvar{matching\_correct\_aux} \coqdocvar{pb} \coqdocvar{H}); \coqdoctac{intuition}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Lemma} \coqdocvar{matching\_complete} :\coqdoceol
\coqdocindent{1.00em}
\coqdockw{\ensuremath{\forall}} \coqdocvar{pb} \coqdocvar{sigma}, (\coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{p} = \coqdocvar{s}) \ensuremath{\rightarrow}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{match} \coqdocvar{matching} \coqdocvar{pb} \coqdockw{with}\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{Some} \coqdocvar{tau} \ensuremath{\Rightarrow} \coqdockw{\ensuremath{\forall}} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} \coqdocvar{v} (\coqdocvar{var\_list} \coqdocvar{p}) \ensuremath{\rightarrow} \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) \coqdocvar{pb} \ensuremath{\rightarrow} \coqdoceol
\coqdocindent{18.00em}
\coqdocvar{apply\_subst} \coqdocvar{tau} (\coqdocvar{Var} \coqdocvar{v}) = \coqdocvar{apply\_subst} \coqdocvar{sigma} (\coqdocvar{Var} \coqdocvar{v})\coqdoceol
\coqdocindent{1.00em}
\ensuremath{|} \coqdocvar{None} \ensuremath{\Rightarrow} \coqdocvar{False}\coqdoceol
\coqdocindent{1.00em}
\coqdockw{end}.\coqdoceol
\coqdocnoindent
\coqdockw{Proof}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Rt} : \coqdocvar{reflexive} \coqdocvar{\_} (@\coqdocvar{eq} \coqdocvar{term})).\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{a}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{pb}; \coqdoctac{pattern} \coqdocvar{pb}; \coqdoctac{apply} (\coqdocvar{well\_founded\_ind} \coqdocvar{wf\_size}); \coqdoctac{clear} \coqdocvar{pb}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} [ \ensuremath{|} [\coqdocvar{patt} \coqdocvar{subj}] \coqdocvar{pb}] \coqdocvar{IH} \coqdocvar{sigma} \coqdocvar{H};\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{matching\_unfold2}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{tailH} : \coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{s} : \coqdocvar{term}, \coqdocvar{In} (\coqdocvar{p}, \coqdocvar{s}) \coqdocvar{pb} \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{p} = \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros}; \coqdoctac{apply} \coqdocvar{H}; \coqdoctac{right}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Hsigma} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call1} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_}) \coqdocvar{sigma} \coqdocvar{tailH}).\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{patt} \coqdockw{as} [ \coqdocvar{x} \ensuremath{|} \coqdocvar{f} \coqdocvar{l}].\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{matching} \coqdocvar{pb}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdoctac{subst} \coqdocvar{matching\_pb\_eq\_subst}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_subst} \coqdoctac{in} \coqdocvar{Hsigma}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{matching\_correct\_aux} \coqdocvar{pb} \coqdocvar{matching\_pb\_eq\_subst}) \coqdockw{as} [\coqdocvar{C1} [\coqdocvar{C2} [\coqdocvar{C4} \coqdocvar{C3}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'{}'} := \coqdocvar{merge\_correct} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{eq\_bool\_ok} \coqdocvar{EX.eq\_proof} \coqdocvar{Rt} ((\coqdocvar{x},\coqdocvar{subj}) :: \coqdocvar{nil}) \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{merge} \coqdocvar{eq\_var\_bool} \coqdocvar{eq\_bool} ((\coqdocvar{x}, \coqdocvar{subj}) :: \coqdocvar{nil}) \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{tau} \coqdocvar{matching\_pb\_eq\_tau}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_tau} \coqdoctac{in} \coqdocvar{H'{}'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{H'{}'} \coqdockw{as} [\coqdocvar{H1} [\coqdocvar{H2} \coqdocvar{H3}]].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} [\coqdocvar{ps\_eq\_xsubj} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_xsubj}; \coqdoctac{clear} \coqdocvar{ps\_eq\_xsubj}; \coqdoctac{intros}; \coqdoctac{subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{v\_in\_p} \coqdockw{as} [\coqdocvar{v\_eq\_x} \ensuremath{|} \coqdocvar{v\_in\_nil}]; [\coqdoctac{idtac} \ensuremath{|} \coqdocvar{contradiction}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{v}; \coqdoctac{rewrite} (\coqdocvar{H} (\coqdocvar{Var} \coqdocvar{x}) \coqdocvar{s} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} (\coqdocvar{H1} \coqdocvar{x} \coqdocvar{s}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{rewrite} \coqdocvar{eq\_var\_bool\_refl}; \coqdoctac{reflexivity}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} (\coqdocvar{Hsigma} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} \coqdocvar{ps\_in\_pb}).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{C2} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} \coqdocvar{ps\_in\_pb}).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst} \coqdocvar{H'{}'}; \coqdoctac{destruct} (\coqdocvar{H2} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'{}'}) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{K4}]]; \coqdoctac{rewrite} \coqdocvar{K3}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{symmetry}; \coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{v\_subst} \coqdocvar{b}); \coqdoctac{rewrite} \coqdocvar{K4}; \coqdoctac{intro} \coqdocvar{K5}; \coqdoctac{exact} \coqdocvar{K5}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H'{}'}; \coqdoctac{rewrite} \coqdocvar{H'{}'} \coqdoctac{in} \coqdocvar{K2}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{matching\_pb\_eq\_none}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_none} \coqdoctac{in} \coqdocvar{H'{}'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{H'{}'} \coqdockw{as} [\coqdocvar{v} [\coqdocvar{v'} [\coqdocvar{t1} [\coqdocvar{t2} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{v\_eq\_v'} \coqdocvar{t1\_diff\_t2}]]]]]]].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{v'}); \coqdoctac{rewrite} \coqdocvar{v\_eq\_v'}; \coqdoctac{intro} \coqdocvar{v\_eq\_v'{}'}; \coqdoctac{subst} \coqdocvar{v'}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{t2} \coqdocvar{t1}); \coqdoctac{rewrite} \coqdocvar{t1\_diff\_t2}; \coqdoctac{clear} \coqdocvar{t1\_diff\_t2}; \coqdoctac{intro} \coqdocvar{t1\_diff\_t2}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{C1} \coqdoctac{in} \coqdocvar{H1}; \coqdoctac{rewrite} \coqdocvar{C1} \coqdoctac{in} \coqdocvar{H2}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} \coqdocvar{H1}; \coqdoctac{clear} \coqdocvar{H1}; \coqdoctac{intro} \coqdocvar{H1}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{C4} \coqdocvar{v}) \coqdockw{as} [\coqdocvar{p} [\coqdocvar{s} [\coqdocvar{ps\_in\_pb} \coqdocvar{v\_in\_p}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H2}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H1}; \coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{x}); \coqdoctac{destruct} (\coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{x}); \coqdoceol
\coqdocnoindent
[\coqdoctac{intros} \coqdocvar{v\_eq\_x} \ensuremath{|} \coqdoctac{intros} \coqdocvar{v\_diff\_x}; \coqdoctac{discriminate}].\coqdoceol
\coqdocnoindent
\coqdoctac{subst} \coqdocvar{v}; \coqdoctac{injection} \coqdocvar{H1}; \coqdoctac{clear} \coqdocvar{H1}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{subj}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Hv} := \coqdocvar{Hsigma} \coqdocvar{x} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} \coqdocvar{ps\_in\_pb}).\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Hv'} := \coqdocvar{H} (\coqdocvar{Var} \coqdocvar{x}) \coqdocvar{t1} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{Hv'} \coqdoctac{in} \coqdocvar{Hv}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{Hv}; \coqdoctac{rewrite} \coqdocvar{H2} \coqdoctac{in} \coqdocvar{Hv}; \coqdocvar{absurd} (\coqdocvar{t2} = \coqdocvar{t1}); \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H2}; \coqdoctac{apply} \coqdocvar{t1\_diff\_t2}; \coqdoctac{symmetry}; \coqdoctac{injection} \coqdocvar{H2}; \coqdoctac{intro} \coqdocvar{H3}; \coqdoctac{exact} \coqdocvar{H3}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{matching\_pb\_eq\_none}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_none} \coqdoctac{in} \coqdocvar{Hsigma}.\coqdoceol
\coqdocnoindent
\coqdoctac{elim} \coqdocvar{Hsigma}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{subj} \coqdockw{as} [\coqdocvar{x} \ensuremath{|} \coqdocvar{g} \coqdocvar{m}].\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{H} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{l}) (\coqdocvar{Var} \coqdocvar{x}) (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))); \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{eq\_symb\_bool} \coqdocvar{f} \coqdocvar{g}); [\coqdoctac{intro} \coqdocvar{f\_eq\_g} \ensuremath{|} \coqdoctac{intro} \coqdocvar{f\_diff\_g}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{l} \coqdockw{as} [ \ensuremath{|} \coqdocvar{pat1} \coqdocvar{lpat}]; \coqdoctac{destruct} \coqdocvar{m} \coqdockw{as} [ \ensuremath{|} \coqdocvar{sub1} \coqdocvar{lsub}].\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{matching} \coqdocvar{pb}) \coqdockw{as} [\coqdocvar{tau} \ensuremath{|} ].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} [\coqdocvar{ps\_eq\_ff} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_ff}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{v\_in\_p}; \coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{Hsigma} \coqdockw{with} \coqdocvar{p} \coqdocvar{s}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{H} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{nil}) (\coqdocvar{Term} \coqdocvar{g} (\coqdocvar{sub1} :: \coqdocvar{lsub})) (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))); \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{H} (\coqdocvar{Term} \coqdocvar{f} (\coqdocvar{pat1} :: \coqdocvar{lpat})) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{nil}) (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))); \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call2} \coqdocvar{pat1} \coqdocvar{sub1} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Correct} := \coqdocvar{matching\_correct\_aux} ((\coqdocvar{pat1},\coqdocvar{sub1}) :: \coqdocvar{nil})).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{matching} ((\coqdocvar{pat1},\coqdocvar{sub1}) :: \coqdocvar{nil})).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{subst1} \coqdocvar{matching\_pat1sub1\_eq\_subst1}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{Correct} \coqdocvar{\_} \coqdocvar{matching\_pat1sub1\_eq\_subst1}) \coqdockw{as}  [\coqdocvar{C1} [\coqdocvar{C2} [\coqdocvar{C4} \coqdocvar{C3}]]]; \coqdoctac{clear} \coqdocvar{Correct}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'{}'} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call3} \coqdocvar{pat1} \coqdocvar{sub1} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Correct'} := \coqdocvar{matching\_correct\_aux} ((\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}, \coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}) :: \coqdocvar{pb})).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{matching} ((\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}, \coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}) :: \coqdocvar{pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdoctac{subst} \coqdocvar{matching\_pb\_eq\_subst}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{Correct'} \coqdocvar{\_} \coqdocvar{matching\_pb\_eq\_subst}) \coqdockw{as}  [\coqdocvar{C1'} [\coqdocvar{C2'} [\coqdocvar{C4'} \coqdocvar{C3'}]]]; \coqdoctac{clear} \coqdocvar{Correct'}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H'{}'{}'} := \coqdocvar{merge\_correct} \coqdocvar{\_} \coqdocvar{X.eq\_bool\_ok} \coqdocvar{\_} \coqdocvar{eq\_bool\_ok} \coqdocvar{EX.eq\_proof} \coqdocvar{Rt} \coqdocvar{subst1} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{headH} : \coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) ((\coqdocvar{pat1},\coqdocvar{sub1}) :: \coqdocvar{nil}) \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{p} = \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{s} [\coqdocvar{ps\_eq\_pat1sub1} \ensuremath{|} \coqdocvar{ps\_in\_nil}]; [\coqdoctac{idtac} \ensuremath{|} \coqdocvar{contradiction}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_pat1sub1}; \coqdoctac{clear} \coqdocvar{ps\_eq\_pat1sub1}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{p} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{H} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{injection} \coqdocvar{K}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{Hsigma1} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call2}  \coqdocvar{pat1} \coqdocvar{sub1} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}) \coqdocvar{sigma} \coqdocvar{headH}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{matching\_pat1sub1\_eq\_subst1} \coqdoctac{in} \coqdocvar{Hsigma1}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{tailH}; \coqdoctac{assert} (\coqdocvar{tailH} : \coqdockw{\ensuremath{\forall}} \coqdocvar{p} \coqdocvar{s}, \coqdocvar{In} (\coqdocvar{p},\coqdocvar{s}) ((\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}, \coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub}) :: \coqdocvar{pb}) \ensuremath{\rightarrow} \coqdocvar{apply\_subst} \coqdocvar{sigma} \coqdocvar{p} = \coqdocvar{s}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{s} [\coqdocvar{ps\_eq\_patsub} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{clear} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{p} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{H} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{injection} \coqdocvar{K}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{clear} \coqdocvar{Hsigma}; \coqdoctac{assert} (\coqdocvar{Hsigma} := \coqdocvar{IH} \coqdocvar{\_} (\coqdocvar{matching\_call3}  \coqdocvar{pat1} \coqdocvar{sub1} \coqdocvar{f} \coqdocvar{lpat} \coqdocvar{g} \coqdocvar{lsub} \coqdocvar{pb}) \coqdocvar{sigma} \coqdocvar{tailH}).\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_subst} \coqdoctac{in} \coqdocvar{Hsigma}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{merge} \coqdocvar{eq\_var\_bool} \coqdocvar{eq\_bool} \coqdocvar{subst1} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{tau} \coqdocvar{matching\_pb\_eq\_tau}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_tau} \coqdoctac{in} \coqdocvar{H'{}'{}'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{H'{}'{}'} \coqdockw{as} [\coqdocvar{H1} [\coqdocvar{H2} \coqdocvar{H3}]].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} [\coqdocvar{ps\_eq\_pat\_sub} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_pat\_sub}; \coqdoctac{clear} \coqdocvar{ps\_eq\_pat\_sub}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{p} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{var\_list\_unfold} \coqdoctac{in} \coqdocvar{v\_in\_p}; \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{v\_in\_p}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{in\_app\_or} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_in\_p}) \coqdockw{as} [\coqdocvar{v\_in\_pat1} \ensuremath{|} \coqdocvar{v\_in\_lpat}]; \coqdoctac{clear} \coqdocvar{v\_in\_p}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} (\coqdocvar{Hsigma1} \coqdocvar{v} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_in\_pat1} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{C2} \coqdocvar{v} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{v\_in\_pat1} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdocvar{subst1}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst1} \coqdocvar{H'{}'{}'}; \coqdoctac{rewrite} (\coqdocvar{H1} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'{}'{}'}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H'{}'{}'}; \coqdoctac{rewrite} \coqdocvar{H'{}'{}'} \coqdoctac{in} \coqdocvar{K2}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{Hsigma} \coqdocvar{v} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub})).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{generalize} (\coqdocvar{K} \coqdocvar{v\_in\_lpat} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))); \coqdoctac{clear} \coqdocvar{K}; \coqdoctac{intro} \coqdocvar{K}.\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{C2'} \coqdocvar{v} (\coqdocvar{Term} \coqdocvar{f} \coqdocvar{lpat}) (\coqdocvar{Term} \coqdocvar{g} \coqdocvar{lsub})).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K2}; \coqdoctac{generalize} (\coqdocvar{K2} \coqdocvar{v\_in\_lpat} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))); \coqdoctac{clear} \coqdocvar{K2}; \coqdoctac{intro} \coqdocvar{K2}.\coqdoceol
\coqdocnoindent
\coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}); [\coqdoctac{idtac} \ensuremath{|} \coqdoctac{intro} \coqdocvar{H'{}'{}'}; \coqdoctac{rewrite} \coqdocvar{H'{}'{}'} \coqdoctac{in} \coqdocvar{K2}; \coqdoctac{apply} \coqdocvar{False\_rec}; \coqdoctac{apply} \coqdocvar{K2}; \coqdoctac{reflexivity}].\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst} \coqdocvar{H'{}'{}'}; \coqdoctac{destruct} (\coqdocvar{H2} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'{}'{}'}) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{K4}]].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{v\_subst} \coqdocvar{b}); \coqdoctac{rewrite} \coqdocvar{K4}; \coqdoctac{clear} \coqdocvar{K4}; \coqdoctac{intro} \coqdocvar{K4}; \coqdoctac{subst} \coqdocvar{b}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H'{}'{}'} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{rewrite} \coqdocvar{K3}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{Hsigma} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} (\coqdocvar{or\_intror} \coqdocvar{\_} \coqdocvar{ps\_in\_pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl}; \coqdoctac{assert} (\coqdocvar{K2} := \coqdocvar{C2'} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} (\coqdocvar{or\_intror} \coqdocvar{\_} \coqdocvar{ps\_in\_pb})).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdocvar{case\_eq} (\coqdocvar{find} \coqdocvar{eq\_var\_bool} \coqdocvar{v} \coqdoctac{subst}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{v\_subst} \coqdocvar{H'{}'{}'}; \coqdoctac{destruct} (\coqdocvar{H2} \coqdocvar{\_} \coqdocvar{\_} \coqdocvar{H'{}'{}'}) \coqdockw{as} [\coqdocvar{b} [\coqdocvar{K3} \coqdocvar{K4}]].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{v\_subst} \coqdocvar{b}); \coqdoctac{rewrite} \coqdocvar{K4}; \coqdoctac{clear} \coqdocvar{K4}; \coqdoctac{intro} \coqdocvar{K4}; \coqdoctac{subst} \coqdocvar{b}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H'{}'{}'} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{rewrite} \coqdocvar{K3}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{H'{}'{}'}; \coqdoctac{rewrite} \coqdocvar{H'{}'{}'} \coqdoctac{in} \coqdocvar{K2}; \coqdocvar{absurd} (@\coqdocvar{None} \coqdocvar{term} = \coqdocvar{None}); \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{matching\_pb\_eq\_none}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_none} \coqdoctac{in} \coqdocvar{H'{}'{}'}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} \coqdocvar{H'{}'{}'} \coqdockw{as} [\coqdocvar{v} [\coqdocvar{v'} [\coqdocvar{t1} [\coqdocvar{t2} [\coqdocvar{H1} [\coqdocvar{H2} [\coqdocvar{v\_eq\_v'} \coqdocvar{t1\_diff\_t2}]]]]]]].\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{X.eq\_bool\_ok} \coqdocvar{v} \coqdocvar{v'}); \coqdoctac{rewrite} \coqdocvar{v\_eq\_v'}; \coqdoctac{intro} \coqdocvar{v\_eq\_v'{}'}; \coqdoctac{subst} \coqdocvar{v'}.\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{eq\_bool\_ok} \coqdocvar{t2} \coqdocvar{t1}); \coqdoctac{rewrite} \coqdocvar{t1\_diff\_t2}; \coqdoctac{clear} \coqdocvar{t1\_diff\_t2}; \coqdoctac{intro} \coqdocvar{t1\_diff\_t2}.\coqdoceol
\coqdocnoindent
\coqdoctac{case} \coqdocvar{H1}; \coqdoctac{clear} \coqdocvar{H1}; \coqdoctac{intro} \coqdocvar{H1}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{C4} \coqdocvar{v}) \coqdockw{as} [\coqdocvar{p} [\coqdocvar{s} [\coqdocvar{ps\_in\_pb} \coqdocvar{v\_in\_p}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H1}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H1v} := \coqdocvar{Hsigma1} \coqdocvar{v} \coqdocvar{p} \coqdocvar{s} \coqdocvar{v\_in\_p} \coqdocvar{ps\_in\_pb}); \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H1v}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H1v}.\coqdoceol
\coqdocnoindent
\coqdoctac{destruct} (\coqdocvar{C4'} \coqdocvar{v}) \coqdockw{as} [\coqdocvar{p'} [\coqdocvar{s'} [\coqdocvar{ps'\_in\_pb} \coqdocvar{v\_in\_p'}]]].\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{C1'} \coqdoctac{in} \coqdocvar{H2}; \coqdoctac{rewrite} \coqdocvar{H2}; \coqdoctac{discriminate}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{H2v} := \coqdocvar{Hsigma} \coqdocvar{v} \coqdocvar{p'} \coqdocvar{s'} \coqdocvar{v\_in\_p'} \coqdocvar{ps'\_in\_pb}); \coqdoctac{simpl} \coqdoctac{in} \coqdocvar{H2v}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \ensuremath{\leftarrow} \coqdocvar{H2v} \coqdoctac{in} \coqdocvar{H1v}.\coqdoceol
\coqdocnoindent
\coqdoctac{rewrite} \coqdocvar{C1'} \coqdoctac{in} \coqdocvar{H2}; \coqdoctac{rewrite} \coqdocvar{H2} \coqdoctac{in} \coqdocvar{H1v}; \coqdoctac{apply} \coqdocvar{t1\_diff\_t2}; \coqdoctac{symmetry}; \coqdoctac{assumption}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{t1\_diff\_t2}; \coqdoctac{symmetry}; \coqdoctac{rewrite} \coqdocvar{C1'} \coqdoctac{in} \coqdocvar{H1}; \coqdoctac{rewrite} \coqdocvar{C1'} \coqdoctac{in} \coqdocvar{H2}; \coqdoctac{rewrite} \coqdocvar{H1} \coqdoctac{in} \coqdocvar{H2}; \coqdoctac{injection} \coqdocvar{H2}; \coqdoctac{intro} \coqdocvar{H3}; \coqdoctac{exact} \coqdocvar{H3}.\coqdoceol
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{matching\_pb\_eq\_none}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_none} \coqdoctac{in} \coqdocvar{H'{}'}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H'{}'} \coqdocvar{sigma}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{s} [\coqdocvar{ps\_eq\_patsub} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{clear} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{p} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{H} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{injection} \coqdocvar{K}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} \coqdocvar{H}; \coqdoctac{right}; \coqdoctac{trivial}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdoctac{intro} \coqdocvar{matching\_pb\_eq\_none}; \coqdoctac{rewrite} \coqdocvar{matching\_pb\_eq\_none} \coqdoctac{in} \coqdocvar{H'}.\coqdoceol
\coqdocnoindent
\coqdoctac{apply} (\coqdocvar{H'} \coqdocvar{sigma}).\coqdoceol
\coqdocnoindent
\coqdoctac{intros} \coqdocvar{p} \coqdocvar{s} [\coqdocvar{ps\_eq\_patsub} \ensuremath{|} \coqdocvar{ps\_in\_pb}].\coqdoceol
\coqdocnoindent
\coqdoctac{injection} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{clear} \coqdocvar{ps\_eq\_patsub}; \coqdoctac{intros}; \coqdoctac{subst} \coqdocvar{p} \coqdocvar{s}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{H} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{injection} \coqdocvar{K}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdocvar{contradiction}.\coqdoceol
\coqdocnoindent
\coqdocvar{absurd} (\coqdocvar{f}=\coqdocvar{g}).\coqdoceol
\coqdocnoindent
\coqdoctac{generalize} (\coqdocvar{F.Symb.eq\_bool\_ok} \coqdocvar{f} \coqdocvar{g}); \coqdoctac{rewrite} \coqdocvar{f\_diff\_g}; \coqdoctac{intro} \coqdocvar{H3}; \coqdoctac{exact} \coqdocvar{H3}.\coqdoceol
\coqdocnoindent
\coqdoctac{assert} (\coqdocvar{K} := \coqdocvar{H} \coqdocvar{\_} \coqdocvar{\_} (\coqdocvar{or\_introl} \coqdocvar{\_} (\coqdocvar{refl\_equal} \coqdocvar{\_}))).\coqdoceol
\coqdocnoindent
\coqdoctac{simpl} \coqdoctac{in} \coqdocvar{K}; \coqdoctac{injection} \coqdocvar{K}; \coqdoctac{intros}; \coqdoctac{subst}; \coqdoctac{trivial}.\coqdoceol
\coqdocnoindent
\coqdockw{Qed}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{End} \coqdocvar{Make'}.\coqdoceol
\coqdocemptyline
\coqdocnoindent
\coqdockw{Module} \coqdocvar{Make} (\coqdocvar{F1} : \coqdocvar{Signature}) (\coqdocvar{X1} : \coqdocvar{decidable\_set.S}) : \coqdoceol
\coqdocindent{2.50em}
\coqdocvar{Term} \coqdockw{with} \coqdockw{Module} \coqdocvar{F} := \coqdocvar{F1} \coqdockw{with} \coqdockw{Module} \coqdocvar{X} := \coqdocvar{X1} := \coqdocvar{Make'} \coqdocvar{F1} \coqdocvar{X1}.\coqdoceol
\coqdocemptyline
\coqdocemptyline
\end{coqdoccode}
\end{document}
